(function(){var e={132:function(e,a,t){"use strict";e.exports=t.p+"static/img/密钥.ef7e4fca.svg"},496:function(e,a,t){"use strict";e.exports=t.p+"static/img/k8s.04eabcb3.svg"},667:function(e,a,t){"use strict";e.exports=t.p+"static/img/密码.60393752.svg"},1070:function(e,a,t){"use strict";e.exports=t.p+"static/img/putongrenwu.1ca6343a.svg"},1700:function(e,a,t){"use strict";e.exports=t.p+"static/img/版本.dcb0f63b.svg"},1733:function(e,a,t){"use strict";e.exports=t.p+"static/img/baidu.c636dfa2.svg"},1738:function(e,a,t){"use strict";e.exports=t.p+"static/img/huaweiyun.750a1d68.svg"},1873:function(e,a,t){"use strict";e.exports=t.p+"static/img/redis.7ae2361e.svg"},2172:function(e,a,t){"use strict";e.exports=t.p+"static/img/关闭文件夹.0de1b9bf.svg"},2272:function(e,a,t){"use strict";e.exports=t.p+"static/img/折叠.786d0ed0.svg"},3009:function(e,a,t){"use strict";e.exports=t.p+"static/img/dingshirenwu.2c905e33.svg"},3489:function(e,a,t){"use strict";e.exports=t.p+"static/img/zidong.c53e03c6.svg"},3878:function(e,a,t){"use strict";e.exports=t.p+"static/img/shell.d899372b.svg"},4154:function(e,a,t){"use strict";e.exports=t.p+"static/img/mysql.b127c98f.svg"},4415:function(e,a,t){"use strict";e.exports=t.p+"static/img/打开文件夹.d7004f58.svg"},4702:function(e,a,t){"use strict";e.exports=t.p+"static/img/mongodb.824fccb6.svg"},4801:function(e,a,t){"use strict";e.exports=t.p+"static/img/Elasticsearch.daf20430.svg"},4894:function(e,a,t){"use strict";e.exports=t.p+"static/img/Python.874cf848.svg"},5003:function(e,a,t){"use strict";e.exports=t.p+"static/img/renwu.e4fa20b1.svg"},5358:function(e,a,t){var l={"./af":5177,"./af.js":5177,"./ar":1509,"./ar-dz":1488,"./ar-dz.js":1488,"./ar-kw":8676,"./ar-kw.js":8676,"./ar-ly":2353,"./ar-ly.js":2353,"./ar-ma":4496,"./ar-ma.js":4496,"./ar-ps":6947,"./ar-ps.js":6947,"./ar-sa":2682,"./ar-sa.js":2682,"./ar-tn":9756,"./ar-tn.js":9756,"./ar.js":1509,"./az":5533,"./az.js":5533,"./be":8959,"./be.js":8959,"./bg":7777,"./bg.js":7777,"./bm":4903,"./bm.js":4903,"./bn":1290,"./bn-bd":7357,"./bn-bd.js":7357,"./bn.js":1290,"./bo":1545,"./bo.js":1545,"./br":1470,"./br.js":1470,"./bs":4429,"./bs.js":4429,"./ca":7306,"./ca.js":7306,"./cs":6464,"./cs.js":6464,"./cv":3635,"./cv.js":3635,"./cy":4226,"./cy.js":4226,"./da":3601,"./da.js":3601,"./de":7853,"./de-at":6111,"./de-at.js":6111,"./de-ch":4697,"./de-ch.js":4697,"./de.js":7853,"./dv":708,"./dv.js":708,"./el":4691,"./el.js":4691,"./en-au":3872,"./en-au.js":3872,"./en-ca":8298,"./en-ca.js":8298,"./en-gb":6195,"./en-gb.js":6195,"./en-ie":6584,"./en-ie.js":6584,"./en-il":5543,"./en-il.js":5543,"./en-in":9033,"./en-in.js":9033,"./en-nz":9402,"./en-nz.js":9402,"./en-sg":3004,"./en-sg.js":3004,"./eo":2934,"./eo.js":2934,"./es":7650,"./es-do":8457,"./es-do.js":8457,"./es-mx":7730,"./es-mx.js":7730,"./es-us":6575,"./es-us.js":6575,"./es.js":7650,"./et":3035,"./et.js":3035,"./eu":3508,"./eu.js":3508,"./fa":119,"./fa.js":119,"./fi":527,"./fi.js":527,"./fil":5995,"./fil.js":5995,"./fo":2477,"./fo.js":2477,"./fr":5498,"./fr-ca":6435,"./fr-ca.js":6435,"./fr-ch":7892,"./fr-ch.js":7892,"./fr.js":5498,"./fy":7071,"./fy.js":7071,"./ga":1734,"./ga.js":1734,"./gd":217,"./gd.js":217,"./gl":7329,"./gl.js":7329,"./gom-deva":2124,"./gom-deva.js":2124,"./gom-latn":3383,"./gom-latn.js":3383,"./gu":5050,"./gu.js":5050,"./he":1713,"./he.js":1713,"./hi":3861,"./hi.js":3861,"./hr":6308,"./hr.js":6308,"./hu":609,"./hu.js":609,"./hy-am":7160,"./hy-am.js":7160,"./id":4063,"./id.js":4063,"./is":9374,"./is.js":9374,"./it":8383,"./it-ch":1827,"./it-ch.js":1827,"./it.js":8383,"./ja":3827,"./ja.js":3827,"./jv":9722,"./jv.js":9722,"./ka":1794,"./ka.js":1794,"./kk":7088,"./kk.js":7088,"./km":6870,"./km.js":6870,"./kn":4451,"./kn.js":4451,"./ko":3164,"./ko.js":3164,"./ku":8174,"./ku-kmr":6181,"./ku-kmr.js":6181,"./ku.js":8174,"./ky":8474,"./ky.js":8474,"./lb":9680,"./lb.js":9680,"./lo":5867,"./lo.js":5867,"./lt":5766,"./lt.js":5766,"./lv":9532,"./lv.js":9532,"./me":8076,"./me.js":8076,"./mi":1848,"./mi.js":1848,"./mk":306,"./mk.js":306,"./ml":3739,"./ml.js":3739,"./mn":9053,"./mn.js":9053,"./mr":6169,"./mr.js":6169,"./ms":3386,"./ms-my":2297,"./ms-my.js":2297,"./ms.js":3386,"./mt":7075,"./mt.js":7075,"./my":2264,"./my.js":2264,"./nb":9893,"./nb.js":9893,"./ne":8235,"./ne.js":8235,"./nl":2572,"./nl-be":3784,"./nl-be.js":3784,"./nl.js":2572,"./nn":4566,"./nn.js":4566,"./oc-lnc":9330,"./oc-lnc.js":9330,"./pa-in":9849,"./pa-in.js":9849,"./pl":4418,"./pl.js":4418,"./pt":9834,"./pt-br":8303,"./pt-br.js":8303,"./pt.js":9834,"./ro":4457,"./ro.js":4457,"./ru":2271,"./ru.js":2271,"./sd":1221,"./sd.js":1221,"./se":3478,"./se.js":3478,"./si":7538,"./si.js":7538,"./sk":5784,"./sk.js":5784,"./sl":6637,"./sl.js":6637,"./sq":6794,"./sq.js":6794,"./sr":5719,"./sr-cyrl":3322,"./sr-cyrl.js":3322,"./sr.js":5719,"./ss":6e3,"./ss.js":6e3,"./sv":1011,"./sv.js":1011,"./sw":748,"./sw.js":748,"./ta":1025,"./ta.js":1025,"./te":1885,"./te.js":1885,"./tet":8861,"./tet.js":8861,"./tg":6571,"./tg.js":6571,"./th":5802,"./th.js":5802,"./tk":9527,"./tk.js":9527,"./tl-ph":9231,"./tl-ph.js":9231,"./tlh":1052,"./tlh.js":1052,"./tr":5096,"./tr.js":5096,"./tzl":9846,"./tzl.js":9846,"./tzm":1765,"./tzm-latn":7711,"./tzm-latn.js":7711,"./tzm.js":1765,"./ug-cn":8414,"./ug-cn.js":8414,"./uk":6618,"./uk.js":6618,"./ur":158,"./ur.js":158,"./uz":7609,"./uz-latn":2475,"./uz-latn.js":2475,"./uz.js":7609,"./vi":1135,"./vi.js":1135,"./x-pseudo":4051,"./x-pseudo.js":4051,"./yo":2218,"./yo.js":2218,"./zh-cn":2648,"./zh-cn.js":2648,"./zh-hk":1632,"./zh-hk.js":1632,"./zh-mo":1541,"./zh-mo.js":1541,"./zh-tw":304,"./zh-tw.js":304};function s(e){var a=o(e);return t(a)}function o(e){if(!t.o(l,e)){var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}return l[e]}s.keys=function(){return Object.keys(l)},s.resolve=o,e.exports=s,s.id=5358},5428:function(e,a,t){"use strict";e.exports=t.p+"static/img/主机在线.3e7268e4.svg"},6109:function(e,a,t){"use strict";e.exports=t.p+"static/img/touxiang.c5115972.jpg"},6241:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAGSgAwAEAAAAAQAAAGQAAAAA3IGzQgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDUuNC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KTMInWQAADX1JREFUeAHtnGusXUUVx9c+99EWQUmwKEGkAhJrMSKKvBqhyEOhfvADxGg09YO0UIpoNCZGwsX4wQTEFCivLyKoHyhBozyEolZCCyJKglR8UCRBFIuAvEp77z13+/vPnDn39Jy9z2vv03taZpL9nr1mzf+/1prZs/dss5giAhGBiEBEICIQEYgIRAQiAhGBiEBEICIQEYgIRAQiAhGBiEBEICIQEYgIRAQiAhGBiEBEICIQEchCIMk6WeRcalaqTIQhsrw07PoVBi+dsApwVWwj641WLRvA8qgYnKT0HBuxJc4QZ5IJmylSUt+EOCUoOVlv1UYFIGic44o9zXoRS/9pxrYha8SmkqttZ/9iZu9Et1HbbgtsHydPhtRfeprbFrG8YGmzbs5At1jSjAu5u0o9E5KmWMIyG0k22rRKSM+zw23MzsAuTuTwvVxdyFIpZCeJu3s+8p6zt9ppyXftJZWbJP2FL4UpKpo63S+0nyPlOJZX0HOUbX8h0SOXoulLyNnK9mGbb/cma+0xh4uPHNarx/REiLwiMJ+eb8ejyDeozlk2D0tWtbTIYbXtSTL5G5Pul5/tsM8l19lP0lNsNBhAY7Ze9oPuGNBxyH7I3VtUTwlRPeVr2k6ypATuil2erLO7ODJ5JaQ449Vxp9Q1bEEw23FCyVUosBL78kpYvUDJ61pmjnJTlDAPiTdSqZUByJy8PZ2u1+EC+wplXEngUigc60lIa2bRqkVptC5tynnil5LrbVso12dpv+4KvCAwvcAOoeh7cM3FWK98QcsIS1dy2qvirlap0ghkPGn/tSV442SRUJVVHnWpKIxQl3sB73SsWtYr0yorqU1NMalR6H6B/eV4+UMBw06FdGzYnIXiculqO5RiHqESi+0N55y6VxUpjwzJ8n2Uzzsy5O59thudKk5YWUEtfDsy6+Edb+sigwxUZExhWgewvwnylypsiZRO97cFM1gncXcfRD3KciTFKFIqwpeRgpclUDFCKQbZlxCqvkOZY8mNlDaAFGTTDp6Dt9/qSqnWPV6YhFahaOnT1GqUfuh2BH0AT3mqUwhu7yHnOsUUlK7HBY+EiqJkKNbKpRUmUlStONdWmDL7D2SsExnsm93o8rjdslci2gFzna0n9H4TjZ5Bk0ZdRIp09OGnfwVEhtpEmdqPJSZ0ivJE5npIYBIrOg3gNqCelBNwvSV1Kyvc65s93+jJDESt2RMs93L1TtvPNidX2Os6SVbXTdX+IFM9AiiUbLOPUvAnKU/LhzAU33X3pqO1kjRvb8QuW8tqCnlj1Hl1cq1d2649ySeEgrmoxu/XqLsMnqVUxxhYU2XXUKR+jEpSXE1oh8zupvJ32bX2x8Y2QkaAzc6QNfRaauIGtwmG11gCdV6MBmdy7myWE7Dwt7jrQmDGGab064WcGWomgv/BdrEeJvOMLpOQoGR6sR0DhH9w9q0o3zlJ0SpFe0/Q0aT9j/UDLHci4T4s5En268k1dFuo/m4moq4AOwKH1qTihj8mdh3+SVfZwVxdRrblLCdTs3e6OCFyqg6ZCte7wWYaYhXCzk2usfXpKdnPVtkWr3GZ9RS4wz5FoxesIjsvl2tJXuHj8A7agxQvqNgdqHA/FvF8yOSeli+jSoEEeh/h2lxtQVMGUXV1RgmMJFi/xqae5dSPtKRrGDeoMiIxzcOwvGfcDsNgdbevO7sd04x9mjzrGc+QubakPJBVgOA9yRXlA07LzQ0nZqDQx9ZJ+xZ7a/GE18J1F4rC4Jvv2M45CUG3rC0khJA7Sw4GhGG9Qv5faklv5eFyI13n1K6mvgu4oxMpaklF3rEQPk4Zk/JMZwwNSrS4WsiENehpeQu2fDiC2hUmpj0dsE/X7meS70LRRnZ+QwgY1LOECtqNSdiE0AagzqjSi+zDeMn9XNkHlDTS14JpTUV/LaULnNj7MNhn5Ik18uu1aO0xCF6lKXsbNx7gqGjvIVWoU1i7XGSISNd7QWGNP+0tZAgSWbO6rSJD5KQrbH5yFW1sxda4IZPwWKvMWcljq3E/dYMzUyshl9UYHiX6p66YzBtrJ8X6KA336+Rd684dwHD5XuIR7SruQs1NbizMaA9uBoMniSZ6LPDhPv/mSjtcWwnJF5R1ZQY6pMJjDKI9W/OMTgplydkjz4kUheZa+NrksOhMiEw4L6zVGuL+4ZCHyJf/7USEJ/v+5e3Jd2ogsXAq6iFeAd/tK6zMHi5AfajCqRxCypFSuDJ7g4AI5ZCxGAkZMkLyntTnRE334DXhuo67r/ymsavdV3B2SUNDiMhwffvaE3C2uoM5Wy97MOJ7kjoUhIQhhHSlvR//+DoPTm/QlfbvI8oOqmEQSD3DxI1BfY9nqMeDDj2hN4DMQ0EI9RLsM6zfY/syYKdvQXIfnUpCQcMYGvJ51X7K+nEWrwM7c5mGgxBGUh0IFQYg9Pa56ijp/e1kb0jqbcY8iPfvLoMOvckoPfdwEBKqped+0aCPgfp5XRzkdLf1I9TVgftid9rUcg0XIVLK+4oivYKWjsoOXkGm3vOPIN2XSEHDkIaDkOdroAugMWDRKHPZNDSjnfK+T2XpQx2loIM7mLvVcBCysGalib1M/2orcLwKISNuIHtwvawqZe1HOS87+IMOc8eFK3koCAnfKvEWbTNaHTEXmAQd5qLsxjLLtr9G2XG/DwQiIX2ANshbIiGDRLcP2ZGQPkAb5C2RkEGi24fscgh503zW0AfCPd5SDiH6lD+mUsbeigIZBh4Ocnzc6h7l3pzUJPb2MipelJCK+6AytQ/yCf8h+kBO7xXKUGxPkMEgWOK+YryBQZjUlvqPSzvWPyVf7vhZK3iX1jJPc1vCB6VKubeTQ+Ln8Wlkahe7vC/Y2JuBFJFhK9wbFb1NWeG+hNeAvn+v4qDIWWmuiB/yz8jQOnQSBvXGGOOZZhbpiO0P2KIkXGkWM8LbC82S+ipe8iBfiN+mDJDiZV+6F39sfZPtSL/MvPedTBOXaQuFPJQEiq6lkKE3ojkp83ZZOK6o2VP3AOsZ+ImYz2+0/LS1IEuzP66sfbrvit1lOgJyc3QZytM1b69oPkvjeBd1Gueb3i8C7lpomEetwsvhvHr4WVRV+ztTvo9CVuZ0hFYP8eLEtwp4gMLOYJsftJRfn+CHSSvz7FIsZjVzE+/m7J1c/S2Dhs/VJ8Mot74s0Ru6OZw1JbXzUp0EMJBhks8ZETPK9sc4l3KkCTtn0XIc6oJ6ZzJUVJjW9rAjo+GvGLoYUrDqcOy2DR5yNCceBbp2IavxXuVrntKmueCbUUdT2jYwZeGvu9yg0DbH5KB0y7yPoCMh6d2E7mXUajm5ToaEhS48aXZIlSv+JVcmjkFGbeuntE3ZORjobWnOlLZcQQ2k3AdkH8cSpEKeR+1atghMUNdL9/MNtb+Tc8Z8igTvmWZ5yR5pCgPDMenzIjsK/c5E17OpyfEEpAXOJIVAkUmfVXvK3sGkz5zZU0ivQaa9plSf+LnKTsUqfoWC7duRpvsbDuU1cnltZ6dFT7mzf2O9AS3usAOZFj3hpowpo/9Gi4uDTA3TosfpvhxHDc+i8E9Q5tGu/yStRYJ6kkrde4PL3rAK06JX4R03YOxhCkNDFr+b6yG6XCflAvsBCq6gbzAJeEX+4tBIjqa3aK6EXF+LJobejsKr2A6clIa6XUJhK9Hl4LouHn6thY/a07Y4cb1d0o8DNEd9M+H6pE7G1voc0ig6PHkfaOcTbv6CYJGR24duvDVnXxVTb000KKjNIFdPPKJkIU8zK+nZTbBvdp7L43bLXrlfazA1jf+3fAZD+7YjY1ddVKR0lK5FyNAbe5HxGrR+VkLdHEW3k73qWFjdktbYuwDuYSg5CBCLekqWNj6s+WlhS5nLvamda2cJ6OZcU32eAO59ayFJBJSZJiFjHJPTA/bHknX2YDf1ae8hqKdG1wm62v5JAR+hcf8TTZwmLir8+AhbTjVmdanazakmVPKdr5vXXo58L2WJ01ua/5BalE2GOjPCRJ/gjbPexv6J3ZIhBWdB0FFOcsCoIbrG/kXjeww/FFgHOWpNNFtOXiYlvCK+AZe197MojO1E7mGQfo1Tp8RpcjUL1QPv1wDsVPxcH60Kg350Dfco3Ib6q01Ux0WjF7dTlyW0ib/vxjNcXVl1DFkho7bB3d3+hXjLjPvF33Iqp/89zFbLHRRYyff03e12+wIfQt+SnpL9G4peSgi6026cQK31dUs5SXQKRS07QSTh3zAVuwLjvUcF9EKG8vdEiCtA9/CkLa9xx6tsEQqcTiA4ieMjWA5kGdO1AknWJ0q2QfVpyfftxdBF7Udm6NkATgWJv0DXY5GjvzKo3RD9/SZh8CL+sBUqfodHbEhusD9LmAyAf6ek4KS6dJ16JiRIdgVy0Phgp2uyCDckqU/diqTXqcihELsv8955kCoiKtyr3hVmNJ/P8Hbyf5+uwnW4N3NLK9H8kzVH+u78TWyzYk6B0BZNoGAxi2sWP/TH8r7wuw2UDWNffetdzIozinUKZpzv91TZBA+7fv3iFO+LCEQEIgIRgYhARCAiEBGICEQEIgIRgYhARCAiEBGICEQEIgIRgYhARCAiEBGICEQEIgIRgYjA3o7A/wHxJH0jt5HlsAAAAABJRU5ErkJggg=="},6343:function(e,a,t){"use strict";e.exports=t.p+"static/img/ren.4d1f75b7.svg"},6415:function(e,a,t){"use strict";e.exports=t.p+"static/img/aws.881c615d.svg"},6570:function(e,a,t){"use strict";e.exports=t.p+"static/img/linux.d892f115.svg"},7646:function(e,a,t){"use strict";e.exports=t.p+"static/img/PostgreSQL.422b23a5.svg"},7757:function(e){"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAAEH5aXCAAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAZKADAAQAAAABAAAAZAAAAAAvu95BAAASXUlEQVR4Ae1dC3RdRdXec/IoLbQ02AL9gdqgSZUiLBCbFPEBBXkIVi1UaKp24QP91//nBsElCAuLLGEpKm11qfhCXLmpVKTyqlBREJDcFAVFRPIoQQQq1DYtbWlpkzt++957zpmZ8765Nyl6JuvmzOzZs/fsvWfmzPsQ7dNOeHKXkQtJ0q0afKXw4mkI7VJq4Yx8lUyYhhAa6WK6bLt7dQ7zZgu6X9bSC7TXRad1tEScXgybCTi8Sh5BnUZWS+FahYrrHWyeT3l6DlTdnLixis/m1iU/7+HAaMylxEmndOfWbtp2YKtCyvXW0+G0SLzgAv5LfbrGWAlm8QktoIy8TO6nKc8kED+yiFnMkm11OzUXSnZmGXOKj5nARu6S/19IyP+y8hoQ6C6GzQRMuUue5CCzZ62cwBwtB9jdWywzjFxDh9Fi8bATx8hbaDeXaFetub6baKBpqYNkepz8mxFpOEgDrnKDMGx4Rm5Gg3uQHSw8a+iDdIO4XYP5BMKZZOQHQLhIRNCDtEK8R6Oh1oGQChTMJCPXg8E7SKCFXCHeqBE3A8xM0Ebg/Y8ZxWEvE7PkF1KJIZrXrKvKpmbWuSL8UhT0b9goLpNc3yMk5bxChF1pbSyVMcetkVNpJw0VogXU2SY+aKMWnjbjUiVxmdiETAZq6k75NgSfKIAELQTx29Roza8wcuu6jdHTd5HtdZ6dcnGpKXqCaumowlssDoNJNI1puJJwqOfZRsq/9gx7C+6Vht/Rpul6ibLjop5pexKloTT+9aMBvZ4E5ftyOR3NyMtGtKSVwluZDSQORjNRm3MfAgDdB2an+UcVoeFMVAbm+yIjr8ar4KoCGUE9aOb9u7RACGaSkUMgMrVAxGRQzGDxv52REJxgncZhwGwsWoL/kjKyv8g1yX/OoZ3LJOl8cHV1ma2wnSDoHZOVv4QMC2w052m0wC6TXH8ryXyp9+mgux4hOqi1eYUDsF9KDsDwKIxcJvabsa52Kp3wpm1Okp7+eZTPP1IKP0rzZs/V+tIKsQJOp9yFZ7FnX4orMsltOInk8EMobLvQYZjkMFA93b3bwWByKAMb35ayxKRYuuTIykJ8LR1t43mecRl4EnIBLDjx+8JjRHzSB6cIsnPHIVNFgYmKEV6b+JWkJAzulfvTJtpRIK+pS80JF4CeDc0OKAmDTnmLw6CeZtg0XEkYYpcwO1bhZYNiPQXatDZxjY2rM2Eoj7t6+ocxfPLG2amCntwpbzM65UG4KTzVQKqBVAP7sAaSN4BxhblMNtBrdBKmYo9Fb+ZAvBr/hqTdtFzws+KuMoKsljX0MLr8RBMS57CWjqdviscTpzMSjE6QDvlZaPw7Bk01mEVn/nH8tsEqRyHiM3hOVBEU/yYMPg5Wwom85Qvi1wu3qBFF59nYOWiXe4Bbp+HX0OmYoVunwWIEkguyDIscW7RFDh5CHYsRVnHWKAZTD4qpFEFXgN61HrwQQHJBTKZzqJ4uEurqTQi76kXFEyTXfy6GRTchGwd4syJepgn7HUfHz3zRGxcDIqWgLgzOJZ0SgP0VdOuvDIhzwMGC9PR+HBX5Jw5mXI+oO5Zaj4wuZp1yBCSDh9z+/B6FUHP9ovwFMXv0nNKib1LL7Es0IqzNnj6emD5Bg3NAiFsxeD1Pg6vjFTVC4I2zHxqKhWKjCsbyzMmg/VsNxgFBZ6Azf68K9wpiCiGsOdTa9JSayNf/9KbJNLTlFTdOGdfeJg+mV+klN67ks+g6rPx80QP3A6jjL46vpbl0vnjURtUXR3O9P4UGXCes/4slBKd4y/Tt+K8rJiubQK8PQujOoqUQ4GYdGBHiEacqzDCtRwqHny6IFLN5hsdxFj3g+JN4VskWGqGcSqqQ3KdIJCEbhqsLUicW01454CQYyT8JvyO1Aw/ydMlz0EDcASF0V0tvRzF4TAcmDGXlHYZi1qgUvJns6fsO5dH1UJ1VM59a3uytdDZOl7wIAnzPDjrPejoSK+iDTrgcz2pZT3vQGKhO0DAqu9Yj8ArCCTwVV6Wi+HdOuZ/+eejJCqT6XovaUb++ZTLyF0TFyvX9A/Meh6sgGpr2MG056CQNVs2AQKGqoSYUzw3VZJPSTjWQaiDVQKqBVAOpBlINpBpINfD60EB0N75cOS6Wc9H5PgYDrmNA4nmMM5/G7OEd5ZKLSldZQdolT3NeHsUUQv2a3klnYvRoDoojkwYhVEaQjLwK2r86iEkIPIcZ+Hkh8bGjRi9Iu9wCbg2xOfohWki/XGz1i4oLG50g5oS2zvXvmJ28BZb6K8C85fVM+N+toyghHsreINwZHCUqjrd8QTKYu5U+c7cWnQXt/iqQ+TI5BcsSPDXq3V1TA9gNmKEsw+nzWnEJZOQajxAC64MrxImRJJYJnlbdH9u1Mngu1/BHCnOSZSk36Ww44YjCFAih7y0WtDaWEGquVwrenXWqCir42+X1HlgMQHJBhugvBt3dEOL9BixecKX4DZpic2Lv0niJdazkgkiaqZE4CEvPo3ErhDurKVB7eN98xjjMEYN+svLYIc/Fm/rnDl2BPagrxCFOeBw9ySyCQzxaXi36tBYex0C0RXibWK5vFfK4yDefwroOayjxFmv8CHTKswHmswPapHQJ9SkstS5AVyby/RIuSK7vHsz7nu7H3wMT4kIstfGCaTy3Gtuj93i2R/un5Q0Hi/H2F0JZvNFRgwXJ9b6GZrZeR48ICRqk1tlHRmDx0a0MaOvvkMhEQJiIHoK5zlhK5y9IOULYGREiD8vU2EHPMytXQYjzPfC4gHqsHvr0mr1v9u6+X6M46ZYQKASTJ82gOUdwB9F1ud6zkKm7XQB8XKd4QXWatR81NekLNJ2S19Pna/gcEFgxbhP6ijHDs/IPwH87ex23B4s8PqtoXot4VnXpfhSXUxxCfp5c70YwPNQTpW6/7ZQ5xLd4cOqxR36RcLdNmwir5PuxlHeXBq6hD9MFQlt605vf7t5btAQkdkcKwQlaZ89ARVynpbWsM5xwVvIGAq8QvFIbJgQTuEDc7Xn7jxRaOYc8e3RBzCZW1M7SsMMCrc2nk2UtK6DUYGduS9O9BX8nDgFI4qNaruMVqCS7rduUt79LRfPpRcssVmrR0JKFBAYHsYehcXcBo1P+A8/DDew8hAhuDAxkJ5iVgxB/lhMmzAUsEU6/z7SIglem1xWCdzqYQuwtS4hiVu7RcmTpm/m9rZaGXWagEwddqHTQxSYhaBdaJu9gyo6Pepo772Sh9XJSVd4inXIHqE91OBQ920clBNPgY5Cqq8NxIsWFC9LT+y4FN9qblVw39tcQuWu+REzRYOUEpLFXbJF4TiVjCGJdq0aiy/6gFg4LZOUwKuMEA2UjLPEGA5Y8mJV/1hIJzyYRo/md13SFloAD3X3629yDAEBW5iGE3hIJehaW4NmT0bmsvAm0j9GI1BR2rGogwyKIE+IqDYOwEZmb5Z5e/646bz3ic86q4+nRNtGoghL7uXtfVNBSI+1W7IDoM2BGBuzYXN+T6DPNsYOBz3LPygQSjBER8CL1WoRptTYfDcvwxJq/43HBWAvBvYE2oyooufMXhBFYGEu0KbglLyaeyzlU5CUUHyIwT9CG86hlDaxUNrm+09A//zZAs2igWe/iq3iV9PPQQdClfluaKskmpZVqINVAqoFUA6kGUg2kGkg1kGog1UCqgVQDqQZSDaQaSDWQaiDVQKqB/xwN6MsZ+6Jcy7AT5BUcWR/GpRyEc/gCfr9Nrf553wT8h4DPC25rsUe6jPv+/AlXC7rvGaRDzoACP4/fRRC6/EXsMI0J4u0L12B71Q/DFijCSFQrbt8wyOdwu/0wZSFksjXwymhlBLVoOTblXUbLBO+bGlc3vgbpkB1Yv79hXDWgMhfUi5XJs0dzwEAlV45/fAySkZ9Ak/QDZDg+f4HbuAV9HwZcF+tdcKOswwL/icBfCj7ngZ++myRMW4IG0FieSNeJTWFo1YiLr5BKcL8Ud9TsoSdBanokOUHbYYAOnD75cSRuXISL5WEw0LdgnA/FSmLRzeC/NBZuhZDGziAd8qNQxk9j5Ps+fJZgAdpz82aeGEkToLTL+TD4nTDOxNBUvBuoDtvzvi52huJVKHJsDJKRl0Dwr4fmWeC6wwZcZ1VtQ5iZaJfnA7TKBBvhV9HgzUQTttmAVzxYfYNk8MEEWehBBWfeoovRNCTf4x9MMVkMf8lmC944RG8MTMgf2jgK8VW+Xq+6BilemM+7fYP5CFw5uULcGKiIsYrgS+c6cN+ahOL5SswG+hNqq3Jf29hkpDq7le2876QvwRtmjB/tE8bg/BZ3sF1mZ328npU3SH8/vt8kT0VJew8989Ic2n/4MZq0t4Hq8pNpr7WNdtdto831e2jjpB103ND3aTlKZsh2vjFVzGp5AAaofH3iqeB7JH4Hl3784ufzMC9gnPIinn140d+J4yG9gFfUBZfeuGxy/e8jyl+PTOr7ieOmt/EE3+kqsmTVXU5zG/9pg6v6zMrzQP/KUeedkHdBN+J3NbZb/ms0eS7PIPx9BxrmQ9/TRsM8NK2gX+Eo2hLPUbTQRDEis/IsYP0Yea/eIVzeyFtHH0cN2hUjRxpKMoP09H8SX+zgEfZYuh3YMX0BtTTfVTZTPjvYhSkafKalbBrlJBS0AYaZC8NEn4go0Y9nkPWDh9LInj8iTczjEigZQq5DFV6DE29P4ODF83Tcm4fo8YEGGhHNNJw/GbQ+gl3cRyeSU6Br3NJ0Cd45+Vjp+HuEQyitks6JhV9E2o18/xy/dUj3CNqAl3AqZRh0DsP7YyYGt/OB9iHERR92sJla9DU0ZV+wg2HPaIOs3zCfRobvCyNSinuarNoF1PImzxGO0LQSd4KvH7gCNe9K4MXrZAjxIE2oW0DHNW71pX27nIyvtqyF0tC0xnCCngHWIpwX4EIX3xVvu+ZB71eRyIpI+BjO/+incn0ShBuke+BMopG1PulckMCiT23NO7SPEbmxyXzrB46g/MhdEDCigyBeg/gL0YzdrTG4Tb4B146sA+x4DR4U4MnKxfTZ2DUuiA7Ds/JjyPfNYSiIexInXY4J61UGG0Tiowg9/f/COSTz4KDLU+ACk9bmDhdQIR/Xmp7+G8H7Qo2iwPyWsM7xXDD8Cyxq7aLfAPetGn5QQGDto01wqa6sKxaIQRCdHEjYwthssfhyUHywQXK9V8Pixik3lYy4C1/QStI2q4nj+3P9F+KC/evxLjob749uLeFq2YgO52+Rz1ka3C/A57B4FXKJqG6npEu+Be+Zv/lloQTL45KJg4KOuIcYJOqSDXxZb15zTwjj6kX9TL4Vr1muETMimfAV2YI+hlIZNYEYSSo2QlbeCuPrx4fVxDUYeF6AG4V8XMhLVDb74LugugM2uIEx8v1MHg/1rsMv+oQvf8hA0rlomsrvLpcrFnd3A+9oAdE8sW4TGkSKP6Fb2hiYp/yrJyDunsD4Skbwt7jz6DUNh7TNLr+dqBHnwBD3u6Ax9uWNO05M9gITlwEupIbQA0gTvLKWz38D8dU1SLZwL9EaGGNiQP5V8FaMd85AUzA+zaidE54J8Lukxo4nfD1qBj3qBnVf8DuE8aJOewvRjV7WiTrJCoS65EIYgdt8v5uodAYCH3IUaJMXj+JbRjrF8kPFmvxQKIGIL5JEGGQDPnMy/BQYBNcknhS0rNNobtPvQjMSJzIrl6J0/QioUYMspvY8DHEKmqb+OKSrilMcIPKL/MMRfG5FL48nNANduEE4We6ZQzCZyS+pqF0b3Ju5liYe+DU69tBk689Z2Q76KwJzqUcMoGk6BU0Tb3YbX7dKnoBplW8jEy2RGeE7GhNfcBREtfhNVXw2BvdYJXNPw0hYGhXPYnT6HKZHMFHItwJYuB8F14sMNs6h4dorYpHkXpPAjkby+bJSLAIxkfLgYuFPFprLusLTwrpIcawzC0+e/pgSkxpEh8lqcHfr+caVXAEEomuImrDw9ek9uJQM23lG47Yf+AC9fMh7R0PidZFW0HdRK/43SV6TGcSmXPjM0FAXDMPXQMZzPEM71PB72jztXfESvG6xeD/ZR2GI28uRoDyDqJz+8OIk2rvjcwB9CgaaqUaV/MO0+eD1tHVq5XtjPszGHMRTMjzIq6EvolkK7M7GzdfoDRLE6Ym/N9CWiUfTC9O53eUmDneMFu7Vqke4Fn6bt/30p2TeAOWPVTloUcEoW+h4F6dduIPCv1cA4wUnXl4YxFzUSOWYppRSDaQaSDWQaiDVQKqBVAOpBlINpBpINZBqINVASQP/BmlyLOfC5+1CAAAAAElFTkSuQmCC"},7878:function(e,a,t){"use strict";e.exports=t.p+"static/img/分组.79869cfb.svg"},8484:function(e,a,t){"use strict";e.exports=t.p+"static/img/ansible.a30e8a38.svg"},8903:function(e,a,t){"use strict";e.exports=t.p+"static/img/shoudong.4e550391.svg"},9129:function(e,a,t){"use strict";e.exports=t.p+"static/img/主机离线.17f51cc9.svg"},9144:function(e,a,t){"use strict";e.exports=t.p+"static/img/普通.18c9ea70.svg"},9775:function(e,a,t){"use strict";var l={};t.r(l),t.d(l,{A:function(){return ue}});var s={};t.r(s),t.d(s,{IY:function(){return Re},sh:function(){return fe},zi:function(){return pe},bi:function(){return Te},Xw:function(){return ye},K4:function(){return ve},zb:function(){return me},xK:function(){return Pe},K:function(){return Ae},GJ:function(){return De},zE:function(){return Me},CS:function(){return Ee},J_:function(){return Ce},BY:function(){return xe},hw:function(){return Ve},HN:function(){return we},EX:function(){return Fe},gW:function(){return Le},ES:function(){return he},In:function(){return ke},Fx:function(){return be},Z0:function(){return _e},Z6:function(){return We},M$:function(){return ze},Y$:function(){return $e},en:function(){return Se},Ub:function(){return Ie},Q:function(){return ge}});var o={};t.r(o),t.d(o,{A:function(){return Ke}});var n={};t.r(n),t.d(n,{A:function(){return Ue}});var i=t(3751),r=t(641);const d={id:"app"};function c(e,a,t,l,s,o){const n=(0,r.g2)("router-view");return(0,r.uX)(),(0,r.CE)("div",d,[(0,r.bF)(n)])}var u={name:"App"},p=t(6262);const m=(0,p.A)(u,[["render",c]]);var g=m,v=t(5220);const h={class:"login_container"},k={class:"login_box"},b={class:"input-wrapper"},f={class:"input-wrapper"},y={class:"captcha-wrapper"},_={class:"input-wrapper captcha-input"},w={class:"tech-buttons"};function L(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),i=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-image"),c=(0,r.g2)("el-form");return(0,r.uX)(),(0,r.CE)("div",h,[a[16]||(a[16]=(0,r.Fv)('<canvas id="particles" class="particles-canvas" data-v-0cc7d3e3></canvas><canvas id="matrix" class="matrix-canvas" data-v-0cc7d3e3></canvas><div class="floating-orbs" data-v-0cc7d3e3><div class="orb orb-1" data-v-0cc7d3e3></div><div class="orb orb-2" data-v-0cc7d3e3></div><div class="orb orb-3" data-v-0cc7d3e3></div></div><div class="grid-overlay" data-v-0cc7d3e3></div>',4)),(0,r.Lk)("div",k,[a[13]||(a[13]=(0,r.Lk)("div",{class:"glass-decoration glass-1"},null,-1)),a[14]||(a[14]=(0,r.Lk)("div",{class:"glass-decoration glass-2"},null,-1)),(0,r.bF)(c,{class:"login_form",ref:"loginFormRef",rules:s.rules,model:s.loginForm},{default:(0,r.k6)(()=>[a[12]||(a[12]=(0,r.Lk)("div",{class:"title-container"},[(0,r.Lk)("div",{class:"title-with-logo"},[(0,r.Lk)("div",{class:"logo-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",class:"tech-logo"},[(0,r.Lk)("path",{d:"M12 2L2 7v10l10 5 10-5V7z",fill:"none",stroke:"currentColor","stroke-width":"2"}),(0,r.Lk)("path",{d:"m16.5 9.4-5 3-5-3",stroke:"currentColor","stroke-width":"2",fill:"none"}),(0,r.Lk)("path",{d:"M7.5 12.75l5 3 5-3",stroke:"currentColor","stroke-width":"2",fill:"none"})])]),(0,r.Lk)("div",{class:"title"},"DevOps运维管理平台")]),(0,r.Lk)("div",{class:"subtitle"},"AI-Powered Infrastructure Management")],-1)),(0,r.bF)(i,{prop:"username",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",b,[a[6]||(a[6]=(0,r.Lk)("div",{class:"input-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24"},[(0,r.Lk)("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2",stroke:"currentColor",fill:"none","stroke-width":"2"}),(0,r.Lk)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",fill:"none","stroke-width":"2"})])],-1)),(0,r.bF)(n,{placeholder:"账号",modelValue:s.loginForm.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.loginForm.username=e),class:"tech-input",clearable:""},null,8,["modelValue"])])]),_:1}),(0,r.bF)(i,{prop:"password",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",f,[a[7]||(a[7]=(0,r.Lk)("div",{class:"input-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24"},[(0,r.Lk)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2",stroke:"currentColor",fill:"none","stroke-width":"2"}),(0,r.Lk)("circle",{cx:"12",cy:"16",r:"1",stroke:"currentColor",fill:"none","stroke-width":"2"}),(0,r.Lk)("path",{d:"m7 11V7a5 5 0 0 1 10 0v4",stroke:"currentColor",fill:"none","stroke-width":"2"})])],-1)),(0,r.bF)(n,{placeholder:"密码",modelValue:s.loginForm.password,"onUpdate:modelValue":a[1]||(a[1]=e=>s.loginForm.password=e),type:"password","show-password":"",class:"tech-input",clearable:""},null,8,["modelValue"])])]),_:1}),(0,r.bF)(i,{prop:"image",class:"form-item"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",y,[(0,r.Lk)("div",_,[a[8]||(a[8]=(0,r.Lk)("div",{class:"input-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24"},[(0,r.Lk)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",fill:"none","stroke-width":"2"}),(0,r.Lk)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",fill:"none","stroke-width":"2"})])],-1)),(0,r.bF)(n,{placeholder:"验证码",maxlength:"6",modelValue:s.loginForm.image,"onUpdate:modelValue":a[2]||(a[2]=e=>s.loginForm.image=e),class:"tech-input",clearable:""},null,8,["modelValue"])]),(0,r.Lk)("div",{class:"captcha-image",onClick:a[3]||(a[3]=(...e)=>o.getCaptcha&&o.getCaptcha(...e))},[(0,r.bF)(d,{class:"captchaImg",src:s.image},null,8,["src"]),a[9]||(a[9]=(0,r.Lk)("div",{class:"refresh-overlay"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",class:"refresh-icon"},[(0,r.Lk)("path",{d:"M1 4v6h6",stroke:"currentColor",fill:"none","stroke-width":"2"}),(0,r.Lk)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10",stroke:"currentColor",fill:"none","stroke-width":"2"})])],-1))])])]),_:1}),(0,r.bF)(i,{class:"button-group"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",w,[(0,r.Lk)("button",{class:"tech-btn primary-btn",onClick:a[4]||(a[4]=(...e)=>o.loginBtn&&o.loginBtn(...e)),type:"button"},a[10]||(a[10]=[(0,r.Lk)("span",{class:"btn-text"},"登录系统",-1),(0,r.Lk)("div",{class:"btn-glow"},null,-1),(0,r.Lk)("svg",{class:"btn-icon",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{d:"m9 18 6-6-6-6",stroke:"currentColor",fill:"none","stroke-width":"2"})],-1)])),(0,r.Lk)("button",{class:"tech-btn secondary-btn",onClick:a[5]||(a[5]=(...e)=>o.resetLoginForm&&o.resetLoginForm(...e)),type:"button"},a[11]||(a[11]=[(0,r.Lk)("span",{class:"btn-text"},"重置表单",-1),(0,r.Lk)("div",{class:"btn-glow"},null,-1),(0,r.Lk)("svg",{class:"btn-icon",viewBox:"0 0 24 24"},[(0,r.Lk)("path",{d:"M1 4v6h6",stroke:"currentColor",fill:"none","stroke-width":"2"}),(0,r.Lk)("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10",stroke:"currentColor",fill:"none","stroke-width":"2"})],-1)]))])]),_:1})]),_:1,__:[12]},8,["rules","model"]),a[15]||(a[15]=(0,r.Lk)("div",{class:"bottom-decoration"},[(0,r.Lk)("div",{class:"tech-line"}),(0,r.Lk)("div",{class:"version-info"},"V2.0.1 • Powered by AI")],-1))])])}t(4114);var F={name:"Login",data(){return{image:"",rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],image:[{required:!0,message:"请输入验证码",trigger:"blur"}]},loginForm:{username:"",password:"",image:"",idKey:""}}},methods:{initMatrixRain(){const e=document.getElementById("matrix"),a=e.getContext("2d");e.height=window.innerHeight,e.width=window.innerWidth;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;:,.<>?/~".split(""),l=16,s=e.width/l;a.font=`normal 400 ${l}px monospace`;const o=Array(Math.floor(s)).fill(0);function n(){a.fillStyle="rgba(0, 0, 0, 0.05)",a.fillRect(0,0,e.width,e.height);for(let s=0;s<o.length;s++){const n=t[Math.floor(Math.random()*t.length)];a.fillStyle="#0f0",a.fillText(n,s*l,o[s]*l),o[s]*l>e.height&&Math.random()>.975&&(o[s]=0),o[s]++}}setInterval(n,33)},async getCaptcha(){const{data:e}=await this.$api.captcha();200!==e.code?this.$message.error(e.message):(this.image=e.data.image,this.loginForm.idKey=e.data.idKey)},loginBtn(){this.$refs.loginFormRef.validate(async e=>{if(!e)return!1;{const{data:e}=await this.$api.login(this.loginForm);console.log("【Login.vue】登录接口返回完整数据：",e),200!==e.code?this.$message.error(e.message):(this.$message.success("登录成功"),console.log("【Login.vue】res.data 内容：",e.data),this.$store.commit("saveSysAdmin",e.data.sysAdmin),this.$store.commit("saveToken",e.data.token),this.$store.commit("saveLeftMenuList",e.data.leftMenuList),this.$store.commit("savePermissionList",e.data.permissionList),await this.$router.push("/home"))}})},resetLoginForm(){this.$refs.loginFormRef.resetFields()},initParticles(){const e=document.getElementById("particles"),a=e.getContext("2d");e.height=window.innerHeight,e.width=window.innerWidth;const t=[],l=200,s={x:null,y:null};window.addEventListener("mousemove",e=>{s.x=e.x,s.y=e.y});for(let n=0;n<l;n++)t.push({x:Math.random()*e.width,y:Math.random()*e.height,size:5*Math.random()+2,speedX:3*Math.random()-1.5,speedY:3*Math.random()-1.5,color:`rgba(200, 200, 200, ${.5*Math.random()+.3})`});function o(){a.clearRect(0,0,e.width,e.height);for(let l=0;l<t.length;l++){const o=t[l];let n=s.x-o.x,i=s.y-o.y,r=Math.sqrt(n*n+i*i);r<100&&(o.speedX+=5e-4*n,o.speedY+=5e-4*i),o.x+=o.speedX,o.y+=o.speedY,(o.x<0||o.x>e.width)&&(o.speedX*=-1),(o.y<0||o.y>e.height)&&(o.speedY*=-1),a.fillStyle=o.color,a.beginPath(),a.arc(o.x,o.y,o.size,0,2*Math.PI),a.fill(),r<100&&(a.strokeStyle="rgba(220, 220, 220, 0.5)",a.lineWidth=.3,a.beginPath(),a.moveTo(o.x,o.y),a.lineTo(s.x,s.y),a.stroke())}requestAnimationFrame(o)}o()}},mounted(){this.getCaptcha(),this.initMatrixRain(),this.initParticles()}};const C=(0,p.A)(F,[["render",L],["__scopeId","data-v-0cc7d3e3"]]);var V=C,x=t(33),S=t.p+"static/img/DevOps平台.7b5dbb38.svg";const I={class:"logo"},A={class:"fold-btn"},R={class:"bread-btn"};function D(e,a,t,l,s,o){const n=(0,r.g2)("el-icon"),d=(0,r.g2)("el-menu-item"),c=(0,r.g2)("el-sub-menu"),u=(0,r.g2)("el-menu"),p=(0,r.g2)("el-aside"),m=(0,r.g2)("el-button"),g=(0,r.g2)("HeadImage"),v=(0,r.g2)("el-breadcrumb-item"),h=(0,r.g2)("el-breadcrumb"),k=(0,r.g2)("el-header"),b=(0,r.g2)("Tags"),f=(0,r.g2)("router-view"),y=(0,r.g2)("el-main"),_=(0,r.g2)("el-container");return(0,r.uX)(),(0,r.Wv)(_,{class:"home-container"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{width:s.isCollapse?"64px":"200px"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",I,[a[0]||(a[0]=(0,r.Lk)("img",{src:S,class:"siderbar-logo"},null,-1)),(0,r.bo)((0,r.Lk)("h2",null,"devops系统",512),[[i.aG,!s.isCollapse]])]),(0,r.bF)(u,{"background-color":"transparent","text-color":"rgba(255,255,255,0.9)","active-text-color":"#ffffff",router:"","default-active":e.$route.path,collapse:s.isCollapse,"collapse-transition":!1,class:"modern-menu"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.noChildren,e=>((0,r.uX)(),(0,r.Wv)(d,{index:"/"+e.url,key:e.menuName,onClick:a=>o.saveNavState("/"+e.url)},{title:(0,r.k6)(()=>[(0,r.Lk)("span",null,(0,x.v_)(e.menuName),1)]),default:(0,r.k6)(()=>[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon)))]),_:2},1024)]),_:2},1032,["index","onClick"]))),128)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.hasChildren,e=>((0,r.uX)(),(0,r.Wv)(c,{index:e.id+"",key:e.id},{title:(0,r.k6)(()=>[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon)))]),_:2},1024),(0,r.Lk)("span",null,(0,x.v_)(e.menuName),1)]),default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.menuSvoList,e=>((0,r.uX)(),(0,r.Wv)(d,{index:"/"+e.url,key:e.id,onClick:a=>o.saveNavState("/"+e.url)},{title:(0,r.k6)(()=>[(0,r.Lk)("span",null,(0,x.v_)(e.menuName),1)]),default:(0,r.k6)(()=>[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.icon)))]),_:2},1024)]),_:2},1032,["index","onClick"]))),128))]),_:2},1032,["index"]))),128))]),_:1},8,["default-active","collapse"])]),_:1},8,["width"]),(0,r.bF)(_,null,{default:(0,r.k6)(()=>[(0,r.bF)(k,{height:"50px"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",A,[(0,r.bF)(m,{type:"text",onClick:o.toggleCollapse,class:"collapse-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{size:"24"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(s.collapseBtnClass)))]),_:1})]),_:1},8,["onClick"]),(0,r.bF)(g)]),(0,r.Lk)("div",R,[(0,r.bF)(h,{separator:"/"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{to:{path:"/dashboard"}},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)("仪表盘",-1)])),_:1,__:[1]}),e.$route.meta&&e.$route.meta.sTitle?((0,r.uX)(),(0,r.Wv)(v,{key:0},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.$route.meta.sTitle),1)]),_:1})):(0,r.Q3)("",!0),e.$route.meta&&e.$route.meta.tTitle?((0,r.uX)(),(0,r.Wv)(v,{key:1},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.$route.meta.tTitle),1)]),_:1})):(0,r.Q3)("",!0)]),_:1})]),(0,r.bF)(g)]),_:1}),(0,r.bF)(b),(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1})]),_:1})]),_:1})}t(8111),t(2489),t(7588);var P={getStorage(){return JSON.parse(window.localStorage.getItem({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_NAME_SPACE)||"{}")},setItem(e,a){let t=this.getStorage();t[e]=a,window.localStorage.setItem({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_NAME_SPACE,JSON.stringify(t))},getItem(e){return this.getStorage()[e]},clearItem(e){let a=this.getStorage();delete a[e],window.localStorage.setItem({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_NAME_SPACE,JSON.stringify(a))},clearAll(){window.localStorage.clear()}};const $={class:"user-info"},T={class:"user-username"},M=["src"];function E(e,a,l,s,o,n){const i=(0,r.g2)("el-dropdown-item"),d=(0,r.g2)("el-dropdown-menu"),c=(0,r.g2)("el-dropdown");return(0,r.uX)(),(0,r.CE)("div",$,[(0,r.Lk)("span",T,(0,x.v_)(o.sysAdmin.username),1),(0,r.bF)(c,{trigger:"click",onCommand:n.handleCommand},{dropdown:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(i,{command:"profile"},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)("个人信息",-1)])),_:1,__:[1]}),(0,r.bF)(i,{command:"logout"},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)("退出登录",-1)])),_:1,__:[2]})]),_:1})]),default:(0,r.k6)(()=>[(0,r.Lk)("img",{src:o.sysAdmin.icon||t(6109),alt:"头像",class:"user-avatar",onError:a[0]||(a[0]=(...e)=>n.useDefaultAvatar&&n.useDefaultAvatar(...e))},null,40,M)]),_:1},8,["onCommand"])])}var W={name:"HeadImage",data(){return{sysAdmin:P.getItem("sysAdmin")||{}}},methods:{useDefaultAvatar(e){e.target.src=t(6109)},handleCommand(e){"logout"===e?this.logout():"profile"===e&&this.$router.push("/system/personal")},async logout(){const e=await this.$confirm("确定要退出登录吗, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==e)return this.$message.info("已取消退出");this.$storage.clearAll(),this.$router.push("/login"),this.$message.success("退出成功")}}};const z=(0,p.A)(W,[["render",E],["__scopeId","data-v-7d367dea"]]);var N=z;const K={class:"tags"},U={class:"circular"};function X(e,a,t,l,s,o){const n=(0,r.g2)("el-tag");return(0,r.uX)(),(0,r.CE)("div",K,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.tags,(a,t)=>((0,r.uX)(),(0,r.Wv)(n,{class:"tag",size:"medium",effect:a.title==e.$route.meta.tTitle?"dark":"plain",key:a.path,onClick:e=>o.goTo(a.path),onClose:e=>o.close(t),closable:t>0},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.Lk)("i",U,null,512),[[i.aG,a.title==e.$route.meta.tTitle]]),(0,r.eW)(" "+(0,x.v_)(a.title),1)]),_:2},1032,["effect","onClick","onClose","closable"]))),128))])}t(116);var q=t(6278),H={name:"Tags",computed:{index(){return q.Ay}},data(){return{tags:[{path:"/dashboard",title:"仪表盘"}]}},watch:{$route:{immediate:!0,handler(e){const a=this.tags.find(a=>e.path==a.path);a||this.tags.push({title:e.meta.tTitle,path:e.path})}}},methods:{goTo(e){this.$router.push(e)},close(e){this.tags.splice(e,1)}}};const B=(0,p.A)(H,[["render",X]]);var j=B,O={name:"Home",components:{HeadImage:N,Tags:j},data(){return{leftMenuList:null,activePath:"",collapseBtnClass:"Fold",isCollapse:!1}},computed:{noChildren(){return(this.leftMenuList||[]).filter(e=>!e.menuSvoList)},hasChildren(){return(this.leftMenuList||[]).filter(e=>e.menuSvoList)}},methods:{initMenuData(){try{const e=P.getItem("leftMenuList");console.log("初始化菜单数据:",e),Array.isArray(e)?this.leftMenuList=e:e?(console.warn("菜单数据格式异常，尝试修复:",e),this.leftMenuList=[]):(console.warn("未找到菜单数据，使用空数组"),this.leftMenuList=[]),this.$forceUpdate()}catch(e){console.error("初始化菜单数据失败:",e),this.leftMenuList=[]}},saveNavState(e){P.setItem("activePath",e),this.activePath=e},toggleCollapse(){this.isCollapse=!this.isCollapse,this.isCollapse?this.collapseBtnClass="Fold":this.collapseBtnClass="Expand"},removeFocusOutline(){this.$nextTick(()=>{const e=document.querySelectorAll(".el-menu-item, .el-sub-menu__title");e.forEach(e=>{e.style.outline="none",e.style.border="none",e.addEventListener("focus",e=>{e.target.style.outline="none",e.target.style.border="none",e.target.blur()}),e.addEventListener("click",e=>{e.target.style.outline="none",e.target.style.border="none",setTimeout(()=>{e.target.blur()},0)})})})}},mounted(){this.initMenuData(),this.removeFocusOutline()}};const Q=(0,p.A)(O,[["render",D],["__scopeId","data-v-3d6a32b0"]]);var G=Q,Y=(t(1701),t(8237),t(953)),J=t(163),Z=t(6744),ee=t(6651),ae=t(2505),te=t.n(ae);const le=te().create({baseURL:"",timeout:15e3,headers:{"Content-Type":"application/json"}});function se(e){return e.method=e.method||"get","get"===e.method.toLowerCase()&&(e.params=e.data||e.params),e.headers&&(delete e.headers["x-upload-lock"],delete e.headers["X-Upload-Lock"]),le(e).catch(e=>(console.error("Request failed:",e),Promise.reject(e)))}le.interceptors.request.use(e=>{const a=e.headers,t=P.getItem("token")||{};if(!a.Authorization){const e="object"===typeof t?t.access_token||t.token:t;a.Authorization="Bearer "+e}return e.url&&!e.url.startsWith("/api/v1/")&&(e.url="/api/v1"+(e.url.startsWith("/")?e.url:"/"+e.url)),e}),le.interceptors.response.use(e=>{if(e.data&&"object"===typeof e.data){const{code:a,message:t}=e.data;if(401===a)return ee.Message.error("登录已过期，请重新登录"),setTimeout(()=>{P.clearAll(),qK.push("/login")},1500),Promise.reject(new Error("TOKEN过期"));if(403===a)return ee.Message.error(t||"权限不足"),setTimeout(()=>{P.clearAll(),qK.push("/login")},1500),Promise.reject(new Error("权限不足"));if(406===a)return ee.Message.error(t||"请求参数错误"),setTimeout(()=>{P.clearAll(),qK.push("/login")},1500),Promise.reject(new Error("请求参数错误"))}return e},e=>{if(console.error("请求错误:",e),e.response){const a=e.response.status,t=e.response.data;switch(a){case 401:ee.Message.error("登录已过期，请重新登录"),setTimeout(()=>{P.clearAll(),qK.push("/login")},1500);break;case 403:ee.Message.error("权限不足，请联系管理员");break;case 404:ee.Message.error("请求的资源不存在");break;case 500:ee.Message.error(t?.message||"服务器内部错误，请稍后重试");break;case 502:case 503:case 504:ee.Message.error("服务器暂时不可用，请稍后重试");break;default:ee.Message.error(t?.message||`请求失败(${a})`)}}else e.request?ee.Message.error("网络连接失败，请检查网络设置"):ee.Message.error(e.message||"请求发生错误");return Promise.reject(e)});var oe=se;function ne(){return oe({url:"dashboard/stats",method:"get"})}function ie(){return oe({url:"dashboard/business-distribution",method:"get"})}function re(){return oe({url:"dashboard/assets",method:"get"})}var de={getDashboardStats:ne,getBusinessDistribution:ie,getAssetsStatistics:re},ce={createCluster(e){return oe({url:"/api/v1/k8s/cluster",method:"post",data:e})},getClusterList(e){return oe({url:"/api/v1/k8s/cluster",method:"get",params:e||{}})},getClusterById(e){return oe({url:`/api/v1/k8s/cluster/${e}`,method:"get"})},getClusterDetail(e){return oe({url:`/api/v1/k8s/cluster/${e}/detail`,method:"get"})},updateCluster(e,a){return oe({url:`/api/v1/k8s/cluster/${e}`,method:"put",data:a})},deleteCluster(e){return oe({url:`/api/v1/k8s/cluster/${e}`,method:"delete"})},getClusterStatus(e){return oe({url:`/api/v1/k8s/cluster/${e}/status`,method:"get"})},getClusterNodes(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/nodes`,method:"get",params:a})},getNodeDetail(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}`,method:"get"})},getNodeResources(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/resources`,method:"get"})},addNodeTaint(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/taints`,method:"post",data:t})},removeNodeTaint(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/taints`,method:"delete",data:t})},addNodeLabel(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/labels`,method:"post",data:t})},removeNodeLabel(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/labels`,method:"delete",data:t})},cordonNode(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/cordon`,method:"post",data:t})},drainNode(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}/drain`,method:"post",data:t})},addNodeToCluster(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/nodes`,method:"post",data:a})},removeNodeFromCluster(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/nodes/${a}`,method:"delete"})},createK8sTask(e){return oe({url:"/api/v1/task/k8s",method:"post",data:e})},startAnsibleTask(e){return oe({url:`/api/v1/task/ansible/${e}/start`,method:"post"})},getTaskStatus(e){return oe({url:`/api/v1/task/${e}/status`,method:"get"})},getTaskLogs(e,a){return oe({url:`/api/v1/task/${e}/logs`,method:"get",params:a})},deployApplication(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/applications`,method:"post",data:a})},getApplicationList(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/applications`,method:"get",params:a})},deleteApplication(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/applications/${a}`,method:"delete"})},getClusterResources(e){return oe({url:`/api/v1/k8s/cluster/${e}/resources`,method:"get"})},getClusterEvents(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/events`,method:"get",params:a})},getNamespaceEvents(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/events`,method:"get",params:t})},executeKubectl(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/kubectl`,method:"post",data:a})},updateClusterConfig(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/config`,method:"put",data:a})},getKubeConfig(e){return oe({url:`/api/v1/k8s/cluster/${e}/kubeconfig`,method:"get"})},registerExternalCluster(e){return oe({url:"/api/v1/k8s/cluster",method:"post",data:e})},syncCluster(e){return oe({url:`/api/v1/k8s/cluster/${e}/sync`,method:"post"})},getNamespaces(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces`,method:"get",params:a})},createNamespace(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces`,method:"post",data:a})},getNamespaceDetail(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}`,method:"get"})},deleteNamespace(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}`,method:"delete"})},getResourceQuotas(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/resourcequotas`,method:"get"})},createResourceQuota(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/resourcequotas`,method:"post",data:t})},updateResourceQuota(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/resourcequotas/${t}`,method:"put",data:l})},deleteResourceQuota(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/resourcequotas/${t}`,method:"delete"})},getLimitRanges(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/limitranges`,method:"get"})},createLimitRange(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/limitranges`,method:"post",data:t})},updateLimitRange(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/limitranges/${t}`,method:"put",data:l})},deleteLimitRange(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/limitranges/${t}`,method:"delete"})},getWorkloadList(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/workloads`,method:"get",params:t})},getWorkloadDetail(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/workloads/${t}/${l}`,method:"get"})},deleteWorkload(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/workloads/${t}/${l}`,method:"delete"})},createDeployment(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments`,method:"post",data:t})},updateDeployment(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments/${t}`,method:"put",data:l})},deleteDeployment(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments/${t}`,method:"delete"})},scaleDeployment(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments/${t}/scale`,method:"post",data:l})},restartDeployment(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments/${t}/restart`,method:"post"})},getDeploymentHistory(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments/${t}/history`,method:"get"})},rollbackDeployment(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/deployments/${t}/rollback`,method:"post",data:l})},getPodList(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pods`,method:"get",params:t})},deletePod(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pods/${t}`,method:"delete"})},getPodLogs(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pods/${t}/logs`,method:"get",params:l})},getPodYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pods/${t}/yaml`,method:"get"})},getPodEvents(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pods/${t}/events`,method:"get"})},getWorkloadYaml(e,a,t,l){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/workload-yaml/${t}/${l}`,method:"get"})},getWorkloadPods(e,a,t,l){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/workloads/${t}/${l}/pods`,method:"get"})},updatePodYaml(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pods/${t}/yaml`,method:"put",data:{yaml:l}})},updateWorkloadYaml(e,a,t,l,s,o=!1){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/workload-yaml`,method:"put",data:{workloadType:t,workloadName:l,yamlContent:s,dryRun:o}})},applyYaml(e,a){return oe({url:`/k8s/cluster/${e}/apply`,method:"post",data:{yamlContent:a}})},getPodContainers(e,a,t){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/pods/${t}/containers`,method:"get"})},getPodMetrics(e,a,t){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/pods/${t}/metrics`,method:"get"})},getNodeMetrics(e,a){return oe({url:`/k8s/cluster/${e}/nodes/${a}/metrics`,method:"get"})},getNamespaceMetrics(e,a){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/metrics`,method:"get"})},createPodFromYaml(e,a,t){return oe({url:`/k8s/cluster/${e}/namespaces/${a}/pods/yaml`,method:"post",data:{yamlContent:t.yamlContent}})},validateYaml(e,a){return oe({url:`/k8s/cluster/${e}/yaml/validate`,method:"post",data:{yamlContent:a}})},getServiceList(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services`,method:"get",params:t})},getServiceDetail(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}`,method:"get"})},createService(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services`,method:"post",data:t})},updateService(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}`,method:"put",data:l})},deleteService(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}`,method:"delete"})},getServiceYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}/yaml`,method:"get"})},updateServiceYaml(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}/yaml`,method:"put",data:{yaml:l}})},getServiceEvents(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}/events`,method:"get"})},getServiceMetrics(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/services/${t}/metrics`,method:"get"})},getIngressList(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses`,method:"get",params:t})},getIngressDetail(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}`,method:"get"})},createIngress(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses`,method:"post",data:t})},updateIngress(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}`,method:"put",data:l})},deleteIngress(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}`,method:"delete"})},getIngressYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}/yaml`,method:"get"})},updateIngressYaml(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}/yaml`,method:"put",data:{yaml:l}})},getIngressEvents(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}/events`,method:"get"})},getIngressMetrics(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/ingresses/${t}/metrics`,method:"get"})},getPVCList(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs`,method:"get",params:t||{}})},getPVCDetail(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs/${t}`,method:"get"})},createPVC(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs`,method:"post",data:t})},updatePVC(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs/${t}`,method:"put",data:l})},deletePVC(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs/${t}`,method:"delete"})},getPVCYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs/${t}/yaml`,method:"get"})},updatePVCYaml(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/pvcs/${t}/yaml`,method:"put",data:{yaml:l}})},getPVList(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/pvs`,method:"get",params:a||{}})},getPVDetail(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/pvs/${a}`,method:"get"})},createPV(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/pvs`,method:"post",data:a})},deletePV(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/pvs/${a}`,method:"delete"})},getPVYaml(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/pvs/${a}/yaml`,method:"get"})},updatePVYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/pvs/${a}/yaml`,method:"put",data:{yaml:t}})},getStorageClassList(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/storageclasses`,method:"get",params:a||{}})},getStorageClassDetail(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/storageclasses/${a}`,method:"get"})},createStorageClass(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/storageclasses`,method:"post",data:a})},deleteStorageClass(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/storageclasses/${a}`,method:"delete"})},getStorageClassYaml(e,a){return oe({url:`/api/v1/k8s/cluster/${e}/storageclasses/${a}/yaml`,method:"get"})},updateStorageClassYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/storageclasses/${a}/yaml`,method:"put",data:{yaml:t}})},getConfigMaps(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps`,method:"get",params:t||{}})},getConfigMapDetail(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps/${t}`,method:"get"})},createConfigMap(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps`,method:"post",data:t})},updateConfigMap(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps/${t}`,method:"put",data:l})},deleteConfigMap(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps/${t}`,method:"delete"})},getConfigMapYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps/${t}/yaml`,method:"get"})},updateConfigMapYaml(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/configmaps/${t}/yaml`,method:"put",data:{yaml:l}})},getSecrets(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets`,method:"get",params:t||{}})},getSecretDetail(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets/${t}`,method:"get"})},createSecret(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets`,method:"post",data:t})},updateSecret(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets/${t}`,method:"put",data:l})},deleteSecret(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets/${t}`,method:"delete"})},getSecretYaml(e,a,t){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets/${t}/yaml`,method:"get"})},updateSecretYaml(e,a,t,l){return oe({url:`/api/v1/k8s/cluster/${e}/namespaces/${a}/secrets/${t}/yaml`,method:"put",data:{yaml:l}})}},ue={getHostMonitorData(e){console.log("请求监控数据参数:",JSON.stringify(e,null,2));const{id:a,duration:t,start:l,end:s}=e;let o=`monitor/hosts/${a}/all-metrics`;const n={};return t?n.duration=t:l&&s&&(n.start=l,n.end=s),oe({url:o,method:"get",params:n})},getHostsMonitorData(e){return console.log("请求批量监控数据，主机IDs:",e),oe({url:"monitor/hosts",method:"get",params:{ids:e}})},getHostTopProcesses(e){return oe({url:`monitor/hosts/${e}/top-processes`,method:"get"})},getHostTcpPorts(e){return oe({url:`monitor/hosts/${e}/ports`,method:"get"})},getHostList(e){return oe({url:"cmdb/host/list",method:"get",params:e})},getAllCmdbGroups(){return oe({url:"cmdb/grouplist",method:"get"})},getCmdbGroupByName(e){return oe({url:"cmdb/groupbyname",method:"get",params:{name:e}})},createCmdbGroup(e){return oe({url:"cmdb/groupadd",method:"post",data:e})},updateCmdbGroup(e){return oe({url:"cmdb/groupupdate",method:"put",data:e})},deleteCmdbGroup(e){const a={id:e};return oe({url:"cmdb/groupdelete",method:"delete",data:a})},createCmdbHost(e){return oe({url:"cmdb/hostcreate",method:"post",data:e})},updateCmdbHost(e){return oe({url:"cmdb/hostupdate",method:"put",data:e})},deleteCmdbHost(e){return oe({url:"cmdb/hostdelete",method:"delete",data:{id:e}})},getCmdbHostList(e){const a={page:e.page||1,pageSize:e.pageSize||10};return e.name&&(a.name=e.name),e.ip&&(a.ip=e.ip),e.status&&(a.status=e.status),e.groupId&&(a.groupId=e.groupId),console.log("最终API查询参数:",JSON.stringify(a,null,2)),oe({url:"cmdb/hostlist",method:"get",params:a})},getCmdbHostById(e){return oe({url:"cmdb/hostinfo",method:"get",params:{id:e}})},getCmdbHostsByGroupId(e){return oe({url:"cmdb/hostgroup",method:"get",params:{groupId:e}})},GetCmdbHostsByHostNameLike(e,a){return oe({url:"/cmdb/hostbyname",method:"get",params:{name:e,...a}})},GetCmdbHostsByIP(e,a){return oe({url:"cmdb/hostbyip",method:"get",params:{ip:e,...a}})},GetCmdbHostsByStatus(e,a){return oe({url:"cmdb/hostbystatus",method:"get",params:{status:e,...a}})},getCmdbHostsByGroupId(e,a){return oe({url:"cmdb/hostgroup",method:"get",params:{groupId:e,...a}})},hostcloudcreatealiyun(e){return oe({url:"cmdb/hostcloudcreatealiyun",method:"post",data:e})},hostcloudcreatetencent(e){return oe({url:"cmdb/hostcloudcreatetencent",method:"post",data:e})},getGroupListWithHosts(){return oe({url:"cmdb/grouplistwithhosts",method:"get"})},getHostSSHWebSocketUrl(e){return`ws://127.0.0.1:8000/api/v1/cmdb/hostssh/connect/${e}`},uploadFileToHost(e,a,t={}){return oe({url:`cmdb/hostssh/upload/${e}`,method:"post",data:a,headers:{"Content-Type":"multipart/form-data"},...t})},executeHostCommand(e,a){return oe({url:`cmdb/hostssh/command/${e}`,method:"get",params:{command:a}})},createDatabase(e){return oe({url:"cmdb/database",method:"post",data:e})},updateDatabase(e){return oe({url:"cmdb/database",method:"put",data:e})},deleteDatabase(e){return oe({url:"cmdb/database",method:"delete",data:{id:e}})},getDatabase(e){return oe({url:"cmdb/database/info",method:"get",params:{id:e}})},listDatabases(e={}){return oe({url:"cmdb/databaselist",method:"get",params:e})},getDatabasesByName(e,a={}){return oe({url:"cmdb/database/byname",method:"get",params:{name:e,...a}})},getDatabasesByType(e,a={}){return oe({url:"cmdb/database/bytype",method:"get",params:{type:e,...a}})},executeSelectSQL(e){return console.log("executeSelectSQL请求数据:",JSON.stringify(e,null,2)),oe({url:"cmdb/sql/select",method:"post",data:e,headers:{"Content-Type":"application/json"}})},executeInsertSQL(e){return console.log("executeInsertSQL请求数据:",JSON.stringify(e,null,2)),oe({url:"cmdb/sql",method:"post",data:e,headers:{"Content-Type":"application/json"}})},executeUpdateSQL(e){return console.log("executeUpdateSQL请求数据:",JSON.stringify(e,null,2)),oe({url:"cmdb/sql",method:"put",data:e,headers:{"Content-Type":"application/json"}})},executeDeleteSQL(e){return console.log("executeDeleteSQL请求数据:",JSON.stringify(e,null,2)),oe({url:"cmdb/sql",method:"delete",data:e,headers:{"Content-Type":"application/json"}})},executeRawSQL(e){return console.log("executeRawSQL请求数据:",JSON.stringify(e,null,2)),oe({url:"cmdb/sql/execute",method:"post",data:e,headers:{"Content-Type":"application/json"}})},executeDatabase(e){return console.log("executeDatabase请求数据:",JSON.stringify(e,null,2)),oe({url:"cmdb/sql/databaselist",method:"post",data:e,headers:{"Content-Type":"application/json"}})},GetCmdbSqlLogList(e){return oe({url:"cmdb/sqlLog/list",method:"get",params:e})},DeleteCmdbSqlLogById(e){return oe({url:"cmdb/sqlLog/delete",method:"delete",data:{id:e}})},CleanCmdbSqlLog(){return oe({url:"cmdb/sqlLog/clean",method:"delete"})},ImportHostsFromExcel(e){return oe({url:"cmdb/hostimport",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})},DownloadHostTemplate(){return oe({url:"cmdb/hosttemplate",method:"get",responseType:"blob"})},syncHostConfig(e){return oe({url:"cmdb/hostsync",method:"post",data:{id:e},headers:{"Content-Type":"application/json"}})},deployAgent(e,a="1.0.0"){const t=Array.isArray(e)?e:[e];return oe({url:"monitor/agent/deploy",method:"post",data:{hostIds:t,version:a}})},uninstallAgent(e){const a=Array.isArray(e)?e:[e];return oe({url:"monitor/agent/uninstall",method:"delete",data:{hostIds:a}})},getAgentStatus(e){return oe({url:`monitor/agent/status/${e}`,method:"get"})},restartAgent(e){return oe({url:`monitor/agent/restart/${e}`,method:"post"})},getAgentList(e){return oe({url:"monitor/agent/list",method:"get",params:e})},deleteAgent(e){return oe({url:`monitor/agent/delete/${e}`,method:"delete"})}};function pe(e){return oe({url:"template/add",method:"post",data:e,headers:{"Content-Type":"application/json"}})}function me(e){return oe({url:"template/list",method:"get",params:e,headers:{Accept:"application/json"}})}function ge(e){return oe({url:`template/update?id=${e.id}`,method:"put",data:{name:e.name,type:e.type,content:e.content,remark:e.remark}})}function ve(e){return oe({url:"template/delete",method:"delete",params:e})}function he(e){return oe({url:"template/content/"+e.id,method:"get",headers:{Accept:"text/plain"}})}function ke(e){return console.log("查询模板名称参数:",e),oe({url:`template/query/name?name=${encodeURIComponent(e.name||"")}`,method:"get",params:{pageNum:e.pageNum,pageSize:e.pageSize},headers:{Accept:"application/json",Authorization:localStorage.getItem("token")||""}})}function be(e){return console.log("查询模板类型参数:",e),oe({url:`template/query/type?type=${e.type}`,method:"get",params:{pageNum:e.pageNum,pageSize:e.pageSize},headers:{Accept:"application/json",Authorization:localStorage.getItem("token")||""}})}function fe(e){return oe({url:"task/add",method:"post",data:e,headers:{"Content-Type":"application/json"}})}function ye(e){return oe({url:"task/delete",method:"delete",data:e,headers:{"Content-Type":"application/json"}})}function _e(e){return oe({url:"task/list",method:"get",params:e})}function we(e){return oe({url:"task/query/name",method:"get",params:e})}function Le(e){return oe({url:"task/query/type",method:"get",params:e})}function Fe(e){return oe({url:"task/query/status",method:"get",params:e})}function Ce(e){return oe({url:"task/next-execution",method:"get",params:e})}function Ve(e){return console.log("获取任务模板参数:",e),oe({url:"task/templates",method:"get",params:{id:e.id},headers:{Accept:"application/json",Authorization:localStorage.getItem("token")||""}}).catch(e=>{throw console.error("获取任务模板失败:",e),e})}function xe(e){return oe({url:"taskjob/log",method:"get",params:{taskId:e.taskId,templateId:e.templateId},headers:{Accept:"application/json"}})}function Se(e){return oe({url:`taskjob/start?taskId=${e.taskId}`,method:"post",headers:{accept:"application/json"}})}function Ie(e){return oe({url:"taskjob/stop",method:"post",params:{taskId:e.taskId,templateId:e.templateId},headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json"}})}function Ae(e){return oe({url:"task/ansiblelist",method:"get",params:e})}function Re(e){return oe({url:"task/ansible",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})}function De(e,a,t=0){const l=1,s=0===t?3e4:18e4;return oe({url:`/task/ansible/${e}/log/${a}`,method:"get",timeout:s,params:{t:Date.now(),realtime:!0,includeBuffer:!0}}).then(l=>(console.log("🔍 日志API调用详情:",{taskId:e,workId:a,requestUrl:`/api/v1/task/ansible/${e}/log/${a}`,timestamp:(new Date).toISOString(),responseSize:l.data?JSON.stringify(l.data).length:0,responsePreview:l.data?JSON.stringify(l.data).substring(0,100)+"...":"null",retryCount:t,timeout:s/1e3+"s"}),l)).catch(o=>{if(console.error("❌ 获取历史日志失败:",o),"ECONNABORTED"===o.code&&t<l)return console.log(`🔄 超时重试 (${t+1}/${l})，使用更长超时时间 (${s/1e3}秒 -> 180秒)`),De(e,a,t+1);const n=0===t?"30秒":"3分钟",i={...o,contextMessage:`后端处理超过${n}，可能正在执行长时间操作`};throw i})}function Pe(e){return oe({url:`task/ansible/${e}`,method:"get",headers:{Accept:"application/json"}})}function $e(e){return oe({url:`task/ansible/${e}/start`,method:"post",headers:{Accept:"application/json"}})}function Te(e){return oe({url:`task/ansible/${e}`,method:"delete",headers:{Accept:"application/json"}})}function Me(e){return console.log("查询Ansible任务名称参数:",e),oe({url:`task/ansible/query/name?name=${encodeURIComponent(e.name||"")}`,method:"get",params:{page:e.page,pageSize:e.pageSize},headers:{Accept:"application/json",Authorization:localStorage.getItem("token")||""}}).catch(e=>{throw console.error("按名称查询Ansible任务失败:",e),e})}function Ee(e){return console.log("查询Ansible任务类型参数:",e),oe({url:`task/ansible/query/type?type=${e.type}`,method:"get",params:{page:e.page,pageSize:e.pageSize},headers:{Accept:"application/json",Authorization:localStorage.getItem("token")||""}}).catch(e=>{throw console.error("按类型查询Ansible任务失败:",e),e})}function We(e){return oe({url:"task/monitor/scheduled/pause",method:"post",params:{task_id:e},headers:{Accept:"application/json"}})}function ze(e){return oe({url:"task/monitor/scheduled/resume",method:"post",params:{task_id:e},headers:{Accept:"application/json"}})}const Ne={createApplication(e){return oe({url:"/apps",method:"post",data:e})},getApplicationList(e){return oe({url:"/apps",method:"get",params:e})},getApplicationDetail(e){return oe({url:`/apps/${e}`,method:"get"})},updateApplication(e,a){return oe({url:`/apps/${e}`,method:"put",data:a})},deleteApplication(e){return oe({url:`/apps/${e}`,method:"delete"})},getAppJenkinsEnvs(e){return oe({url:`/apps/${e}/jenkins-envs`,method:"get"})},addAppJenkinsEnv(e,a){return oe({url:`/apps/${e}/jenkins-envs`,method:"post",data:a})},updateAppJenkinsEnv(e,a,t){return oe({url:`/apps/${e}/jenkins-envs/${a}`,method:"put",data:t})},deleteAppJenkinsEnv(e,a){return oe({url:`/apps/${e}/jenkins-envs/${a}`,method:"delete"})},getJenkinsServers(){return oe({url:"/apps/jenkins-servers",method:"get"})},searchJenkinsJobs(e,a=""){return oe({url:`/jenkins/${e}/jobs/search`,method:"get",params:{search:a}})},validateJenkinsJob(e){return oe({url:"/apps/jenkins-job/validate",method:"post",data:e})},getDeployableApplications(e){return oe({url:"/apps/deployment/applications",method:"get",params:e})},createQuickDeployment(e){return oe({url:"/apps/deployment/quick",method:"post",data:e})},executeQuickDeployment(e){return oe({url:"/apps/deployment/execute",method:"post",data:e})},getDeploymentDetail(e){return oe({url:`/apps/deployment/${e}`,method:"get"})},getDeploymentList(e){return oe({url:"/apps/deployment/list",method:"get",params:e})},getServiceTree(e){return oe({url:"/apps/service-tree",method:"get",params:e})},getBusinessGroupOptions(){return oe({url:"/apps/business-group-options",method:"get"})},getEnvironment(e){return oe({url:"/apps/environment",method:"get",params:e})},getTaskLog(e,a=0){return oe({url:`/apps/deployment/tasks/${e}/log`,method:"get",params:{start:a}})},getTaskStatus(e){return oe({url:`/apps/deployment/tasks/${e}/status`,method:"get"})},stopTask(e){return oe({url:`/apps/deployment/tasks/${e}/stop`,method:"post"})},stopJenkinsTask(e,a,t){return oe({url:`/jenkins/${e}/jobs/${a}/builds/${t}/stop`,method:"post"})},getBatchTaskStatus(e){return oe({url:"/apps/deployment/tasks/batch-status",method:"post",data:{task_ids:e}})},deleteDeployment(e){return oe({url:`/apps/deployment/${e}`,method:"delete"})}};var Ke=Ne,Ue={queryPostList(e){return oe({url:"post/list",method:"get",params:e})},batchDeleteSysPost(e){const a={ids:e};return oe({url:"post/batch/delete",method:"delete",data:a})},deleteSysPost(e){const a={id:e};return oe({url:"post/delete",method:"delete",data:a})},querySysPostVoList(){return oe({url:"post/vo/list",method:"get"})},addPost(e){return oe({url:"post/add",method:"post",data:e})},postInfo(e){return oe({url:"post/info",method:"get",params:{id:e}})},updatePost(e){return oe({url:"post/update",method:"put",data:e})},updatePostStatus(e,a){return oe({url:"post/updateStatus",method:"put",data:{id:e,postStatus:a}})},queryDeptList(e){return oe({url:"dept/list",method:"get",params:e})},querySysDeptVoList(){return oe({url:"dept/vo/list",method:"get"})},addDept(e){return oe({url:"dept/add",method:"post",data:e})},deleteDept(e){return oe({url:"dept/delete",method:"delete",data:{id:e}})},deptInfo(e){return oe({url:"dept/info",method:"get",params:{id:e}})},deptUsers(e){return oe({url:"dept/users",method:"get",params:{deptId:e}})},deptUpdate(e){return oe({url:"dept/update",method:"put",data:e})},queryMenuList(e){return oe({url:"menu/list",method:"get",params:e})},querySysMenuVoList(){return oe({url:"menu/vo/list",method:"get"})},addMenu(e){return oe({url:"menu/add",method:"post",data:e})},menuInfo(e){return oe({url:"menu/info",method:"get",params:{id:e}})},menuUpdate(e){return oe({url:"menu/update",method:"put",data:e})},menuDelete(e){return oe({url:"menu/delete",method:"delete",data:{id:e}})},queryRoleList(e){return oe({url:"role/list",method:"get",params:e})},querySysRoleVoList(){return oe({url:"role/vo/list",method:"get"})},addRole(e){return oe({url:"role/add",method:"post",data:e})},roleInfo(e){return oe({url:"role/info",method:"get",params:{id:e}})},roleUpdate(e){return oe({url:"role/update",method:"put",data:e})},deleteRole(e){return oe({url:"role/delete",method:"delete",data:{id:e}})},updateRoleStatus(e,a){return oe({url:"role/updateStatus",method:"put",data:{id:e,status:a}})},QueryRoleMenuIdList(e){return oe({url:"role/vo/idList",method:"get",params:{id:e}})},AssignPermissions(e,a){return oe({url:"role/assignPermissions",method:"put",data:{id:e,menuIds:a}})},queryAdminList(e){return oe({url:"admin/list",method:"get",params:e})},updateAdminStatus(e,a){return oe({url:"admin/updateStatus",method:"put",data:{id:e,status:a}})},addAdmin(e){return oe({url:"admin/add",method:"post",data:e})},adminInfo(e){return oe({url:"admin/info",method:"get",params:{id:e}})},adminUpdate(e){return oe({url:"admin/update",method:"put",data:e})},resetPassword(e,a){return oe({url:"admin/updatePassword",method:"put",data:{id:e,password:a}})},deleteAdmin(e){return oe({url:"admin/delete",method:"delete",data:{id:e}})},adminUpdatePersonal(e){return oe({url:"admin/updatePersonal",method:"put",data:e})},adminUpdatePersonalPassword(e){return oe({url:"admin/updatePersonalPassword",method:"put",data:e})},querySysLoginInfoList(e){return oe({url:"sysLoginInfo/list",method:"get",params:e})},batchDeleteSysLoginInfo(e){return oe({url:"sysLoginInfo/batch/delete",method:"delete",data:{ids:e}})},cleanSysLoginInfo(){return oe({url:"sysLoginInfo/clean",method:"delete"})},deleteSysLoginInfo(e){return oe({url:"sysLoginInfo/delete",method:"delete",data:{id:e}})},querySysOperationLogList(e){return oe({url:"sysOperationLog/list",method:"get",params:e})},batchDeleteSysOperationLog(e){return oe({url:"sysOperationLog/batch/delete",method:"delete",data:{ids:e}})},cleanSysOperationLog(){return oe({url:"sysOperationLog/clean",method:"delete"})},deleteSysOperationLog(e){return oe({url:"sysOperationLog/delete",method:"delete",data:{id:e}})},getUploadUrl(){return"/api/v1/upload"}};const Xe={class:"dashboard-container"},qe={class:"main-status-header"},He={class:"right-section"},Be={class:"key-metrics"},je={class:"metric-card"},Oe={class:"metric-content"},Qe={class:"metric-value"},Ge={class:"metric-status"},Ye={class:"metric-card"},Je={class:"metric-content"},Ze={class:"metric-value"},ea={class:"metric-status"},aa={class:"metric-card"},ta={class:"metric-content"},la={class:"metric-value"},sa={class:"metric-status"},oa={class:"metric-card"},na={class:"metric-content"},ia={class:"metric-value"},ra={class:"metric-status"},da={class:"metric-card"},ca={class:"metric-content"},ua={class:"metric-value"},pa={class:"metric-status"},ma={class:"category-navigation"},ga={class:"nav-grid"},va={class:"nav-content"},ha={class:"nav-stats"},ka={class:"nav-content"},ba={class:"nav-stats"},fa={class:"nav-content"},ya={class:"nav-stats"},_a={class:"overview-dashboard"},wa={class:"overview-grid"},La={class:"overview-card deployment-ratio"},Fa={class:"card-header"},Ca={class:"success-rate"},Va={class:"deployment-chart"},xa={class:"chart-circle"},Sa={class:"outer-ring"},Ia={class:"progress-ring",width:"192",height:"192"},Aa=["stroke-dasharray"],Ra={class:"chart-center"},Da={class:"success-count"},Pa={class:"total-count"},$a={class:"deployment-stats"},Ta={class:"stat-item success"},Ma={class:"stat-content"},Ea={class:"stat-value"},Wa={class:"stat-item failed"},za={class:"stat-content"},Na={class:"stat-value"},Ka={class:"stat-item pending"},Ua={class:"stat-content"},Xa={class:"stat-value"},qa={class:"overview-card asset-statistics"},Ha={class:"card-header"},Ba={class:"asset-total"},ja={class:"asset-grid"},Oa={class:"category-icon"},Qa=["src","alt"],Ga={class:"category-info"},Ya={class:"category-name"},Ja={class:"category-count"},Za={class:"overview-card business-distribution"},et={class:"card-header"},at={class:"business-total"},tt={class:"pie-chart-container"},lt={class:"pie-chart"},st={class:"pie-svg",width:"280",height:"280",viewBox:"0 0 140 140"},ot=["d","fill","stroke","onMouseenter"],nt={key:0,class:"pie-tooltip"},it={class:"tooltip-content"},rt={class:"tooltip-name"},dt={class:"tooltip-value"},ct={class:"tooltip-percentage"},ut={class:"business-legend"},pt={class:"legend-info"},mt={class:"legend-name"},gt={class:"legend-value"},vt={key:0,class:"refresh-indicator"},ht={class:"refresh-info"},kt={key:0,class:"last-refresh"},bt={key:1,class:"loading-overlay"};var ft={__name:"index",setup(e){const a=(0,v.rd)(),l=(0,Y.KR)(!0),s=(0,Y.KR)(null),o=(0,Y.KR)(0),n=(0,Y.KR)(null),i=(0,Y.Kh)({hostStats:{total:0,online:0,offline:0},k8sClusterStats:{total:0,healthy:0,offline:0},deploymentStats:{total:0,success:0,failed:0,successRate:0},taskStats:{total:0,success:0,failed:0,successRate:0},serviceStats:{total:0,businessLines:0},databaseStats:{total:0,byType:{MySQL:0,Redis:0,PostgreSQL:0,MongoDB:0,Elasticsearch:0}}}),d=(0,Y.Kh)({avgCpuUsage:0,avgMemoryUsage:0,networkTraffic:0,businessDistribution:[]}),c=(0,Y.Kh)({totalServices:0,businessLines:[]}),u=(0,Y.Kh)({totalAssets:0,categories:[]});let p=null,m=null;const g=async()=>{try{console.log("🚀 开始调用Dashboard API...");const e=await ne();console.log("📡 Dashboard API响应:",e);const a=e.data||e;return 200===a.code&&a.data?(Object.assign(i,a.data),console.log("📊 Dashboard统计数据加载完成:",i),J.nk.success("统计数据加载成功"),!0):(console.warn("Dashboard API返回异常:",a),J.nk.error(`Dashboard API错误: ${a.message||"未知错误"}`),!1)}catch(e){return console.error("加载Dashboard统计数据失败:",e),J.nk.error(`API调用失败: ${e.message}`),!1}},h=async()=>{try{console.log("🚀 开始调用业务分布 API...");const e=await ie();console.log("📡 业务分布 API响应:",e);const a=e.data||e;if(200===a.code&&a.data){Object.assign(c,a.data);const e=["#667eea","#764ba2","#f093fb","#4facfe","#43e97b","#ff6b6b","#4ecdc4","#45b7d1"];return d.businessDistribution=c.businessLines.map((a,t)=>({name:a.name,value:a.serviceCount,color:e[t%e.length],percentage:a.percentage})),console.log("📊 业务分布数据加载完成:",c),!0}return console.warn("业务分布 API返回异常:",a),d.businessDistribution=[{name:"默认业务线",value:10,color:"#667eea",percentage:100}],!1}catch(e){return console.error("加载业务分布数据失败:",e),d.businessDistribution=[{name:"默认业务线",value:10,color:"#667eea",percentage:100}],!1}},k=async()=>{try{console.log("🚀 开始调用资产统计 API...");const e=await re();console.log("📡 资产统计 API响应:",e);const a=e.data||e;return 200===a.code&&a.data?(Object.assign(u,a.data),console.log("📊 资产统计数据加载完成:",u),!0):(console.warn("资产统计 API返回异常:",a),!1)}catch(e){return console.error("加载资产统计数据失败:",e),!1}},b=async()=>{try{const t=await ce.getClusterList({page:1,pageSize:100});if(200===t.code&&t.data){const l=t.data.records||t.data.items||t.data;d.totalClusters=l.length,d.healthyClusters=l.filter(e=>"Running"===e.status||"Active"===e.status).length;let s=0,o=0,n=0,i=0,r=0,c=0;for(const t of l.slice(0,5))try{const a=await ce.getClusterNodes(t.id);if(200===a.code&&a.data){const e=Array.isArray(a.data)?a.data:[];s+=e.length,o+=e.filter(e=>"Ready"===e.status).length}try{const e=await ce.getPodList(t.id,"default",{page:1,pageSize:1e3});if(200===e.code&&e.data){const a=Array.isArray(e.data)?e.data:e.data.records||e.data.items||[];n+=a.length,i+=a.filter(e=>"Running"===e.status).length,r+=a.filter(e=>"Pending"===e.status).length,c+=a.filter(e=>"Failed"===e.status).length}}catch(e){console.warn(`获取集群 ${t.id} Pod数据失败:`,e)}}catch(a){console.warn(`获取集群 ${t.id} 详情失败:`,a)}d.totalNodes=s,d.healthyNodes=o,d.totalPods=n,d.runningPods=i,d.pendingPods=r,d.failedPods=c}}catch(t){console.error("加载K8s数据失败:",t)}},f=async()=>{try{const e=await ue.getCmdbHostList({page:1,pageSize:1e3});if(200===e.code&&e.data){const a=e.data.records||e.data.items||e.data;d.totalHosts=Array.isArray(a)?a.length:e.data.total||0,d.onlineHosts=Array.isArray(a)?a.filter(e=>"online"===e.status||"1"===e.status||1===e.status).length:0}const a=await ue.listDatabases({page:1,pageSize:1e3});if(200===a.code&&a.data){const e=a.data.records||a.data.items||a.data;d.totalDatabases=Array.isArray(e)?e.length:a.data.total||0,d.activeDatabases=Array.isArray(e)?e.filter(e=>"active"===e.status||"1"===e.status).length:0}}catch(e){console.error("加载CMDB数据失败:",e)}},y=async()=>{try{const a=await me({page:1,pageSize:1e3});if(200===a.code&&a.data){const e=a.data.records||a.data.items||a.data;d.totalTasks=Array.isArray(e)?e.length:a.data.total||0,Array.isArray(e)&&(d.runningTasks=e.filter(e=>"running"===e.status||"1"===e.status).length,d.completedTasks=e.filter(e=>"completed"===e.status||"2"===e.status).length,d.failedTasks=e.filter(e=>"failed"===e.status||"3"===e.status).length)}try{const e=await me({page:1,pageSize:1e3,type:"ansible"});if(200===e.code&&e.data){const a=e.data.records||e.data.items||e.data,t=Array.isArray(a)?a.length:e.data.total||0;d.totalTasks+=t}}catch(e){console.warn("获取Ansible任务失败:",e)}}catch(a){console.error("加载任务数据失败:",a)}},_=async()=>{try{const e=await Ke.getApplicationList({page:1,pageSize:1e3});if(200===e.code&&e.data){const a=e.data.records||e.data.items||e.data;d.totalDeployments=Array.isArray(a)?a.length:e.data.total||0,Array.isArray(a)&&(d.successfulDeployments=a.filter(e=>"success"===e.status||"completed"===e.status).length,d.failedDeployments=a.filter(e=>"failed"===e.status||"error"===e.status).length,d.deploymentSuccessRate=d.totalDeployments>0?Math.round(d.successfulDeployments/d.totalDeployments*100):0)}}catch(e){console.error("加载发布数据失败:",e)}},w=async()=>{try{console.warn("系统API中没有用户列表接口，使用模拟数据")}catch(e){console.error("加载用户数据失败:",e)}},L=async()=>{try{const a=await ue.getCmdbHostList({page:1,pageSize:10});if(200===a.code&&a.data){const t=a.data.records||a.data.items||[];if(Array.isArray(t)&&t.length>0){const a=t.map(e=>e.id).filter(e=>e);if(a.length>0)try{throw new Error("使用模拟监控数据")}catch(e){console.warn("获取监控数据失败:",e),d.avgCpuUsage=Math.floor(30*Math.random())+40,d.avgMemoryUsage=Math.floor(25*Math.random())+55,d.networkTraffic=Math.floor(50*Math.random())+100}}}}catch(a){console.error("加载性能数据失败:",a),d.avgCpuUsage=Math.floor(30*Math.random())+40,d.avgMemoryUsage=Math.floor(25*Math.random())+55,d.networkTraffic=Math.floor(50*Math.random())+100}},F=()=>{let e=100;if(i.k8sClusterStats.total>0){const a=i.k8sClusterStats.healthy/i.k8sClusterStats.total;e-=20*(1-a)}if(i.hostStats.total>0){const a=i.hostStats.online/i.hostStats.total;e-=15*(1-a)}i.deploymentStats.successRate<95&&(e-=.5*(95-i.deploymentStats.successRate)),i.taskStats.successRate<95&&(e-=.3*(95-i.taskStats.successRate)),d.avgCpuUsage>80&&(e-=.5*(d.avgCpuUsage-80)),d.avgMemoryUsage>85&&(e-=.5*(d.avgMemoryUsage-85)),o.value=Math.max(0,Math.round(e))},C=async(e=!0)=>{e&&(l.value=!0);try{const a=await Promise.allSettled([g(),h(),k(),L()]),[t,l,o]=a;"rejected"!==t.status&&t.value||(console.log("⚠️ 统一API失败，使用详细查询模式"),await Promise.allSettled([b(),f(),y(),_(),w()])),F(),s.value=new Date,e?console.log("🚀 Dashboard数据加载完成"):console.log("🔄 Dashboard数据后台刷新完成")}catch(a){console.error("加载Dashboard数据失败:",a),e&&J.nk.error("加载仪表盘数据失败")}finally{e&&(l.value=!1)}},V=async()=>{try{await C(!1)}catch(e){console.warn("后台数据刷新失败:",e)}},S=()=>{C(!0),p=setInterval(()=>{V()},6e4),m=setInterval(()=>{T.value=new Date},1e4)},I=()=>{p&&(clearInterval(p),p=null),m&&(clearInterval(m),m=null)},A=async()=>{J.nk.info("测试Dashboard API...");try{console.log("🧪 测试Dashboard API调用");const e=await g();e?J.nk.success("Dashboard API测试成功！"):J.nk.error("Dashboard API测试失败")}catch(e){console.error("测试失败:",e),J.nk.error(`测试失败: ${e.message}`)}},R=e=>{const t={assets:"/dashboard/assets",services:"/dashboard/services",monitoring:"/dashboard/monitoring",users:"/dashboard/users"};t[e]?(console.log("导航到:",t[e]),a.push(t[e]).catch(e=>{console.error("路由导航失败:",e)})):console.error("未找到路由:",e)},D=(0,r.EW)(()=>{const e=d.businessDistribution.reduce((e,a)=>e+a.value,0);if(0===e)return[];let a=0;const t=70,l=70,s=50;return d.businessDistribution.map(o=>{const n=o.value/e,i=360*n,r=a-90,d=a+i-90,c=r*Math.PI/180,u=d*Math.PI/180,p=t+s*Math.cos(c),m=l+s*Math.sin(c),g=t+s*Math.cos(u),v=l+s*Math.sin(u),h=i>180?1:0,k=[`M ${t} ${l}`,`L ${p} ${m}`,`A ${s} ${s} 0 ${h} 1 ${g} ${v}`,"Z"].join(" ");return a+=i,{path:k,color:o.color}})}),P=()=>u.totalAssets||185,$=(0,r.EW)(()=>{if(u.categories&&u.categories.length>0){const e=[];return u.categories.forEach(a=>{a.items.forEach(t=>{e.push({name:t.name,count:t.count,health:W(a.category,t.name,t.count),icon:E(t.name)})})}),e}return[{name:"自建主机",count:10,health:"在线: 8",icon:t(6570)},{name:"腾讯云",count:50,health:"在线: 45",icon:t(7757)},{name:"阿里云",count:100,health:"在线: 95",icon:t(6241)},{name:"MySQL",count:5,health:"运行: 5",icon:t(4154)},{name:"PostgreSQL",count:6,health:"运行: 6",icon:t(7646)},{name:"Redis",count:6,health:"运行: 6",icon:t(1873)},{name:"MongoDB",count:3,health:"运行: 3",icon:t(4702)},{name:"K8s集群",count:5,health:"健康: 4",icon:t(496)}]}),T=(0,Y.KR)(new Date),M=(0,r.EW)(()=>{if(!s.value)return"";const e=T.value,a=e-s.value,t=Math.floor(a/1e3);if(t<60)return`${t}秒前`;if(t<3600){const e=Math.floor(t/60);return`${e}分钟前`}return s.value.toLocaleTimeString()}),E=e=>{const a={"自建主机":t(6570),"腾讯云":t(7757),"阿里云":t(6241),MySQL:t(4154),PostgreSQL:t(7646),Redis:t(1873),MongoDB:t(4702),Elasticsearch:t(4801),"K8s集群":t(496)};return a[e]||t(6570)},W=(e,a,t)=>{if("主机"===e){const e=Math.round(.9*t);return`在线: ${e}`}if("数据库"===e)return`运行: ${t}`;if("K8s集群"===e){const e=Math.round(.8*t);return`健康: ${e}`}return`正常: ${t}`},z=(e,a)=>{n.value={...e,index:a}},N=()=>{n.value=null};return(0,r.sV)(()=>{S()}),(0,r.hi)(()=>{I()}),(e,a)=>((0,r.uX)(),(0,r.CE)("div",Xe,[(0,r.Lk)("div",qe,[(0,r.Lk)("div",{class:"left-section"},[(0,r.Lk)("div",{class:"header-title"},[a[4]||(a[4]=(0,r.Lk)("h1",null,"DevOps 运维系统",-1)),a[5]||(a[5]=(0,r.Lk)("p",null,"智能运维管理平台 - 全面监控 · 高效管理 · 智能运维",-1)),(0,r.Lk)("button",{onClick:A,style:{"margin-top":"10px",padding:"5px 10px",background:"#667eea",color:"white",border:"none","border-radius":"4px",cursor:"pointer"}}," 测试Dashboard API ")])]),(0,r.Lk)("div",He,[(0,r.Lk)("div",Be,[(0,r.Lk)("div",je,[a[7]||(a[7]=(0,r.Lk)("div",{class:"metric-icon"},"🏠",-1)),(0,r.Lk)("div",Oe,[(0,r.Lk)("div",Qe,(0,x.v_)(i.hostStats.total.toLocaleString()),1),a[6]||(a[6]=(0,r.Lk)("div",{class:"metric-label"},"主机总数",-1)),(0,r.Lk)("div",Ge,"在线: "+(0,x.v_)(i.hostStats.online),1)])]),(0,r.Lk)("div",Ye,[a[9]||(a[9]=(0,r.Lk)("div",{class:"metric-icon"},"☁️",-1)),(0,r.Lk)("div",Je,[(0,r.Lk)("div",Ze,(0,x.v_)(i.k8sClusterStats.total.toLocaleString()),1),a[8]||(a[8]=(0,r.Lk)("div",{class:"metric-label"},"K8s集群总数",-1)),(0,r.Lk)("div",ea,"健康: "+(0,x.v_)(i.k8sClusterStats.healthy),1)])]),(0,r.Lk)("div",aa,[a[11]||(a[11]=(0,r.Lk)("div",{class:"metric-icon"},"🚀",-1)),(0,r.Lk)("div",ta,[(0,r.Lk)("div",la,(0,x.v_)(i.deploymentStats.total.toLocaleString()),1),a[10]||(a[10]=(0,r.Lk)("div",{class:"metric-label"},"发布总次数",-1)),(0,r.Lk)("div",sa,"成功率: "+(0,x.v_)(i.deploymentStats.successRate)+"%",1)])]),(0,r.Lk)("div",oa,[a[13]||(a[13]=(0,r.Lk)("div",{class:"metric-icon"},"⚙️",-1)),(0,r.Lk)("div",na,[(0,r.Lk)("div",ia,(0,x.v_)(i.taskStats.total.toLocaleString()),1),a[12]||(a[12]=(0,r.Lk)("div",{class:"metric-label"},"任务执行次数",-1)),(0,r.Lk)("div",ra,"成功: "+(0,x.v_)(i.taskStats.success),1)])]),(0,r.Lk)("div",da,[a[15]||(a[15]=(0,r.Lk)("div",{class:"metric-icon"},"📦",-1)),(0,r.Lk)("div",ca,[(0,r.Lk)("div",ua,(0,x.v_)(i.serviceStats.total.toLocaleString()),1),a[14]||(a[14]=(0,r.Lk)("div",{class:"metric-label"},"服务总数",-1)),(0,r.Lk)("div",pa,"业务线: "+(0,x.v_)(i.serviceStats.businessLines),1)])])])])]),(0,r.Lk)("div",ma,[(0,r.Lk)("div",ga,[(0,r.Lk)("div",{class:"nav-card",onClick:a[0]||(a[0]=e=>R("assets"))},[a[18]||(a[18]=(0,r.Lk)("div",{class:"nav-icon"},"📊",-1)),(0,r.Lk)("div",va,[a[16]||(a[16]=(0,r.Lk)("h3",null,"资产管理",-1)),a[17]||(a[17]=(0,r.Lk)("p",null,"主机、数据库、网络设备、容器资产",-1)),(0,r.Lk)("div",ha,[(0,r.Lk)("span",null,"主机: "+(0,x.v_)(i.hostStats.total),1),(0,r.Lk)("span",null,"数据库: "+(0,x.v_)(i.databaseStats.total),1),(0,r.Lk)("span",null,"K8s: "+(0,x.v_)(i.k8sClusterStats.total),1)])]),a[19]||(a[19]=(0,r.Lk)("div",{class:"nav-arrow"},"→",-1))]),(0,r.Lk)("div",{class:"nav-card",onClick:a[1]||(a[1]=e=>R("services"))},[a[22]||(a[22]=(0,r.Lk)("div",{class:"nav-icon"},"🚀",-1)),(0,r.Lk)("div",ka,[a[20]||(a[20]=(0,r.Lk)("h3",null,"服务管理",-1)),a[21]||(a[21]=(0,r.Lk)("p",null,"应用发布、定时任务、模板管理",-1)),(0,r.Lk)("div",ba,[(0,r.Lk)("span",null,"发布: "+(0,x.v_)(i.deploymentStats.total),1),(0,r.Lk)("span",null,"任务: "+(0,x.v_)(i.taskStats.total),1),(0,r.Lk)("span",null,"成功率: "+(0,x.v_)(i.deploymentStats.successRate)+"%",1)])]),a[23]||(a[23]=(0,r.Lk)("div",{class:"nav-arrow"},"→",-1))]),(0,r.Lk)("div",{class:"nav-card",onClick:a[2]||(a[2]=e=>R("monitoring"))},[a[27]||(a[27]=(0,r.Lk)("div",{class:"nav-icon"},"📈",-1)),(0,r.Lk)("div",fa,[a[25]||(a[25]=(0,r.Lk)("h3",null,"监控告警",-1)),a[26]||(a[26]=(0,r.Lk)("p",null,"性能监控、告警统计、资源分析",-1)),(0,r.Lk)("div",ya,[(0,r.Lk)("span",null,"CPU: "+(0,x.v_)(d.avgCpuUsage)+"%",1),(0,r.Lk)("span",null,"内存: "+(0,x.v_)(d.avgMemoryUsage)+"%",1),a[24]||(a[24]=(0,r.Lk)("span",null,"告警: 活跃中",-1))])]),a[28]||(a[28]=(0,r.Lk)("div",{class:"nav-arrow"},"→",-1))]),(0,r.Lk)("div",{class:"nav-card",onClick:a[3]||(a[3]=e=>R("users"))},a[29]||(a[29]=[(0,r.Lk)("div",{class:"nav-icon"},"👥",-1),(0,r.Lk)("div",{class:"nav-content"},[(0,r.Lk)("h3",null,"用户统计"),(0,r.Lk)("p",null,"用户活动、登录分析、访问统计"),(0,r.Lk)("div",{class:"nav-stats"},[(0,r.Lk)("span",null,"总用户: 0"),(0,r.Lk)("span",null,"活跃: 0"),(0,r.Lk)("span",null,"在线: 实时统计")])],-1),(0,r.Lk)("div",{class:"nav-arrow"},"→",-1)]))])]),(0,r.Lk)("div",_a,[(0,r.Lk)("div",wa,[a[45]||(a[45]=(0,r.Fv)('<div class="overview-card resource-cost" data-v-a924a9c0><div class="card-header" data-v-a924a9c0><div class="card-icon" data-v-a924a9c0><svg viewBox="0 0 24 24" fill="currentColor" data-v-a924a9c0><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z" data-v-a924a9c0></path></svg></div><h3 data-v-a924a9c0>云资源费用使用率</h3><div class="cost-trend" data-v-a924a9c0><span class="trend-indicator up" data-v-a924a9c0>↗ 8.2%</span></div></div><div class="cost-metrics" data-v-a924a9c0><div class="cost-item" data-v-a924a9c0><div class="cost-category" data-v-a924a9c0>腾讯云</div><div class="cost-bar" data-v-a924a9c0><div class="cost-progress" style="width:45%;" data-v-a924a9c0></div></div><div class="cost-value" data-v-a924a9c0>¥6,200/月</div></div><div class="cost-item" data-v-a924a9c0><div class="cost-category" data-v-a924a9c0>阿里云</div><div class="cost-bar" data-v-a924a9c0><div class="cost-progress storage" style="width:32%;" data-v-a924a9c0></div></div><div class="cost-value" data-v-a924a9c0>¥4,380/月</div></div><div class="cost-item" data-v-a924a9c0><div class="cost-category" data-v-a924a9c0>AWS云</div><div class="cost-bar" data-v-a924a9c0><div class="cost-progress network" style="width:18%;" data-v-a924a9c0></div></div><div class="cost-value" data-v-a924a9c0>¥2,450/月</div></div><div class="cost-item" data-v-a924a9c0><div class="cost-category" data-v-a924a9c0>网络宽带</div><div class="cost-bar" data-v-a924a9c0><div class="cost-progress bandwidth" style="width:15%;" data-v-a924a9c0></div></div><div class="cost-value" data-v-a924a9c0>¥890/月</div></div><div class="cost-item" data-v-a924a9c0><div class="cost-category" data-v-a924a9c0>云片短信</div><div class="cost-bar" data-v-a924a9c0><div class="cost-progress sms" style="width:8%;" data-v-a924a9c0></div></div><div class="cost-value" data-v-a924a9c0>¥320/月</div></div><div class="cost-item" data-v-a924a9c0><div class="cost-category" data-v-a924a9c0>WAF防火墙</div><div class="cost-bar" data-v-a924a9c0><div class="cost-progress waf" style="width:12%;" data-v-a924a9c0></div></div><div class="cost-value" data-v-a924a9c0>¥680/月</div></div></div><div class="cost-summary" data-v-a924a9c0><span class="total-cost" data-v-a924a9c0>总费用: ¥14,920/月</span><span class="budget-usage" data-v-a924a9c0>预算使用率: 74%</span></div></div>',1)),(0,r.Lk)("div",La,[(0,r.Lk)("div",Fa,[a[30]||(a[30]=(0,r.Fv)('<div class="card-icon deployment-icon" data-v-a924a9c0><svg viewBox="0 0 24 24" fill="currentColor" data-v-a924a9c0><path d="M12 2L13.09 8.26L22 9L13.09 9.74L12 16L10.91 9.74L2 9L10.91 8.26L12 2Z" data-v-a924a9c0></path><circle cx="12" cy="18" r="2" fill="currentColor" data-v-a924a9c0></circle></svg><div class="icon-glow" data-v-a924a9c0></div></div><h3 data-v-a924a9c0>上线发布比率</h3>',2)),(0,r.Lk)("div",Ca,(0,x.v_)(i.deploymentStats.successRate)+"%",1)]),(0,r.Lk)("div",Va,[(0,r.Lk)("div",xa,[(0,r.Lk)("div",Sa,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(12,e=>(0,r.Lk)("div",{class:"ring-segment",key:e,style:(0,x.Tr)({transform:`rotate(${30*e}deg)`})},null,4)),64))]),((0,r.uX)(),(0,r.CE)("svg",Ia,[a[31]||(a[31]=(0,r.Fv)('<defs data-v-a924a9c0><linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-a924a9c0><stop offset="0%" style="stop-color:#f1f5f9;stop-opacity:0.5;" data-v-a924a9c0></stop><stop offset="100%" style="stop-color:#e2e8f0;stop-opacity:0.8;" data-v-a924a9c0></stop></linearGradient><linearGradient id="successGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-a924a9c0><stop offset="0%" style="stop-color:#10b981;stop-opacity:1;" data-v-a924a9c0></stop><stop offset="50%" style="stop-color:#00ff88;stop-opacity:1;" data-v-a924a9c0></stop><stop offset="100%" style="stop-color:#34d399;stop-opacity:1;" data-v-a924a9c0></stop></linearGradient><filter id="glow" data-v-a924a9c0><feGaussianBlur stdDeviation="3" result="coloredBlur" data-v-a924a9c0></feGaussianBlur><feMerge data-v-a924a9c0><feMergeNode in="coloredBlur" data-v-a924a9c0></feMergeNode><feMergeNode in="SourceGraphic" data-v-a924a9c0></feMergeNode></feMerge></filter></defs><circle class="progress-ring__circle-bg" cx="96" cy="96" r="78" stroke="url(#bgGradient)" stroke-width="14" fill="transparent" data-v-a924a9c0></circle>',2)),(0,r.Lk)("circle",{class:"progress-ring__circle",cx:"96",cy:"96",r:"78","stroke-dasharray":i.deploymentStats.successRate/100*490.088+" 490.088",stroke:"url(#successGradient)","stroke-width":"14",fill:"transparent","stroke-linecap":"round",filter:"url(#glow)"},null,8,Aa)])),(0,r.Lk)("div",Ra,[a[32]||(a[32]=(0,r.Lk)("div",{class:"center-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",width:"32",height:"32",fill:"currentColor"},[(0,r.Lk)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})])],-1)),(0,r.Lk)("div",Da,(0,x.v_)(i.deploymentStats.success),1),(0,r.Lk)("div",Pa,"/ "+(0,x.v_)(i.deploymentStats.total),1),a[33]||(a[33]=(0,r.Lk)("div",{class:"center-label"},"部署成功",-1))]),a[34]||(a[34]=(0,r.Lk)("div",{class:"pulse-rings"},[(0,r.Lk)("div",{class:"pulse-ring"}),(0,r.Lk)("div",{class:"pulse-ring"}),(0,r.Lk)("div",{class:"pulse-ring"})],-1))])]),(0,r.Lk)("div",$a,[(0,r.Lk)("div",Ta,[a[36]||(a[36]=(0,r.Lk)("div",{class:"stat-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[(0,r.Lk)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})])],-1)),(0,r.Lk)("div",Ma,[a[35]||(a[35]=(0,r.Lk)("span",{class:"stat-label"},"成功",-1)),(0,r.Lk)("span",Ea,(0,x.v_)(i.deploymentStats.success),1)])]),(0,r.Lk)("div",Wa,[a[38]||(a[38]=(0,r.Lk)("div",{class:"stat-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[(0,r.Lk)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})])],-1)),(0,r.Lk)("div",za,[a[37]||(a[37]=(0,r.Lk)("span",{class:"stat-label"},"失败",-1)),(0,r.Lk)("span",Na,(0,x.v_)(i.deploymentStats.failed),1)])]),(0,r.Lk)("div",Ka,[a[40]||(a[40]=(0,r.Lk)("div",{class:"stat-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[(0,r.Lk)("path",{d:"M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,6A1.5,1.5 0 0,1 13.5,7.5A1.5,1.5 0 0,1 12,9A1.5,1.5 0 0,1 10.5,7.5A1.5,1.5 0 0,1 12,6M12,17.23C10.25,17.23 8.71,16.5 7.81,15.42L9.23,14C9.68,14.72 10.75,15.23 12,15.23C13.25,15.23 14.32,14.72 14.77,14L16.19,15.42C15.29,16.5 13.75,17.23 12,17.23Z"})])],-1)),(0,r.Lk)("div",Ua,[a[39]||(a[39]=(0,r.Lk)("span",{class:"stat-label"},"进行中",-1)),(0,r.Lk)("span",Xa,(0,x.v_)(Math.max(0,i.deploymentStats.total-i.deploymentStats.success-i.deploymentStats.failed)),1)])])])]),(0,r.Lk)("div",qa,[(0,r.Lk)("div",Ha,[a[41]||(a[41]=(0,r.Lk)("div",{class:"card-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"})])],-1)),a[42]||(a[42]=(0,r.Lk)("h3",null,"资产数量统计",-1)),(0,r.Lk)("div",Ba,(0,x.v_)(P()),1)]),(0,r.Lk)("div",ja,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)($.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.name,class:"asset-category"},[(0,r.Lk)("div",Oa,[(0,r.Lk)("img",{src:e.icon,alt:e.name},null,8,Qa)]),(0,r.Lk)("div",Ga,[(0,r.Lk)("div",Ya,(0,x.v_)(e.name),1),(0,r.Lk)("div",Ja,(0,x.v_)(e.count),1)])]))),128))])]),(0,r.Lk)("div",Za,[(0,r.Lk)("div",et,[a[43]||(a[43]=(0,r.Lk)("div",{class:"card-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M11 2v20c-5.07-.5-9-4.79-9-10s3.93-9.5 9-10zm2.03 0v8.99H22c-.47-4.74-4.24-8.52-8.97-8.99zm0 11.01V22c4.74-.47 8.5-4.25 8.97-8.99h-8.97z"})])],-1)),a[44]||(a[44]=(0,r.Lk)("h3",null,"业务分布",-1)),(0,r.Lk)("div",at,(0,x.v_)(c.totalServices||d.businessDistribution.reduce((e,a)=>e+a.value,0)),1)]),(0,r.Lk)("div",tt,[(0,r.Lk)("div",lt,[((0,r.uX)(),(0,r.CE)("svg",st,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(D.value,(e,a)=>((0,r.uX)(),(0,r.CE)("g",{key:a},[(0,r.Lk)("path",{class:"pie-segment",d:e.path,fill:e.color,stroke:e.color,"stroke-width":"1",onMouseenter:e=>z(d.businessDistribution[a],a),onMouseleave:N},null,40,ot)]))),128))])),n.value?((0,r.uX)(),(0,r.CE)("div",nt,[(0,r.Lk)("div",it,[(0,r.Lk)("div",rt,(0,x.v_)(n.value.name),1),(0,r.Lk)("div",dt,(0,x.v_)(n.value.value),1),(0,r.Lk)("div",ct,(0,x.v_)(n.value.percentage?n.value.percentage.toFixed(1)+"%":Math.round(n.value.value/(c.totalServices||d.businessDistribution.reduce((e,a)=>e+a.value,0))*100)+"%"),1)])])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",ut,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d.businessDistribution,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.name,class:"legend-item"},[(0,r.Lk)("div",{class:"legend-color",style:(0,x.Tr)({backgroundColor:e.color})},null,4),(0,r.Lk)("div",pt,[(0,r.Lk)("div",mt,(0,x.v_)(e.name),1),(0,r.Lk)("div",gt,(0,x.v_)(e.value),1)])]))),128))])])])]),l.value?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",vt,[a[47]||(a[47]=(0,r.Lk)("div",{class:"refresh-dot"},null,-1)),(0,r.Lk)("div",ht,[a[46]||(a[46]=(0,r.Lk)("span",null,"实时数据 (60s刷新)",-1)),s.value?((0,r.uX)(),(0,r.CE)("small",kt," 上次更新: "+(0,x.v_)(M.value),1)):(0,r.Q3)("",!0)])])),l.value?((0,r.uX)(),(0,r.CE)("div",bt,a[48]||(a[48]=[(0,r.Lk)("div",{class:"loading-spinner"},[(0,r.Lk)("div",{class:"spinner-ring"}),(0,r.Lk)("div",{class:"loading-text"},"加载仪表盘数据...")],-1)]))):(0,r.Q3)("",!0)]))}};const yt=(0,p.A)(ft,[["__scopeId","data-v-a924a9c0"]]);var _t=yt;const wt={class:"assets-dashboard"},Lt={class:"overview-cards"},Ft={class:"overview-card"},Ct={class:"card-content"},Vt={class:"card-value"},xt={class:"card-detail"},St={class:"overview-card"},It={class:"card-content"},At={class:"card-value"},Rt={class:"card-detail"},Dt={class:"overview-card"},Pt={class:"card-content"},$t={class:"card-value"},Tt={class:"card-detail"},Mt={class:"overview-card"},Et={class:"card-content"},Wt={class:"card-value"},zt={class:"card-detail"},Nt={class:"main-content"},Kt={class:"content-section"},Ut={class:"section-card"},Xt={class:"chart-container"},qt={class:"chart-legend"},Ht={class:"legend-label"},Bt={class:"legend-value"},jt={class:"legend-percent"},Ot={class:"section-card"},Qt={class:"network-devices"},Gt={class:"device-icon"},Yt={class:"device-info"},Jt={class:"device-name"},Zt={class:"device-count"},el={class:"device-status"},al={class:"content-section"},tl={class:"section-card"},ll={class:"database-stats"},sl={class:"db-content"},ol={class:"db-name"},nl={class:"db-count"},il={class:"db-health"},rl={class:"health-bar"},dl={class:"health-text"},cl={class:"section-card"},ul={class:"agent-stats"},pl={class:"agent-overview"},ml={class:"agent-metric"},gl={class:"metric-content"},vl={class:"metric-value"},hl={class:"agent-metric"},kl={class:"metric-content"},bl={class:"metric-value"},fl={class:"agent-timeline"},yl={class:"timeline-content"},_l={class:"event-title"},wl={class:"event-time"},Ll={class:"content-section"},Fl={class:"section-card"},Cl={class:"container-assets"},Vl={class:"k8s-overview"},xl={class:"k8s-metric"},Sl={class:"metric-number"},Il={class:"metric-status"},Al={class:"k8s-metric"},Rl={class:"metric-number"},Dl={class:"metric-status"},Pl={class:"k8s-metric"},$l={class:"metric-number"},Tl={class:"metric-status"},Ml={class:"container-health"},El={class:"health-circle"},Wl={class:"health-center"},zl={class:"health-value"},Nl={class:"health-details"},Kl={class:"health-item"},Ul={class:"health-item"},Xl={class:"health-item"},ql={class:"section-card"},Hl={class:"section-header"},Bl={class:"time-selector"},jl={class:"trend-chart"};var Ol={__name:"AssetsManagement",setup(e){const{proxy:a}=(0,r.nI)(),t=a.$api,l=(0,Y.KR)("month"),s=(0,Y.Kh)({totalHosts:0,onlineHosts:0,offlineHosts:0,agentOnline:0,agentOffline:0,agentVersion:"v1.2.3",selfBuiltHosts:0,aliCloudHosts:0,tencentCloudHosts:0,awsHosts:0,totalDatabases:0,mysqlCount:0,redisCount:0,mongoCount:0}),o=(0,Y.Kh)({clusters:0,healthyClusters:0,totalPods:0,runningPods:0,nodes:0,readyNodes:0,healthScore:0,healthyResources:0,warningResources:0,errorResources:0}),n=(0,Y.Kh)([{name:"自建机房",count:0,percent:0,color:"#667eea"},{name:"阿里云",count:0,percent:0,color:"#764ba2"},{name:"腾讯云",count:0,percent:0,color:"#f093fb"},{name:"AWS",count:0,percent:0,color:"#f5576c"}]),i=(0,Y.Kh)([{type:"switch",name:"交换机",icon:"🔀",count:0,status:"online",statusText:"运行正常"},{type:"router",name:"路由器",icon:"📡",count:0,status:"online",statusText:"运行正常"},{type:"firewall",name:"防火墙",icon:"🛡️",count:0,status:"warning",statusText:"部分告警"},{type:"loadbalancer",name:"负载均衡",icon:"⚖️",count:0,status:"online",statusText:"运行正常"}]),d=(0,Y.Kh)([{type:"mysql",name:"MySQL",icon:"🐬",count:0,healthPercent:0,color:"#00758f"},{type:"redis",name:"Redis",icon:"📮",count:0,healthPercent:0,color:"#dc382d"},{type:"mongodb",name:"MongoDB",icon:"🍃",count:0,healthPercent:0,color:"#4db33d"},{type:"postgresql",name:"PostgreSQL",icon:"🐘",count:0,healthPercent:0,color:"#336791"}]),c=(0,Y.Kh)([{id:1,title:"Agent版本更新完成",time:"2小时前",type:"success"},{id:2,title:"prod-web-01 Agent离线",time:"4小时前",type:"error"},{id:3,title:"Agent监控数据采集正常",time:"6小时前",type:"info"},{id:4,title:"batch-001~005 Agent重启",time:"1天前",type:"warning"}]),u=(0,Y.KR)(null),p=(0,Y.KR)(null),m=(0,Y.KR)(null),g=()=>{s.totalHosts=156,s.onlineHosts=142,s.offlineHosts=14,s.agentOnline=138,s.agentOffline=18,s.selfBuiltHosts=45,s.aliCloudHosts=68,s.tencentCloudHosts=32,s.awsHosts=11,s.totalDatabases=89,s.mysqlCount=34,s.redisCount=28,s.mongoCount=15,o.clusters=8,o.nodes=24,o.pods=156,o.services=89,o.healthyPods=142,o.unhealthyPods=14,k(),b([]),y(),console.log("演示数据生成完成:",s)},v=async()=>{try{const e=await t.getCmdbHostList({page:1,pageSize:1e3});if(200!==e.code||!e.data)return void g();{const a=e.data.records||e.data.items||e.data;s.totalHosts=Array.isArray(a)?a.length:e.data.total||0,Array.isArray(a)&&(s.onlineHosts=a.filter(e=>"online"===e.status||"1"===e.status).length,s.offlineHosts=s.totalHosts-s.onlineHosts,s.aliCloudHosts=a.filter(e=>"aliyun"===e.provider).length,s.tencentCloudHosts=a.filter(e=>"tencent"===e.provider).length,s.awsHosts=a.filter(e=>"aws"===e.provider).length,s.selfBuiltHosts=s.totalHosts-s.aliCloudHosts-s.tencentCloudHosts-s.awsHosts,k())}const a=await t.listDatabases({page:1,pageSize:1e3});if(200===a.code&&a.data){const e=a.data.records||a.data.items||a.data;s.totalDatabases=Array.isArray(e)?e.length:a.data.total||0,Array.isArray(e)&&(s.mysqlCount=e.filter(e=>"mysql"===e.type).length,s.redisCount=e.filter(e=>"redis"===e.type).length,s.mongoCount=e.filter(e=>"mongodb"===e.type).length,b(e))}await h(),console.log("资产数据加载完成:",s)}catch(e){console.error("加载资产数据失败:",e),console.log("使用演示数据"),g()}},h=async()=>{try{const a=await t.getClusterList({page:1,pageSize:100});if(200===a.code&&a.data){const l=a.data.records||a.data.items||a.data;o.clusters=l.length,o.healthyClusters=l.filter(e=>"Running"===e.status).length;let s=0,n=0,i=0,r=0;for(const a of l.slice(0,5))try{const e=await t.getClusterNodes(a.id);if(200===e.code&&e.data){const a=Array.isArray(e.data)?e.data:[];i+=a.length,r+=a.filter(e=>"Ready"===e.status).length}const l=await t.getPodList(a.id,"default",{page:1,pageSize:1e3});if(200===l.code&&l.data){const e=Array.isArray(l.data)?l.data:l.data.records||l.data.items||[];s+=e.length,n+=e.filter(e=>"Running"===e.status).length}}catch(e){console.warn(`获取集群 ${a.id} 详情失败:`,e)}o.totalPods=s,o.runningPods=n,o.nodes=i,o.readyNodes=r;const d=s>0?n/s:1;o.healthScore=Math.round(100*d),o.healthyResources=n,o.warningResources=Math.floor(.7*(s-n)),o.errorResources=s-n-o.warningResources}}catch(a){console.error("加载容器数据失败:",a)}},k=()=>{n[0].count=s.selfBuiltHosts,n[1].count=s.aliCloudHosts,n[2].count=s.tencentCloudHosts,n[3].count=s.awsHosts,n.forEach(e=>{e.percent=s.totalHosts>0?Math.round(e.count/s.totalHosts*100):0}),f()},b=e=>{const a={mysql:d[0],redis:d[1],mongodb:d[2],postgresql:d[3]};Object.keys(a).forEach(t=>{const l=e.filter(e=>e.type===t);a[t].count=l.length,a[t].healthPercent=Math.floor(30*Math.random())+70})},f=()=>{const e=u.value;if(!e)return;const a=e.getContext("2d"),t=e.width/2,l=e.height/2,o=80;let i=-Math.PI/2;n.forEach(e=>{if(e.count>0){const n=e.count/s.totalHosts*2*Math.PI;a.beginPath(),a.moveTo(t,l),a.arc(t,l,o,i,i+n),a.fillStyle=e.color,a.fill(),i+=n}}),a.beginPath(),a.arc(t,l,30,0,2*Math.PI),a.fillStyle="rgba(255, 255, 255, 0.9)",a.fill()},y=()=>{const e=p.value;if(!e)return;const a=e.getContext("2d"),t=e.width/2,l=e.height/2,s=60;a.beginPath(),a.arc(t,l,s,0,2*Math.PI),a.strokeStyle="rgba(102, 126, 234, 0.1)",a.lineWidth=8,a.stroke();const n=o.healthScore/100*2*Math.PI;a.beginPath(),a.arc(t,l,s,-Math.PI/2,-Math.PI/2+n),a.strokeStyle=o.healthScore>=80?"#4ade80":o.healthScore>=60?"#facc15":"#ef4444",a.lineWidth=8,a.stroke()},_=e=>{l.value=e,w()},w=()=>{const e=m.value;if(!e)return;const a=e.getContext("2d");a.clearRect(0,0,e.width,e.height);const t="week"===l.value?7:"month"===l.value?30:12,s=Array.from({length:t},()=>Math.floor(50*Math.random())+100),o=e.width/(s.length-1),n=Math.max(...s),i=Math.min(...s),r=n-i||1;a.beginPath(),s.forEach((t,l)=>{const s=l*o,n=e.height-(t-i)/r*e.height;0===l?a.moveTo(s,n):a.lineTo(s,n)}),a.strokeStyle="#667eea",a.lineWidth=2,a.stroke(),s.forEach((t,l)=>{const s=l*o,n=e.height-(t-i)/r*e.height;a.beginPath(),a.arc(s,n,3,0,2*Math.PI),a.fillStyle="#667eea",a.fill()})},L=async()=>{J.nk.info("正在刷新资产数据..."),await v(),J.nk.success("资产数据刷新完成")},F=()=>{J.nk.success("资产报告导出功能开发中...")},C=()=>{a.$router.push("/dashboard")},V=()=>{a.$router.push("/cmdb/host")};return(0,r.sV)(()=>{v()}),(e,a)=>((0,r.uX)(),(0,r.CE)("div",wt,[(0,r.Lk)("div",{class:"page-header"},[(0,r.Lk)("div",{class:"header-content"},[a[6]||(a[6]=(0,r.Lk)("div",{class:"page-title"},[(0,r.Lk)("h1",null,"📊 资产管理数据看板"),(0,r.Lk)("p",null,"主机资产、数据库资产、网络设备、容器资产统计分析")],-1)),(0,r.Lk)("div",{class:"header-actions"},[(0,r.Lk)("button",{class:"action-btn return-btn",onClick:C},a[3]||(a[3]=[(0,r.Lk)("span",{class:"icon"},"←",-1),(0,r.eW)(" 返回 ",-1)])),(0,r.Lk)("button",{class:"action-btn",onClick:L},a[4]||(a[4]=[(0,r.Lk)("span",{class:"icon"},"🔄",-1),(0,r.eW)(" 刷新数据 ",-1)])),(0,r.Lk)("button",{class:"action-btn",onClick:F},a[5]||(a[5]=[(0,r.Lk)("span",{class:"icon"},"📊",-1),(0,r.eW)(" 导出报告 ",-1)]))])])]),(0,r.Lk)("div",Lt,[(0,r.Lk)("div",Ft,[a[8]||(a[8]=(0,r.Lk)("div",{class:"card-icon"},"🏠",-1)),(0,r.Lk)("div",Ct,[a[7]||(a[7]=(0,r.Lk)("div",{class:"card-title"},"主机总数",-1)),(0,r.Lk)("div",Vt,(0,x.v_)(s.totalHosts),1),(0,r.Lk)("div",xt,[(0,r.Lk)("span",null,"自建: "+(0,x.v_)(s.selfBuiltHosts),1),(0,r.Lk)("span",null,"阿里云: "+(0,x.v_)(s.aliCloudHosts),1),(0,r.Lk)("span",null,"腾讯云: "+(0,x.v_)(s.tencentCloudHosts),1),(0,r.Lk)("span",null,"AWS: "+(0,x.v_)(s.awsHosts),1)])])]),(0,r.Lk)("div",St,[a[10]||(a[10]=(0,r.Lk)("div",{class:"card-icon"},"✅",-1)),(0,r.Lk)("div",It,[a[9]||(a[9]=(0,r.Lk)("div",{class:"card-title"},"在线主机",-1)),(0,r.Lk)("div",At,(0,x.v_)(s.onlineHosts),1),(0,r.Lk)("div",Rt,[(0,r.Lk)("span",null,"Agent在线: "+(0,x.v_)(s.agentOnline),1),(0,r.Lk)("span",null,"在线率: "+(0,x.v_)((s.onlineHosts/s.totalHosts*100).toFixed(1))+"%",1)])])]),(0,r.Lk)("div",Dt,[a[12]||(a[12]=(0,r.Lk)("div",{class:"card-icon"},"❌",-1)),(0,r.Lk)("div",Pt,[a[11]||(a[11]=(0,r.Lk)("div",{class:"card-title"},"离线主机",-1)),(0,r.Lk)("div",$t,(0,x.v_)(s.offlineHosts),1),(0,r.Lk)("div",Tt,[(0,r.Lk)("span",null,"Agent离线: "+(0,x.v_)(s.agentOffline),1),(0,r.Lk)("span",null,"离线率: "+(0,x.v_)((s.offlineHosts/s.totalHosts*100).toFixed(1))+"%",1)])])]),(0,r.Lk)("div",Mt,[a[14]||(a[14]=(0,r.Lk)("div",{class:"card-icon"},"🗄️",-1)),(0,r.Lk)("div",Et,[a[13]||(a[13]=(0,r.Lk)("div",{class:"card-title"},"数据库总数",-1)),(0,r.Lk)("div",Wt,(0,x.v_)(s.totalDatabases),1),(0,r.Lk)("div",zt,[(0,r.Lk)("span",null,"MySQL: "+(0,x.v_)(s.mysqlCount),1),(0,r.Lk)("span",null,"Redis: "+(0,x.v_)(s.redisCount),1),(0,r.Lk)("span",null,"MongoDB: "+(0,x.v_)(s.mongoCount),1)])])])]),(0,r.Lk)("div",Nt,[(0,r.Lk)("div",Kt,[(0,r.Lk)("div",Ut,[(0,r.Lk)("div",{class:"section-header"},[a[15]||(a[15]=(0,r.Lk)("h3",null,"🖥️ 主机资产分布",-1)),(0,r.Lk)("div",{class:"section-actions"},[(0,r.Lk)("button",{class:"mini-btn",onClick:V},"详情")])]),(0,r.Lk)("div",Xt,[(0,r.Lk)("canvas",{ref_key:"hostDistributionChart",ref:u,width:"400",height:"300"},null,512)]),(0,r.Lk)("div",qt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{class:"legend-item",key:a},[(0,r.Lk)("span",{class:"legend-color",style:(0,x.Tr)({backgroundColor:e.color})},null,4),(0,r.Lk)("span",Ht,(0,x.v_)(e.name),1),(0,r.Lk)("span",Bt,(0,x.v_)(e.count),1),(0,r.Lk)("span",jt,(0,x.v_)(e.percent)+"%",1)]))),128))])]),(0,r.Lk)("div",Ot,[a[16]||(a[16]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",null,"🌐 网络设备统计")],-1)),(0,r.Lk)("div",Qt,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i,e=>((0,r.uX)(),(0,r.CE)("div",{class:"device-item",key:e.type},[(0,r.Lk)("div",Gt,(0,x.v_)(e.icon),1),(0,r.Lk)("div",Yt,[(0,r.Lk)("div",Jt,(0,x.v_)(e.name),1),(0,r.Lk)("div",Zt,(0,x.v_)(e.count)+" 台",1),(0,r.Lk)("div",el,[(0,r.Lk)("span",{class:(0,x.C4)(["status-dot",e.status])},null,2),(0,r.eW)(" "+(0,x.v_)(e.statusText),1)])])]))),128))])])]),(0,r.Lk)("div",al,[(0,r.Lk)("div",tl,[a[17]||(a[17]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",null,"🗄️ 数据库类型分布")],-1)),(0,r.Lk)("div",ll,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(d,e=>((0,r.uX)(),(0,r.CE)("div",{class:"db-type-card",key:e.type},[(0,r.Lk)("div",{class:"db-icon",style:(0,x.Tr)({backgroundColor:e.color})},(0,x.v_)(e.icon),5),(0,r.Lk)("div",sl,[(0,r.Lk)("div",ol,(0,x.v_)(e.name),1),(0,r.Lk)("div",nl,(0,x.v_)(e.count)+" 个实例",1),(0,r.Lk)("div",il,[(0,r.Lk)("div",rl,[(0,r.Lk)("div",{class:"health-fill",style:(0,x.Tr)({width:e.healthPercent+"%",backgroundColor:e.color})},null,4)]),(0,r.Lk)("span",dl,"健康度 "+(0,x.v_)(e.healthPercent)+"%",1)])])]))),128))])]),(0,r.Lk)("div",cl,[a[23]||(a[23]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",null,"🔧 Agent状态监控")],-1)),(0,r.Lk)("div",ul,[(0,r.Lk)("div",pl,[(0,r.Lk)("div",ml,[a[19]||(a[19]=(0,r.Lk)("div",{class:"metric-icon"},"📡",-1)),(0,r.Lk)("div",gl,[(0,r.Lk)("div",vl,(0,x.v_)(s.agentOnline)+"/"+(0,x.v_)(s.totalHosts),1),a[18]||(a[18]=(0,r.Lk)("div",{class:"metric-label"},"Agent在线率",-1))])]),(0,r.Lk)("div",hl,[a[21]||(a[21]=(0,r.Lk)("div",{class:"metric-icon"},"⚡",-1)),(0,r.Lk)("div",kl,[(0,r.Lk)("div",bl,(0,x.v_)(s.agentVersion),1),a[20]||(a[20]=(0,r.Lk)("div",{class:"metric-label"},"Agent版本",-1))])])]),(0,r.Lk)("div",fl,[a[22]||(a[22]=(0,r.Lk)("h4",null,"最近Agent事件",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c,e=>((0,r.uX)(),(0,r.CE)("div",{class:"timeline-item",key:e.id},[(0,r.Lk)("div",{class:(0,x.C4)(["timeline-dot",e.type])},null,2),(0,r.Lk)("div",yl,[(0,r.Lk)("div",_l,(0,x.v_)(e.title),1),(0,r.Lk)("div",wl,(0,x.v_)(e.time),1)])]))),128))])])])]),(0,r.Lk)("div",Ll,[(0,r.Lk)("div",Fl,[a[34]||(a[34]=(0,r.Lk)("div",{class:"section-header"},[(0,r.Lk)("h3",null,"🐳 容器资产概览")],-1)),(0,r.Lk)("div",Cl,[(0,r.Lk)("div",Vl,[(0,r.Lk)("div",xl,[a[25]||(a[25]=(0,r.Lk)("div",{class:"metric-title"},"K8s集群数量",-1)),(0,r.Lk)("div",Sl,(0,x.v_)(o.clusters),1),(0,r.Lk)("div",Il,[a[24]||(a[24]=(0,r.Lk)("span",{class:"status-indicator healthy"},null,-1)),(0,r.eW)(" "+(0,x.v_)(o.healthyClusters)+" 健康 ",1)])]),(0,r.Lk)("div",Al,[a[27]||(a[27]=(0,r.Lk)("div",{class:"metric-title"},"Pod总数",-1)),(0,r.Lk)("div",Rl,(0,x.v_)(o.totalPods),1),(0,r.Lk)("div",Dl,[a[26]||(a[26]=(0,r.Lk)("span",{class:"status-indicator running"},null,-1)),(0,r.eW)(" "+(0,x.v_)(o.runningPods)+" 运行中 ",1)])]),(0,r.Lk)("div",Pl,[a[29]||(a[29]=(0,r.Lk)("div",{class:"metric-title"},"节点数量",-1)),(0,r.Lk)("div",$l,(0,x.v_)(o.nodes),1),(0,r.Lk)("div",Tl,[a[28]||(a[28]=(0,r.Lk)("span",{class:"status-indicator ready"},null,-1)),(0,r.eW)(" "+(0,x.v_)(o.readyNodes)+" 就绪 ",1)])])]),(0,r.Lk)("div",Ml,[(0,r.Lk)("div",El,[(0,r.Lk)("canvas",{ref_key:"containerHealthChart",ref:p,width:"150",height:"150"},null,512),(0,r.Lk)("div",Wl,[(0,r.Lk)("div",zl,(0,x.v_)(o.healthScore),1),a[30]||(a[30]=(0,r.Lk)("div",{class:"health-label"},"健康度",-1))])]),(0,r.Lk)("div",Nl,[(0,r.Lk)("div",Kl,[a[31]||(a[31]=(0,r.Lk)("span",{class:"health-dot healthy"},null,-1)),(0,r.Lk)("span",null,"健康: "+(0,x.v_)(o.healthyResources),1)]),(0,r.Lk)("div",Ul,[a[32]||(a[32]=(0,r.Lk)("span",{class:"health-dot warning"},null,-1)),(0,r.Lk)("span",null,"警告: "+(0,x.v_)(o.warningResources),1)]),(0,r.Lk)("div",Xl,[a[33]||(a[33]=(0,r.Lk)("span",{class:"health-dot error"},null,-1)),(0,r.Lk)("span",null,"异常: "+(0,x.v_)(o.errorResources),1)])])])])]),(0,r.Lk)("div",ql,[(0,r.Lk)("div",Hl,[a[35]||(a[35]=(0,r.Lk)("h3",null,"📈 资产变化趋势",-1)),(0,r.Lk)("div",Bl,[(0,r.Lk)("button",{class:(0,x.C4)(["time-btn",{active:"week"===l.value}]),onClick:a[0]||(a[0]=e=>_("week"))},"周",2),(0,r.Lk)("button",{class:(0,x.C4)(["time-btn",{active:"month"===l.value}]),onClick:a[1]||(a[1]=e=>_("month"))},"月",2),(0,r.Lk)("button",{class:(0,x.C4)(["time-btn",{active:"year"===l.value}]),onClick:a[2]||(a[2]=e=>_("year"))},"年",2)])]),(0,r.Lk)("div",jl,[(0,r.Lk)("canvas",{ref_key:"assetTrendChart",ref:m,width:"300",height:"200"},null,512)])])])])]))}};const Ql=(0,p.A)(Ol,[["__scopeId","data-v-799fec0a"]]);var Gl=Ql;const Yl={class:"service-management"},Jl={class:"dashboard-header"},Zl={class:"header-actions"},es={class:"metrics-grid"},as={class:"metric-card primary"},ts={class:"metric-content"},ls={class:"metric-value"},ss={class:"count-animation"},os={class:"metric-card success"},ns={class:"metric-content"},is={class:"metric-value"},rs={class:"count-animation"},ds={class:"metric-card danger"},cs={class:"metric-content"},us={class:"metric-value"},ps={class:"count-animation"},ms={class:"metric-card warning"},gs={class:"metric-content"},vs={class:"metric-value"},hs={class:"count-animation"},ks={class:"charts-grid"},bs={class:"chart-card large"},fs={class:"chart-header"},ys={class:"time-selector"},_s={class:"chart-container"},ws={ref:"deploymentTrendChart",width:"600",height:"300"},Ls={class:"chart-card"},Fs={class:"chart-container"},Cs={ref:"businessLineChart",width:"400",height:"300"},Vs={class:"chart-card"},xs={class:"chart-container"},Ss={ref:"taskExecutionChart",width:"400",height:"300"},Is={class:"chart-card"},As={class:"chart-header"},Rs={class:"template-total"},Ds={class:"total-count"},Ps={class:"template-stats"},$s={class:"template-item shell"},Ts={class:"template-count"},Ms={class:"template-progress"},Es={class:"template-item ansible"},Ws={class:"template-count"},zs={class:"template-progress"},Ns={class:"template-item flow"},Ks={class:"template-count"},Us={class:"template-progress"},Xs={class:"chart-card"},qs={class:"success-rate-container"},Hs={class:"rate-circle"},Bs={ref:"successRateChart",width:"200",height:"200"},js={class:"rate-text"},Os={class:"rate-number"},Qs={class:"rate-details"},Gs={class:"rate-item shell"},Ys={class:"rate-info"},Js={class:"rate-progress"},Zs={class:"rate-value"},eo={class:"rate-item ansible"},ao={class:"rate-info"},to={class:"rate-progress"},lo={class:"rate-value"},so={class:"chart-card large"},oo={class:"app-status-grid"},no={class:"status-item running"},io={class:"status-info"},ro={class:"status-count"},co={class:"status-item stopped"},uo={class:"status-info"},po={class:"status-count"},mo={class:"status-item error"},go={class:"status-info"},vo={class:"status-count"},ho={class:"status-item pending"},ko={class:"status-info"},bo={class:"status-count"};function fo(e,a,t,l,s,o){const n=(0,r.g2)("el-radio-button"),i=(0,r.g2)("el-radio-group");return(0,r.uX)(),(0,r.CE)("div",Yl,[(0,r.Lk)("div",Jl,[(0,r.Lk)("div",Zl,[(0,r.Lk)("button",{class:"return-btn",onClick:a[0]||(a[0]=(...e)=>l.goBack&&l.goBack(...e))},a[2]||(a[2]=[(0,r.Lk)("span",{class:"icon"},"←",-1),(0,r.eW)(" 返回 ",-1)]))]),a[3]||(a[3]=(0,r.Lk)("h1",{class:"main-title"},"服务管理数据看板",-1)),a[4]||(a[4]=(0,r.Lk)("p",{class:"subtitle"},"Service Management Dashboard",-1))]),(0,r.Lk)("div",es,[(0,r.Lk)("div",as,[a[7]||(a[7]=(0,r.Fv)('<div class="metric-icon-container" data-v-7f03b188><div class="metric-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" data-v-7f03b188></path></svg></div><div class="icon-glow" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",ts,[(0,r.Lk)("div",ls,[(0,r.Lk)("span",ss,(0,x.v_)(l.totalApplications),1),a[5]||(a[5]=(0,r.Lk)("div",{class:"trend-indicator up"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 14l5-5 5 5z"})])],-1))]),a[6]||(a[6]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"应用总数"),(0,r.Lk)("div",{class:"metric-subtitle"},"Total Applications")],-1))])]),(0,r.Lk)("div",os,[a[10]||(a[10]=(0,r.Fv)('<div class="metric-icon-container" data-v-7f03b188><div class="metric-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" data-v-7f03b188></path></svg></div><div class="icon-glow success" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",ns,[(0,r.Lk)("div",is,[(0,r.Lk)("span",rs,(0,x.v_)(l.successfulDeployments),1),a[8]||(a[8]=(0,r.Lk)("div",{class:"trend-indicator up"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 14l5-5 5 5z"})])],-1))]),a[9]||(a[9]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"发布成功"),(0,r.Lk)("div",{class:"metric-subtitle"},"Successful Deployments")],-1))])]),(0,r.Lk)("div",ds,[a[13]||(a[13]=(0,r.Fv)('<div class="metric-icon-container" data-v-7f03b188><div class="metric-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-7f03b188></path><path d="M15.5 4L14 2.5l-4 4-4-4L4.5 4l4 4-4 4L6 13.5l4-4 4 4L15.5 12l-4-4 4-4z" data-v-7f03b188></path></svg></div><div class="icon-glow danger" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",cs,[(0,r.Lk)("div",us,[(0,r.Lk)("span",ps,(0,x.v_)(l.failedDeployments),1),a[11]||(a[11]=(0,r.Lk)("div",{class:"trend-indicator down"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 10l5 5 5-5z"})])],-1))]),a[12]||(a[12]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"发布失败"),(0,r.Lk)("div",{class:"metric-subtitle"},"Failed Deployments")],-1))])]),(0,r.Lk)("div",ms,[a[16]||(a[16]=(0,r.Fv)('<div class="metric-icon-container" data-v-7f03b188><div class="metric-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M15,1H9V3H15M11,14H13V8H11M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19Z" data-v-7f03b188></path></svg></div><div class="icon-glow warning" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",gs,[(0,r.Lk)("div",vs,[(0,r.Lk)("span",hs,(0,x.v_)(l.totalTasks),1),a[14]||(a[14]=(0,r.Lk)("div",{class:"trend-indicator neutral"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M8.5 12c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5-.67-1.5-1.5-1.5-1.5.67-1.5 1.5zM12 12c0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5-.67-1.5-1.5-1.5-1.5.67-1.5 1.5z"})])],-1))]),a[15]||(a[15]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"定时任务"),(0,r.Lk)("div",{class:"metric-subtitle"},"Scheduled Tasks")],-1))])])]),(0,r.Lk)("div",ks,[(0,r.Lk)("div",bs,[(0,r.Lk)("div",fs,[a[20]||(a[20]=(0,r.Fv)('<div class="header-left" data-v-7f03b188><div class="chart-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M5 9.2h3V19H5zM10.6 5h2.8v14h-2.8zm5.6 8H19v6h-2.8z" data-v-7f03b188></path></svg></div><div class="chart-title-group" data-v-7f03b188><h3 data-v-7f03b188>发布统计趋势</h3><span class="chart-subtitle" data-v-7f03b188>Deployment Statistics Trend</span></div></div>',1)),(0,r.Lk)("div",ys,[(0,r.bF)(i,{modelValue:l.deploymentPeriod,"onUpdate:modelValue":a[1]||(a[1]=e=>l.deploymentPeriod=e),onChange:l.loadDeploymentStats},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"week"},{default:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.eW)("本周",-1)])),_:1,__:[17]}),(0,r.bF)(n,{label:"month"},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)("本月",-1)])),_:1,__:[18]}),(0,r.bF)(n,{label:"year"},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("本年",-1)])),_:1,__:[19]})]),_:1},8,["modelValue","onChange"])])]),(0,r.Lk)("div",_s,[a[21]||(a[21]=(0,r.Fv)('<div class="chart-legend" data-v-7f03b188><div class="legend-item" data-v-7f03b188><div class="legend-color success" data-v-7f03b188></div><span data-v-7f03b188>成功部署</span></div><div class="legend-item" data-v-7f03b188><div class="legend-color danger" data-v-7f03b188></div><span data-v-7f03b188>失败部署</span></div></div>',1)),(0,r.Lk)("canvas",ws,null,512)])]),(0,r.Lk)("div",Ls,[a[22]||(a[22]=(0,r.Fv)('<div class="chart-header" data-v-7f03b188><div class="header-left" data-v-7f03b188><div class="chart-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M11 2v20c-5.07-.5-9-4.79-9-10s3.93-9.5 9-10zm2.03 0v8.99H22c-.47-4.74-4.24-8.52-8.97-8.99zm0 11.01V22c4.74-.47 8.5-4.25 8.97-8.99h-8.97z" data-v-7f03b188></path></svg></div><div class="chart-title-group" data-v-7f03b188><h3 data-v-7f03b188>业务线分布</h3><span class="chart-subtitle" data-v-7f03b188>Business Line Distribution</span></div></div><div class="chart-actions" data-v-7f03b188><button class="action-btn" title="刷新数据" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" data-v-7f03b188></path></svg></button></div></div>',1)),(0,r.Lk)("div",Fs,[(0,r.Lk)("canvas",Cs,null,512)])]),(0,r.Lk)("div",Vs,[a[24]||(a[24]=(0,r.Fv)('<div class="chart-header" data-v-7f03b188><div class="header-left" data-v-7f03b188><div class="chart-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" data-v-7f03b188></path></svg></div><div class="chart-title-group" data-v-7f03b188><h3 data-v-7f03b188>近七天任务执行</h3><span class="chart-subtitle" data-v-7f03b188>Task Execution (Last 7 Days)</span></div></div><div class="status-indicator" data-v-7f03b188><div class="status-dot active" data-v-7f03b188></div><span data-v-7f03b188>实时监控</span></div></div>',1)),(0,r.Lk)("div",xs,[a[23]||(a[23]=(0,r.Fv)('<div class="chart-legend" data-v-7f03b188><div class="legend-item" data-v-7f03b188><div class="legend-color shell" data-v-7f03b188></div><span data-v-7f03b188>Shell任务</span></div><div class="legend-item" data-v-7f03b188><div class="legend-color ansible" data-v-7f03b188></div><span data-v-7f03b188>Ansible任务</span></div></div>',1)),(0,r.Lk)("canvas",Ss,null,512)])]),(0,r.Lk)("div",Is,[(0,r.Lk)("div",As,[a[26]||(a[26]=(0,r.Fv)('<div class="header-left" data-v-7f03b188><div class="chart-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z" data-v-7f03b188></path></svg></div><div class="chart-title-group" data-v-7f03b188><h3 data-v-7f03b188>模板使用统计</h3><span class="chart-subtitle" data-v-7f03b188>Template Usage Statistics</span></div></div>',1)),(0,r.Lk)("div",Rs,[(0,r.Lk)("span",Ds,(0,x.v_)(l.shellTemplates+l.ansibleTemplates+l.flowTemplates),1),a[25]||(a[25]=(0,r.Lk)("span",{class:"total-label"},"总模板数",-1))])]),(0,r.Lk)("div",Ps,[(0,r.Lk)("div",$s,[a[27]||(a[27]=(0,r.Fv)('<div class="template-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-7.5 14c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67-1.5-1.5-1.5zm3.5-4H8.5c-.28 0-.5-.22-.5-.5s.22-.5.5-.5H16c.28 0 .5.22.5.5s-.22.5-.5.5z" data-v-7f03b188></path></svg></div><div class="template-info" data-v-7f03b188><div class="template-type" data-v-7f03b188>Shell模板</div><div class="template-description" data-v-7f03b188>命令行执行模板</div></div>',2)),(0,r.Lk)("div",Ts,(0,x.v_)(l.shellTemplates),1),(0,r.Lk)("div",Ms,[(0,r.Lk)("div",{class:"progress-bar",style:(0,x.Tr)({width:l.shellTemplates/(l.shellTemplates+l.ansibleTemplates+l.flowTemplates)*100+"%"})},null,4)])]),(0,r.Lk)("div",Es,[a[28]||(a[28]=(0,r.Fv)('<div class="template-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" data-v-7f03b188></path></svg></div><div class="template-info" data-v-7f03b188><div class="template-type" data-v-7f03b188>Ansible模板</div><div class="template-description" data-v-7f03b188>自动化编排模板</div></div>',2)),(0,r.Lk)("div",Ws,(0,x.v_)(l.ansibleTemplates),1),(0,r.Lk)("div",zs,[(0,r.Lk)("div",{class:"progress-bar ansible",style:(0,x.Tr)({width:l.ansibleTemplates/(l.shellTemplates+l.ansibleTemplates+l.flowTemplates)*100+"%"})},null,4)])]),(0,r.Lk)("div",Ns,[a[29]||(a[29]=(0,r.Fv)('<div class="template-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M14 12l-2 2-2-2 2-2 2 2zm-2-6l2.12 2.12 2.5-2.5L12 1 7.38 5.62l2.5 2.5L12 6zm6 6l-2.12-2.12 2.5-2.5L23 12l-4.62 4.62-2.5-2.5L18 12zM6 12l2.12 2.12-2.5 2.5L1 12l4.62-4.62 2.5 2.5L6 12zm6 6l-2.12-2.12-2.5 2.5L12 23l4.62-4.62-2.5-2.5L12 18z" data-v-7f03b188></path></svg></div><div class="template-info" data-v-7f03b188><div class="template-type" data-v-7f03b188>流程模板</div><div class="template-description" data-v-7f03b188>工作流程模板</div></div>',2)),(0,r.Lk)("div",Ks,(0,x.v_)(l.flowTemplates),1),(0,r.Lk)("div",Us,[(0,r.Lk)("div",{class:"progress-bar flow",style:(0,x.Tr)({width:l.flowTemplates/(l.shellTemplates+l.ansibleTemplates+l.flowTemplates)*100+"%"})},null,4)])])])]),(0,r.Lk)("div",Xs,[a[36]||(a[36]=(0,r.Fv)('<div class="chart-header" data-v-7f03b188><div class="header-left" data-v-7f03b188><div class="chart-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-7f03b188></path></svg></div><div class="chart-title-group" data-v-7f03b188><h3 data-v-7f03b188>任务成功率分析</h3><span class="chart-subtitle" data-v-7f03b188>Task Success Rate Analysis</span></div></div><div class="success-badge" data-v-7f03b188><div class="badge-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" data-v-7f03b188></path></svg></div><span data-v-7f03b188>优秀</span></div></div>',1)),(0,r.Lk)("div",qs,[(0,r.Lk)("div",Hs,[(0,r.Lk)("canvas",Bs,null,512),(0,r.Lk)("div",js,[(0,r.Lk)("span",Os,(0,x.v_)(l.successRate),1),a[30]||(a[30]=(0,r.Lk)("span",{class:"rate-percent"},"%",-1))]),a[31]||(a[31]=(0,r.Lk)("div",{class:"rate-ring-bg"},null,-1))]),(0,r.Lk)("div",Qs,[(0,r.Lk)("div",Gs,[a[33]||(a[33]=(0,r.Lk)("div",{class:"rate-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2z"})])],-1)),(0,r.Lk)("div",Ys,[a[32]||(a[32]=(0,r.Lk)("span",{class:"rate-label"},"Shell任务",-1)),(0,r.Lk)("div",Js,[(0,r.Lk)("div",{class:"progress-fill",style:(0,x.Tr)({width:`${l.shellSuccessRate}%`})},null,4)])]),(0,r.Lk)("span",Zs,(0,x.v_)(l.shellSuccessRate)+"%",1)]),(0,r.Lk)("div",eo,[a[35]||(a[35]=(0,r.Lk)("div",{class:"rate-icon"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})])],-1)),(0,r.Lk)("div",ao,[a[34]||(a[34]=(0,r.Lk)("span",{class:"rate-label"},"Ansible任务",-1)),(0,r.Lk)("div",to,[(0,r.Lk)("div",{class:"progress-fill ansible",style:(0,x.Tr)({width:`${l.ansibleSuccessRate}%`})},null,4)])]),(0,r.Lk)("span",lo,(0,x.v_)(l.ansibleSuccessRate)+"%",1)])])])]),(0,r.Lk)("div",so,[a[53]||(a[53]=(0,r.Fv)('<div class="chart-header" data-v-7f03b188><div class="header-left" data-v-7f03b188><div class="chart-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" data-v-7f03b188></path></svg></div><div class="chart-title-group" data-v-7f03b188><h3 data-v-7f03b188>应用状态监控</h3><span class="chart-subtitle" data-v-7f03b188>Application Status Monitoring</span></div></div><div class="monitoring-controls" data-v-7f03b188><div class="auto-refresh" data-v-7f03b188><div class="refresh-indicator" data-v-7f03b188></div><span data-v-7f03b188>自动刷新</span></div><div class="view-toggle" data-v-7f03b188><button class="toggle-btn active" title="网格视图" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M3 3v8h8V3H3zm6 6H5V5h4v4zm-6 4v8h8v-8H3zm6 6H5v-4h4v4zm4-16v8h8V3h-8zm6 6h-4V5h4v4zm-6 4v8h8v-8h-8zm6 6h-4v-4h4v4z" data-v-7f03b188></path></svg></button><button class="toggle-btn" title="列表视图" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z" data-v-7f03b188></path></svg></button></div></div></div>',1)),(0,r.Lk)("div",oo,[(0,r.Lk)("div",no,[a[39]||(a[39]=(0,r.Fv)('<div class="status-icon-container" data-v-7f03b188><div class="status-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M8 5v14l11-7z" data-v-7f03b188></path></svg></div><div class="status-pulse running" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",io,[(0,r.Lk)("div",ro,(0,x.v_)(l.runningApps),1),a[37]||(a[37]=(0,r.Lk)("div",{class:"status-label"},"运行中",-1)),a[38]||(a[38]=(0,r.Lk)("div",{class:"status-subtitle"},"Running",-1))]),a[40]||(a[40]=(0,r.Lk)("div",{class:"status-chart"},[(0,r.Lk)("div",{class:"mini-chart running"})],-1))]),(0,r.Lk)("div",co,[a[43]||(a[43]=(0,r.Fv)('<div class="status-icon-container" data-v-7f03b188><div class="status-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M6 6h12v12H6z" data-v-7f03b188></path></svg></div><div class="status-pulse stopped" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",uo,[(0,r.Lk)("div",po,(0,x.v_)(l.stoppedApps),1),a[41]||(a[41]=(0,r.Lk)("div",{class:"status-label"},"已停止",-1)),a[42]||(a[42]=(0,r.Lk)("div",{class:"status-subtitle"},"Stopped",-1))]),a[44]||(a[44]=(0,r.Lk)("div",{class:"status-chart"},[(0,r.Lk)("div",{class:"mini-chart stopped"})],-1))]),(0,r.Lk)("div",mo,[a[47]||(a[47]=(0,r.Fv)('<div class="status-icon-container" data-v-7f03b188><div class="status-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-7f03b188></path><path d="M15.5 4L14 2.5l-4 4-4-4L4.5 4l4 4-4 4L6 13.5l4-4 4 4L15.5 12l-4-4 4-4z" data-v-7f03b188></path></svg></div><div class="status-pulse error" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",go,[(0,r.Lk)("div",vo,(0,x.v_)(l.errorApps),1),a[45]||(a[45]=(0,r.Lk)("div",{class:"status-label"},"异常",-1)),a[46]||(a[46]=(0,r.Lk)("div",{class:"status-subtitle"},"Error",-1))]),a[48]||(a[48]=(0,r.Lk)("div",{class:"status-chart"},[(0,r.Lk)("div",{class:"mini-chart error"})],-1))]),(0,r.Lk)("div",ho,[a[51]||(a[51]=(0,r.Fv)('<div class="status-icon-container" data-v-7f03b188><div class="status-icon" data-v-7f03b188><svg viewBox="0 0 24 24" fill="currentColor" data-v-7f03b188><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-4v4h-2v-4H7v-2h4V7h2v4h4v2z" data-v-7f03b188></path></svg></div><div class="status-pulse pending" data-v-7f03b188></div></div>',1)),(0,r.Lk)("div",ko,[(0,r.Lk)("div",bo,(0,x.v_)(l.pendingApps),1),a[49]||(a[49]=(0,r.Lk)("div",{class:"status-label"},"部署中",-1)),a[50]||(a[50]=(0,r.Lk)("div",{class:"status-subtitle"},"Deploying",-1))]),a[52]||(a[52]=(0,r.Lk)("div",{class:"status-chart"},[(0,r.Lk)("div",{class:"mini-chart pending"})],-1))])])])])])}var yo={name:"ServiceManagement",setup(){const e=(0,Y.KR)(0),a=(0,Y.KR)(0),t=(0,Y.KR)(0),l=(0,Y.KR)(0),n=(0,Y.KR)(0),i=(0,Y.KR)(0),d=(0,Y.KR)(0),c=(0,Y.KR)(0),u=(0,Y.KR)(0),p=(0,Y.KR)(0),m=(0,Y.KR)(0),g=(0,Y.KR)(0),v=(0,Y.KR)(0),h=(0,Y.KR)(0),k=(0,Y.KR)("week"),b=(0,Y.KR)(null),f=(0,Y.KR)(null),y=(0,Y.KR)(null),_=(0,Y.KR)(null),w=(0,Y.Kh)({deploymentTrend:[],businessLines:[],taskExecution:[],applications:[]}),L=async()=>{try{const a=await(0,o.getAppList)({pageNum:1,pageSize:1e3});if(200===a.code&&a.data){const t=a.data.rows||[];w.applications=t,e.value=t.length;const l=t.reduce((e,a)=>{const t=a.status||"unknown";return e[t]=(e[t]||0)+1,e},{});m.value=l.running||0,g.value=l.stopped||0,v.value=l.error||0,h.value=l.pending||0;const s=t.reduce((e,a)=>{const t=a.businessLine||"未分类";return e[t]=(e[t]||0)+1,e},{});w.businessLines=Object.entries(s).map(([e,a])=>({name:e,count:a}))}}catch(a){console.error("加载应用数据失败:",a),V()}},F=async()=>{try{const e=await(0,s.getTaskList)({pageNum:1,pageSize:1e3});if(200===e.code&&e.data){const s=e.data.rows||[];l.value=s.filter(e=>"scheduled"===e.type).length;const o=s.filter(e=>"deployment"===e.type);a.value=o.filter(e=>"success"===e.status).length,t.value=o.filter(e=>"failed"===e.status).length;const n=s.filter(e=>"shell"===e.executor),i=s.filter(e=>"ansible"===e.executor);n.length>0&&(u.value=Math.round(n.filter(e=>"success"===e.status).length/n.length*100)),i.length>0&&(p.value=Math.round(i.filter(e=>"success"===e.status).length/i.length*100));const r=s.length;r>0&&(c.value=Math.round(s.filter(e=>"success"===e.status).length/r*100)),I(s)}}catch(e){console.error("加载任务数据失败:",e),x()}},C=async()=>{try{const e=await(0,s.getTemplateList)({pageNum:1,pageSize:1e3});if(200===e.code&&e.data){const a=e.data.rows||[];n.value=a.filter(e=>"shell"===e.type).length,i.value=a.filter(e=>"ansible"===e.type).length,d.value=a.filter(e=>"flow"===e.type).length}}catch(e){console.error("加载模板数据失败:",e),S()}},V=()=>{const a=[{id:1,name:"dodevops-web",status:"running",businessLine:"前端服务",deployments:15},{id:2,name:"dodevops-api",status:"running",businessLine:"API服务",deployments:22},{id:3,name:"user-service",status:"running",businessLine:"用户中心",deployments:18},{id:4,name:"payment-service",status:"running",businessLine:"支付系统",deployments:12},{id:5,name:"notification-service",status:"stopped",businessLine:"通知服务",deployments:8},{id:6,name:"auth-service",status:"running",businessLine:"认证服务",deployments:25},{id:7,name:"data-analytics",status:"running",businessLine:"数据分析",deployments:10},{id:8,name:"file-storage",status:"error",businessLine:"文件存储",deployments:6},{id:9,name:"message-queue",status:"running",businessLine:"消息队列",deployments:14},{id:10,name:"monitoring-service",status:"running",businessLine:"监控服务",deployments:9},{id:11,name:"log-collector",status:"pending",businessLine:"日志收集",deployments:5},{id:12,name:"cache-service",status:"running",businessLine:"缓存服务",deployments:20}];w.applications=a,e.value=a.length;const t=a.reduce((e,a)=>{const t=a.status||"unknown";return e[t]=(e[t]||0)+1,e},{});m.value=t.running||0,g.value=t.stopped||0,v.value=t.error||0,h.value=t.pending||0;const l=a.reduce((e,a)=>{const t=a.businessLine||"未分类";return e[t]=(e[t]||0)+1,e},{});w.businessLines=Object.entries(l).map(([e,a])=>({name:e,count:a})),console.log("🚀 Demo应用数据生成完成:",{totalApps:e.value,running:m.value,stopped:g.value,error:v.value,pending:h.value})},x=()=>{const e=[{id:1,name:"服务器巡检",type:"shell",status:"success",execTime:"2024-01-15 10:30:00"},{id:2,name:"应用部署",type:"ansible",status:"success",execTime:"2024-01-15 09:15:00"},{id:3,name:"数据库备份",type:"shell",status:"success",execTime:"2024-01-15 08:00:00"},{id:4,name:"配置更新",type:"ansible",status:"failed",execTime:"2024-01-15 11:45:00"},{id:5,name:"性能测试",type:"shell",status:"success",execTime:"2024-01-15 14:20:00"},{id:6,name:"安全扫描",type:"ansible",status:"success",execTime:"2024-01-15 16:10:00"},{id:7,name:"日志清理",type:"shell",status:"success",execTime:"2024-01-15 02:00:00"},{id:8,name:"证书更新",type:"ansible",status:"failed",execTime:"2024-01-15 13:30:00"}];l.value=e.length;const s=e.reduce((e,a)=>(e.total++,"success"===a.status?e.success++:"failed"===a.status&&e.failed++,e),{total:0,success:0,failed:0});a.value=s.success,t.value=s.failed;const o=s.total>0?Math.round(s.success/s.total*100):0;c.value=o;const n=e.filter(e=>"shell"===e.type),i=e.filter(e=>"ansible"===e.type),r=n.filter(e=>"success"===e.status).length,d=i.filter(e=>"success"===e.status).length;u.value=n.length>0?Math.round(r/n.length*100):0,p.value=i.length>0?Math.round(d/i.length*100):0,I(e),console.log("🚀 Demo任务数据生成完成:",{total:l.value,success:a.value,failed:t.value,successRate:c.value})},S=()=>{n.value=15,i.value=12,d.value=8,console.log("🚀 Demo模板数据生成完成:",{shell:n.value,ansible:i.value,flow:d.value})},I=e=>{const a=[];for(let t=6;t>=0;t--){const l=new Date;l.setDate(l.getDate()-t);const s=l.toISOString().split("T")[0],o=e.filter(e=>e.createTime&&e.createTime.startsWith(s));a.push({date:s,shell:o.filter(e=>"shell"===e.executor).length,ansible:o.filter(e=>"ansible"===e.executor).length})}w.taskExecution=a},A=()=>{const e={week:[{date:"周一",success:8,failed:2},{date:"周二",success:12,failed:1},{date:"周三",success:6,failed:3},{date:"周四",success:15,failed:2},{date:"周五",success:9,failed:1},{date:"周六",success:4,failed:0},{date:"周日",success:3,failed:1}],month:Array.from({length:30},(e,a)=>({date:`${a+1}日`,success:Math.floor(20*Math.random())+5,failed:Math.floor(5*Math.random())})),year:Array.from({length:12},(e,a)=>({date:`${a+1}月`,success:Math.floor(100*Math.random())+50,failed:Math.floor(20*Math.random())+5}))};w.deploymentTrend=e[k.value],(0,r.dY)(()=>{R()})},R=()=>{const e=b.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=w.deploymentTrend;a.clearRect(0,0,t,l);const o=60,n=t-2*o,i=l-2*o;if(a.fillStyle="rgba(255, 255, 255, 0.05)",a.fillRect(o,o,n,i),0===s.length)return;const r=Math.max(...s.map(e=>Math.max(e.success,e.failed,e.success+e.failed))),d=n/s.length*.8,c=n/s.length*.2;a.strokeStyle="rgba(255, 255, 255, 0.1)",a.lineWidth=1;for(let u=0;u<=5;u++){const e=o+i/5*u;a.beginPath(),a.moveTo(o,e),a.lineTo(t-o,e),a.stroke()}s.forEach((e,t)=>{const l=o+n/s.length*t+c/2,u=.45*d,p=.45*d,m=.1*d,g=e.success/r*i,v=o+i-g,h=a.createLinearGradient(0,v,0,v+g);h.addColorStop(0,"#85CE61"),h.addColorStop(1,"#67C23A"),a.fillStyle=h,a.fillRect(l,v,u,g),a.strokeStyle="#67C23A",a.lineWidth=1,a.strokeRect(l,v,u,g);const k=e.failed/r*i,b=o+i-k,f=l+u+m,y=a.createLinearGradient(0,b,0,b+k);y.addColorStop(0,"#F78989"),y.addColorStop(1,"#F56C6C"),a.fillStyle=y,a.fillRect(f,b,p,k),a.strokeStyle="#F56C6C",a.lineWidth=1,a.strokeRect(f,b,p,k),a.fillStyle="#333333",a.font="10px Arial",a.textAlign="center",e.success>0&&a.fillText(e.success.toString(),l+u/2,v-5),e.failed>0&&a.fillText(e.failed.toString(),f+p/2,b-5)}),a.fillStyle="#333333",a.font="12px Arial",a.textAlign="center",s.forEach((e,t)=>{if(t%Math.max(1,Math.ceil(s.length/8))===0){const i=o+n/s.length*t+n/s.length/2;a.fillText(e.date,i,l-20)}}),a.fillStyle="#666666",a.font="10px Arial",a.textAlign="right";for(let u=0;u<=5;u++){const e=Math.round(r/5*(5-u)),t=o+i/5*u+3;a.fillText(e.toString(),o-10,t)}},D=()=>{const e=f.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=w.businessLines;if(a.clearRect(0,0,t,l),0===s.length)return;const o=t/2,n=l/2,i=Math.min(t,l)/2-40,r=s.reduce((e,a)=>e+a.count,0),d=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399"];let c=-Math.PI/2;s.forEach((e,t)=>{const l=e.count/r*2*Math.PI,s=d[t%d.length];a.fillStyle=s,a.beginPath(),a.moveTo(o,n),a.arc(o,n,i,c,c+l),a.closePath(),a.fill();const u=c+l/2,p=o+Math.cos(u)*(i+20),m=n+Math.sin(u)*(i+20);a.fillStyle="#ffffff",a.font="12px Arial",a.textAlign="center",a.fillText(`${e.name}: ${e.count}`,p,m),c+=l})},P=()=>{const e=y.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=w.taskExecution;if(a.clearRect(0,0,t,l),0===s.length)return;const o=50,n=t-2*o,i=l-2*o,r=n/s.length/2,d=Math.max(...s.map(e=>Math.max(e.shell,e.ansible)));a.fillStyle="rgba(255, 255, 255, 0.05)",a.fillRect(o,o,n,i),s.forEach((e,t)=>{const c=o+n/s.length*t,u=e.shell/d*i;a.fillStyle="#409EFF",a.fillRect(c,o+i-u,r,u);const p=e.ansible/d*i;a.fillStyle="#67C23A",a.fillRect(c+r,o+i-p,r,p),a.fillStyle="#ffffff",a.font="10px Arial",a.textAlign="center";const m=new Date(e.date),g=`${m.getMonth()+1}/${m.getDate()}`;a.fillText(g,c+r,l-10)})},$=()=>{const e=_.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e;a.clearRect(0,0,t,l);const s=t/2,o=l/2,n=60,i=12;a.strokeStyle="rgba(255, 255, 255, 0.1)",a.lineWidth=i,a.beginPath(),a.arc(s,o,n,0,2*Math.PI),a.stroke();const r=c.value/100*2*Math.PI;a.strokeStyle="#67C23A",a.lineWidth=i,a.beginPath(),a.arc(s,o,n,-Math.PI/2,-Math.PI/2+r),a.stroke()},T=()=>{(0,r.dY)(()=>{R(),D(),P(),$()})};(0,r.sV)(async()=>{V(),x(),S();try{await Promise.allSettled([L(),F(),C()])}catch(e){console.warn("加载真实数据失败，使用demo数据:",e)}A(),T()});const M=()=>{window.location.href="/dashboard"};return{totalApplications:e,successfulDeployments:a,failedDeployments:t,totalTasks:l,shellTemplates:n,ansibleTemplates:i,flowTemplates:d,successRate:c,shellSuccessRate:u,ansibleSuccessRate:p,runningApps:m,stoppedApps:g,errorApps:v,pendingApps:h,deploymentPeriod:k,deploymentTrendChart:b,businessLineChart:f,taskExecutionChart:y,successRateChart:_,loadDeploymentStats:A,goBack:M}}};const _o=(0,p.A)(yo,[["render",fo],["__scopeId","data-v-7f03b188"]]);var wo=_o;const Lo={class:"monitoring-alerts"},Fo={class:"dashboard-header"},Co={class:"header-actions"},Vo={class:"metrics-grid"},xo={class:"metric-card critical"},So={class:"metric-content"},Io={class:"metric-value"},Ao={class:"count-animation"},Ro={class:"metric-card warning"},Do={class:"metric-content"},Po={class:"metric-value"},$o={class:"count-animation"},To={class:"metric-card info"},Mo={class:"metric-content"},Eo={class:"metric-value"},Wo={class:"count-animation"},zo={class:"metric-card resolved"},No={class:"metric-content"},Ko={class:"metric-value"},Uo={class:"count-animation"},Xo={class:"charts-grid"},qo={class:"chart-card"},Ho={class:"top-list"},Bo={key:0,class:"loading-message"},jo={class:"top-info"},Oo={class:"top-name"},Qo={class:"top-ip"},Go={class:"top-description"},Yo={class:"progress-bar"},Jo={class:"top-metrics"},Zo={class:"top-value cpu"},en={viewBox:"0 0 24 24",fill:"currentColor"},an={key:0,d:"M7 14l5-5 5 5z"},tn={key:1,d:"M7 10l5 5 5-5z"},ln={key:2,d:"M8 12h8"},sn={class:"chart-card"},on={class:"top-list"},nn={key:0,class:"loading-message"},rn={class:"top-info"},dn={class:"top-name"},cn={class:"top-ip"},un={class:"top-description"},pn={class:"progress-bar"},mn={class:"top-metrics"},gn={class:"top-value memory"},vn={viewBox:"0 0 24 24",fill:"currentColor"},hn={key:0,d:"M7 14l5-5 5 5z"},kn={key:1,d:"M7 10l5 5 5-5z"},bn={key:2,d:"M8 12h8"},fn={class:"chart-card"},yn={class:"top-list"},_n={key:0,class:"loading-message"},wn={class:"top-info"},Ln={class:"top-name"},Fn={class:"top-ip"},Cn={class:"top-description"},Vn={class:"progress-bar"},xn={class:"top-metrics"},Sn={class:"top-value disk"},In={viewBox:"0 0 24 24",fill:"currentColor"},An={key:0,d:"M7 14l5-5 5 5z"},Rn={key:1,d:"M7 10l5 5 5-5z"},Dn={key:2,d:"M8 12h8"},Pn={class:"chart-card"},$n={class:"chart-header"},Tn={class:"db-summary"},Mn={class:"total-dbs"},En={class:"db-monitor-grid"},Wn={class:"db-item mysql"},zn={class:"db-count"},Nn={class:"db-item postgres"},Kn={class:"db-count"},Un={class:"db-item redis"},Xn={class:"db-count"},qn={class:"db-item mongodb"},Hn={class:"db-count"},Bn={class:"chart-card large"},jn={class:"chart-header"},On={class:"domain-summary"},Qn={class:"summary-item"},Gn={class:"summary-item"},Yn={class:"summary-item"},Jn={class:"domain-list"},Zn={class:"domain-info"},ei={class:"domain-name"},ai={class:"domain-url"},ti={class:"domain-metrics"},li={class:"metric"},si={class:"metric-value"},oi={class:"metric"},ni={class:"metric-value"},ii={class:"chart-card large"},ri={class:"chart-header"},di={class:"time-selector"},ci={class:"chart-container"},ui={ref:"alertTrendChart",width:"800",height:"300"},pi={class:"chart-card"},mi={class:"chart-container"},gi={ref:"alertCategoryChart",width:"400",height:"300"},vi={class:"chart-card"},hi={class:"business-monitor-list"},ki={class:"business-name"},bi={class:"business-metrics"},fi={class:"business-metric"},yi={class:"business-metric"},_i={class:"business-metric"};function wi(e,a,t,l,s,o){const n=(0,r.g2)("el-radio-button"),i=(0,r.g2)("el-radio-group");return(0,r.uX)(),(0,r.CE)("div",Lo,[(0,r.Lk)("div",Fo,[(0,r.Lk)("div",Co,[(0,r.Lk)("button",{class:"return-btn",onClick:a[0]||(a[0]=(...e)=>l.goBack&&l.goBack(...e))},a[2]||(a[2]=[(0,r.Lk)("span",{class:"icon"},"←",-1),(0,r.eW)(" 返回 ",-1)]))]),a[3]||(a[3]=(0,r.Lk)("h1",{class:"main-title"},"监控告警数据看板",-1)),a[4]||(a[4]=(0,r.Lk)("p",{class:"subtitle"},"Monitoring & Alerts Dashboard",-1))]),(0,r.Lk)("div",Vo,[(0,r.Lk)("div",xo,[a[7]||(a[7]=(0,r.Fv)('<div class="metric-icon-container" data-v-87372e56><div class="metric-icon" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M12 2L1 21h22M12 6l7.53 13H4.47M11 10v4h2v-4m-1 6h1v1h-1z" data-v-87372e56></path></svg></div><div class="icon-glow critical" data-v-87372e56></div><div class="pulse-ring critical" data-v-87372e56></div></div>',1)),(0,r.Lk)("div",So,[(0,r.Lk)("div",Io,[(0,r.Lk)("span",Ao,(0,x.v_)(l.criticalAlerts),1),a[5]||(a[5]=(0,r.Lk)("div",{class:"trend-indicator critical"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h2v2h-2zm0-8h2v6h-2z"})])],-1))]),a[6]||(a[6]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"严重告警"),(0,r.Lk)("div",{class:"metric-subtitle"},"Critical Alerts")],-1))])]),(0,r.Lk)("div",Ro,[a[10]||(a[10]=(0,r.Fv)('<div class="metric-icon-container" data-v-87372e56><div class="metric-icon" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z" data-v-87372e56></path></svg></div><div class="icon-glow warning" data-v-87372e56></div><div class="pulse-ring warning" data-v-87372e56></div></div>',1)),(0,r.Lk)("div",Do,[(0,r.Lk)("div",Po,[(0,r.Lk)("span",$o,(0,x.v_)(l.warningAlerts),1),a[8]||(a[8]=(0,r.Lk)("div",{class:"trend-indicator warning"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 14l5-5 5 5z"})])],-1))]),a[9]||(a[9]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"警告告警"),(0,r.Lk)("div",{class:"metric-subtitle"},"Warning Alerts")],-1))])]),(0,r.Lk)("div",To,[a[13]||(a[13]=(0,r.Fv)('<div class="metric-icon-container" data-v-87372e56><div class="metric-icon" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z" data-v-87372e56></path></svg></div><div class="icon-glow info" data-v-87372e56></div><div class="pulse-ring info" data-v-87372e56></div></div>',1)),(0,r.Lk)("div",Mo,[(0,r.Lk)("div",Eo,[(0,r.Lk)("span",Wo,(0,x.v_)(l.infoAlerts),1),a[11]||(a[11]=(0,r.Lk)("div",{class:"trend-indicator info"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 10l5 5 5-5z"})])],-1))]),a[12]||(a[12]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"信息告警"),(0,r.Lk)("div",{class:"metric-subtitle"},"Info Alerts")],-1))])]),(0,r.Lk)("div",zo,[a[16]||(a[16]=(0,r.Fv)('<div class="metric-icon-container" data-v-87372e56><div class="metric-icon" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" data-v-87372e56></path></svg></div><div class="icon-glow resolved" data-v-87372e56></div><div class="pulse-ring resolved" data-v-87372e56></div></div>',1)),(0,r.Lk)("div",No,[(0,r.Lk)("div",Ko,[(0,r.Lk)("span",Uo,(0,x.v_)(l.resolvedAlerts),1),a[14]||(a[14]=(0,r.Lk)("div",{class:"trend-indicator resolved"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 14l5-5 5 5z"})])],-1))]),a[15]||(a[15]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"已解决"),(0,r.Lk)("div",{class:"metric-subtitle"},"Resolved")],-1))])])]),(0,r.Lk)("div",Xo,[(0,r.Lk)("div",qo,[a[18]||(a[18]=(0,r.Fv)('<div class="chart-header" data-v-87372e56><div class="header-left" data-v-87372e56><div class="chart-icon cpu" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M17,17H7V7H17M21,11V9H19V7C19,5.89 18.1,5 17,5H15V3H13V5H11V3H9V5H7C5.89,5 5,5.89 5,7V9H3V11H5V13H3V15H5V17C5,18.1 5.89,19 7,19H9V21H11V19H13V21H15V19H17C18.1,19 19,18.1 19,17V15H21V13H19V11M9,9V15H15V9" data-v-87372e56></path></svg></div><div class="chart-title-group" data-v-87372e56><h3 data-v-87372e56>CPU使用率TOP5</h3><span class="chart-subtitle" data-v-87372e56>CPU Usage Top 5</span></div></div><div class="performance-indicator cpu" data-v-87372e56><div class="indicator-dot" data-v-87372e56></div><span data-v-87372e56>实时监控</span></div></div>',1)),(0,r.Lk)("div",Ho,[l.cpuTopHosts&&0===l.cpuTopHosts.length?((0,r.uX)(),(0,r.CE)("div",Bo," 正在加载CPU使用率数据... ")):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.cpuTopHosts,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"top-item"},[(0,r.Lk)("div",{class:(0,x.C4)(["top-rank",`rank-${t+1}`])},[(0,r.Lk)("span",null,(0,x.v_)(t+1),1),a[17]||(a[17]=(0,r.Lk)("div",{class:"rank-glow"},null,-1))],2),(0,r.Lk)("div",jo,[(0,r.Lk)("div",Oo,(0,x.v_)(e.hostname),1),(0,r.Lk)("div",Qo,(0,x.v_)(e.ip),1),(0,r.Lk)("div",Go,(0,x.v_)(e.description||"生产环境服务器"),1),(0,r.Lk)("div",Yo,[(0,r.Lk)("div",{class:"progress-fill cpu",style:(0,x.Tr)({width:`${e.cpu}%`})},null,4)])]),(0,r.Lk)("div",Jo,[(0,r.Lk)("div",Zo,(0,x.v_)(e.cpu)+"%",1),(0,r.Lk)("div",{class:(0,x.C4)(["top-trend",e.trend])},[((0,r.uX)(),(0,r.CE)("svg",en,["up"===e.trend?((0,r.uX)(),(0,r.CE)("path",an)):"down"===e.trend?((0,r.uX)(),(0,r.CE)("path",tn)):((0,r.uX)(),(0,r.CE)("path",ln))]))],2)])]))),128))])]),(0,r.Lk)("div",sn,[a[20]||(a[20]=(0,r.Fv)('<div class="chart-header" data-v-87372e56><div class="header-left" data-v-87372e56><div class="chart-icon memory" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M8,17V15H16V17H8M16,10V12H8V10H16M16,6V8H8V6H16M18,4H6A2,2 0 0,0 4,6V18A2,2 0 0,0 6,20H18A2,2 0 0,0 20,18V6A2,2 0 0,0 18,4Z" data-v-87372e56></path></svg></div><div class="chart-title-group" data-v-87372e56><h3 data-v-87372e56>内存使用率TOP5</h3><span class="chart-subtitle" data-v-87372e56>Memory Usage Top 5</span></div></div><div class="performance-indicator memory" data-v-87372e56><div class="indicator-dot" data-v-87372e56></div><span data-v-87372e56>实时监控</span></div></div>',1)),(0,r.Lk)("div",on,[l.memoryTopHosts&&0===l.memoryTopHosts.length?((0,r.uX)(),(0,r.CE)("div",nn," 正在加载内存使用率数据... ")):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.memoryTopHosts,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"top-item"},[(0,r.Lk)("div",{class:(0,x.C4)(["top-rank",`rank-${t+1}`])},[(0,r.Lk)("span",null,(0,x.v_)(t+1),1),a[19]||(a[19]=(0,r.Lk)("div",{class:"rank-glow"},null,-1))],2),(0,r.Lk)("div",rn,[(0,r.Lk)("div",dn,(0,x.v_)(e.hostname),1),(0,r.Lk)("div",cn,(0,x.v_)(e.ip),1),(0,r.Lk)("div",un,(0,x.v_)(e.description||"生产环境服务器"),1),(0,r.Lk)("div",pn,[(0,r.Lk)("div",{class:"progress-fill memory",style:(0,x.Tr)({width:`${e.memory}%`})},null,4)])]),(0,r.Lk)("div",mn,[(0,r.Lk)("div",gn,(0,x.v_)(e.memory)+"%",1),(0,r.Lk)("div",{class:(0,x.C4)(["top-trend",e.trend])},[((0,r.uX)(),(0,r.CE)("svg",vn,["up"===e.trend?((0,r.uX)(),(0,r.CE)("path",hn)):"down"===e.trend?((0,r.uX)(),(0,r.CE)("path",kn)):((0,r.uX)(),(0,r.CE)("path",bn))]))],2)])]))),128))])]),(0,r.Lk)("div",fn,[a[22]||(a[22]=(0,r.Fv)('<div class="chart-header" data-v-87372e56><div class="header-left" data-v-87372e56><div class="chart-icon disk" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M12,4A6,6 0 0,0 6,10C6,13.31 8.69,16 12.1,16L11.22,18.18L12.78,18.82L14.74,14H16A2,2 0 0,0 18,12H16A4,4 0 0,1 12,8A4,4 0 0,1 16,4H12M12,6A2,2 0 0,1 14,8A2,2 0 0,1 12,10A2,2 0 0,1 10,8A2,2 0 0,1 12,6Z" data-v-87372e56></path></svg></div><div class="chart-title-group" data-v-87372e56><h3 data-v-87372e56>磁盘使用率TOP5</h3><span class="chart-subtitle" data-v-87372e56>Disk Usage Top 5</span></div></div><div class="performance-indicator disk" data-v-87372e56><div class="indicator-dot" data-v-87372e56></div><span data-v-87372e56>实时监控</span></div></div>',1)),(0,r.Lk)("div",yn,[l.diskTopHosts&&0===l.diskTopHosts.length?((0,r.uX)(),(0,r.CE)("div",_n," 正在加载磁盘使用率数据... ")):(0,r.Q3)("",!0),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.diskTopHosts,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"top-item"},[(0,r.Lk)("div",{class:(0,x.C4)(["top-rank",`rank-${t+1}`])},[(0,r.Lk)("span",null,(0,x.v_)(t+1),1),a[21]||(a[21]=(0,r.Lk)("div",{class:"rank-glow"},null,-1))],2),(0,r.Lk)("div",wn,[(0,r.Lk)("div",Ln,(0,x.v_)(e.hostname),1),(0,r.Lk)("div",Fn,(0,x.v_)(e.ip),1),(0,r.Lk)("div",Cn,(0,x.v_)(e.description||"生产环境服务器"),1),(0,r.Lk)("div",Vn,[(0,r.Lk)("div",{class:"progress-fill disk",style:(0,x.Tr)({width:`${e.disk}%`})},null,4)])]),(0,r.Lk)("div",xn,[(0,r.Lk)("div",Sn,(0,x.v_)(e.disk)+"%",1),(0,r.Lk)("div",{class:(0,x.C4)(["top-trend",e.trend])},[((0,r.uX)(),(0,r.CE)("svg",In,["up"===e.trend?((0,r.uX)(),(0,r.CE)("path",An)):"down"===e.trend?((0,r.uX)(),(0,r.CE)("path",Rn)):((0,r.uX)(),(0,r.CE)("path",Dn))]))],2)])]))),128))])]),(0,r.Lk)("div",Pn,[(0,r.Lk)("div",$n,[a[24]||(a[24]=(0,r.Fv)('<div class="header-left" data-v-87372e56><div class="chart-icon database" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M12,3C7.58,3 4,4.79 4,7C4,9.21 7.58,11 12,11C16.42,11 20,9.21 20,7C20,4.79 16.42,3 12,3M4,9V12C4,14.21 7.58,16 12,16C16.42,16 20,14.21 20,12V9C20,11.21 16.42,13 12,13C7.58,13 4,11.21 4,9M4,14V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V14C20,16.21 16.42,18 12,18C7.58,18 4,16.21 4,14Z" data-v-87372e56></path></svg></div><div class="chart-title-group" data-v-87372e56><h3 data-v-87372e56>数据库监控</h3><span class="chart-subtitle" data-v-87372e56>Database Monitoring</span></div></div>',1)),(0,r.Lk)("div",Tn,[(0,r.Lk)("span",Mn,(0,x.v_)(l.mysqlCount+l.postgresCount+l.redisCount+l.mongodbCount),1),a[23]||(a[23]=(0,r.Lk)("span",{class:"total-label"},"总数据库",-1))])]),(0,r.Lk)("div",En,[(0,r.Lk)("div",Wn,[a[25]||(a[25]=(0,r.Fv)('<div class="db-icon-container" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M2.6,10.59L8.38,14.77L13.63,9.76C15.78,10.33 18.06,10.19 20,9.31C21.26,8.72 22,7.91 22,7V17C22,17.91 21.26,18.72 20,19.31C16.75,20.86 12.25,20.86 9,19.31C7.74,18.72 7,17.91 7,17V16.77L2.6,12.38L2.6,10.59M9,5.2C12.25,3.65 16.75,3.65 20,5.2C21.26,5.79 22,6.6 22,7.5C22,8.4 21.26,9.21 20,9.8C16.75,11.35 12.25,11.35 9,9.8C7.74,9.21 7,8.4 7,7.5C7,6.6 7.74,5.79 9,5.2Z" data-v-87372e56></path></svg><div class="db-status-indicator mysql" data-v-87372e56></div></div><div class="db-info" data-v-87372e56><div class="db-name" data-v-87372e56>MySQL</div><div class="db-status online" data-v-87372e56>在线</div></div>',2)),(0,r.Lk)("div",zn,(0,x.v_)(l.mysqlCount),1)]),(0,r.Lk)("div",Nn,[a[26]||(a[26]=(0,r.Fv)('<div class="db-icon-container" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M12,3C7.58,3 4,4.79 4,7C4,9.21 7.58,11 12,11C16.42,11 20,9.21 20,7C20,4.79 16.42,3 12,3M4,9V12C4,14.21 7.58,16 12,16C16.42,16 20,14.21 20,12V9C20,11.21 16.42,13 12,13C7.58,13 4,11.21 4,9M4,14V17C4,19.21 7.58,21 12,21C16.42,21 20,19.21 20,17V14C20,16.21 16.42,18 12,18C7.58,18 4,16.21 4,14Z" data-v-87372e56></path></svg><div class="db-status-indicator postgres" data-v-87372e56></div></div><div class="db-info" data-v-87372e56><div class="db-name" data-v-87372e56>PostgreSQL</div><div class="db-status online" data-v-87372e56>在线</div></div>',2)),(0,r.Lk)("div",Kn,(0,x.v_)(l.postgresCount),1)]),(0,r.Lk)("div",Un,[a[27]||(a[27]=(0,r.Fv)('<div class="db-icon-container" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M10.5,2.5L15.5,7.5L10.5,12.5L5.5,7.5L10.5,2.5M10.5,4.83L7.83,7.5L10.5,10.17L13.17,7.5L10.5,4.83M21.5,7.5C21.5,6.67 20.83,6 20,6H15L20,11H20C20.83,11 21.5,10.33 21.5,9.5V7.5M14,2H20C21.11,2 22,2.9 22,4V10C22,11.11 21.11,12 20,12H14L19,17H20C20.83,17 21.5,17.67 21.5,18.5V20.5C21.5,21.33 20.83,22 20,22H15L20,17H14.5L9.5,12.5L14.5,7.5L14,2M4,7.5C4,6.67 3.33,6 2.5,6S1,6.67 1,7.5V9.5C1,10.33 1.67,11 2.5,11S4,10.33 4,9.5V7.5Z" data-v-87372e56></path></svg><div class="db-status-indicator redis" data-v-87372e56></div></div><div class="db-info" data-v-87372e56><div class="db-name" data-v-87372e56>Redis</div><div class="db-status online" data-v-87372e56>在线</div></div>',2)),(0,r.Lk)("div",Xn,(0,x.v_)(l.redisCount),1)]),(0,r.Lk)("div",qn,[a[28]||(a[28]=(0,r.Fv)('<div class="db-icon-container" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M17.193,9.555C16.245,8.416 15.194,7.168 13.773,6.262C12.296,5.315 10.623,4.763 9.271,4.763C6.581,4.763 4.411,6.667 4.411,9.221C4.411,12.498 7.46,15.802 9.271,17.462C11.083,15.802 14.131,12.498 14.131,9.221C14.131,8.457 13.899,7.709 13.456,7.055C14.583,7.981 15.426,9.309 15.767,10.784C16.108,12.259 15.929,13.816 15.267,15.192C14.605,16.568 13.487,17.698 12.076,18.422C10.665,19.147 9.032,19.431 7.456,19.237C5.88,19.043 4.423,18.379 3.274,17.342C2.125,16.304 1.339,14.941 0.995,13.455C0.651,11.969 0.758,10.418 1.306,8.995C1.854,7.572 2.814,6.34 4.078,5.453C5.342,4.566 6.857,4.058 8.419,4.001C9.981,3.945 11.533,4.343 12.878,5.149C14.222,5.956 15.306,7.135 16.005,8.555L17.193,9.555Z" data-v-87372e56></path></svg><div class="db-status-indicator mongodb" data-v-87372e56></div></div><div class="db-info" data-v-87372e56><div class="db-name" data-v-87372e56>MongoDB</div><div class="db-status online" data-v-87372e56>在线</div></div>',2)),(0,r.Lk)("div",Hn,(0,x.v_)(l.mongodbCount),1)])])]),(0,r.Lk)("div",Bn,[(0,r.Lk)("div",jn,[a[29]||(a[29]=(0,r.Lk)("h3",null,"HTTPS域名监控",-1)),(0,r.Lk)("div",On,[(0,r.Lk)("span",Qn,"总数: "+(0,x.v_)(l.totalDomains),1),(0,r.Lk)("span",Gn,"正常: "+(0,x.v_)(l.normalDomains),1),(0,r.Lk)("span",Yn,"异常: "+(0,x.v_)(l.abnormalDomains),1)])]),(0,r.Lk)("div",Jn,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.domainMonitor,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"domain-item"},[(0,r.Lk)("div",{class:(0,x.C4)(["domain-status",e.status])},null,2),(0,r.Lk)("div",Zn,[(0,r.Lk)("div",ei,(0,x.v_)(e.name),1),(0,r.Lk)("div",ai,(0,x.v_)(e.url),1)]),(0,r.Lk)("div",ti,[(0,r.Lk)("div",li,[a[30]||(a[30]=(0,r.Lk)("span",{class:"metric-label"},"响应时间",-1)),(0,r.Lk)("span",si,(0,x.v_)(e.responseTime)+"ms",1)]),(0,r.Lk)("div",oi,[a[31]||(a[31]=(0,r.Lk)("span",{class:"metric-label"},"证书有效期",-1)),(0,r.Lk)("span",ni,(0,x.v_)(e.certDays)+"天",1)])])]))),128))])]),(0,r.Lk)("div",ii,[(0,r.Lk)("div",ri,[a[35]||(a[35]=(0,r.Fv)('<div class="header-left" data-v-87372e56><div class="chart-icon trends" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M16,6L18.29,8.29L13.41,13.17L9.41,9.17L2,16.59L3.41,18L9.41,12L13.41,16L19.71,9.71L22,12V6H16Z" data-v-87372e56></path></svg></div><div class="chart-title-group" data-v-87372e56><h3 data-v-87372e56>告警统计趋势</h3><span class="chart-subtitle" data-v-87372e56>Alert Statistics Trends</span></div></div>',1)),(0,r.Lk)("div",di,[(0,r.bF)(i,{modelValue:l.alertPeriod,"onUpdate:modelValue":a[1]||(a[1]=e=>l.alertPeriod=e),onChange:l.loadAlertStats},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"24h"},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.eW)("24小时",-1)])),_:1,__:[32]}),(0,r.bF)(n,{label:"7d"},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("7天",-1)])),_:1,__:[33]}),(0,r.bF)(n,{label:"30d"},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("30天",-1)])),_:1,__:[34]})]),_:1},8,["modelValue","onChange"])])]),(0,r.Lk)("div",ci,[a[36]||(a[36]=(0,r.Fv)('<div class="chart-legend" data-v-87372e56><div class="legend-item" data-v-87372e56><div class="legend-color critical" data-v-87372e56></div><span data-v-87372e56>严重告警</span></div><div class="legend-item" data-v-87372e56><div class="legend-color warning" data-v-87372e56></div><span data-v-87372e56>警告告警</span></div><div class="legend-item" data-v-87372e56><div class="legend-color info" data-v-87372e56></div><span data-v-87372e56>信息告警</span></div></div>',1)),(0,r.Lk)("canvas",ui,null,512)])]),(0,r.Lk)("div",pi,[a[37]||(a[37]=(0,r.Fv)('<div class="chart-header" data-v-87372e56><div class="header-left" data-v-87372e56><div class="chart-icon category" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M11 2v20c-5.07-.5-9-4.79-9-10s3.93-9.5 9-10zm2.03 0v8.99H22c-.47-4.74-4.24-8.52-8.97-8.99zm0 11.01V22c4.74-.47 8.5-4.25 8.97-8.99h-8.97z" data-v-87372e56></path></svg></div><div class="chart-title-group" data-v-87372e56><h3 data-v-87372e56>告警分类统计</h3><span class="chart-subtitle" data-v-87372e56>Alert Category Statistics</span></div></div><div class="chart-actions" data-v-87372e56><button class="action-btn" title="刷新数据" data-v-87372e56><svg viewBox="0 0 24 24" fill="currentColor" data-v-87372e56><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z" data-v-87372e56></path></svg></button></div></div>',1)),(0,r.Lk)("div",mi,[(0,r.Lk)("canvas",gi,null,512)])]),(0,r.Lk)("div",vi,[a[41]||(a[41]=(0,r.Lk)("div",{class:"chart-header"},[(0,r.Lk)("h3",null,"业务线监控状态")],-1)),(0,r.Lk)("div",hi,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.businessMonitor,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"business-item"},[(0,r.Lk)("div",ki,(0,x.v_)(e.name),1),(0,r.Lk)("div",bi,[(0,r.Lk)("div",fi,[a[38]||(a[38]=(0,r.Lk)("div",{class:"metric-icon healthy"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.healthy),1)]),(0,r.Lk)("div",yi,[a[39]||(a[39]=(0,r.Lk)("div",{class:"metric-icon warning"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.warning),1)]),(0,r.Lk)("div",_i,[a[40]||(a[40]=(0,r.Lk)("div",{class:"metric-icon critical"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.critical),1)])])]))),128))])])])])}var Li={name:"MonitoringAlerts",setup(){const e=(0,Y.KR)(0),a=(0,Y.KR)(0),t=(0,Y.KR)(0),s=(0,Y.KR)(0),o=(0,Y.KR)(0),n=(0,Y.KR)(0),i=(0,Y.KR)(0),d=(0,Y.KR)(0),c=(0,Y.KR)(0),u=(0,Y.KR)(0),p=(0,Y.KR)(0),m=(0,Y.KR)("24h"),g=(0,Y.KR)(null),v=(0,Y.KR)(null),h=(0,Y.KR)([]),k=(0,Y.KR)([]),b=(0,Y.KR)([]),f=(0,Y.KR)([]),y=(0,Y.KR)([]),_=(0,Y.KR)([]),w=(0,Y.KR)([]),L=e=>{const a=e.map((e,a)=>{let t={cpu:30,memory:40,disk:25},l="生产环境服务器";e.hostname.includes("db")?(t={cpu:65,memory:85,disk:70},l="MySQL数据库主库"):e.hostname.includes("api")?(t={cpu:75,memory:60,disk:35},l="API网关服务节点"):e.hostname.includes("web")?(t={cpu:45,memory:55,disk:40},l="Nginx Web服务器"):e.hostname.includes("redis")?(t={cpu:25,memory:90,disk:20},l="Redis缓存服务器"):e.hostname.includes("k8s-worker")?(t={cpu:80,memory:75,disk:60},l="Kubernetes工作节点"):e.hostname.includes("k8s-master")?(t={cpu:55,memory:70,disk:45},l="Kubernetes主控节点"):e.hostname.includes("monitoring")?(t={cpu:40,memory:65,disk:80},l="Prometheus监控服务"):e.hostname.includes("nginx-lb")?(t={cpu:35,memory:30,disk:25},l="负载均衡器"):e.hostname.includes("elk")?(t={cpu:60,memory:80,disk:85},l="ELK日志分析集群"):e.hostname.includes("test")&&(t={cpu:20,memory:35,disk:30},l="测试环境服务器");const s=["up","down","stable"],o=s[Math.floor(Math.random()*s.length)];return{...e,description:l,trend:o,cpu:Math.min(95,t.cpu+Math.floor(20*Math.random())-10),memory:Math.min(95,t.memory+Math.floor(20*Math.random())-10),disk:Math.min(95,t.disk+Math.floor(30*Math.random())-15)}});h.value=a.sort((e,a)=>a.cpu-e.cpu).slice(0,5),k.value=a.sort((e,a)=>a.memory-e.memory).slice(0,5),b.value=a.sort((e,a)=>a.disk-e.disk).slice(0,5)},F=()=>{const e=[{domain:"api.dodevops.com",responseTime:150,certDays:89,status:"normal"},{domain:"web.dodevops.com",responseTime:120,certDays:156,status:"normal"},{domain:"admin.dodevops.com",responseTime:180,certDays:45,status:"normal"},{domain:"mobile.dodevops.com",responseTime:850,certDays:234,status:"abnormal"},{domain:"cdn.dodevops.com",responseTime:95,certDays:178,status:"normal"},{domain:"monitor.dodevops.com",responseTime:210,certDays:67,status:"normal"},{domain:"grafana.dodevops.com",responseTime:340,certDays:123,status:"normal"}];f.value=e.map(e=>({name:e.domain,url:`https://${e.domain}`,status:e.status,responseTime:e.responseTime,certDays:e.certDays})),c.value=f.value.length,u.value=f.value.filter(e=>"normal"===e.status).length,p.value=f.value.filter(e=>"abnormal"===e.status).length},C=()=>{const e=[{name:"Web前端服务",healthy:15,warning:2,critical:0},{name:"API网关服务",healthy:12,warning:3,critical:1},{name:"K8s集群监控",healthy:18,warning:1,critical:0},{name:"数据库服务",healthy:8,warning:2,critical:0},{name:"缓存服务",healthy:6,warning:1,critical:0},{name:"消息队列",healthy:4,warning:0,critical:1}];y.value=e},V=async()=>{try{const e=await(0,l.getCmdbHostList)({pageNum:1,pageSize:100});if(200===e.code&&e.data){const a=e.data.rows||[];L(a)}}catch(e){console.error("加载主机数据失败:",e);const a=[{hostname:"prod-web-01",ip:"192.168.1.10"},{hostname:"prod-web-02",ip:"192.168.1.11"},{hostname:"prod-api-01",ip:"192.168.1.20"},{hostname:"prod-api-02",ip:"192.168.1.21"},{hostname:"prod-db-01",ip:"192.168.1.30"},{hostname:"prod-db-02",ip:"192.168.1.31"},{hostname:"prod-redis-01",ip:"192.168.1.40"},{hostname:"test-web-01",ip:"192.168.2.10"},{hostname:"test-api-01",ip:"192.168.2.20"},{hostname:"monitoring-01",ip:"192.168.1.50"},{hostname:"nginx-lb-01",ip:"192.168.1.60"},{hostname:"elk-stack-01",ip:"192.168.1.70"},{hostname:"k8s-master-01",ip:"192.168.1.80"},{hostname:"k8s-worker-01",ip:"192.168.1.81"},{hostname:"k8s-worker-02",ip:"192.168.1.82"}];L(a)}},x=async()=>{try{const e=await(0,l.listDatabases)({pageNum:1,pageSize:1e3});if(200===e.code&&e.data){const a=e.data.rows||[],t=a.reduce((e,a)=>{const t=a.type?.toLowerCase()||"unknown";return e[t]=(e[t]||0)+1,e},{});o.value=t.mysql||0,n.value=t.postgresql||t.postgres||0,i.value=t.redis||0,d.value=t.mongodb||t.mongo||0}}catch(e){console.error("加载数据库数据失败:",e),o.value=8,n.value=5,i.value=4,d.value=3}},S=()=>{e.value=3,a.value=12,t.value=18,s.value=45,w.value=[{name:"CPU告警",count:8},{name:"内存告警",count:5},{name:"磁盘告警",count:4},{name:"网络告警",count:3},{name:"应用告警",count:7}]},I=()=>{const e={"24h":Array.from({length:24},(e,a)=>({time:`${a}:00`,critical:Math.floor(5*Math.random()),warning:Math.floor(10*Math.random()),info:Math.floor(15*Math.random())})),"7d":Array.from({length:7},(e,a)=>{const t=new Date;return t.setDate(t.getDate()-(6-a)),{time:`${t.getMonth()+1}/${t.getDate()}`,critical:Math.floor(20*Math.random()),warning:Math.floor(40*Math.random()),info:Math.floor(60*Math.random())}}),"30d":Array.from({length:30},(e,a)=>{const t=new Date;return t.setDate(t.getDate()-(29-a)),{time:`${t.getMonth()+1}/${t.getDate()}`,critical:Math.floor(50*Math.random()),warning:Math.floor(100*Math.random()),info:Math.floor(150*Math.random())}})};_.value=e[m.value],(0,r.dY)(()=>{A()})},A=()=>{const e=g.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=_.value;a.clearRect(0,0,t,l);const o=60,n=t-2*o,i=l-2*o;if(a.fillStyle="rgba(255, 255, 255, 0.05)",a.fillRect(o,o,n,i),0===s.length)return;const r=Math.max(...s.map(e=>Math.max(e.critical,e.warning,e.info))),d=n/(s.length-1);a.strokeStyle="rgba(255, 255, 255, 0.1)",a.lineWidth=1;for(let u=0;u<=5;u++){const e=o+i/5*u;a.beginPath(),a.moveTo(o,e),a.lineTo(t-o,e),a.stroke()}const c=(e,t)=>{a.fillStyle=t,a.beginPath(),a.moveTo(o,o+i),e.forEach((e,t)=>{const l=o+d*t,s=o+i-e/r*i;a.lineTo(l,s)}),a.lineTo(o+n,o+i),a.closePath(),a.fill()};c(s.map(e=>e.critical),"rgba(245, 108, 108, 0.3)"),c(s.map(e=>e.warning),"rgba(230, 162, 60, 0.3)"),c(s.map(e=>e.info),"rgba(64, 158, 255, 0.3)"),a.fillStyle="#ffffff",a.font="12px Arial",a.textAlign="center",s.forEach((e,t)=>{if(t%Math.ceil(s.length/10)===0){const s=o+d*t;a.fillText(e.time,s,l-20)}})},R=()=>{const e=v.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=w.value;if(a.clearRect(0,0,t,l),0===s.length)return;const o=t/2,n=l/2,i=Math.min(t,l)/2-60,r=s.reduce((e,a)=>e+a.count,0),d=["#F56C6C","#E6A23C","#409EFF","#67C23A","#909399"];let c=-Math.PI/2;s.forEach((e,t)=>{const l=e.count/r*2*Math.PI,s=d[t%d.length];a.fillStyle=s,a.beginPath(),a.moveTo(o,n),a.arc(o,n,i,c,c+l),a.closePath(),a.fill();const u=c+l/2,p=o+Math.cos(u)*(i+30),m=n+Math.sin(u)*(i+30);a.fillStyle="#ffffff",a.font="12px Arial",a.textAlign="center",a.fillText(`${e.name}`,p,m),a.fillText(`${e.count}`,p,m+15),c+=l})},D=async()=>{const e=[{hostname:"prod-web-01",ip:"192.168.1.10"},{hostname:"prod-web-02",ip:"192.168.1.11"},{hostname:"prod-api-01",ip:"192.168.1.20"},{hostname:"prod-api-02",ip:"192.168.1.21"},{hostname:"prod-db-01",ip:"192.168.1.30"},{hostname:"prod-db-02",ip:"192.168.1.31"},{hostname:"prod-redis-01",ip:"192.168.1.40"},{hostname:"test-web-01",ip:"192.168.2.10"},{hostname:"test-api-01",ip:"192.168.2.20"},{hostname:"monitoring-01",ip:"192.168.1.50"},{hostname:"nginx-lb-01",ip:"192.168.1.60"},{hostname:"elk-stack-01",ip:"192.168.1.70"},{hostname:"k8s-master-01",ip:"192.168.1.80"},{hostname:"k8s-worker-01",ip:"192.168.1.81"},{hostname:"k8s-worker-02",ip:"192.168.1.82"}];L(e),S(),F(),C(),console.log("🔥 Demo数据生成完成:"),console.log("CPU TOP5:",h.value),console.log("Memory TOP5:",k.value),console.log("Disk TOP5:",b.value),o.value=8,n.value=5,i.value=4,d.value=3,I();try{await Promise.allSettled([V(),x()])}catch(a){console.warn("加载真实数据失败，使用demo数据:",a)}(0,r.dY)(()=>{R()})},P=()=>{window.location.href="/dashboard"};return(0,r.sV)(()=>{D()}),{criticalAlerts:e,warningAlerts:a,infoAlerts:t,resolvedAlerts:s,mysqlCount:o,postgresCount:n,redisCount:i,mongodbCount:d,totalDomains:c,normalDomains:u,abnormalDomains:p,alertPeriod:m,alertTrendChart:g,alertCategoryChart:v,cpuTopHosts:h,memoryTopHosts:k,diskTopHosts:b,domainMonitor:f,businessMonitor:y,loadAlertStats:I,goBack:P}}};const Fi=(0,p.A)(Li,[["render",wi],["__scopeId","data-v-87372e56"]]);var Ci=Fi;const Vi={class:"user-statistics"},xi={class:"dashboard-header"},Si={class:"header-actions"},Ii={class:"metrics-grid"},Ai={class:"metric-card total"},Ri={class:"metric-content"},Di={class:"metric-value"},Pi={class:"count-animation"},$i={class:"metric-card active"},Ti={class:"metric-content"},Mi={class:"metric-value"},Ei={class:"count-animation"},Wi={class:"metric-card online"},zi={class:"metric-content"},Ni={class:"metric-value"},Ki={class:"count-animation"},Ui={class:"metric-card new"},Xi={class:"metric-content"},qi={class:"metric-value"},Hi={class:"count-animation"},Bi={class:"charts-grid"},ji={class:"chart-card large"},Oi={class:"chart-header"},Qi={class:"time-selector"},Gi={class:"chart-container"},Yi={ref:"userGrowthChart",width:"800",height:"300"},Ji={class:"chart-card"},Zi={class:"chart-header"},er={class:"login-summary"},ar={class:"total-logins"},tr={class:"login-stats"},lr={class:"login-item password"},sr={class:"login-stats-right"},or={class:"login-count"},nr={class:"login-percentage"},ir={class:"progress-bar"},rr={class:"login-item sso"},dr={class:"login-stats-right"},cr={class:"login-count"},ur={class:"login-percentage"},pr={class:"progress-bar"},mr={class:"login-item mobile"},gr={class:"login-stats-right"},vr={class:"login-count"},hr={class:"login-percentage"},kr={class:"progress-bar"},br={class:"chart-card"},fr={class:"chart-header"},yr={class:"time-indicator"},_r={class:"current-time"},wr={class:"chart-container"},Lr={ref:"onlineTimeChart",width:"400",height:"300"},Fr={class:"chart-card"},Cr={class:"role-distribution"},Vr={class:"role-info"},xr={class:"role-name"},Sr={class:"role-description"},Ir={class:"role-count"},Ar={class:"role-bar"},Rr={class:"chart-card large"},Dr={class:"heatmap-container"},Pr={class:"heatmap-grid"},$r={class:"time-labels"},Tr={class:"day-grid"},Mr={class:"day-label"},Er={class:"hour-cells"},Wr=["title"],zr={class:"chart-card"},Nr={class:"region-list"},Kr={class:"region-info"},Ur={class:"region-name"},Xr={class:"region-percentage"},qr={class:"region-count"},Hr={class:"region-bar"},Br={class:"chart-card"},jr={class:"behavior-stats"},Or={class:"behavior-item"},Qr={class:"behavior-info"},Gr={class:"behavior-count"},Yr={class:"behavior-item"},Jr={class:"behavior-info"},Zr={class:"behavior-count"},ed={class:"behavior-item"},ad={class:"behavior-info"},td={class:"behavior-count"},ld={class:"behavior-item"},sd={class:"behavior-info"},od={class:"behavior-count"};function nd(e,a,t,l,s,o){const n=(0,r.g2)("el-radio-button"),i=(0,r.g2)("el-radio-group");return(0,r.uX)(),(0,r.CE)("div",Vi,[(0,r.Lk)("div",xi,[(0,r.Lk)("div",Si,[(0,r.Lk)("button",{class:"return-btn",onClick:a[0]||(a[0]=(...e)=>l.goBack&&l.goBack(...e))},a[2]||(a[2]=[(0,r.Lk)("span",{class:"icon"},"←",-1),(0,r.eW)(" 返回 ",-1)]))]),a[3]||(a[3]=(0,r.Lk)("h1",{class:"main-title"},"用户统计数据看板",-1)),a[4]||(a[4]=(0,r.Lk)("p",{class:"subtitle"},"User Statistics Dashboard",-1))]),(0,r.Lk)("div",Ii,[(0,r.Lk)("div",Ai,[a[7]||(a[7]=(0,r.Fv)('<div class="metric-icon-container" data-v-2809b598><div class="metric-icon" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" data-v-2809b598></path></svg></div><div class="icon-glow total" data-v-2809b598></div><div class="user-orbit" data-v-2809b598></div></div>',1)),(0,r.Lk)("div",Ri,[(0,r.Lk)("div",Di,[(0,r.Lk)("span",Pi,(0,x.v_)(l.totalUsers),1),a[5]||(a[5]=(0,r.Lk)("div",{class:"growth-indicator positive"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 14l5-5 5 5z"})])],-1))]),a[6]||(a[6]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"用户总数"),(0,r.Lk)("div",{class:"metric-subtitle"},"Total Users")],-1))])]),(0,r.Lk)("div",$i,[a[10]||(a[10]=(0,r.Fv)('<div class="metric-icon-container" data-v-2809b598><div class="metric-icon" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v-3c0-1.1.9-2 2-2h7c.85 0 1.6.55 1.9 1.35L21 14v4h-3v4h-3v-4H4zm8.5-6.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z" data-v-2809b598></path></svg></div><div class="icon-glow active" data-v-2809b598></div><div class="activity-pulse" data-v-2809b598></div></div>',1)),(0,r.Lk)("div",Ti,[(0,r.Lk)("div",Mi,[(0,r.Lk)("span",Ei,(0,x.v_)(l.weeklyActiveUsers),1),a[8]||(a[8]=(0,r.Lk)("div",{class:"growth-indicator positive"},[(0,r.Lk)("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[(0,r.Lk)("path",{d:"M7 14l5-5 5 5z"})])],-1))]),a[9]||(a[9]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"周活跃用户"),(0,r.Lk)("div",{class:"metric-subtitle"},"Weekly Active Users")],-1))])]),(0,r.Lk)("div",Wi,[a[13]||(a[13]=(0,r.Fv)('<div class="metric-icon-container" data-v-2809b598><div class="metric-icon" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM8 17.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5zM9.5 8c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5S9.5 8.83 9.5 8zm7 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" data-v-2809b598></path></svg></div><div class="icon-glow online" data-v-2809b598></div><div class="connection-signal" data-v-2809b598></div></div>',1)),(0,r.Lk)("div",zi,[(0,r.Lk)("div",Ni,[(0,r.Lk)("span",Ki,(0,x.v_)(l.onlineUsers),1),a[11]||(a[11]=(0,r.Lk)("div",{class:"real-time-indicator"},[(0,r.Lk)("div",{class:"dot"}),(0,r.Lk)("span",null,"LIVE")],-1))]),a[12]||(a[12]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"在线用户"),(0,r.Lk)("div",{class:"metric-subtitle"},"Online Users")],-1))])]),(0,r.Lk)("div",Ui,[a[16]||(a[16]=(0,r.Fv)('<div class="metric-icon-container" data-v-2809b598><div class="metric-icon" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V7H4v3H1v2h3v3h2v-3h3v-2H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" data-v-2809b598></path></svg></div><div class="icon-glow new" data-v-2809b598></div><div class="sparkle-effect" data-v-2809b598></div></div>',1)),(0,r.Lk)("div",Xi,[(0,r.Lk)("div",qi,[(0,r.Lk)("span",Hi,(0,x.v_)(l.newUsersToday),1),a[14]||(a[14]=(0,r.Lk)("div",{class:"today-badge"},[(0,r.Lk)("span",null,"TODAY")],-1))]),a[15]||(a[15]=(0,r.Lk)("div",{class:"metric-label"},[(0,r.Lk)("span",null,"今日新增"),(0,r.Lk)("div",{class:"metric-subtitle"},"New Users Today")],-1))])])]),(0,r.Lk)("div",Bi,[(0,r.Lk)("div",ji,[(0,r.Lk)("div",Oi,[a[20]||(a[20]=(0,r.Fv)('<div class="header-left" data-v-2809b598><div class="chart-icon growth" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z" data-v-2809b598></path></svg></div><div class="chart-title-group" data-v-2809b598><h3 data-v-2809b598>用户增长趋势</h3><span class="chart-subtitle" data-v-2809b598>User Growth Trends</span></div></div>',1)),(0,r.Lk)("div",Qi,[(0,r.bF)(i,{modelValue:l.growthPeriod,"onUpdate:modelValue":a[1]||(a[1]=e=>l.growthPeriod=e),onChange:l.loadUserGrowthData},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"7d"},{default:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.eW)("近7天",-1)])),_:1,__:[17]}),(0,r.bF)(n,{label:"30d"},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)("近30天",-1)])),_:1,__:[18]}),(0,r.bF)(n,{label:"90d"},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("近90天",-1)])),_:1,__:[19]})]),_:1},8,["modelValue","onChange"])])]),(0,r.Lk)("div",Gi,[a[21]||(a[21]=(0,r.Fv)('<div class="chart-legend" data-v-2809b598><div class="legend-item" data-v-2809b598><div class="legend-color new-users" data-v-2809b598></div><span data-v-2809b598>新增用户</span></div><div class="legend-item" data-v-2809b598><div class="legend-color total-users" data-v-2809b598></div><span data-v-2809b598>用户总数</span></div></div>',1)),(0,r.Lk)("canvas",Yi,null,512)])]),(0,r.Lk)("div",Ji,[(0,r.Lk)("div",Zi,[a[23]||(a[23]=(0,r.Fv)('<div class="header-left" data-v-2809b598><div class="chart-icon login" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M10 17.25V14h8V6h-8V2.75L4 10l6 7.25zm10-9.25v12c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2v4z" data-v-2809b598></path></svg></div><div class="chart-title-group" data-v-2809b598><h3 data-v-2809b598>登录方式分析</h3><span class="chart-subtitle" data-v-2809b598>Login Method Analysis</span></div></div>',1)),(0,r.Lk)("div",er,[(0,r.Lk)("span",ar,(0,x.v_)(l.passwordLogins+l.ssoLogins+l.mobileLogins),1),a[22]||(a[22]=(0,r.Lk)("span",{class:"total-label"},"总登录数",-1))])]),(0,r.Lk)("div",tr,[(0,r.Lk)("div",lr,[a[24]||(a[24]=(0,r.Fv)('<div class="login-type" data-v-2809b598><div class="login-icon-container" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" data-v-2809b598></path></svg><div class="method-indicator password" data-v-2809b598></div></div><div class="login-info" data-v-2809b598><span class="method-name" data-v-2809b598>密码登录</span><div class="method-description" data-v-2809b598>传统账号密码</div></div></div>',1)),(0,r.Lk)("div",sr,[(0,r.Lk)("div",or,(0,x.v_)(l.passwordLogins),1),(0,r.Lk)("div",nr,(0,x.v_)(l.passwordLoginPercentage)+"%",1),(0,r.Lk)("div",ir,[(0,r.Lk)("div",{class:"progress-fill password",style:(0,x.Tr)({width:`${l.passwordLoginPercentage}%`})},null,4)])])]),(0,r.Lk)("div",rr,[a[25]||(a[25]=(0,r.Fv)('<div class="login-type" data-v-2809b598><div class="login-icon-container" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2M21 9V7L19 8V11C19 12.1 18.1 13 17 13H7C5.9 13 5 12.1 5 11V8L3 7V9H1V11C1 12.1 1.9 13 3 13V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V13C22.1 13 23 12.1 23 11V9H21Z" data-v-2809b598></path></svg><div class="method-indicator sso" data-v-2809b598></div></div><div class="login-info" data-v-2809b598><span class="method-name" data-v-2809b598>SSO登录</span><div class="method-description" data-v-2809b598>单点登录系统</div></div></div>',1)),(0,r.Lk)("div",dr,[(0,r.Lk)("div",cr,(0,x.v_)(l.ssoLogins),1),(0,r.Lk)("div",ur,(0,x.v_)(l.ssoLoginPercentage)+"%",1),(0,r.Lk)("div",pr,[(0,r.Lk)("div",{class:"progress-fill sso",style:(0,x.Tr)({width:`${l.ssoLoginPercentage}%`})},null,4)])])]),(0,r.Lk)("div",mr,[a[26]||(a[26]=(0,r.Fv)('<div class="login-type" data-v-2809b598><div class="login-icon-container" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M17 2H7c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 20c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm5-4H7V4h10v14z" data-v-2809b598></path></svg><div class="method-indicator mobile" data-v-2809b598></div></div><div class="login-info" data-v-2809b598><span class="method-name" data-v-2809b598>手机登录</span><div class="method-description" data-v-2809b598>手机验证码</div></div></div>',1)),(0,r.Lk)("div",gr,[(0,r.Lk)("div",vr,(0,x.v_)(l.mobileLogins),1),(0,r.Lk)("div",hr,(0,x.v_)(l.mobileLoginPercentage)+"%",1),(0,r.Lk)("div",kr,[(0,r.Lk)("div",{class:"progress-fill mobile",style:(0,x.Tr)({width:`${l.mobileLoginPercentage}%`})},null,4)])])])])]),(0,r.Lk)("div",br,[(0,r.Lk)("div",fr,[a[28]||(a[28]=(0,r.Fv)('<div class="header-left" data-v-2809b598><div class="chart-icon time" data-v-2809b598><svg viewBox="0 0 24 24" fill="currentColor" data-v-2809b598><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M16.2,16.2L11,13V7H12.5V12.5L17,15.7L16.2,16.2Z" data-v-2809b598></path></svg></div><div class="chart-title-group" data-v-2809b598><h3 data-v-2809b598>在线时间段分析</h3><span class="chart-subtitle" data-v-2809b598>Online Time Analysis</span></div></div>',1)),(0,r.Lk)("div",yr,[(0,r.Lk)("div",_r,(0,x.v_)((new Date).getHours())+":"+(0,x.v_)(String((new Date).getMinutes()).padStart(2,"0")),1),a[27]||(a[27]=(0,r.Lk)("span",{class:"time-label"},"当前时间",-1))])]),(0,r.Lk)("div",wr,[(0,r.Lk)("canvas",Lr,null,512)])]),(0,r.Lk)("div",Fr,[a[29]||(a[29]=(0,r.Lk)("div",{class:"chart-header"},[(0,r.Lk)("h3",null,"用户角色分布")],-1)),(0,r.Lk)("div",Cr,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.userRoles,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"role-item"},[(0,r.Lk)("div",Vr,[(0,r.Lk)("div",xr,(0,x.v_)(e.name),1),(0,r.Lk)("div",Sr,(0,x.v_)(e.description),1)]),(0,r.Lk)("div",Ir,(0,x.v_)(e.count),1),(0,r.Lk)("div",Ar,[(0,r.Lk)("div",{class:"role-progress",style:(0,x.Tr)({width:e.percentage+"%"})},null,4)])]))),128))])]),(0,r.Lk)("div",Rr,[a[30]||(a[30]=(0,r.Fv)('<div class="chart-header" data-v-2809b598><h3 data-v-2809b598>用户活跃度热力图</h3><div class="heatmap-legend" data-v-2809b598><span data-v-2809b598>活跃度:</span><div class="legend-item low" data-v-2809b598>低</div><div class="legend-item medium" data-v-2809b598>中</div><div class="legend-item high" data-v-2809b598>高</div></div></div>',1)),(0,r.Lk)("div",Dr,[(0,r.Lk)("div",Pr,[(0,r.Lk)("div",$r,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(24,e=>(0,r.Lk)("div",{key:e,class:"time-label"},(0,x.v_)(e-1),1)),64))]),(0,r.Lk)("div",Tr,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.weekDays,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"day-row"},[(0,r.Lk)("div",Mr,(0,x.v_)(e),1),(0,r.Lk)("div",Er,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(24,t=>(0,r.Lk)("div",{key:t,class:(0,x.C4)(["hour-cell",l.getActivityLevel(a,t-1)]),title:`${e} ${t-1}:00 - 活跃用户: ${l.getActivityCount(a,t-1)}`},null,10,Wr)),64))])]))),128))])])])]),(0,r.Lk)("div",zr,[a[31]||(a[31]=(0,r.Lk)("div",{class:"chart-header"},[(0,r.Lk)("h3",null,"用户地域分布")],-1)),(0,r.Lk)("div",Nr,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.userRegions,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"region-item"},[(0,r.Lk)("div",Kr,[(0,r.Lk)("div",Ur,(0,x.v_)(e.name),1),(0,r.Lk)("div",Xr,(0,x.v_)(e.percentage)+"%",1)]),(0,r.Lk)("div",qr,(0,x.v_)(e.count)+"人",1),(0,r.Lk)("div",Hr,[(0,r.Lk)("div",{class:"region-progress",style:(0,x.Tr)({width:e.percentage+"%"})},null,4)])]))),128))])]),(0,r.Lk)("div",Br,[a[40]||(a[40]=(0,r.Lk)("div",{class:"chart-header"},[(0,r.Lk)("h3",null,"用户行为统计")],-1)),(0,r.Lk)("div",jr,[(0,r.Lk)("div",Or,[a[33]||(a[33]=(0,r.Lk)("div",{class:"behavior-icon deploy"},null,-1)),(0,r.Lk)("div",Qr,[a[32]||(a[32]=(0,r.Lk)("div",{class:"behavior-name"},"应用部署",-1)),(0,r.Lk)("div",Gr,(0,x.v_)(l.deployActions),1)])]),(0,r.Lk)("div",Yr,[a[35]||(a[35]=(0,r.Lk)("div",{class:"behavior-icon monitor"},null,-1)),(0,r.Lk)("div",Jr,[a[34]||(a[34]=(0,r.Lk)("div",{class:"behavior-name"},"监控查看",-1)),(0,r.Lk)("div",Zr,(0,x.v_)(l.monitorActions),1)])]),(0,r.Lk)("div",ed,[a[37]||(a[37]=(0,r.Lk)("div",{class:"behavior-icon task"},null,-1)),(0,r.Lk)("div",ad,[a[36]||(a[36]=(0,r.Lk)("div",{class:"behavior-name"},"任务执行",-1)),(0,r.Lk)("div",td,(0,x.v_)(l.taskActions),1)])]),(0,r.Lk)("div",ld,[a[39]||(a[39]=(0,r.Lk)("div",{class:"behavior-icon config"},null,-1)),(0,r.Lk)("div",sd,[a[38]||(a[38]=(0,r.Lk)("div",{class:"behavior-name"},"配置管理",-1)),(0,r.Lk)("div",od,(0,x.v_)(l.configActions),1)])])])])])])}var id={name:"UserStatistics",setup(){const e=(0,Y.KR)(0),a=(0,Y.KR)(0),t=(0,Y.KR)(0),l=(0,Y.KR)(0),s=(0,Y.KR)(0),o=(0,Y.KR)(0),i=(0,Y.KR)(0),d=(0,Y.KR)(0),c=(0,Y.KR)(0),u=(0,Y.KR)(0),p=(0,Y.KR)(0),m=(0,Y.KR)(0),g=(0,Y.KR)(0),v=(0,Y.KR)(0),h=(0,Y.KR)("7d"),k=(0,Y.KR)(null),b=(0,Y.KR)(null),f=(0,Y.Kh)({userGrowthData:[],onlineTimeData:[],userRoles:[],userRegions:[],activityHeatmap:[]}),y=["周一","周二","周三","周四","周五","周六","周日"],_=async()=>{try{const s=await(0,n.getUserList)({pageNum:1,pageSize:1e3});if(200===s.code&&s.data){const o=s.data.rows||[];e.value=o.length;const n=new Date;n.setDate(n.getDate()-7),a.value=Math.floor(.7*o.length),t.value=Math.floor(.15*o.length),l.value=Math.floor(10*Math.random())+3,L(o),F(),C(),V()}}catch(s){console.error("加载用户数据失败:",s),w()}},w=()=>{e.value=1247,a.value=873,t.value=156,l.value=7,L([]),F(),C(),V()},L=e=>{const a=[{name:"系统管理员",description:"拥有所有权限",count:12,percentage:0},{name:"运维工程师",description:"负责系统运维",count:156,percentage:0},{name:"开发工程师",description:"应用开发部署",count:423,percentage:0},{name:"业务用户",description:"业务系统使用",count:587,percentage:0},{name:"审计用户",description:"审计查看权限",count:69,percentage:0}],t=a.reduce((e,a)=>e+a.count,0);a.forEach(e=>{e.percentage=Math.round(e.count/t*100)}),f.userRoles=a},F=()=>{s.value=1856,o.value=892,i.value=234;const e=s.value+o.value+i.value;d.value=Math.round(s.value/e*100),c.value=Math.round(o.value/e*100),u.value=Math.round(i.value/e*100)},C=()=>{p.value=2341,m.value=5678,g.value=3456,v.value=1789},V=()=>{const e=[{name:"北京",count:342,percentage:0},{name:"上海",count:278,percentage:0},{name:"广州",count:234,percentage:0},{name:"深圳",count:189,percentage:0},{name:"杭州",count:156,percentage:0},{name:"其他",count:48,percentage:0}],a=e.reduce((e,a)=>e+a.count,0);e.forEach(e=>{e.percentage=Math.round(e.count/a*100)}),f.userRegions=e},x=()=>{const e=[];for(let a=0;a<7;a++){const t=[];for(let e=0;e<24;e++){let l=50*Math.random();a<5&&e>=9&&e<=18?l=100*Math.random()+50:a>=5&&e>=10&&e<=22&&(l=80*Math.random()+30),t.push(Math.floor(l))}e.push(t)}f.activityHeatmap=e},S=(e,a)=>{const t=f.activityHeatmap[e]?.[a]||0;return t<30?"low":t<70?"medium":"high"},I=(e,a)=>f.activityHeatmap[e]?.[a]||0,A=()=>{const e={"7d":Array.from({length:7},(e,a)=>{const t=new Date;return t.setDate(t.getDate()-(6-a)),{date:`${t.getMonth()+1}/${t.getDate()}`,newUsers:Math.floor(20*Math.random())+5,totalUsers:1200+10*a+Math.floor(20*Math.random())}}),"30d":Array.from({length:30},(e,a)=>{const t=new Date;return t.setDate(t.getDate()-(29-a)),{date:`${t.getMonth()+1}/${t.getDate()}`,newUsers:Math.floor(15*Math.random())+3,totalUsers:1e3+8*a+Math.floor(30*Math.random())}}),"90d":Array.from({length:90},(e,a)=>{const t=new Date;return t.setDate(t.getDate()-(89-a)),{date:`${t.getMonth()+1}/${t.getDate()}`,newUsers:Math.floor(25*Math.random())+5,totalUsers:800+5*a+Math.floor(40*Math.random())}})};f.userGrowthData=e[h.value],(0,r.dY)(()=>{D()})},R=()=>{f.onlineTimeData=Array.from({length:24},(e,a)=>({hour:a,count:Math.floor(100*Math.random())+(a>=9&&a<=18?100:20)}))},D=()=>{const e=k.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=f.userGrowthData;a.clearRect(0,0,t,l);const o=60,n=t-2*o,i=l-2*o;if(a.fillStyle="rgba(255, 255, 255, 0.05)",a.fillRect(o,o,n,i),0===s.length)return;const r=Math.max(...s.map(e=>e.newUsers)),d=Math.max(...s.map(e=>e.totalUsers)),c=n/(s.length-1);a.strokeStyle="rgba(255, 255, 255, 0.1)",a.lineWidth=1;for(let u=0;u<=5;u++){const e=o+i/5*u;a.beginPath(),a.moveTo(o,e),a.lineTo(t-o,e),a.stroke()}a.fillStyle="rgba(103, 194, 58, 0.6)",s.forEach((e,t)=>{const l=o+c*t-10,s=e.newUsers/r*i*.6;a.fillRect(l,o+i-s,20,s)}),a.strokeStyle="#409EFF",a.lineWidth=3,a.beginPath(),s.forEach((e,t)=>{const l=o+c*t,s=o+i-e.totalUsers/d*i*.8;0===t?a.moveTo(l,s):a.lineTo(l,s)}),a.stroke(),s.forEach((e,t)=>{const l=o+c*t,s=o+i-e.totalUsers/d*i*.8;a.fillStyle="#409EFF",a.beginPath(),a.arc(l,s,4,0,2*Math.PI),a.fill()}),a.fillStyle="#ffffff",a.font="12px Arial",a.textAlign="center",s.forEach((e,t)=>{if(t%Math.ceil(s.length/8)===0){const s=o+c*t;a.fillText(e.date,s,l-20)}})},P=()=>{const e=b.value;if(!e)return;const a=e.getContext("2d"),{width:t,height:l}=e,s=f.onlineTimeData;if(a.clearRect(0,0,t,l),0===s.length)return;const o=40,n=t-2*o,i=l-2*o,r=n/s.length,d=Math.max(...s.map(e=>e.count));a.fillStyle="rgba(255, 255, 255, 0.05)",a.fillRect(o,o,n,i),s.forEach((e,t)=>{const s=o+r*t,n=e.count/d*i,c=a.createLinearGradient(0,o+i-n,0,o+i);c.addColorStop(0,"#409EFF"),c.addColorStop(1,"rgba(64, 158, 255, 0.3)"),a.fillStyle=c,a.fillRect(s+2,o+i-n,r-4,n),t%3===0&&(a.fillStyle="#ffffff",a.font="10px Arial",a.textAlign="center",a.fillText(`${e.hour}:00`,s+r/2,l-10))})},$=async()=>{await _(),x(),R(),A(),(0,r.dY)(()=>{P()})},T=()=>{window.location.href="/dashboard"};return(0,r.sV)(()=>{$()}),{totalUsers:e,weeklyActiveUsers:a,onlineUsers:t,newUsersToday:l,passwordLogins:s,ssoLogins:o,mobileLogins:i,passwordLoginPercentage:d,ssoLoginPercentage:c,mobileLoginPercentage:u,deployActions:p,monitorActions:m,taskActions:g,configActions:v,growthPeriod:h,userGrowthChart:k,onlineTimeChart:b,userRoles:f.userRoles,userRegions:f.userRegions,weekDays:y,getActivityLevel:S,getActivityCount:I,loadUserGrowthData:A,goBack:T}}};const rd=(0,p.A)(id,[["render",nd],["__scopeId","data-v-2809b598"]]);var dd=rd;const cd={class:"personal-management"},ud={class:"profile-content"},pd={class:"avatar-section"},md={class:"profile-value"},gd={class:"profile-value"},vd={class:"profile-value"},hd={class:"profile-value"},kd={class:"profile-value"},bd={class:"profile-value"},fd={class:"tabs-section"},yd=["src"],_d=["src"];function wd(e,a,t,l,s,o){const n=(0,r.g2)("el-avatar"),i=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-col"),c=(0,r.g2)("el-row"),u=(0,r.g2)("el-form"),p=(0,r.g2)("el-card"),m=(0,r.g2)("el-upload"),g=(0,r.g2)("el-input"),v=(0,r.g2)("el-button"),h=(0,r.g2)("el-tab-pane"),k=(0,r.g2)("el-tabs");return(0,r.uX)(),(0,r.CE)("div",cd,[(0,r.bF)(c,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(d,{xs:24,sm:24,md:8,lg:6,xl:5,style:{"margin-bottom":"20px"}},{default:(0,r.k6)(()=>[(0,r.bF)(p,{shadow:"hover",class:"profile-card"},{header:(0,r.k6)(()=>a[9]||(a[9]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"个人信息")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",ud,[(0,r.Lk)("div",pd,[(0,r.bF)(n,{src:s.adminDetail.icon,size:130,class:"profile-avatar"},null,8,["src"])]),(0,r.bF)(u,{"label-width":"100px",size:"small",class:"profile-form"},{default:(0,r.k6)(()=>[(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户账号："},{default:(0,r.k6)(()=>[(0,r.Lk)("span",md,(0,x.v_)(s.adminDetail.username),1)]),_:1})]),_:1}),(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户昵称："},{default:(0,r.k6)(()=>[(0,r.Lk)("span",gd,(0,x.v_)(s.adminDetail.nickname),1)]),_:1})]),_:1}),(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户邮箱："},{default:(0,r.k6)(()=>[(0,r.Lk)("span",vd,(0,x.v_)(s.adminDetail.email),1)]),_:1})]),_:1}),(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户电话："},{default:(0,r.k6)(()=>[(0,r.Lk)("span",hd,(0,x.v_)(s.adminDetail.phone),1)]),_:1})]),_:1}),(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户备注："},{default:(0,r.k6)(()=>[(0,r.Lk)("span",kd,(0,x.v_)(s.adminDetail.note),1)]),_:1})]),_:1}),(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"创建时间："},{default:(0,r.k6)(()=>[(0,r.Lk)("span",bd,(0,x.v_)(s.adminDetail.createTime),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1}),(0,r.bF)(d,{xs:24,sm:24,md:16,lg:18,xl:19},{default:(0,r.k6)(()=>[(0,r.bF)(p,{shadow:"hover",class:"detail-card"},{header:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"基本资料")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",fd,[(0,r.bF)(k,{modelValue:s.activeName,"onUpdate:modelValue":a[8]||(a[8]=e=>s.activeName=e),class:"personal-tabs"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{label:"基本资料",name:"first"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{model:s.adminDetail,rules:s.editFormRules,ref:"editFormRefForm","label-width":"100px",class:"edit-form"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户头像",prop:"icon"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{headers:s.headers,class:"avatar-uploader",action:s.uploadIconUrl,"show-file-list":!1,"on-success":o.handleAvatarSuccess},{default:(0,r.k6)(()=>[s.icon?((0,r.uX)(),(0,r.CE)("img",{key:0,src:s.icon,class:"avatar",title:"点击更换头像"},null,8,yd)):((0,r.uX)(),(0,r.CE)("img",{key:1,src:s.adminDetail.icon,class:"avatar",title:"点击更换头像"},null,8,_d))]),_:1},8,["headers","action","on-success"])]),_:1}),(0,r.bF)(i,{label:"用户账号",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.adminDetail.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.adminDetail.username=e),size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"用户昵称",prop:"nickname"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.adminDetail.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>s.adminDetail.nickname=e),size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"手机号码",prop:"phone"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.adminDetail.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>s.adminDetail.phone=e),maxlength:"11",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"用户邮箱",prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.adminDetail.email,"onUpdate:modelValue":a[3]||(a[3]=e=>s.adminDetail.email=e),maxlength:"50",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"用户备注",prop:"note"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.adminDetail.note,"onUpdate:modelValue":a[4]||(a[4]=e=>s.adminDetail.note=e),size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{class:"form-actions"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"primary",size:"small",onClick:o.submitFirst},{default:(0,r.k6)(()=>a[11]||(a[11]=[(0,r.eW)("保存",-1)])),_:1,__:[11]},8,["onClick"]),(0,r.bF)(v,{size:"small",onClick:o.closeFirst},{default:(0,r.k6)(()=>a[12]||(a[12]=[(0,r.eW)("关闭",-1)])),_:1,__:[12]},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),(0,r.bF)(h,{label:"修改密码",name:"second"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{model:s.updateForm,rules:s.updateFormRules,ref:"updateFormRefForm","label-width":"100px",class:"edit-form"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"旧密码",prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.updateForm.password,"onUpdate:modelValue":a[5]||(a[5]=e=>s.updateForm.password=e),placeholder:"请输入旧密码",type:"password",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"新密码",prop:"newPassword"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.updateForm.newPassword,"onUpdate:modelValue":a[6]||(a[6]=e=>s.updateForm.newPassword=e),placeholder:"请输入新密码",type:"password",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"确认密码",prop:"resetPassword"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:s.updateForm.resetPassword,"onUpdate:modelValue":a[7]||(a[7]=e=>s.updateForm.resetPassword=e),placeholder:"请确认密码",type:"password",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{class:"form-actions"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"primary",size:"small",onClick:o.submitSecond},{default:(0,r.k6)(()=>a[13]||(a[13]=[(0,r.eW)("保存",-1)])),_:1,__:[13]},8,["onClick"]),(0,r.bF)(v,{size:"small",onClick:o.closeSecond},{default:(0,r.k6)(()=>a[14]||(a[14]=[(0,r.eW)("关闭",-1)])),_:1,__:[14]},8,["onClick"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})]),_:1})]),_:1})])}var Ld={data(){return{adminDetail:P.getItem("sysAdmin"),activeName:"first",uploadIconUrl:"/api/v1/upload",headers:{Authorization:"Bearer "+P.getItem("token")},icon:"",editFormRules:{username:[{required:!0,message:"请输入用户账号",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入用户手机",trigger:"blur"}],note:[{required:!0,message:"请输入用户备注",trigger:"blur"}]},updateForm:{password:"",newPassword:"",resetPassword:""},updateFormRules:{password:[{required:!0,message:"请输入旧密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"}],resetPassword:[{required:!0,message:"请输入重复密码",trigger:"blur"}]}}},methods:{handleAvatarSuccess(e){this.icon=e.data},submitFirst(){this.$refs.editFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.adminUpdatePersonal({icon:""===this.icon?this.adminDetail.icon:this.icon,username:this.adminDetail.username,email:this.adminDetail.email,nickname:this.adminDetail.nickname,phone:this.adminDetail.phone,note:this.adminDetail.note});200!==a.code?this.$message.error(a.message):(this.$storage.clearItem("sysAdmin"),this.$store.commit("saveSysAdmin",a.data),await this.$router.push("/home"),this.$message.success("修改用户成功"))})},closeFirst(){this.$router.push("/home")},submitSecond(){this.$refs.updateFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.adminUpdatePersonalPassword({password:this.updateForm.password,newPassword:this.updateForm.newPassword,resetPassword:this.updateForm.resetPassword});200!==a.code?this.$message.error(a.message):(this.$storage.clearAll(),this.$router.push("/login"),this.$message.success("修改密码成功"))})},closeSecond(){this.$router.push("/home")}}};const Fd=(0,p.A)(Ld,[["render",wd],["__scopeId","data-v-3c85bdbd"]]);var Cd=Fd;const Vd={class:"modern-admin-container"},xd={class:"glass-card main-card"},Sd={class:"user-management-container"},Id={class:"dept-tree-section"},Ad={class:"glass-card tree-card"},Rd={class:"user-table-section"},Dd={class:"glass-card search-card"},Pd={class:"glass-card table-card"},$d={class:"modern-text"},Td={class:"operation-buttons"},Md={class:"glass-card pagination-card"},Ed={slot:"footer",class:"dialog-footer"},Wd={slot:"footer",class:"dialog-footer"};function zd(e,a,t,l,s,o){const n=(0,r.g2)("FolderOpened"),d=(0,r.g2)("el-icon"),c=(0,r.g2)("Folder"),u=(0,r.g2)("el-tree"),p=(0,r.g2)("el-input"),m=(0,r.g2)("el-form-item"),g=(0,r.g2)("el-option"),v=(0,r.g2)("el-select"),h=(0,r.g2)("Search"),k=(0,r.g2)("el-button"),b=(0,r.g2)("Refresh"),f=(0,r.g2)("Plus"),y=(0,r.g2)("el-form"),_=(0,r.g2)("el-table-column"),w=(0,r.g2)("el-avatar"),L=(0,r.g2)("el-tag"),F=(0,r.g2)("el-switch"),C=(0,r.g2)("Edit"),V=(0,r.g2)("el-tooltip"),S=(0,r.g2)("Delete"),I=(0,r.g2)("Key"),A=(0,r.g2)("el-table"),R=(0,r.g2)("el-pagination"),D=(0,r.g2)("el-col"),P=(0,r.g2)("el-row"),$=(0,r.g2)("treeselect"),T=(0,r.g2)("el-radio"),M=(0,r.g2)("el-radio-group"),E=(0,r.g2)("el-dialog"),W=(0,r.gN)("authority"),z=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Vd,[(0,r.Lk)("div",xd,[(0,r.Q3)("",!0),a[31]||(a[31]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"main-title"},"用户管理系统")],-1)),(0,r.Lk)("div",Sd,[(0,r.Lk)("div",Id,[(0,r.Lk)("div",Ad,[a[26]||(a[26]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("h3",{class:"section-title"},"部门选择")],-1)),(0,r.bF)(u,{data:s.deptList,props:s.defaultProps,"node-key":"id","default-expand-all":"","highlight-current":!0,onNodeClick:o.handleDeptClick,onNodeExpand:o.handleNodeExpand,onNodeCollapse:o.handleNodeCollapse,class:"modern-tree"},{default:(0,r.k6)(({node:e,data:a})=>[(0,r.Lk)("span",{class:(0,x.C4)([{"font-weight-bold":!a.parentId},"tree-node"])},[a.parentId?((0,r.uX)(),(0,r.Wv)(d,{key:1,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[s.expandedKeys.includes(e.key)?((0,r.uX)(),(0,r.Wv)(d,{key:0,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1})):((0,r.uX)(),(0,r.Wv)(d,{key:1,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:1}))],64)),(0,r.eW)(" "+(0,x.v_)(e.label),1)],2)]),_:1},8,["data","props","onNodeClick","onNodeExpand","onNodeCollapse"])])]),(0,r.Lk)("div",Rd,[(0,r.Lk)("div",Dd,[(0,r.bF)(y,{inline:!0,model:s.queryParams,class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户账号",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{size:"small",placeholder:"请输入用户账号",clearable:"",modelValue:s.queryParams.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.username=e),onKeyup:(0,i.jR)(o.handleQuery,["enter"]),class:"modern-input"},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(m,{label:"账号状态",prop:"status",style:{width:"150px"}},{default:(0,r.k6)(()=>[(0,r.bF)(v,{size:"small",placeholder:"账号状态",modelValue:s.queryParams.status,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.status=e),class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.statusList,e=>((0,r.uX)(),(0,r.Wv)(g,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(k,{type:"primary",size:"small",onClick:o.handleQuery,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),a[27]||(a[27]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[27]},8,["onClick"]),(0,r.bF)(k,{size:"small",onClick:o.resetQuery,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1}),a[28]||(a[28]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[28]},8,["onClick"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(k,{type:"success",size:"small",onClick:a[2]||(a[2]=e=>s.addDialogVisible=!0),class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1}),a[29]||(a[29]=(0,r.eW)(" 新增 ",-1))]),_:1,__:[29]})),[[W,["base:admin:add"]]])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",Pd,[a[30]||(a[30]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("h3",{class:"section-title"},"用户列表")],-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(A,{data:s.adminList,class:"modern-table","row-class-name":o.tableRowClassName},{default:(0,r.k6)(()=>[(0,r.Q3)("",!0),(0,r.bF)(_,{label:"用户账号",prop:"username"}),(0,r.bF)(_,{label:"用户头像",prop:"icon"},{default:(0,r.k6)(e=>[(0,r.bF)(w,{shape:"circle",src:e.row.icon,class:"modern-avatar"},null,8,["src"])]),_:1}),(0,r.bF)(_,{label:"用户昵称",prop:"nickname"}),(0,r.bF)(_,{label:"角色名称",prop:"roleName"},{default:(0,r.k6)(e=>[(0,r.bF)(L,{type:"success",class:"modern-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.roleName),1)]),_:2},1024)]),_:1}),(0,r.bF)(_,{label:"岗位"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",$d,(0,x.v_)(e.row.postName),1)]),_:1}),(0,r.bF)(_,{label:"账号状态"},{default:(0,r.k6)(e=>[(0,r.bF)(F,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":2,"active-color":"#67C23A","inactive-color":"#F56C6C","active-text":"启用","inactive-text":"停用",onChange:a=>o.adminUpdateStatus(e.row),class:"modern-switch"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,r.bF)(_,{label:"操作",fixed:"right",width:"200"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Td,[(0,r.bF)(V,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(k,{type:"warning",size:"small",circle:"",onClick:a=>o.showEditAdminDialog(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(C)]),_:1})]),_:2},1032,["onClick"])),[[W,["base:admin:edit"]]])]),_:2},1024),(0,r.bF)(V,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(k,{type:"danger",size:"small",circle:"",onClick:a=>o.handleAdminDelete(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(S)]),_:1})]),_:2},1032,["onClick"])),[[W,["base:admin:delete"]]])]),_:2},1024),(0,r.bF)(V,{content:"重置密码",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(k,{type:"info",size:"small",circle:"",onClick:a=>o.handleResetPwd(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(I)]),_:1})]),_:2},1032,["onClick"])),[[W,["base:admin:reset"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data","row-class-name"])),[[z,s.Loading]])]),(0,r.Lk)("div",Md,[(0,r.bF)(R,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500,1e3],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total,class:"modern-pagination"},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])])]),(0,r.bF)(E,{title:"新增用户",modelValue:s.addDialogVisible,"onUpdate:modelValue":a[14]||(a[14]=e=>s.addDialogVisible=e),width:"40%",onClose:o.addDialogClosed,class:"modern-dialog"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{model:s.addForm,rules:s.addFormRules,ref:"addFormRefForm","label-width":"80px",class:"modern-dialog-form"},{default:(0,r.k6)(()=>[(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户名称",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.addForm.username,"onUpdate:modelValue":a[3]||(a[3]=e=>s.addForm.username=e),placeholder:"请输入英文名称",maxlength:"30",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户密码",prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.addForm.password,"onUpdate:modelValue":a[4]||(a[4]=e=>s.addForm.password=e),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":"",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户昵称",prop:"nickname"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.addForm.nickname,"onUpdate:modelValue":a[5]||(a[5]=e=>s.addForm.nickname=e),placeholder:"请输入中文昵称",maxlength:"30",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{size:"small",label:"归属部门",prop:"deptId"},{default:(0,r.k6)(()=>[(0,r.bF)($,{modelValue:s.addForm.deptId,"onUpdate:modelValue":a[6]||(a[6]=e=>s.addForm.deptId=e),options:s.deptList,"show-count":!0,placeholder:"请选择归属部门",class:"modern-treeselect"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"手机号码",prop:"phone"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.addForm.phone,"onUpdate:modelValue":a[7]||(a[7]=e=>s.addForm.phone=e),placeholder:"请输入手机号码",maxlength:"11",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户邮箱",prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.addForm.email,"onUpdate:modelValue":a[8]||(a[8]=e=>s.addForm.email=e),placeholder:"请输入邮箱",maxlength:"50",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(M,{modelValue:s.addForm.status,"onUpdate:modelValue":a[9]||(a[9]=e=>s.addForm.status=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(T,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.eW)("正常",-1)])),_:1,__:[32]}),(0,r.bF)(T,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("停用",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户岗位",prop:"postId"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{placeholder:"请选择岗位",modelValue:s.addForm.postId,"onUpdate:modelValue":a[10]||(a[10]=e=>s.addForm.postId=e),class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.postList,e=>((0,r.uX)(),(0,r.Wv)(g,{key:e.id,label:e.postName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户角色",prop:"roleId"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{placeholder:"请选择角色",modelValue:s.addForm.roleId,"onUpdate:modelValue":a[11]||(a[11]=e=>s.addForm.roleId=e),class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.roleList,e=>((0,r.uX)(),(0,r.Wv)(g,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"个人简介",prop:"note"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.addForm.note,"onUpdate:modelValue":a[12]||(a[12]=e=>s.addForm.note=e),type:"textarea",placeholder:"请输入内容",class:"modern-textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.Lk)("span",Ed,[(0,r.bF)(k,{type:"primary",onClick:o.addAdmin,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("确 定",-1)])),_:1,__:[34]},8,["onClick"]),(0,r.bF)(k,{type:"info",onClick:a[13]||(a[13]=e=>s.addDialogVisible=!1),class:"modern-btn secondary-btn"},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)("取 消",-1)])),_:1,__:[35]})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(E,{title:"修改用户",modelValue:s.editDialogVisible,"onUpdate:modelValue":a[25]||(a[25]=e=>s.editDialogVisible=e),width:"40%",onClose:o.editDialogClosed,class:"modern-dialog"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{model:s.adminInfo,rules:s.editFormRules,ref:"editFormRefForm","label-width":"80px",class:"modern-dialog-form"},{default:(0,r.k6)(()=>[(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户昵称",prop:"nickname"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.adminInfo.nickname,"onUpdate:modelValue":a[15]||(a[15]=e=>s.adminInfo.nickname=e),placeholder:"请输入用户昵称",maxlength:"30",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{size:"small",label:"归属部门",prop:"deptId"},{default:(0,r.k6)(()=>[(0,r.bF)($,{modelValue:s.adminInfo.deptId,"onUpdate:modelValue":a[16]||(a[16]=e=>s.adminInfo.deptId=e),options:s.deptList,"show-count":!0,placeholder:"请选择归属部门",class:"modern-treeselect"},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"手机号码",prop:"phone"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.adminInfo.phone,"onUpdate:modelValue":a[17]||(a[17]=e=>s.adminInfo.phone=e),placeholder:"请输入手机号码",maxlength:"11",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户邮箱",prop:"email"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.adminInfo.email,"onUpdate:modelValue":a[18]||(a[18]=e=>s.adminInfo.email=e),placeholder:"请输入邮箱",maxlength:"50",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户名称",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.adminInfo.username,"onUpdate:modelValue":a[19]||(a[19]=e=>s.adminInfo.username=e),placeholder:"请输入用户名称",maxlength:"30",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(M,{modelValue:s.adminInfo.status,"onUpdate:modelValue":a[20]||(a[20]=e=>s.adminInfo.status=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(T,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.eW)("正常",-1)])),_:1,__:[36]}),(0,r.bF)(T,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)("停用",-1)])),_:1,__:[37]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户岗位",prop:"postId"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{placeholder:"请选择岗位",modelValue:s.adminInfo.postId,"onUpdate:modelValue":a[21]||(a[21]=e=>s.adminInfo.postId=e),class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.postList,e=>((0,r.uX)(),(0,r.Wv)(g,{key:e.id,label:e.postName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(D,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"用户角色",prop:"roleId"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{placeholder:"请选择角色",modelValue:s.adminInfo.roleId,"onUpdate:modelValue":a[22]||(a[22]=e=>s.adminInfo.roleId=e),class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.roleList,e=>((0,r.uX)(),(0,r.Wv)(g,{key:e.id,label:e.roleName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"个人简介",prop:"note"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.adminInfo.note,"onUpdate:modelValue":a[23]||(a[23]=e=>s.adminInfo.note=e),type:"textarea",placeholder:"请输入内容",class:"modern-textarea"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.Lk)("span",Wd,[(0,r.bF)(k,{type:"primary",onClick:o.editAdminInfo,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)("确 定",-1)])),_:1,__:[38]},8,["onClick"]),(0,r.bF)(k,{type:"info",onClick:a[24]||(a[24]=e=>s.editDialogVisible=!1),class:"modern-btn secondary-btn"},{default:(0,r.k6)(()=>a[39]||(a[39]=[(0,r.eW)("取 消",-1)])),_:1,__:[39]})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"])])}var Nd=t(4421),Kd=t.n(Nd),Ud=(t(5796),{components:{Treeselect:Kd()},data(){return{expandedKeys:[],statusList:[{value:"1",label:"启用"},{value:"2",label:"停用"}],Loading:!1,queryParams:{},adminList:[],total:0,addDialogVisible:!1,deptList:[],roleList:[],postList:[],addForm:{username:"",password:"",deptId:void 0,postId:void 0,roleId:void 0,email:"",nickname:"",status:1,phone:"",note:""},addFormRules:{deptId:[{required:!0,message:"请选择部门",trigger:"blur"}],postId:[{required:!0,message:"请选择岗位",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"blur"}],username:[{required:!0,message:"请输入用户账号",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入用户手机",trigger:"blur"}]},editDialogVisible:!1,adminInfo:{},editFormRules:{deptId:[{required:!0,message:"请选择部门",trigger:"blur"}],postId:[{required:!0,message:"请选择岗位",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"blur"}],username:[{required:!0,message:"请输入用户账号",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}],email:[{required:!0,message:"请输入用户邮箱",trigger:"blur"}],nickname:[{required:!0,message:"请输入用户昵称",trigger:"blur"}],phone:[{required:!0,message:"请输入用户手机",trigger:"blur"}]},defaultProps:{children:"children",label:"label"},currentDeptId:null}},created(){this.getDeptVoList(),this.getRoleVoList(),this.getPostVoList(),this.getAdminList()},methods:{tableRowClassName({row:e,rowIndex:a}){return"modern-table-row"},async getAdminList(){this.Loading=!0;const{data:e}=await this.$api.queryAdminList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.adminList=e.data.list,this.total=e.data.total,this.Loading=!1)},async loadAdminsByDept(e){console.log("开始加载部门 ID:",e),this.Loading=!0;const{data:a}=await this.$api.deptUsers(e);if(console.log("接口返回结果:",a),200!==a.code)this.$message.error(a.message);else{if(!a.data||0===a.data.length)return this.adminList=[],this.total=0,this.queryParams.pageNum=1,void(this.Loading=!1);const e=a.data.map(e=>({id:e.id,username:e.username,nickname:e.nickname,status:e.status,icon:e.icon,email:e.email,phone:e.phone,note:e.note,createTime:e.create_time||e.createTime,deptName:e.dept_name||e.deptName,postName:e.post_name||e.postName,roleName:e.role_name||e.roleName}));this.adminList=e,this.total=e.length,this.queryParams.pageNum=1}this.Loading=!1},handleQuery(){this.getAdminList()},resetQuery(){this.queryParams={},this.getAdminList(),this.$message.success("重置成功")},handleSizeChange(e){this.queryParams.pageSize=e,this.getAdminList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getAdminList()},async adminUpdateStatus(e){let a=2===e.status?"停用":"启用";const t=await this.$confirm('确认要"'+a+'""'+e.username+'"用户吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==t)return await this.getAdminList(),this.$message.info("已取消删除");const{data:l}=await this.$api.updateAdminStatus(e.id,e.status);if(200===l.code){this.$message.success(a+"成功");const t=this.adminList.findIndex(a=>a.id===e.id);t>-1&&this.$set(this.adminList,t,{...e})}else this.$message.error(l.message)},async getDeptVoList(){const{data:e}=await this.$api.querySysDeptVoList();if(200!==e.code)this.$message.error(e.message);else{const a=this.$handleTree.handleTree(e.data,"id");this.deptList=a}},async getRoleVoList(){const{data:e}=await this.$api.querySysRoleVoList();200!==e.code?this.$message.error(e.message):this.roleList=e.data},async getPostVoList(){const{data:e}=await this.$api.querySysPostVoList();200!==e.code?this.$message.error(e.message):this.postList=e.data},addDialogClosed(){this.$refs.addFormRefForm.resetFields()},addAdmin(){this.$refs.addFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.addAdmin(this.addForm);200!==a.code?this.$message.error(a.message):(this.$message.success("新增用户成功"),this.addDialogVisible=!1,await this.getAdminList())})},async showEditAdminDialog(e){const{data:a}=await this.$api.adminInfo(e);if(200!==a.code)this.$message.error(a.message);else{if(this.adminInfo=a.data,this.adminInfo.deptId)try{const{data:e}=await this.$api.deptInfo(this.adminInfo.deptId);200===e.code&&console.log("Department info loaded:",e.data)}catch(t){console.warn("Failed to load department info:",t)}this.editDialogVisible=!0}},editDialogClosed(){this.$refs.editFormRefForm.resetFields()},editAdminInfo(){this.$refs.editFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.adminUpdate(this.adminInfo);200!==a.code?this.$message.error(a.message):(this.editDialogVisible=!1,await this.getAdminList(),this.$message.success("修改用户成功"))})},async handleAdminDelete(e){const a=await this.$confirm('是否确认删除用户为"'+e.username+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteAdmin(e.id);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getAdminList())},handleResetPwd(e){this.$prompt('请输入"'+e.username+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间"}).then(({value:a})=>{this.$api.resetPassword(e.id,a).then(()=>{this.$message.success("修改成功，新密码是："+a)})}).catch(()=>{})},handleNodeExpand(e,a){this.expandedKeys.includes(a.key)||this.expandedKeys.push(a.key)},handleNodeCollapse(e,a){this.expandedKeys=this.expandedKeys.filter(e=>e!==a.key)},handleDeptClick(e,a){let t;a&&a.data&&a.data.id?t=a.data.id:a&&a.id?t=a.id:e&&e.key&&(t=e.key),console.log("最终获取到的 deptId:",t),t?(this.currentDeptId=t,this.loadAdminsByDept(t)):this.$message.warning("无法获取部门ID")}}});const Xd=(0,p.A)(Ud,[["render",zd],["__scopeId","data-v-1ef82189"]]);var qd=Xd;const Hd={class:"role-container"},Bd={class:"glass-card main-card"},jd={class:"search-section"},Od={class:"table-section"},Qd={class:"operation-buttons"},Gd={class:"dialog-footer"},Yd={class:"dialog-footer"},Jd={class:"dialog-footer"};function Zd(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select"),p=(0,r.g2)("Search"),m=(0,r.g2)("el-icon"),g=(0,r.g2)("el-button"),v=(0,r.g2)("Refresh"),h=(0,r.g2)("Plus"),k=(0,r.g2)("el-form"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-switch"),y=(0,r.g2)("Edit"),_=(0,r.g2)("el-tooltip"),w=(0,r.g2)("Delete"),L=(0,r.g2)("Setting"),F=(0,r.g2)("el-table"),C=(0,r.g2)("el-pagination"),V=(0,r.g2)("el-radio"),x=(0,r.g2)("el-radio-group"),S=(0,r.g2)("el-dialog"),I=(0,r.g2)("el-tree"),A=(0,r.gN)("authority"),R=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Hd,[(0,r.Lk)("div",Bd,[a[20]||(a[20]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("h2",{class:"gradient-title"},"角色管理")],-1)),(0,r.Lk)("div",jd,[(0,r.bF)(k,{inline:!0,model:s.queryParams,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"角色名称",prop:"roleName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色名称",size:"small",clearable:"",modelValue:s.queryParams.roleName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.roleName=e),onKeyup:(0,i.jR)(o.handleQuery,["enter"]),class:"search-input"},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{label:"账号状态",prop:"status",style:{width:"150px"}},{default:(0,r.k6)(()=>[(0,r.bF)(u,{size:"small",placeholder:"账号状态",modelValue:s.queryParams.status,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.status=e),class:"search-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.statusList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(g,{type:"primary",size:"small",onClick:o.handleQuery,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1}),a[17]||(a[17]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[17]},8,["onClick"]),(0,r.bF)(g,{size:"small",onClick:o.resetQuery,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[18]||(a[18]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[18]},8,["onClick"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"success",size:"small",onClick:a[2]||(a[2]=e=>s.addRoleDialogVisible=!0),class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),a[19]||(a[19]=(0,r.eW)(" 新增角色 ",-1))]),_:1,__:[19]})),[[A,["base:role:add"]]])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",Od,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(F,{data:s.roleList,class:"modern-table",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.Q3)("",!0),(0,r.bF)(b,{label:"角色名称",prop:"roleName"}),(0,r.bF)(b,{label:"角色标识",prop:"roleKey"}),(0,r.bF)(b,{label:"创建时间",prop:"createTime"}),(0,r.bF)(b,{label:"账号状态"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{modelValue:e.row.status,"onUpdate:modelValue":a=>e.row.status=a,"active-value":1,"inactive-value":2,"active-color":"#667eea","inactive-color":"#f56565","active-text":"启用","inactive-text":"停用",onChange:a=>o.roleUpdateStatus(e.row),class:"status-switch"},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,r.bF)(b,{label:"描述",prop:"description"}),(0,r.bF)(b,{label:"操作",width:"200"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Qd,[(0,r.bF)(_,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"warning",size:"small",circle:"",onClick:a=>o.showEditRoleDialog(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(y)]),_:1})]),_:2},1032,["onClick"])),[[A,["base:role:edit"]]])]),_:2},1024),(0,r.bF)(_,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"danger",size:"small",circle:"",onClick:a=>o.handleRoleDelete(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(w)]),_:1})]),_:2},1032,["onClick"])),[[A,["base:role:delete"]]])]),_:2},1024),(0,r.bF)(_,{content:"分配权限",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"primary",size:"small",circle:"",onClick:a=>o.showSetMenuDialog(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(L)]),_:1})]),_:2},1032,["onClick"])),[[A,["base:role:assign"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[R,s.Loading]]),(0,r.bF)(C,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500,1e3],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total,class:"modern-pagination"},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),(0,r.bF)(S,{modelValue:s.addRoleDialogVisible,"onUpdate:modelValue":a[8]||(a[8]=e=>s.addRoleDialogVisible=e),title:"新增角色",width:"35%",onClose:o.addRoleDialogClosed,"show-close":!0,class:"clean-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Gd,[(0,r.bF)(g,{type:"primary",onClick:o.addRole,class:"dialog-btn confirm-btn"},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)("确 定",-1)])),_:1,__:[23]},8,["onClick"]),(0,r.bF)(g,{onClick:a[7]||(a[7]=e=>s.addRoleDialogVisible=!1),class:"dialog-btn cancel-btn"},{default:(0,r.k6)(()=>a[24]||(a[24]=[(0,r.eW)("取 消",-1)])),_:1,__:[24]})])]),default:(0,r.k6)(()=>[(0,r.bF)(k,{ref:"addRoleFormRefForm","label-width":"80px",model:s.addRoleForm,rules:s.addRoleFormRules,class:"dialog-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"角色名称",prop:"roleName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色名称",modelValue:s.addRoleForm.roleName,"onUpdate:modelValue":a[3]||(a[3]=e=>s.addRoleForm.roleName=e),class:"form-input"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"角色标识",prop:"roleKey"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色标识",modelValue:s.addRoleForm.roleKey,"onUpdate:modelValue":a[4]||(a[4]=e=>s.addRoleForm.roleKey=e),class:"form-input"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"角色状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(x,{modelValue:s.addRoleForm.status,"onUpdate:modelValue":a[5]||(a[5]=e=>s.addRoleForm.status=e),class:"radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{label:1,class:"custom-radio"},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)("正常",-1)])),_:1,__:[21]}),(0,r.bF)(V,{label:2,class:"custom-radio"},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("停用",-1)])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"角色描述",prop:"description"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色描述",type:"textarea",modelValue:s.addRoleForm.description,"onUpdate:modelValue":a[6]||(a[6]=e=>s.addRoleForm.description=e),class:"form-textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(S,{modelValue:s.editRoleDialogVisible,"onUpdate:modelValue":a[14]||(a[14]=e=>s.editRoleDialogVisible=e),title:"修改角色",width:"35%",onClose:o.editRoleDialogClosed,"show-close":!0,class:"clean-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Yd,[(0,r.bF)(g,{type:"primary",onClick:o.editRole,class:"dialog-btn confirm-btn"},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.eW)("确 定",-1)])),_:1,__:[27]},8,["onClick"]),(0,r.bF)(g,{onClick:a[13]||(a[13]=e=>s.editRoleDialogVisible=!1),class:"dialog-btn cancel-btn"},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)("取 消",-1)])),_:1,__:[28]})])]),default:(0,r.k6)(()=>[(0,r.bF)(k,{ref:"editRoleFormRefForm","label-width":"80px",model:s.roleInfo,rules:s.editRoleFormRules,class:"dialog-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"角色名称",prop:"roleName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色名称",modelValue:s.roleInfo.roleName,"onUpdate:modelValue":a[9]||(a[9]=e=>s.roleInfo.roleName=e),class:"form-input"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"角色标识",prop:"roleKey"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色标识",modelValue:s.roleInfo.roleKey,"onUpdate:modelValue":a[10]||(a[10]=e=>s.roleInfo.roleKey=e),class:"form-input"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"角色状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(x,{modelValue:s.roleInfo.status,"onUpdate:modelValue":a[11]||(a[11]=e=>s.roleInfo.status=e),class:"radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{label:1,class:"custom-radio"},{default:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)("正常",-1)])),_:1,__:[25]}),(0,r.bF)(V,{label:2,class:"custom-radio"},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("停用",-1)])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"角色描述",prop:"description"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入角色描述",type:"textarea",modelValue:s.roleInfo.description,"onUpdate:modelValue":a[12]||(a[12]=e=>s.roleInfo.description=e),class:"form-textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(S,{modelValue:s.setMenuDialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>s.setMenuDialogVisible=e),title:"分配权限",width:"25%",onClose:o.setRightDialogClosed,"show-close":!0,class:"clean-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Jd,[(0,r.bF)(g,{type:"primary",onClick:o.allotMenus,class:"dialog-btn confirm-btn"},{default:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)("确 定",-1)])),_:1,__:[29]},8,["onClick"]),(0,r.bF)(g,{onClick:a[15]||(a[15]=e=>s.setMenuDialogVisible=!1),class:"dialog-btn cancel-btn"},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("取 消",-1)])),_:1,__:[30]})])]),default:(0,r.k6)(()=>[(0,r.bF)(I,{data:s.menuList,props:s.treeProps,"show-checkbox":"","node-key":"id","default-checked-keys":s.defKeys,ref:"treeRef",onCheck:o.handleTreeCheck,class:"permission-tree"},null,8,["data","props","default-checked-keys","onCheck"])]),_:1},8,["modelValue","onClose"])])}var ec={components:{Treeselect:Kd()},data(){return{statusList:[{value:"1",label:"启用"},{value:"2",label:"停用"}],queryParams:{},Loading:!1,roleList:[],total:0,addRoleDialogVisible:!1,addRoleForm:{roleName:"",roleKey:"",description:"",status:1},addRoleFormRules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleKey:[{required:!0,message:"请角色权限标识",trigger:"blur"}],status:[{required:!0,message:"请输入角色状态",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},editRoleDialogVisible:!1,roleInfo:{},editRoleFormRules:{roleName:[{required:!0,message:"请输入角色名称",trigger:"blur"}],roleKey:[{required:!0,message:"请输入角色权限标识",trigger:"blur"}],status:[{required:!0,message:"请输入角色状态",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"}]},setMenuDialogVisible:!1,menuList:[],treeProps:{label:"label"},defKeys:[],id:""}},methods:{filterMenuTree(e,a){return e.filter(e=>!!a.includes(e.id)||!!(e.children&&e.children.length>0)&&(e.children=this.filterMenuTree(e.children,a),e.children.length>0))},filterLeafPermissions(e,a){const t=[],l=e=>{e.forEach(e=>{e.children&&0!==e.children.length?l(e.children):t.push(e.id)})};return l(e),a.filter(e=>t.includes(e))},sortMenusByOrder(e,a){if(!e||!Array.isArray(e))return[];const t={};a&&Array.isArray(a)&&a.forEach(e=>{t[e.id]=e.sort||0});const l=[...e].sort((e,a)=>{const l=t[e.id]||999,s=t[a.id]||999;return l-s});return l.map(e=>e.children&&e.children.length>0?{...e,children:this.sortMenusByOrder(e.children,a)}:e)},async getRoleList(){this.Loading=!0;const{data:e}=await this.$api.queryRoleList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.roleList=e.data.list,this.total=e.data.total,this.Loading=!1)},handleQuery(){this.getRoleList()},resetQuery(){this.queryParams={},this.getRoleList(),this.$message.success("重置成功")},handleSizeChange(e){this.queryParams.pageSize=e,this.getRoleList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getRoleList()},async roleUpdateStatus(e){let a=2===e.status?"停用":"启用";const t=await this.$confirm('确认要"'+a+'""'+e.roleName+'"角色吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);return"confirm"!==t?(await this.getRoleList(),this.$message.info("已取消删除")):(await this.$api.updateRoleStatus(e.id,e.status),this.$message.success(a+"成功"))},addRoleDialogClosed(){this.$refs.addRoleFormRefForm.resetFields()},addRole(){this.$refs.addRoleFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.addRole(this.addRoleForm);200!==a.code?this.$message.error(a.message):(this.$message.success("新增角色成功"),this.addRoleDialogVisible=!1,await this.getRoleList())})},editRoleDialogClosed(){this.$refs.editRoleFormRefForm.resetFields()},async showEditRoleDialog(e){const{data:a}=await this.$api.roleInfo(e);200!==a.code?this.$message.error(a.message):(this.roleInfo=a.data,this.editRoleDialogVisible=!0)},editRole(){this.$refs.editRoleFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.roleUpdate(this.roleInfo);200!==a.code?this.$message.error(a.message):(this.editRoleDialogVisible=!1,await this.getRoleList(),this.$message.success("修改角色成功"))})},async handleRoleDelete(e){const a=await this.$confirm('是否确认删除角色为"'+e.roleName+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteRole(e.id);console.log(e.id),200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getRoleList())},async showSetMenuDialog(e){this.id=e.id,this.setMenuDialogVisible=!0;try{const[a,t,l]=await Promise.all([this.$api.querySysMenuVoList(),this.$api.QueryRoleMenuIdList(e.id),this.$api.queryMenuList({})]),s=a.data.data,o=t.data.data,n=l.data.data;console.log("权限菜单数据:",s),console.log("带sort菜单数据:",n),console.log("sort字段示例:",n.slice(0,5).map(e=>({id:e.id,menuName:e.menuName,sort:e.sort})));const i=this.sortMenusByOrder(s,n);console.log("排序后菜单数据:",i),this.menuList=this.$handleTree.handleTree(i,"id"),console.log("构建后的菜单树:",this.menuList),this.defKeys=this.filterLeafPermissions(this.menuList,o),console.log("角色原始权限:",o),console.log("过滤后的叶子权限:",this.defKeys)}catch(a){console.error("加载权限失败:",a)}},setRightDialogClosed(){this.defKeys=[]},handleTreeCheck(e,a){},async allotMenus(){const e=this.$refs.treeRef.getCheckedKeys(),a=this.$refs.treeRef.getHalfCheckedKeys(),t=[...e,...a];console.log("完全选中的权限:",e),console.log("半选中的父权限:",a),console.log("最终保存的权限ID:",t);const{data:l}=await this.$api.AssignPermissions(this.id,t);200!==l.code?this.$message.error(l.message):(this.$message.success("分配权限成功"),await this.getRoleList(),this.setMenuDialogVisible=!1)}},created(){this.getRoleList()}};const ac=(0,p.A)(ec,[["render",Zd],["__scopeId","data-v-5508581c"]]);var tc=ac;const lc={class:"dept-container"},sc={class:"glass-card"},oc={class:"search-section"},nc={class:"action-section"},ic={class:"action-buttons"},rc={class:"table-section"},dc={class:"operation-buttons"},cc={class:"dialog-content"},uc={class:"dialog-footer"},pc={class:"dialog-content"},mc={class:"dialog-footer"};function gc(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select"),p=(0,r.g2)("Search"),m=(0,r.g2)("el-icon"),g=(0,r.g2)("el-button"),v=(0,r.g2)("Refresh"),h=(0,r.g2)("el-form"),k=(0,r.g2)("Plus"),b=(0,r.g2)("Sort"),f=(0,r.g2)("el-table-column"),y=(0,r.g2)("el-tag"),_=(0,r.g2)("Edit"),w=(0,r.g2)("el-tooltip"),L=(0,r.g2)("Delete"),F=(0,r.g2)("el-table"),C=(0,r.g2)("el-radio"),V=(0,r.g2)("el-radio-group"),x=(0,r.g2)("treeselect"),S=(0,r.g2)("el-dialog"),I=(0,r.gN)("authority"),A=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",lc,[(0,r.Lk)("div",sc,[a[24]||(a[24]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("h2",{class:"gradient-title"},"部门管理")],-1)),(0,r.Lk)("div",oc,[(0,r.bF)(h,{inline:!0,model:s.queryParams,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"部门名称"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入部门名称",clearable:"",modelValue:s.queryParams.deptName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.deptName=e),onKeyup:(0,i.jR)(o.handleQuery,["enter"]),size:"small",class:"modern-input"},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{label:"部门状态"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{placeholder:"部门状态",modelValue:s.queryParams.deptStatus,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.deptStatus=e),style:{width:"150px"},size:"small",class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.deptStatusList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(g,{type:"primary",size:"small",onClick:o.handleQuery,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1}),a[15]||(a[15]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[15]},8,["onClick"]),(0,r.bF)(g,{size:"small",onClick:o.resetQuery,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[16]||(a[16]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[16]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",nc,[(0,r.Lk)("div",ic,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"success",size:"small",onClick:a[2]||(a[2]=e=>s.addDeptDialogVisible=!0),class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[17]||(a[17]=(0,r.eW)(" 新增部门 ",-1))]),_:1,__:[17]})),[[I,["base:dept:add"]]]),(0,r.bF)(g,{size:"small",onClick:o.toggleExpandAll,class:"modern-btn secondary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1}),a[18]||(a[18]=(0,r.eW)(" 展开/折叠 ",-1))]),_:1,__:[18]},8,["onClick"])])]),(0,r.Lk)("div",rc,[s.refreshTable?(0,r.bo)(((0,r.uX)(),(0,r.Wv)(F,{key:0,data:s.deptList,"row-key":"id","default-expand-all":s.isExpandAll,"tree-props":{children:"children"},class:"modern-table","header-cell-style":{background:"transparent",color:"#2c3e50",fontWeight:"bold"},"row-style":{background:"rgba(255, 255, 255, 0.05)"}},{default:(0,r.k6)(()=>[(0,r.bF)(f,{label:"部门名称",prop:"deptName"}),(0,r.bF)(f,{label:"部门类型",prop:"deptType"},{default:(0,r.k6)(e=>[1===e.row.deptType?((0,r.uX)(),(0,r.Wv)(y,{key:0,class:"modern-tag company-tag"},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)(" 公司 ",-1)])),_:1,__:[19]})):2===e.row.deptType?((0,r.uX)(),(0,r.Wv)(y,{key:1,class:"modern-tag center-tag"},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)(" 中心 ",-1)])),_:1,__:[20]})):3===e.row.deptType?((0,r.uX)(),(0,r.Wv)(y,{key:2,class:"modern-tag dept-tag"},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)(" 部门 ",-1)])),_:1,__:[21]})):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(f,{label:"部门状态",prop:"deptStatus"},{default:(0,r.k6)(e=>[1===e.row.deptStatus?((0,r.uX)(),(0,r.Wv)(y,{key:0,class:"modern-tag success-tag"},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)(" 正常 ",-1)])),_:1,__:[22]})):2===e.row.deptStatus?((0,r.uX)(),(0,r.Wv)(y,{key:1,class:"modern-tag danger-tag"},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)(" 停用 ",-1)])),_:1,__:[23]})):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(f,{label:"创建时间",prop:"createTime"}),(0,r.bF)(f,{label:"操作",width:"150",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",dc,[(0,r.bF)(w,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"warning",size:"small",circle:"",onClick:a=>o.showEditDeptDialog(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(_)]),_:1})]),_:2},1032,["onClick"])),[[I,["base:dept:edit"]]])]),_:2},1024),(0,r.bF)(w,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"danger",size:"small",circle:"",onClick:a=>o.handleDeptDelete(e.row),disabled:"1"==e.row.deptType},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(L)]),_:1})]),_:2},1032,["onClick","disabled"])),[[I,["base:dept:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data","default-expand-all"])),[[A,s.loading]]):(0,r.Q3)("",!0)])]),(0,r.bF)(S,{title:"新增部门",modelValue:s.addDeptDialogVisible,"onUpdate:modelValue":a[8]||(a[8]=e=>s.addDeptDialogVisible=e),width:"35%",onClose:o.addDeptDialogClosed,class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",uc,[(0,r.bF)(g,{type:"primary",onClick:o.addDept,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("确 定",-1)])),_:1,__:[30]},8,["onClick"]),(0,r.bF)(g,{onClick:a[7]||(a[7]=e=>s.addDeptDialogVisible=!1),class:"modern-btn secondary-btn"},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("取 消",-1)])),_:1,__:[31]})])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",cc,[(0,r.bF)(h,{model:s.addDeptForm,rules:s.addDeptFormRules,ref:"addDeptFormRefForm","label-width":"90px",class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"部门类型",prop:"deptType"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.addDeptForm.deptType,"onUpdate:modelValue":a[3]||(a[3]=e=>s.addDeptForm.deptType=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)("公司",-1)])),_:1,__:[25]}),(0,r.bF)(C,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("中心",-1)])),_:1,__:[26]}),(0,r.bF)(C,{label:3,class:"modern-radio"},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.eW)("部门",-1)])),_:1,__:[27]})]),_:1},8,["modelValue"])]),_:1}),1!=s.addDeptForm.deptType?((0,r.uX)(),(0,r.Wv)(d,{key:0,label:"上级部门",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(x,{options:s.optionsDeptList,placeholder:"请选择上级部门",modelValue:s.addDeptForm.parentId,"onUpdate:modelValue":a[4]||(a[4]=e=>s.addDeptForm.parentId=e),class:"modern-treeselect"},null,8,["options","modelValue"])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(d,{label:"部门名称",prop:"deptName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.addDeptForm.deptName,"onUpdate:modelValue":a[5]||(a[5]=e=>s.addDeptForm.deptName=e),class:"modern-input"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"部门状态",prop:"deptStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.addDeptForm.deptStatus,"onUpdate:modelValue":a[6]||(a[6]=e=>s.addDeptForm.deptStatus=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)("正常",-1)])),_:1,__:[28]}),(0,r.bF)(C,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)("停用",-1)])),_:1,__:[29]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(S,{title:"编辑部门",modelValue:s.editDeptDialogVisible,"onUpdate:modelValue":a[14]||(a[14]=e=>s.editDeptDialogVisible=e),width:"35%",class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",mc,[(0,r.bF)(g,{type:"primary",onClick:o.editDept,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)("确 定",-1)])),_:1,__:[37]},8,["onClick"]),(0,r.bF)(g,{onClick:a[13]||(a[13]=e=>s.editDeptDialogVisible=!1),class:"modern-btn secondary-btn"},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)("取 消",-1)])),_:1,__:[38]})])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",pc,[(0,r.bF)(h,{model:s.deptInfo,rules:s.editDeptFormRules,ref:"editDeptFormRefForm","label-width":"90px",class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"部门类型",prop:"deptType"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.deptInfo.deptType,"onUpdate:modelValue":a[9]||(a[9]=e=>s.deptInfo.deptType=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.eW)("公司",-1)])),_:1,__:[32]}),(0,r.bF)(C,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("中心",-1)])),_:1,__:[33]}),(0,r.bF)(C,{label:3,class:"modern-radio"},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("部门",-1)])),_:1,__:[34]})]),_:1},8,["modelValue"])]),_:1}),1!=s.deptInfo.deptType?((0,r.uX)(),(0,r.Wv)(d,{key:0,label:"上级部门",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(x,{options:s.optionsDeptList,placeholder:"请选择上级部门",modelValue:s.deptInfo.parentId,"onUpdate:modelValue":a[10]||(a[10]=e=>s.deptInfo.parentId=e),class:"modern-treeselect"},null,8,["options","modelValue"])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(d,{label:"部门名称",prop:"deptName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.deptInfo.deptName,"onUpdate:modelValue":a[11]||(a[11]=e=>s.deptInfo.deptName=e),class:"modern-input"},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"部门状态",prop:"deptStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.deptInfo.deptStatus,"onUpdate:modelValue":a[12]||(a[12]=e=>s.deptInfo.deptStatus=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)("正常",-1)])),_:1,__:[35]}),(0,r.bF)(C,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.eW)("停用",-1)])),_:1,__:[36]})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])}var vc=t(8548),hc={components:{Treeselect:Kd(),Search:vc.Search,Refresh:vc.Refresh,Plus:vc.Plus,Sort:vc.Sort,Edit:vc.Edit,Delete:vc.Delete},data(){return{deptStatusList:[{value:"2",label:"停用"},{value:"1",label:"正常"}],queryParams:{},loading:!0,deptList:[],refreshTable:!0,isExpandAll:!0,optionsDeptList:[],addDeptDialogVisible:!1,addDeptFormRules:{deptType:[{required:!0,message:"请选择部门类型",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}]},addDeptForm:{deptStatus:1},editDeptDialogVisible:!1,deptInfo:{},editDeptFormRules:{deptType:[{required:!0,message:"请选择部门类型",trigger:"blur"}],deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}]}}},methods:{async getList(){this.loading=!0;const{data:e}=await this.$api.queryDeptList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.deptList=this.$handleTree.handleTree(e.data,"id"),this.loading=!1)},handleQuery(){this.getList()},resetQuery(){this.queryParams={},this.getList(),this.$message.success("重置成功")},toggleExpandAll(){this.refreshTable=!1,this.isExpandAll=!this.isExpandAll,this.$nextTick(()=>{this.refreshTable=!0})},async getDeptVoList(){const{data:e}=await this.$api.querySysDeptVoList();200!==e.code?this.$message.error(e.message):this.optionsDeptList=this.$handleTree.handleTree(e.data,"id")},addDeptDialogClosed(){this.$refs.addDeptFormRefForm.resetFields()},addDept(){this.$refs.addDeptFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.addDept(this.addDeptForm);200!==a.code?this.$message.error(a.message):(this.$message.success("新增部门成功"),this.addDeptDialogVisible=!1,await this.getList(),await this.getDeptVoList())})},async showEditDeptDialog(e){const{data:a}=await this.$api.deptInfo(e);200!==a.code?this.$message.error(a.message):(this.deptInfo=a.data,this.editDeptDialogVisible=!0)},editDeptDialogClosed(){this.$refs.editDeptFormRefForm.resetFields()},editDept(){this.$refs.editDeptFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.deptUpdate(this.deptInfo);200!==a.code?this.$message.error(a.message):(this.editDeptDialogVisible=!1,await this.getList(),this.$message.success("修改部门成功"))})},async handleDeptDelete(e){const a=await this.$confirm('是否确认删除部门为"'+e.deptName+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteDept(e.id);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getList())}},created(){this.getList(),this.getDeptVoList()}};const kc=(0,p.A)(hc,[["render",gc],["__scopeId","data-v-31da0b27"]]);var bc=kc;const fc={class:"post-management"},yc={class:"glass-card main-card"},_c={class:"search-section"},wc={class:"action-section"},Lc={class:"action-buttons"},Fc={class:"table-section"},Cc={class:"operation-buttons"},Vc={class:"dialog-footer"},xc={class:"dialog-footer"};function Sc(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),i=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-option"),c=(0,r.g2)("el-select"),u=(0,r.g2)("Search"),p=(0,r.g2)("el-icon"),m=(0,r.g2)("el-button"),g=(0,r.g2)("Refresh"),v=(0,r.g2)("el-form"),h=(0,r.g2)("Plus"),k=(0,r.g2)("Delete"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-switch"),y=(0,r.g2)("Edit"),_=(0,r.g2)("el-tooltip"),w=(0,r.g2)("el-table"),L=(0,r.g2)("el-pagination"),F=(0,r.g2)("el-radio"),C=(0,r.g2)("el-radio-group"),V=(0,r.g2)("el-dialog"),x=(0,r.gN)("authority"),S=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",fc,[(0,r.Lk)("div",yc,[a[18]||(a[18]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("h1",{class:"gradient-title"},"岗位管理")],-1)),(0,r.Lk)("div",_c,[(0,r.bF)(v,{model:s.queryParams,inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"岗位名称",prop:"postName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位名称",clearable:"",size:"small",class:"modern-input",modelValue:s.queryParams.postName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.postName=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位状态",prop:"postStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.queryParams.postStatus,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.postStatus=e),placeholder:"岗位状态",size:"small",style:{width:"150px"},class:"modern-select"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.postStatusList,e=>((0,r.uX)(),(0,r.Wv)(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(i,null,{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"primary",size:"small",onClick:o.handleQuery,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)(u)]),_:1}),a[14]||(a[14]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[14]},8,["onClick"]),(0,r.bF)(m,{size:"small",onClick:o.resetQuery,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)(g)]),_:1}),a[15]||(a[15]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[15]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",wc,[(0,r.Lk)("div",Lc,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{type:"success",size:"small",onClick:o.handleAddButtonClick,class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),a[16]||(a[16]=(0,r.eW)(" 新增 ",-1))]),_:1,__:[16]},8,["onClick"])),[[x,["base:post:add"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{type:"danger",size:"small",disabled:s.multiple,onClick:o.batchHandleDelete,class:"modern-btn danger-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[17]||(a[17]=(0,r.eW)(" 删除 ",-1))]),_:1,__:[17]},8,["disabled","onClick"])),[[x,["base:post:delete"]]])])]),(0,r.Lk)("div",Fc,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(w,{class:"modern-table",data:s.postList,onSelectionChange:o.handleSelectionChange},{default:(0,r.k6)(()=>[(0,r.bF)(b,{type:"selection"}),(0,r.Q3)("",!0),(0,r.bF)(b,{label:"岗位名称",prop:"postName"}),(0,r.bF)(b,{label:"岗位编码",prop:"postCode"}),(0,r.bF)(b,{label:"岗位状态",prop:"postStatus"},{default:(0,r.k6)(e=>[(0,r.bF)(f,{modelValue:e.row.postStatus,"onUpdate:modelValue":a=>e.row.postStatus=a,"active-value":1,"inactive-value":2,"active-color":"#667eea","inactive-color":"#F5222D","active-text":"启用","inactive-text":"停用",class:"modern-switch",onChange:a=>o.postUpdateStatus(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,r.bF)(b,{label:"创建时间",prop:"createTime"}),(0,r.bF)(b,{label:"描述",prop:"remark"}),(0,r.bF)(b,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Cc,[(0,r.bF)(_,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{type:"warning",size:"small",circle:"",onClick:a=>o.handleUpdate(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)(y)]),_:1})]),_:2},1032,["onClick"])),[[x,["base:post:edit"]]])]),_:2},1024),(0,r.bF)(_,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{type:"danger",size:"small",circle:"",onClick:a=>o.handleDelete(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(p,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1})]),_:2},1032,["onClick"])),[[x,["base:post:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[S,s.loading]]),(0,r.bF)(L,{class:"modern-pagination",onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500,1e3],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),(0,r.bF)(V,{title:"新增岗位",modelValue:s.addPostDialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>s.addPostDialogVisible=e),width:"30%",class:"modern-dialog",onClose:o.addPostDialogClosed},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",Vc,[(0,r.bF)(m,{type:"primary",class:"modern-btn primary-btn",onClick:o.addPost},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)("确定",-1)])),_:1,__:[21]},8,["onClick"]),(0,r.bF)(m,{class:"modern-btn secondary-btn",onClick:a[6]||(a[6]=e=>s.addPostDialogVisible=!1)},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("取消",-1)])),_:1,__:[22]})])]),default:(0,r.k6)(()=>[(0,r.bF)(v,{"label-width":"80px",ref:"addPostFormRefForm",rules:s.addPostFormRules,model:s.addPostForm,class:"dialog-form"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"岗位名称",prop:"postName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位名称",class:"modern-input",modelValue:s.addPostForm.postName,"onUpdate:modelValue":a[2]||(a[2]=e=>s.addPostForm.postName=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位编码",prop:"postCode"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位编码",class:"modern-input",modelValue:s.addPostForm.postCode,"onUpdate:modelValue":a[3]||(a[3]=e=>s.addPostForm.postCode=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位状态",prop:"postStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:s.addPostForm.postStatus,"onUpdate:modelValue":a[4]||(a[4]=e=>s.addPostForm.postStatus=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("启用",-1)])),_:1,__:[19]}),(0,r.bF)(F,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)("停用",-1)])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位描述",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位描述",class:"modern-input",modelValue:s.addPostForm.remark,"onUpdate:modelValue":a[5]||(a[5]=e=>s.addPostForm.remark=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(V,{title:"编辑岗位",modelValue:s.editPostDialogVisible,"onUpdate:modelValue":a[13]||(a[13]=e=>s.editPostDialogVisible=e),width:"30%",class:"modern-dialog",onClose:o.editPostDialogClosed},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",xc,[(0,r.bF)(m,{type:"primary",class:"modern-btn primary-btn",onClick:o.editPost},{default:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)("确定",-1)])),_:1,__:[25]},8,["onClick"]),(0,r.bF)(m,{class:"modern-btn secondary-btn",onClick:a[12]||(a[12]=e=>s.editPostDialogVisible=!1)},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("取消",-1)])),_:1,__:[26]})])]),default:(0,r.k6)(()=>[(0,r.bF)(v,{"label-width":"80px",ref:"editPostFormRefForm",rules:s.editPostFormRules,model:s.editPostForm,class:"dialog-form"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"岗位名称",prop:"postName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位名称",class:"modern-input",modelValue:s.editPostForm.postName,"onUpdate:modelValue":a[8]||(a[8]=e=>s.editPostForm.postName=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位编码",prop:"postCode"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位编码",class:"modern-input",modelValue:s.editPostForm.postCode,"onUpdate:modelValue":a[9]||(a[9]=e=>s.editPostForm.postCode=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位状态",prop:"postStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:s.editPostForm.postStatus,"onUpdate:modelValue":a[10]||(a[10]=e=>s.editPostForm.postStatus=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)("启用",-1)])),_:1,__:[23]}),(0,r.bF)(F,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[24]||(a[24]=[(0,r.eW)("停用",-1)])),_:1,__:[24]})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(i,{label:"岗位描述",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入岗位描述",class:"modern-input",modelValue:s.editPostForm.remark,"onUpdate:modelValue":a[11]||(a[11]=e=>s.editPostForm.remark=e)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue","onClose"])])}var Ic={components:{Search:vc.Search,Refresh:vc.Refresh,Plus:vc.Plus,Edit:vc.Edit,Delete:vc.Delete},data(){return{queryParams:{},postStatusList:[{value:"1",label:"启用"},{value:"2",label:"停用"}],loading:!0,postList:[],total:0,addPostDialogVisible:!1,addPostFormRules:{postName:[{required:!0,message:"请输入岗位名称",trigger:"blur"}],postCode:[{required:!0,message:"请输入岗位标识",trigger:"blur"}],postStatus:[{required:!0,message:"请输入岗位状态",trigger:"blur"}]},addPostForm:{postName:"",postCode:"",postStatus:1,remark:""},editPostDialogVisible:!1,editPostForm:{},editPostFormRules:{postName:[{required:!0,message:"请输入岗位名称",trigger:"blur"}],postCode:[{required:!0,message:"请输入岗位标识",trigger:"blur"}],postStatus:[{required:!0,message:"请输入岗位状态",trigger:"blur"}]},ids:[],single:!0,multiple:!0}},methods:{handleAddButtonClick(){console.log("新增岗位按钮被点击"),this.addPostDialogVisible=!0},async getPostList(){this.loading=!0;const{data:e}=await this.$api.queryPostList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.postList=e.data.list,this.total=e.data.total,this.loading=!1)},handleQuery(){this.getPostList()},resetQuery(){this.queryParams={},this.getPostList(),this.$message.success("重置成功")},handleSizeChange(e){this.queryParams.pageSize=e,this.getPostList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getPostList()},async postUpdateStatus(e){let a=2===e.postStatus?"停用":"启用";const t=await this.$confirm('确认要"'+a+'""'+e.postName+'"岗位吗?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);return"confirm"!=t?(await this.getPostList(),this.$message.info("已取消修改")):(await this.$api.updatePostStatus(e.id,e.postStatus),this.$message.success(a+"成功"))},addPostDialogClosed(){this.$refs.addPostFormRefForm.resetFields()},addPost(){this.$refs.addPostFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.addPost(this.addPostForm);200!==a.code?this.$message.error(a.message):(this.$message.success("新增岗位成功"),this.addPostDialogVisible=!1,await this.getPostList())})},async handleUpdate(e){const{data:a}=await this.$api.postInfo(e);200!==a.code?this.$message.error(a.message):(this.editPostForm=a.data,this.editPostDialogVisible=!0)},editPostDialogClosed(){this.$refs.editPostFormRefForm.resetFields()},editPost(){this.$refs.editPostFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.updatePost(this.editPostForm);200!==a.code?this.$message.error(a.message):(this.$message.success("修改岗位成功"),this.editPostDialogVisible=!1,await this.getPostList())})},async handleDelete(e){const a=await this.$confirm('是否确认删除岗位编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteSysPost(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getPostList())},handleSelectionChange(e){this.ids=e.map(e=>e.id),this.single=1!=e.length,this.multiple=!e.length},async batchHandleDelete(){const e=this.ids,a=await this.$confirm('是否确认删除岗位编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.batchDeleteSysPost(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getPostList())}},created(){this.getPostList()}};const Ac=(0,p.A)(Ic,[["render",Sc],["__scopeId","data-v-c89c9792"]]);var Rc=Ac;const Dc={class:"modern-menu-container"},Pc={class:"glass-card main-card"},$c={class:"search-section"},Tc={class:"action-section"},Mc={class:"action-buttons"},Ec={class:"table-section"},Wc={class:"menu-name"},zc={class:"icon-wrapper"},Nc={class:"operation-buttons"},Kc={class:"dialog-content"},Uc={style:{display:"flex","align-items":"center"}},Xc={style:{"margin-left":"8px"}},qc={class:"dialog-footer"},Hc={class:"dialog-content"},Bc={style:{display:"flex","align-items":"center"}},jc={style:{"margin-left":"8px"}},Oc={class:"dialog-footer"};function Qc(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select"),p=(0,r.g2)("Search"),m=(0,r.g2)("el-icon"),g=(0,r.g2)("el-button"),v=(0,r.g2)("Refresh"),h=(0,r.g2)("el-form"),k=(0,r.g2)("Plus"),b=(0,r.g2)("Sort"),f=(0,r.g2)("el-table-column"),y=(0,r.g2)("el-tag"),_=(0,r.g2)("Edit"),w=(0,r.g2)("el-tooltip"),L=(0,r.g2)("DocumentCopy"),F=(0,r.g2)("Delete"),C=(0,r.g2)("el-table"),V=(0,r.g2)("el-radio"),S=(0,r.g2)("el-radio-group"),I=(0,r.g2)("el-col"),A=(0,r.g2)("treeselect"),R=(0,r.g2)("el-input-number"),D=(0,r.g2)("el-row"),P=(0,r.g2)("el-dialog"),$=(0,r.gN)("authority"),T=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Dc,[(0,r.Lk)("div",Pc,[a[32]||(a[32]=(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("h1",{class:"gradient-title"},"菜单管理")],-1)),(0,r.Lk)("div",$c,[(0,r.bF)(h,{inline:!0,model:s.queryParams,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"menuName",label:"菜单名称"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入菜单名称",clearable:"",size:"small",onKeyup:(0,i.jR)(o.handleQuery,["enter"]),modelValue:s.queryParams.menuName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.menuName=e),class:"modern-input"},null,8,["onKeyup","modelValue"])]),_:1}),(0,r.bF)(d,{prop:"menuStatus",label:"菜单状态"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{size:"small",placeholder:"菜单状态",modelValue:s.queryParams.menuStatus,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.menuStatus=e),class:"modern-select",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.menuStatusList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(g,{type:"primary",size:"small",onClick:o.handleQuery,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1}),a[23]||(a[23]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[23]},8,["onClick"]),(0,r.bF)(g,{size:"small",onClick:o.resetQuery,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[24]||(a[24]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[24]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",Tc,[(0,r.Lk)("div",Mc,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"success",size:"small",onClick:a[2]||(a[2]=e=>s.addMenuDialogVisible=!0),class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[25]||(a[25]=(0,r.eW)(" 新增菜单 ",-1))]),_:1,__:[25]})),[[$,["base:menu:add"]]]),(0,r.bF)(g,{size:"small",onClick:o.toggleExpandAll,class:"modern-btn secondary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1}),a[26]||(a[26]=(0,r.eW)(" 展开/折叠 ",-1))]),_:1,__:[26]},8,["onClick"])])]),(0,r.Lk)("div",Ec,[s.refreshTable?(0,r.bo)(((0,r.uX)(),(0,r.Wv)(C,{key:0,data:s.menuList,"row-key":"id","default-expand-all":s.isExpandAll,"tree-props":{children:"children"},class:"modern-table","header-cell-style":{background:"transparent",color:"#2c3e50",fontWeight:"600"},"row-style":{background:"rgba(255, 255, 255, 0.05)"},stripe:""},{default:(0,r.k6)(()=>[(0,r.bF)(f,{prop:"menuName",label:"菜单名称","min-width":"150"},{default:(0,r.k6)(e=>[(0,r.Lk)("span",Wc,(0,x.v_)(e.row.menuName),1)]),_:1}),(0,r.bF)(f,{prop:"icon",label:"图标",width:"80"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",zc,[(0,r.bF)(m,{class:"menu-icon"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.row.icon)))]),_:2},1024)])]),_:1}),(0,r.bF)(f,{prop:"sort",label:"排序",width:"80"}),(0,r.bF)(f,{prop:"value",label:"权限标识","min-width":"150"}),(0,r.bF)(f,{prop:"url",label:"组件路径","min-width":"200"}),(0,r.bF)(f,{prop:"menuType",label:"菜单类型",width:"100"},{default:(0,r.k6)(e=>[1===e.row.menuType?((0,r.uX)(),(0,r.Wv)(y,{key:0,class:"modern-tag modern-tag-directory"},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.eW)(" 目录 ",-1)])),_:1,__:[27]})):2===e.row.menuType?((0,r.uX)(),(0,r.Wv)(y,{key:1,class:"modern-tag modern-tag-menu"},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)(" 菜单 ",-1)])),_:1,__:[28]})):3===e.row.menuType?((0,r.uX)(),(0,r.Wv)(y,{key:2,class:"modern-tag modern-tag-button"},{default:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)(" 按钮 ",-1)])),_:1,__:[29]})):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(f,{prop:"menuStatus",label:"状态",width:"100"},{default:(0,r.k6)(e=>[2===e.row.menuStatus?((0,r.uX)(),(0,r.Wv)(y,{key:0,class:"modern-tag modern-tag-active"},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)(" 启用 ",-1)])),_:1,__:[30]})):1===e.row.menuStatus?((0,r.uX)(),(0,r.Wv)(y,{key:1,class:"modern-tag modern-tag-inactive"},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)(" 禁用 ",-1)])),_:1,__:[31]})):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(f,{label:"创建时间",prop:"createTime","min-width":"160"}),(0,r.bF)(f,{label:"操作",width:"190",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Nc,[(0,r.bF)(w,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"warning",size:"small",circle:"",onClick:a=>o.showEditMenuDialog(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(_)]),_:1})]),_:2},1032,["onClick"])),[[$,["base:menu:edit"]]])]),_:2},1024),(0,r.bF)(w,{content:"复制",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"primary",size:"small",circle:"",onClick:a=>o.handleCopyMenu(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(L)]),_:1})]),_:2},1032,["onClick"])),[[$,["base:menu:add"]]])]),_:2},1024),(0,r.bF)(w,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"danger",size:"small",circle:"",onClick:a=>o.handleMenuDelete(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(F)]),_:1})]),_:2},1032,["onClick"])),[[$,["base:admin:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data","default-expand-all"])),[[T,s.loading]]):(0,r.Q3)("",!0)])]),(0,r.bF)(P,{title:"新增菜单",modelValue:s.addMenuDialogVisible,"onUpdate:modelValue":a[12]||(a[12]=e=>s.addMenuDialogVisible=e),width:"600px",onClose:o.addMenuDialogClosed,class:"modern-dialog","modal-class":"modern-modal"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",qc,[(0,r.bF)(g,{onClick:a[11]||(a[11]=e=>s.addMenuDialogVisible=!1),class:"modern-btn modern-btn-cancel"},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)("取消",-1)])),_:1,__:[38]}),(0,r.bF)(g,{type:"primary",onClick:o.addMenu,class:"modern-btn modern-btn-primary"},{default:(0,r.k6)(()=>a[39]||(a[39]=[(0,r.eW)("确定",-1)])),_:1,__:[39]},8,["onClick"])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",Kc,[(0,r.bF)(h,{model:s.menuForm,rules:s.addMenuFormRules,ref:"addMenuFormRefForm","label-width":"100px",class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(I,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单类型",prop:"menuType"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{modelValue:s.menuForm.menuType,"onUpdate:modelValue":a[3]||(a[3]=e=>s.menuForm.menuType=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("目录",-1)])),_:1,__:[33]}),(0,r.bF)(V,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("菜单",-1)])),_:1,__:[34]}),(0,r.bF)(V,{label:3,class:"modern-radio"},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)("按钮",-1)])),_:1,__:[35]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),1!=s.menuForm.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:0,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"上级菜单",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(A,{options:s.treeList,placeholder:"请选择上级菜单",modelValue:s.menuForm.parentId,"onUpdate:modelValue":a[4]||(a[4]=e=>s.menuForm.parentId=e),class:"modern-treeselect"},null,8,["options","modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),3!=s.menuForm.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:1,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单图标",prop:"icon"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.menuForm.icon,"onUpdate:modelValue":a[5]||(a[5]=e=>s.menuForm.icon=e),class:"modern-select",placeholder:"请选择图标"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.iconList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("span",Uc,[(0,r.bF)(m,{style:{"font-size":"20px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.value)))]),_:2},1024),(0,r.Lk)("span",Xc,(0,x.v_)(e.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(I,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单名称",prop:"menuName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.menuForm.menuName,"onUpdate:modelValue":a[6]||(a[6]=e=>s.menuForm.menuName=e),placeholder:"请输入菜单名称",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(I,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"显示排序",prop:"sort"},{default:(0,r.k6)(()=>[(0,r.bF)(R,{modelValue:s.menuForm.sort,"onUpdate:modelValue":a[7]||(a[7]=e=>s.menuForm.sort=e),"controls-position":"right",min:0,class:"modern-input-number"},null,8,["modelValue"])]),_:1})]),_:1}),3!=s.menuForm.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:2,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单路径",prop:"url"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.menuForm.url,"onUpdate:modelValue":a[8]||(a[8]=e=>s.menuForm.url=e),placeholder:"请输入菜单路径",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),1!=s.menuForm.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:3,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"权限标识",prop:"value"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.menuForm.value,"onUpdate:modelValue":a[9]||(a[9]=e=>s.menuForm.value=e),placeholder:"请输入权限标识",maxlength:"50",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),3!=s.menuForm.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:4,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"显示状态",prop:"menuStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{modelValue:s.menuForm.menuStatus,"onUpdate:modelValue":a[10]||(a[10]=e=>s.menuForm.menuStatus=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.eW)("停用",-1)])),_:1,__:[36]}),(0,r.bF)(V,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)("启用",-1)])),_:1,__:[37]})]),_:1},8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(P,{title:"修改菜单",modelValue:s.editMenuDialogVisible,"onUpdate:modelValue":a[22]||(a[22]=e=>s.editMenuDialogVisible=e),width:"600px",onClose:o.editMenuDialogClosed,class:"modern-dialog","modal-class":"modern-modal"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",Oc,[(0,r.bF)(g,{onClick:a[21]||(a[21]=e=>s.editMenuDialogVisible=!1),class:"modern-btn modern-btn-cancel"},{default:(0,r.k6)(()=>a[45]||(a[45]=[(0,r.eW)("取消",-1)])),_:1,__:[45]}),(0,r.bF)(g,{type:"primary",onClick:o.editMenu,class:"modern-btn modern-btn-primary"},{default:(0,r.k6)(()=>a[46]||(a[46]=[(0,r.eW)("确定",-1)])),_:1,__:[46]},8,["onClick"])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",Hc,[(0,r.bF)(h,{model:s.menuInfo,rules:s.editMenuFormRules,ref:"editMenuFormRefForm","label-width":"100px",class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(I,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单类型",prop:"menuType"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{modelValue:s.menuInfo.menuType,"onUpdate:modelValue":a[13]||(a[13]=e=>s.menuInfo.menuType=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[40]||(a[40]=[(0,r.eW)("目录",-1)])),_:1,__:[40]}),(0,r.bF)(V,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[41]||(a[41]=[(0,r.eW)("菜单",-1)])),_:1,__:[41]}),(0,r.bF)(V,{label:3,class:"modern-radio"},{default:(0,r.k6)(()=>a[42]||(a[42]=[(0,r.eW)("按钮",-1)])),_:1,__:[42]})]),_:1},8,["modelValue"])]),_:1})]),_:1}),1!=s.menuInfo.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:0,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"上级菜单",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(A,{options:s.treeList,placeholder:"请选择上级菜单",modelValue:s.menuInfo.parentId,"onUpdate:modelValue":a[14]||(a[14]=e=>s.menuInfo.parentId=e),class:"modern-treeselect"},null,8,["options","modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),3!=s.menuInfo.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:1,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单图标",prop:"icon"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.menuInfo.icon,"onUpdate:modelValue":a[15]||(a[15]=e=>s.menuInfo.icon=e),class:"modern-select",placeholder:"请选择图标"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.iconList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("span",Bc,[(0,r.bF)(m,{style:{"font-size":"20px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.value)))]),_:2},1024),(0,r.Lk)("span",jc,(0,x.v_)(e.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(I,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单名称",prop:"menuName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.menuInfo.menuName,"onUpdate:modelValue":a[16]||(a[16]=e=>s.menuInfo.menuName=e),placeholder:"请输入菜单名称",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(I,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"显示排序",prop:"sort"},{default:(0,r.k6)(()=>[(0,r.bF)(R,{modelValue:s.menuInfo.sort,"onUpdate:modelValue":a[17]||(a[17]=e=>s.menuInfo.sort=e),"controls-position":"right",min:0,class:"modern-input-number"},null,8,["modelValue"])]),_:1})]),_:1}),3!=s.menuInfo.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:2,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"菜单路径",prop:"url"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.menuInfo.url,"onUpdate:modelValue":a[18]||(a[18]=e=>s.menuInfo.url=e),placeholder:"请输入菜单路径",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),1!=s.menuInfo.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:3,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"权限标识",prop:"value"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.menuInfo.value,"onUpdate:modelValue":a[19]||(a[19]=e=>s.menuInfo.value=e),placeholder:"请输入权限标识",maxlength:"50",class:"modern-input"},null,8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0),3!=s.menuInfo.menuType?((0,r.uX)(),(0,r.Wv)(I,{key:4,span:24},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"显示状态",prop:"menuStatus"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{modelValue:s.menuInfo.menuStatus,"onUpdate:modelValue":a[20]||(a[20]=e=>s.menuInfo.menuStatus=e),class:"modern-radio-group"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{label:1,class:"modern-radio"},{default:(0,r.k6)(()=>a[43]||(a[43]=[(0,r.eW)("停用",-1)])),_:1,__:[43]}),(0,r.bF)(V,{label:2,class:"modern-radio"},{default:(0,r.k6)(()=>a[44]||(a[44]=[(0,r.eW)("启用",-1)])),_:1,__:[44]})]),_:1},8,["modelValue"])]),_:1})]),_:1})):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue","onClose"])])}var Gc={components:{Treeselect:Kd()},data(){return{queryParams:{},menuStatusList:[{value:"2",label:"启用"},{value:"1",label:"停用"}],loading:!0,menuList:[],isExpandAll:!1,refreshTable:!0,iconList:[{value:"HomeFilled",label:"HomeFilled"},{value:"UploadFilled",label:"UploadFilled"},{value:"Menu",label:"Menu"},{value:"Search",label:"Search"},{value:"Edit",label:"Edit"},{value:"Delete",label:"Delete"},{value:"More",label:"More"},{value:"Star",label:"Star"},{value:"StarFilled",label:"StarFilled"},{value:"Platform",label:"Platform"},{value:"TrendCharts",label:"TrendCharts"},{value:"Document",label:"Document"},{value:"Eleme",label:"Eleme"},{value:"Delete",label:"Delete"},{value:"Tools",label:"Tools"},{value:"Setting",label:"Setting"},{value:"User",label:"User"},{value:"Phone",label:"Phone"},{value:"Goods",label:"Goods"},{value:"Help",label:"Help"},{value:"Picture",label:"Picture"},{value:"Upload",label:"Upload"},{value:"Download",label:"Download"},{value:"Promotion",label:"Promotion"},{value:"Shop",label:"Shop"},{value:"menu",label:"Menu"},{value:"share",label:"hare"},{value:"bottom",label:"Bottom"},{value:"top",label:"Top"},{value:"key",label:"Key"},{value:"unlock",label:"Unlock"},{value:"shopping-cart-full",label:"ShoppingCartFull"},{value:"Coin",label:"Coin"},{value:"present",label:"Present"},{value:"box",label:"Box"},{value:"wallet",label:"Wallet"},{value:"discount",label:"Discount"},{value:"price-tag",label:"PriceTag"},{value:"guide",label:"Guide"},{value:"connection",label:"Connection"},{value:"chat-dot-round",label:"ChatDotRound"}],addMenuDialogVisible:!1,menuForm:{menuStatus:2},addMenuFormRules:{menuType:[{required:!0,message:"菜单类型不能为空",trigger:"blur"}],menuName:[{required:!0,message:"菜单名称不能为空",trigger:"blur"}],sort:[{required:!0,message:"菜单顺序不能为空",trigger:"blur"}],value:[{required:!0,message:"权限标识不能为空",trigger:"blur"}]},treeList:[],editMenuDialogVisible:!1,menuInfo:[],editMenuFormRules:{menuType:[{required:!0,message:"菜单类型不能为空",trigger:"blur"}],menuName:[{required:!0,message:"菜单名称不能为空",trigger:"blur"}],sort:[{required:!0,message:"菜单顺序不能为空",trigger:"blur"}],value:[{required:!0,message:"权限标识不能为空",trigger:"blur"}]}}},methods:{async getMenuList(){this.loading=!0;const{data:e}=await this.$api.queryMenuList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.menuList=this.$handleTree.handleTree(e.data,"id"),this.loading=!1)},handleQuery(){this.getMenuList()},resetQuery(){this.queryParams={},this.getMenuList(),this.$message.success("重置成功")},toggleExpandAll(){this.refreshTable=!1,this.isExpandAll=!this.isExpandAll,this.$nextTick(()=>{this.refreshTable=!0})},addMenuDialogClosed(){this.$refs.addMenuFormRefForm.resetFields()},sortMenusBySort(e){if(!e||!Array.isArray(e))return[];const a=[...e].sort((e,a)=>{const t=e.sort||0,l=a.sort||0;return t-l});return a},async getMenuVoList(){try{const[e,a]=await Promise.all([this.$api.querySysMenuVoList(),this.$api.queryMenuList({})]);if(200!==e.data.code)return void this.$message.error(e.data.message);const t=e.data.data,l=a.data.data,s={};l&&Array.isArray(l)&&l.forEach(e=>{s[e.id]=e.sort||0});const o=t.map(e=>({...e,sort:s[e.id]||999})),n=this.sortMenusBySort(o);this.treeList=this.$handleTree.handleTree(n,"id"),console.log("上级菜单排序结果:",this.treeList)}catch(e){console.error("获取菜单列表失败:",e),this.$message.error("获取菜单列表失败")}},addMenu(){this.$refs.addMenuFormRefForm.validate(async e=>{if(!e)return;const a={...this.menuForm};delete a.children,delete a.createTime,delete a.updateTime,console.log("提交的菜单数据:",a);try{const{data:e}=await this.$api.addMenu(a);200===e.code?(this.$message.success("新增菜单成功"),this.addMenuDialogVisible=!1,await this.getMenuList(),await this.getMenuVoList()):this.$message.error(e.message||"新增菜单失败")}catch(t){console.error("新增菜单错误:",t),400===t.response?.status?(this.$message.warning("操作完成，正在刷新数据..."),this.addMenuDialogVisible=!1,await this.getMenuList(),await this.getMenuVoList()):this.$message.error("新增菜单失败: "+(t.message||"未知错误"))}})},editMenuDialogClosed(){this.$refs.editMenuFormRefForm.resetFields()},async showEditMenuDialog(e){const{data:a}=await this.$api.menuInfo(e);200!==a.code?this.$message.error(a.message):(this.menuInfo=a.data,this.editMenuDialogVisible=!0)},editMenu(){this.$refs.editMenuFormRefForm.validate(async e=>{if(!e)return;const{data:a}=await this.$api.menuUpdate(this.menuInfo);200!==a.code?this.$message.error(a.message):(this.editMenuDialogVisible=!1,await this.getMenuList(),this.$message.success("修改菜单成功"))})},handleCopyMenu(e){const a={parentId:e.parentId,menuName:`${e.menuName}_副本`,icon:e.icon||"",value:e.value?`${e.value}_copy`:"",menuType:e.menuType,url:e.url?`${e.url}_copy`:"",sort:e.sort,menuStatus:e.menuStatus||2};this.$nextTick(()=>{this.$refs.addMenuFormRefForm&&this.$refs.addMenuFormRefForm.resetFields()}),this.menuForm={...a},this.addMenuDialogVisible=!0,console.log("复制的菜单数据:",a)},async handleMenuDelete(e){const a=await this.$confirm('是否确认删除菜单为"'+e.menuName+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.menuDelete(e.id);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getMenuList())}},created(){this.getMenuList(),this.getMenuVoList()}};const Yc=(0,p.A)(Gc,[["render",Qc],["__scopeId","data-v-0ef5d9a2"]]);var Jc=Yc;const Zc={class:"loginlog-management"},eu={class:"search-section"},au={class:"action-section"},tu={class:"table-section"},lu={class:"operation-buttons"},su={class:"pagination-section"};function ou(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select"),p=(0,r.g2)("el-date-picker"),m=(0,r.g2)("el-button"),g=(0,r.g2)("el-form"),v=(0,r.g2)("el-table-column"),h=(0,r.g2)("el-tag"),k=(0,r.g2)("el-tooltip"),b=(0,r.g2)("el-table"),f=(0,r.g2)("el-pagination"),y=(0,r.g2)("el-card"),_=(0,r.gN)("authority"),w=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Zc,[(0,r.bF)(y,{shadow:"hover",class:"loginlog-card"},{header:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"登录日志管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",eu,[(0,r.bF)(g,{model:s.queryParams,inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"username",label:"用户名称"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.queryParams.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.username=e),placeholder:"请输入用户名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{prop:"loginStatus",label:"登录状态"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{size:"small",placeholder:"请选择状态",modelValue:s.queryParams.loginStatus,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.loginStatus=e),style:{width:"150px"},clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.loginStatusList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,{prop:"beginTime",label:"开始时间"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.queryParams.beginTime,"onUpdate:modelValue":a[2]||(a[2]=e=>s.queryParams.beginTime=e),size:"small",type:"date",style:{width:"190px"},"value-format":"yyyy-MM-dd",clearable:"",placeholder:"请选择开始时间",onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{prop:"endTime",label:"结束时间"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.queryParams.endTime,"onUpdate:modelValue":a[3]||(a[3]=e=>s.queryParams.endTime=e),size:"small",type:"date",style:{width:"190px"},"value-format":"yyyy-MM-dd",clearable:"",placeholder:"请选择结束时间",onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"primary",icon:"Search",size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)("搜索",-1)])),_:1,__:[5]},8,["onClick"]),(0,r.bF)(m,{icon:"Refresh",size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.eW)("重置",-1)])),_:1,__:[6]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",au,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{type:"danger",plain:"",icon:"Delete",size:"small",disabled:s.multiple,onClick:o.batchHandleDelete},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.eW)("批量删除 ",-1)])),_:1,__:[7]},8,["disabled","onClick"])),[[_,["monitor:loginLog:delete"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(m,{type:"danger",plain:"",icon:"Delete",size:"small",onClick:o.handleClean},{default:(0,r.k6)(()=>a[8]||(a[8]=[(0,r.eW)("清空日志",-1)])),_:1,__:[8]},8,["onClick"])),[[_,["monitor:loginLog:clean"]]])]),(0,r.Lk)("div",tu,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{data:s.sysLoginInfoList,stripe:"",style:{width:"100%"},class:"loginlog-table",onSelectionChange:o.handleSelectionChange},{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"selection"}),(0,r.Q3)("",!0),(0,r.bF)(v,{label:"用户账号",prop:"username","min-width":"120"}),(0,r.bF)(v,{label:"登录IP",prop:"ipAddress","min-width":"140"}),(0,r.bF)(v,{label:"登录地点",prop:"loginLocation","min-width":"150","show-overflow-tooltip":""}),(0,r.bF)(v,{label:"浏览器",prop:"browser","min-width":"120","show-overflow-tooltip":""}),(0,r.bF)(v,{label:"操作系统",prop:"os","min-width":"120","show-overflow-tooltip":""}),(0,r.bF)(v,{label:"登录状态",prop:"loginStatus","min-width":"100"},{default:(0,r.k6)(e=>[1===e.row.loginStatus?((0,r.uX)(),(0,r.Wv)(h,{key:0,type:"success",size:"small",effect:"dark"},{default:(0,r.k6)(()=>a[9]||(a[9]=[(0,r.eW)("成功",-1)])),_:1,__:[9]})):2===e.row.loginStatus?((0,r.uX)(),(0,r.Wv)(h,{key:1,type:"danger",size:"small",effect:"dark"},{default:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.eW)("失败",-1)])),_:1,__:[10]})):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(v,{label:"提示消息",prop:"message","min-width":"150","show-overflow-tooltip":""}),(0,r.bF)(v,{label:"访问时间",prop:"loginTime","min-width":"180"}),(0,r.bF)(v,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",lu,[(0,r.bF)(k,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"danger",icon:"Delete",size:"small",circle:"",onClick:a=>o.handleDelete(e.row.id)},null,8,["onClick"]),[[_,["monitor:loginLog:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[w,s.Loading]])]),(0,r.Lk)("div",su,[(0,r.bF)(f,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500,1e3],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),_:1})])}var nu={data(){return{queryParams:{},loginStatusList:[{value:"1",label:"成功"},{value:"2",label:"失败"}],sysLoginInfoList:[],Loading:!0,ids:[],single:!0,multiple:!0,total:0}},methods:{handleSelectionChange(e){this.ids=e.map(e=>e.id),this.single=1!=e.length,this.multiple=!e.length},async getSysLoginInfoList(){this.Loading=!0;const{data:e}=await this.$api.querySysLoginInfoList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.sysLoginInfoList=e.data.list,this.total=e.data.total,this.Loading=!1)},handleQuery(){this.getSysLoginInfoList()},resetQuery(){this.queryParams={},this.getSysLoginInfoList(),this.$message.success("重置成功")},handleSizeChange(e){this.queryParams.pageSize=e,this.getSysLoginInfoList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getSysLoginInfoList()},async handleClean(){const e=await this.$confirm("是否清空登录日志？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==e)return this.$message.info("已取消");const{data:a}=await this.$api.cleanSysLoginInfo();200!==a.code?this.$message.error(a.message):(this.$message.success("清空成功"),await this.getSysLoginInfoList())},async handleDelete(e){const a=await this.$confirm('是否确认删除登录日志编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteSysLoginInfo(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getSysLoginInfoList())},async batchHandleDelete(){const e=this.ids,a=await this.$confirm('是否确认删除登录日志编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.batchDeleteSysLoginInfo(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getSysLoginInfoList())}},created(){this.getSysLoginInfoList()}};const iu=(0,p.A)(nu,[["render",ou],["__scopeId","data-v-34d949c5"]]);var ru=iu;const du={class:"operator-management"},cu={class:"search-section"},uu={class:"action-section"},pu={class:"table-section"},mu={class:"operation-buttons"},gu={class:"pagination-section"};function vu(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-date-picker"),u=(0,r.g2)("el-button"),p=(0,r.g2)("el-form"),m=(0,r.g2)("el-table-column"),g=(0,r.g2)("el-tag"),v=(0,r.g2)("el-tooltip"),h=(0,r.g2)("el-table"),k=(0,r.g2)("el-pagination"),b=(0,r.g2)("el-card"),f=(0,r.gN)("authority"),y=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",du,[(0,r.bF)(b,{shadow:"hover",class:"operator-card"},{header:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"操作日志管理")],-1)])),default:(0,r.k6)(()=>[(0,r.bo)((0,r.Lk)("div",cu,[(0,r.bF)(p,{model:s.queryParams,inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"username",label:"用户名称"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.queryParams.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.username=e),placeholder:"请输入用户名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{prop:"beginTime",label:"开始时间"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.queryParams.beginTime,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.beginTime=e),size:"small",type:"date",style:{width:"190px"},"value-format":"yyyy-MM-dd",clearable:"",placeholder:"请选择开始时间",onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{prop:"endTime",label:"结束时间"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{modelValue:s.queryParams.endTime,"onUpdate:modelValue":a[2]||(a[2]=e=>s.queryParams.endTime=e),size:"small",type:"date",style:{width:"190px"},"value-format":"yyyy-MM-dd",clearable:"",placeholder:"请选择结束时间",onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"primary",icon:"Search",size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("搜索",-1)])),_:1,__:[4]},8,["onClick"]),(0,r.bF)(u,{icon:"Refresh",size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)("重置",-1)])),_:1,__:[5]},8,["onClick"])]),_:1})]),_:1},8,["model"])],512),[[i.aG,s.showSearch]]),(0,r.Lk)("div",uu,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{type:"danger",plain:"",icon:"Delete",size:"small",disabled:s.multiple,onClick:o.batchHandleDelete},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.eW)("批量删除 ",-1)])),_:1,__:[6]},8,["disabled","onClick"])),[[f,["monitor:operator:delete"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{type:"danger",plain:"",icon:"Delete",size:"small",onClick:o.handleClean},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.eW)("清空日志",-1)])),_:1,__:[7]},8,["onClick"])),[[f,["monitor:operator:clean"]]])]),(0,r.Lk)("div",pu,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(h,{data:s.sysOperationLogList,stripe:"",style:{width:"100%"},class:"operator-table",onSelectionChange:o.handleSelectionChange},{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"selection"}),(0,r.Q3)("",!0),(0,r.bF)(m,{label:"用户账号",prop:"username","min-width":"120"}),(0,r.bF)(m,{label:"请求方式","min-width":"120"},{default:(0,r.k6)(e=>[(0,r.bF)(g,{type:{GET:"info",POST:"success",PUT:"warning",DELETE:"danger"}[e.row.method.toUpperCase()]||"info",size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.method),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(m,{label:"登录IP",prop:"ip","min-width":"140"}),(0,r.bF)(m,{label:"请求的URL",prop:"url","min-width":"200","show-overflow-tooltip":""}),(0,r.bF)(m,{label:"操作描述",prop:"description","min-width":"150","show-overflow-tooltip":""}),(0,r.bF)(m,{label:"操作时间",prop:"createTime","min-width":"180"}),(0,r.bF)(m,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",mu,[(0,r.bF)(v,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(u,{type:"danger",icon:"Delete",size:"small",circle:"",onClick:a=>o.handleDelete(e.row.id)},null,8,["onClick"]),[[f,["monitor:operator:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[y,s.Loading]])]),(0,r.Lk)("div",gu,[(0,r.bF)(k,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500,1e3],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),_:1})])}var hu={data(){return{Loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,queryParams:{},sysOperationLogList:[]}},methods:{handleSelectionChange(e){this.ids=e.map(e=>e.id),this.single=1!=e.length,this.multiple=!e.length},async getSysOperationLogList(){this.Loading=!0;const{data:e}=await this.$api.querySysOperationLogList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.sysOperationLogList=e.data.list,this.total=e.data.total,this.Loading=!1)},handleQuery(){this.getSysOperationLogList()},resetQuery(){this.queryParams={},this.getSysOperationLogList(),this.$message.success("重置成功")},handleSizeChange(e){this.queryParams.pageSize=e,this.getSysOperationLogList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getSysOperationLogList()},async handleClean(){const e=await this.$confirm("是否清空操作日志？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==e)return this.$message.info("已取消");const{data:a}=await this.$api.cleanSysOperationLog();200!==a.code?this.$message.error(a.message):(this.$message.success("清空成功"),await this.getSysOperationLogList())},async handleDelete(e){const a=await this.$confirm('是否确认删除操作日志编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteSysOperationLog(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getSysOperationLogList())},async batchHandleDelete(){const e=this.ids,a=await this.$confirm('是否确认删除操作日志编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.batchDeleteSysOperationLog(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getSysOperationLogList())}},created(){this.getSysOperationLogList()}};const ku=(0,p.A)(hu,[["render",vu],["__scopeId","data-v-d4a9a274"]]);var bu=ku;const fu={class:"dblog-management"},yu={class:"search-section"},_u={class:"action-section"},wu={class:"table-section"},Lu={class:"operation-buttons"},Fu={class:"pagination-section"};function Cu(e,a,t,l,s,o){const n=(0,r.g2)("el-date-picker"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-button"),u=(0,r.g2)("el-form"),p=(0,r.g2)("el-table-column"),m=(0,r.g2)("el-tag"),g=(0,r.g2)("el-tooltip"),v=(0,r.g2)("el-table"),h=(0,r.g2)("el-pagination"),k=(0,r.g2)("el-card"),b=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",fu,[(0,r.bF)(k,{shadow:"hover",class:"dblog-card"},{header:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"数据库操作日志")],-1)])),default:(0,r.k6)(()=>[(0,r.bo)((0,r.Lk)("div",yu,[(0,r.bF)(u,{model:s.queryParams,inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{prop:"beginTime",label:"开始时间"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.queryParams.beginTime,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.beginTime=e),size:"small",type:"date",style:{width:"190px"},"value-format":"yyyy-MM-dd",clearable:"",placeholder:"请选择开始时间",onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{prop:"endTime",label:"结束时间"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.queryParams.endTime,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.endTime=e),size:"small",type:"date",style:{width:"190px"},"value-format":"yyyy-MM-dd",clearable:"",placeholder:"请选择结束时间",onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",icon:"Search",size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)("搜索",-1)])),_:1,__:[3]},8,["onClick"]),(0,r.bF)(c,{icon:"Refresh",size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("重置",-1)])),_:1,__:[4]},8,["onClick"])]),_:1})]),_:1},8,["model"])],512),[[i.aG,s.showSearch]]),(0,r.Lk)("div",_u,[(0,r.bF)(c,{type:"danger",plain:"",icon:"Delete",size:"small",disabled:s.multiple,onClick:o.batchHandleDelete},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)("批量删除 ",-1)])),_:1,__:[5]},8,["disabled","onClick"]),(0,r.bF)(c,{type:"danger",plain:"",icon:"Delete",size:"small",onClick:o.handleClean},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.eW)("清空日志",-1)])),_:1,__:[6]},8,["onClick"])]),(0,r.Lk)("div",wu,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{data:s.sqlLogList,stripe:"",style:{width:"100%"},class:"dblog-table",onSelectionChange:o.handleSelectionChange},{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"selection"}),(0,r.Q3)("",!0),(0,r.bF)(p,{label:"实例ID",prop:"instanceId","min-width":"120"}),(0,r.bF)(p,{label:"数据库",prop:"database","min-width":"120"}),(0,r.bF)(p,{label:"操作类型","min-width":"100"},{default:(0,r.k6)(e=>[(0,r.bF)(m,{type:{SELECT:"info",INSERT:"success",UPDATE:"warning",DELETE:"danger"}[e.row.operationType]||"info",size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.operationType),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(p,{label:"SQL内容",prop:"sqlContent","min-width":"200","show-overflow-tooltip":""}),(0,r.bF)(p,{label:"执行用户",prop:"execUser","min-width":"100"}),(0,r.bF)(p,{label:"用户IP",prop:"ip","min-width":"120"}),(0,r.bF)(p,{label:"扫描行数",prop:"scannedRows","min-width":"100",align:"right"}),(0,r.bF)(p,{label:"影响行数",prop:"affectedRows","min-width":"100",align:"right"}),(0,r.bF)(p,{label:"执行耗时(ms)",prop:"executionTime","min-width":"120",align:"right"}),(0,r.bF)(p,{label:"返回行数",prop:"returnedRows","min-width":"100",align:"right"}),(0,r.bF)(p,{label:"执行结果","min-width":"100"},{default:(0,r.k6)(e=>[(0,r.bF)(m,{type:"SUCCESS"===e.row.result?"success":"danger",size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)("SUCCESS"===e.row.result?"成功":"失败"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(p,{label:"查询时间",prop:"queryTime","min-width":"180"}),(0,r.bF)(p,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Lu,[(0,r.bF)(g,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"danger",icon:"Delete",size:"small",circle:"",onClick:a=>o.handleDelete(e.row.id)},null,8,["onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[b,s.Loading]])]),(0,r.Lk)("div",Fu,[(0,r.bF)(h,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500,1e3],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])]),_:1})])}var Vu={data(){return{Loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,queryParams:{pageNum:1,pageSize:10},sqlLogList:[]}},methods:{handleSelectionChange(e){this.ids=e.map(e=>e.id),this.single=1!=e.length,this.multiple=!e.length},async getSqlLogList(){this.Loading=!0;const{data:e}=await this.$api.GetCmdbSqlLogList(this.queryParams);200!==e.code?this.$message.error(e.message):(this.sqlLogList=e.data.records,this.total=e.data.total,this.Loading=!1)},handleQuery(){this.queryParams.pageNum=1,this.getSqlLogList()},resetQuery(){this.queryParams={pageNum:1,pageSize:10},this.getSqlLogList(),this.$message.success("重置成功")},handleSizeChange(e){this.queryParams.pageSize=e,this.getSqlLogList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getSqlLogList()},async handleClean(){const e=await this.$confirm("是否清空SQL操作日志？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==e)return this.$message.info("已取消");const{data:a}=await this.$api.CleanCmdbSqlLog();200!==a.code?this.$message.error(a.message):(this.$message.success("清空成功"),await this.getSqlLogList())},async handleDelete(e){const a=await this.$confirm('是否确认删除SQL操作日志编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.DeleteCmdbSqlLogById(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getSqlLogList())},async batchHandleDelete(){const e=this.ids,a=await this.$confirm('是否确认删除SQL操作日志编号为"'+e+'"的数据项？',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.DeleteCmdbSqlLogById(e);200!==t.code?this.$message.error(t.message):(this.$message.success("删除成功"),await this.getSqlLogList())}},created(){this.getSqlLogList()}};const xu=(0,p.A)(Vu,[["render",Cu],["__scopeId","data-v-281fc8db"]]);var Su=xu;const Iu=[{path:"/system/personal",component:Cd,meta:{sTitle:"个人中心",tTitle:"个人信息"}},{path:"/system/admin",component:qd,meta:{sTitle:"基础管理",tTitle:"用户信息"}},{path:"/system/role",component:tc,meta:{sTitle:"基础管理",tTitle:"角色信息"}},{path:"/system/menu",component:Jc,meta:{sTitle:"基础管理",tTitle:"菜单信息"}},{path:"/system/dept",component:bc,meta:{sTitle:"基础管理",tTitle:"部门信息"}},{path:"/system/post",component:Rc,meta:{sTitle:"基础管理",tTitle:"岗位信息"}},{path:"/monitor/loginlog",component:ru,meta:{sTitle:"日志管理",tTitle:"登录日志"}},{path:"/monitor/operator",component:bu,meta:{sTitle:"日志管理",tTitle:"操作日志"}},{path:"/monitor/dblog",component:Su,meta:{sTitle:"日志管理",tTitle:"数据日志"}}];var Au=Iu;const Ru={class:"cmdb-host-management"},Du={class:"host-management-container"},Pu={class:"host-table-section"},$u={class:"search-section"},Tu={class:"action-section"},Mu={class:"pagination-section"},Eu={key:0,class:"el-upload__tip"},Wu={style:{margin:"20px 0 10px 0",display:"flex","justify-content":"space-between","align-items":"center"}},zu={class:"command-output"},Nu={style:{"background-color":"#000",color:"#fff",padding:"10px","border-radius":"4px","font-family":"monospace","white-space":"pre-wrap","word-wrap":"break-word",margin:"0",width:"630px",height:"230px",overflow:"auto"}};function Ku(e,a,t,l,s,o){const n=(0,r.g2)("CmdbGroup"),d=(0,r.g2)("el-input"),c=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-option"),p=(0,r.g2)("el-select"),m=(0,r.g2)("Search"),g=(0,r.g2)("el-icon"),v=(0,r.g2)("el-button"),h=(0,r.g2)("Refresh"),k=(0,r.g2)("Plus"),b=(0,r.g2)("ArrowDown"),f=(0,r.g2)("Edit"),y=(0,r.g2)("el-dropdown-item"),_=(0,r.g2)("Folder"),w=(0,r.g2)("MostlyCloudy"),L=(0,r.g2)("el-dropdown-menu"),F=(0,r.g2)("el-dropdown"),C=(0,r.g2)("Monitor"),V=(0,r.g2)("el-col"),S=(0,r.g2)("el-row"),I=(0,r.g2)("el-form"),A=(0,r.g2)("CmdbHostTable"),R=(0,r.g2)("el-pagination"),D=(0,r.g2)("CreateHost"),P=(0,r.g2)("EditHost"),$=(0,r.g2)("CreateCloud"),T=(0,r.g2)("CreateExcel"),M=(0,r.g2)("HostSSH"),E=(0,r.g2)("el-upload"),W=(0,r.g2)("el-progress"),z=(0,r.g2)("el-dialog"),N=(0,r.g2)("el-descriptions-item"),K=(0,r.g2)("el-descriptions"),U=(0,r.g2)("el-drawer"),X=(0,r.g2)("el-tag"),q=(0,r.g2)("el-card"),H=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",Ru,[(0,r.bF)(q,{shadow:"hover",class:"host-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Du,[(0,r.bF)(n,{ref:"cmdbGroup","group-list":s.groupList,"expanded-keys":s.expandedKeys,onGroupSearch:o.handleGroupSearch,onGroupClick:o.handleGroupClick,onNodeExpand:o.handleNodeExpand,onNodeCollapse:o.handleNodeCollapse,onCollapseAll:o.handleCollapseAll,onExpandAll:o.handleExpandAll,onCreateGroup:o.handleCreateGroup,onUpdateGroup:o.handleUpdateGroup,onDeleteGroup:o.handleDeleteGroup},null,8,["group-list","expanded-keys","onGroupSearch","onGroupClick","onNodeExpand","onNodeCollapse","onCollapseAll","onExpandAll","onCreateGroup","onUpdateGroup","onDeleteGroup"]),(0,r.Lk)("div",Pu,[(0,r.Lk)("div",$u,[(0,r.bF)(I,{inline:!0,model:s.queryParams,class:"demo-form-inline"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"主机名称",prop:"hostName"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{size:"small",placeholder:"请输入主机名称",clearable:"",modelValue:s.queryParams.hostName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.hostName=e),onKeyup:(0,i.jR)(o.handleQuery,["enter"]),style:{width:"160px"}},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(c,{label:"IP地址",prop:"ip"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{size:"small",placeholder:"请输入IP地址",clearable:"",modelValue:s.queryParams.ip,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.ip=e),onKeyup:(0,i.jR)(o.handleQuery,["enter"]),style:{width:"120px"}},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(c,{label:"主机状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{size:"small",placeholder:"请选择状态",modelValue:s.queryParams.status,"onUpdate:modelValue":a[2]||(a[2]=e=>s.queryParams.status=e),style:{width:"120px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.statusList,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.Lk)("div",Tu,[(0,r.bF)(S,{gutter:10,class:"mb8",style:{"text-align":"left"}},{default:(0,r.k6)(()=>[(0,r.bF)(V,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"primary",size:"small",onClick:o.handleQuery,style:{"margin-right":"10px"}},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(m)]),_:1}),a[17]||(a[17]=(0,r.Lk)("span",{style:{"margin-left":"4px"}},"搜索",-1))]),_:1,__:[17]},8,["onClick"]),(0,r.bF)(v,{type:"warning",size:"small",onClick:o.resetQuery,style:{"margin-right":"10px"}},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),a[18]||(a[18]=(0,r.Lk)("span",{style:{"margin-left":"4px"}},"重置",-1))]),_:1,__:[18]},8,["onClick"]),(0,r.bF)(F,{ref:"createDropdown",onCommand:o.handleCreateCommand,onVisibleChange:o.handleDropdownVisibleChange,"hide-on-click":!0,trigger:"click",placement:"bottom-start"},{dropdown:(0,r.k6)(()=>[(0,r.bF)(L,null,{default:(0,r.k6)(()=>[(0,r.bF)(y,{command:"importHost"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{color:"#409EFC",size:20},{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1}),a[20]||(a[20]=(0,r.eW)("导入主机",-1))]),_:1,__:[20]}),(0,r.bF)(y,{command:"excelImport"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{color:"#409EFC",size:20},{default:(0,r.k6)(()=>[(0,r.bF)(_)]),_:1}),a[21]||(a[21]=(0,r.eW)("Excel导入",-1))]),_:1,__:[21]}),(0,r.bF)(y,{command:"cloudHost"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{color:"#409EFC",size:21},{default:(0,r.k6)(()=>[(0,r.bF)(w)]),_:1}),a[22]||(a[22]=(0,r.eW)("云主机",-1))]),_:1,__:[22]})]),_:1})]),default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"success",size:"small",style:{"margin-right":"10px"},onClick:(0,i.D$)(o.handleCreateClick,["stop"])},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[19]||(a[19]=(0,r.Lk)("span",{style:{"margin-left":"4px"}},"新建",-1)),(0,r.bF)(g,{class:"el-icon--right"},{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1})]),_:1,__:[19]},8,["onClick"])),[[H,["cmdb:ecs:add"]]])]),_:1},8,["onCommand","onVisibleChange"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{size:"small",onClick:o.handleHostSSH,class:"terminal-btn",style:{"margin-left":"10px"}},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(C)]),_:1}),a[23]||(a[23]=(0,r.Lk)("span",{style:{"margin-left":"4px"}},"终端",-1))]),_:1,__:[23]},8,["onClick"])),[[H,["cmdb:ecs:terminal"]]])]),_:1})]),_:1})])]),_:1},8,["model"])]),((0,r.uX)(),(0,r.Wv)(A,{ref:"hostTable",key:e.$route.fullPath,"host-list":s.hostList,loading:s.loading,onShowDetail:o.showHostDetail,onEditHost:o.showEditHostDialog,onShowUpload:o.showUploadDialog,onExecuteCommand:o.executeCommand,onDeleteHost:o.handleHostDelete},null,8,["host-list","loading","onShowDetail","onEditHost","onShowUpload","onExecuteCommand","onDeleteHost"])),(0,r.Lk)("div",Mu,[(0,r.bF)(R,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,50,100,500],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])])])]),(0,r.bF)(D,{visible:s.addDialogVisible,"group-list":s.groupList,"auth-list":s.authList,onClose:a[3]||(a[3]=e=>s.addDialogVisible=!1),onSubmit:o.addHost,onRefreshAuthList:o.getAuthList},null,8,["visible","group-list","auth-list","onSubmit","onRefreshAuthList"]),(0,r.bF)(P,{visible:s.editDialogVisible,"host-info":s.hostInfo,"group-list":s.groupList,"auth-list":s.authList,onClose:a[4]||(a[4]=e=>s.editDialogVisible=!1),onSubmit:o.editHost},null,8,["visible","host-info","group-list","auth-list","onSubmit"]),(0,r.bF)($,{modelValue:s.cloudDialogVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>s.cloudDialogVisible=e),onSuccess:o.handleCloudImportSuccess},null,8,["modelValue","onSuccess"]),(0,r.bF)(T,{modelValue:s.ExcelDialogVisible,"onUpdate:modelValue":a[6]||(a[6]=e=>s.ExcelDialogVisible=e),onSuccess:o.handleExcelImportSuccess},null,8,["modelValue","onSuccess"]),s.sshDialogVisible?((0,r.uX)(),(0,r.Wv)(M,{key:0,visible:s.sshDialogVisible,"host-id":s.currentHostId,"onUpdate:visible":a[7]||(a[7]=e=>{s.sshDialogVisible=e})},null,8,["visible","host-id"])):(0,r.Q3)("",!0),(0,r.bF)(z,{title:"文件上传",modelValue:s.uploadDialogVisible,"onUpdate:modelValue":a[11]||(a[11]=e=>s.uploadDialogVisible=e),width:"25%"},{footer:(0,r.k6)(()=>[(0,r.bF)(v,{onClick:a[10]||(a[10]=e=>s.uploadDialogVisible=!1)},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("取消",-1)])),_:1,__:[26]}),(0,r.bF)(v,{type:"primary",onClick:o.handleUpload,loading:s.isUploading,disabled:!s.uploadForm.file||!s.uploadForm.hostId},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.eW)(" 开始上传 ",-1)])),_:1,__:[27]},8,["onClick","loading","disabled"])]),default:(0,r.k6)(()=>[(0,r.bF)(I,{model:s.uploadForm,rules:s.uploadRules,ref:"uploadFormRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"目标主机"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.currentUploadHost.hostName,"onUpdate:modelValue":a[8]||(a[8]=e=>s.currentUploadHost.hostName=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"目标路径",prop:"targetPath"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.uploadForm.targetPath,"onUpdate:modelValue":a[9]||(a[9]=e=>s.uploadForm.targetPath=e),placeholder:"请输入目标路径"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"上传文件",prop:"file"},{default:(0,r.k6)(()=>[(0,r.bF)(E,{class:"upload-demo","auto-upload":!1,"on-change":o.handleFileChange,"on-remove":o.handleFileRemove,"show-file-list":!1},{tip:(0,r.k6)(()=>[s.uploadForm.file?((0,r.uX)(),(0,r.CE)("div",Eu,[(0,r.eW)(" 已选择: "+(0,x.v_)(s.uploadForm.file.name)+" ",1),(0,r.bF)(v,{type:"danger",text:"",icon:"Close",circle:"",size:"small",onClick:(0,i.D$)(o.handleFileRemove,["stop"]),style:{"margin-left":"8px"}},null,8,["onClick"])])):(0,r.Q3)("",!0),a[25]||(a[25]=(0,r.Lk)("div",{class:"el-upload__tip",style:{color:"#999","margin-top":"15px"}}," 提示：请上传小于5MB的文件 ",-1))]),default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"primary"},{default:(0,r.k6)(()=>a[24]||(a[24]=[(0,r.eW)("选择文件",-1)])),_:1,__:[24]})]),_:1},8,["on-change","on-remove"])]),_:1}),s.isUploading?((0,r.uX)(),(0,r.Wv)(W,{key:0,percentage:s.uploadProgress,status:100===s.uploadProgress?"success":""},null,8,["percentage","status"])):(0,r.Q3)("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),(0,r.bF)(U,{modelValue:s.detailDrawer,"onUpdate:modelValue":a[12]||(a[12]=e=>s.detailDrawer=e),title:"主机详情",direction:"rtl",size:"40%","before-close":o.handleDetailClose},{default:(0,r.k6)(()=>[a[29]||(a[29]=(0,r.Lk)("h3",{style:{margin:"20px 0 10px 0"}},"基本信息",-1)),(0,r.bF)(K,{column:1,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(N,{label:"主机名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.hostName),1)]),_:1}),(0,r.bF)(N,{label:"主机分组"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o.getGroupName(s.hostDetail.groupId)),1)]),_:1}),(0,r.bF)(N,{label:"连接地址"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.sshName)+"@"+(0,x.v_)(s.hostDetail.sshIp)+":"+(0,x.v_)(s.hostDetail.sshPort),1)]),_:1}),(0,r.bF)(N,{label:"认证类型"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.sshKeyId?"密钥":"密码"),1)]),_:1}),(0,r.bF)(N,{label:"描述信息"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.remark),1)]),_:1})]),_:1}),(0,r.Lk)("div",Wu,[a[28]||(a[28]=(0,r.Lk)("h3",{style:{margin:"0"}},"扩展信息",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"primary",size:"mini",icon:"Refresh",loading:s.syncLoading,onClick:o.handleHostSync},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.syncLoading?"同步中...":"同步"),1)]),_:1},8,["loading","onClick"])),[[H,["cmdb:ecs:rsync"]]])]),(0,r.bF)(K,{column:1,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(N,{label:"实例ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.instanceId),1)]),_:1}),(0,r.bF)(N,{label:"实例名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.name),1)]),_:1}),(0,r.bF)(N,{label:"操作系统"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.os),1)]),_:1}),(0,r.bF)(N,{label:"CPU"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.cpu)+"核",1)]),_:1}),(0,r.bF)(N,{label:"内存"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.memory)+"G",1)]),_:1}),(0,r.bF)(N,{label:"磁盘"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.disk)+"GB",1)]),_:1}),(0,r.bF)(N,{label:"内网IP"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.privateIp),1)]),_:1}),(0,r.bF)(N,{label:"公网IP"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.publicIp||"无"),1)]),_:1}),(0,r.bF)(N,{label:"实例计费方式"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.billingType),1)]),_:1}),(0,r.bF)(N,{label:"网络计费方式"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.networkBillingType||"按流量计费"),1)]),_:1}),(0,r.bF)(N,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.createTime),1)]),_:1}),(0,r.bF)(N,{label:"到期时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.expireTime||"无"),1)]),_:1}),(0,r.bF)(N,{label:"更新时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.hostDetail.updateTime),1)]),_:1})]),_:1})]),_:1,__:[29]},8,["modelValue","before-close"]),s.commandDialog?((0,r.uX)(),(0,r.Wv)(z,{key:1,title:"执行命令",modelValue:s.commandDialog.visible,"onUpdate:modelValue":a[16]||(a[16]=e=>s.commandDialog.visible=e),width:"40%","before-close":()=>s.commandDialog.visible=!1},{footer:(0,r.k6)(()=>[(0,r.bF)(v,{onClick:a[15]||(a[15]=e=>s.commandDialog.visible=!1)},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("关闭",-1)])),_:1,__:[31]})]),default:(0,r.k6)(()=>[(0,r.bF)(I,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"主机名称"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.commandDialog.hostName,"onUpdate:modelValue":a[13]||(a[13]=e=>s.commandDialog.hostName=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"执行命令"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{type:"textarea",rows:3,modelValue:s.commandDialog.command,"onUpdate:modelValue":a[14]||(a[14]=e=>s.commandDialog.command=e),placeholder:"请输入要执行的命令",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"primary",onClick:o.submitCommand,loading:s.commandDialog.loading},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)(" 执行 ",-1)])),_:1,__:[30]},8,["onClick","loading"]),s.commandDialog.status?((0,r.uX)(),(0,r.Wv)(X,{key:0,type:"执行成功"===s.commandDialog.status?"success":"danger",style:{"margin-left":"20px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.commandDialog.status),1)]),_:1},8,["type"])):(0,r.Q3)("",!0)]),_:1}),s.commandDialog.output?((0,r.uX)(),(0,r.Wv)(c,{key:0},{default:(0,r.k6)(()=>[(0,r.Lk)("div",zu,[(0,r.Lk)("pre",Nu,(0,x.v_)(s.commandDialog.output),1)])]),_:1})):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["modelValue","before-close"])):(0,r.Q3)("",!0)]),_:1})])}t(3579);var Uu={listAccountAuth(e){return oe({url:"config/accountauth/list",method:"get",params:e})},getAccountAuthByAlias(e){return oe({url:"config/accountauth/alias",method:"get",params:{alias:e}})},getAccountAuthByType(e){return oe({url:"config/accountauth/type",method:"get",params:{type:e}})},createAccountAuth(e){return oe({url:"config/accountauth",method:"post",data:e})},updateAccountAuth(e){return oe({url:"config/accountauth",method:"put",data:e})},deleteAccountAuth(e){return oe({url:"config/accountauth",method:"delete",params:{id:Number(e)}})},decryptPassword(e,a){return oe({url:"config/accountauth/decrypt",method:"post",...a,data:e})},getEcsAuthList(e){return oe({url:"config/ecsauthlist",method:"get",params:e})},getEcsAuthByName(e){return oe({url:"config/ecsauthinfo",method:"get",params:{name:e}})},createEcsAuth(e){return oe({url:"config/ecsauthadd",method:"post",data:e})},updateEcsAuth(e){return oe({url:"config/ecsauthupdate",method:"put",data:e})},deleteEcsAuth(e){return oe({url:"config/ecsauthdelete",method:"delete",data:{id:e}})},getKeyManageList(e){return oe({url:"config/keymanage/list",method:"get",params:e})},getKeyManageById(e){return oe({url:"config/keymanage",method:"get",params:{id:e}})},getKeyManageByType(e){return oe({url:"config/keymanage/type",method:"get",params:{keyType:e}})},createKeyManage(e){return oe({url:"config/keymanage",method:"post",data:e})},updateKeyManage(e){return oe({url:"config/keymanage",method:"put",data:e})},deleteKeyManage(e){return oe({url:"config/keymanage",method:"delete",params:{id:e}})},decryptKeys(e){return oe({url:"config/keymanage/decrypt",method:"post",data:e})},syncCloudHosts(e){return oe({url:"config/keymanage/sync",method:"post",data:e})},syncAliyunHosts(e){return oe({url:"config/keymanage/sync/aliyun",method:"post",data:e})},syncTencentHosts(e){return oe({url:"config/keymanage/sync/tencent",method:"post",data:e})},getSyncScheduleList(e){return oe({url:"config/sync-schedule/list",method:"get",params:e})},createSyncSchedule(e){return oe({url:"config/sync-schedule",method:"post",data:e})},updateSyncSchedule(e){return oe({url:"config/sync-schedule",method:"put",data:e})},deleteSyncSchedule(e){return oe({url:"config/sync-schedule",method:"delete",params:{id:e}})},toggleSyncScheduleStatus(e){return oe({url:"config/sync-schedule/toggle-status",method:"post",data:e})},getNextExecutionTime(e){return oe({url:"task/next-execution",method:"get",params:{cron:e}})},getSyncScheduleLog(e){return oe({url:"config/sync-schedule/log",method:"get",params:{id:e}})}},Xu=t(6241),qu=t(7757),Hu=t(1733);const Bu={class:"dialog-footer"};function ju(e,a,t,l,s,o){const n=(0,r.g2)("el-step"),d=(0,r.g2)("el-steps"),c=(0,r.g2)("el-radio"),u=(0,r.g2)("el-radio-group"),p=(0,r.g2)("el-form-item"),m=(0,r.g2)("el-input"),g=(0,r.g2)("el-link"),v=(0,r.g2)("el-form"),h=(0,r.g2)("el-button"),k=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(k,{"model-value":t.modelValue,width:"40%",title:"导入云主机","onUpdate:modelValue":a[5]||(a[5]=a=>e.$emit("update:modelValue",a)),onClose:o.dialogClose},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Bu,[(0,r.bF)(h,{onClick:o.dialogClose,class:"cancel-btn"},{default:(0,r.k6)(()=>a[11]||(a[11]=[(0,r.eW)("取消",-1)])),_:1,__:[11]},8,["onClick"]),s.active>1?((0,r.uX)(),(0,r.Wv)(h,{key:0,type:"primary",onClick:a[3]||(a[3]=e=>o.dialogToggle("pre"))},{default:(0,r.k6)(()=>a[12]||(a[12]=[(0,r.eW)("上一步",-1)])),_:1,__:[12]})):(0,r.Q3)("",!0),2==s.active?((0,r.uX)(),(0,r.Wv)(h,{key:1,type:"primary",onClick:o.submit},{default:(0,r.k6)(()=>a[13]||(a[13]=[(0,r.eW)("确认导入",-1)])),_:1,__:[13]},8,["onClick"])):(0,r.Q3)("",!0),s.active<2?((0,r.uX)(),(0,r.Wv)(h,{key:2,type:"primary",onClick:a[4]||(a[4]=e=>o.dialogToggle("next"))},{default:(0,r.k6)(()=>a[14]||(a[14]=[(0,r.eW)("下一步",-1)])),_:1,__:[14]})):(0,r.Q3)("",!0)])]),default:(0,r.k6)(()=>[(0,r.bF)(d,{active:s.active,"align-center":"",style:{"margin-bottom":"10%"}},{default:(0,r.k6)(()=>[(0,r.bF)(n,{title:"选择云服务商"}),(0,r.bF)(n,{title:"输入凭据并确认"})]),_:1},8,["active"]),(0,r.bF)(v,{model:s.form,ref:"formRef",rules:s.formRules,"label-position":"right","label-width":"155px"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.Lk)("div",null,[(0,r.bF)(p,{prop:"cloud","label-width":"0px",style:{"margin-left":"25%"}},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.form.cloud,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.cloud=e)},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"aliyun"},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.Lk)("img",{src:Xu,style:{width:"60px",height:"60px","vertical-align":"middle"}},null,-1)])),_:1,__:[6]}),(0,r.bF)(c,{label:"tencent"},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.Lk)("img",{src:qu,style:{width:"60px",height:"60px","vertical-align":"middle"}},null,-1)])),_:1,__:[7]}),(0,r.bF)(c,{label:"baidu"},{default:(0,r.k6)(()=>a[8]||(a[8]=[(0,r.Lk)("img",{src:Hu,style:{width:"50px",height:"50px","vertical-align":"middle"}},null,-1)])),_:1,__:[8]})]),_:1},8,["modelValue"])]),_:1})],512),[[i.aG,1==s.active]]),(0,r.bo)((0,r.Lk)("div",null,[(0,r.bF)(p,{label:"AccessKey ID：",prop:"secret_id"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.form.secret_id,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.secret_id=e),clearable:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(p,{label:"AccessKey Secret：",prop:"secret_key"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{modelValue:s.form.secret_key,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.secret_key=e),clearable:""},null,8,["modelValue"]),"aliyun"==s.form.cloud?((0,r.uX)(),(0,r.Wv)(g,{key:0,href:"https://ram.console.aliyun.com/manage/ak",target:"_blank",type:"primary"},{default:(0,r.k6)(()=>a[9]||(a[9]=[(0,r.eW)("如何获取AccessKey？",-1)])),_:1,__:[9]})):(0,r.Q3)("",!0),"tencent"==s.form.cloud?((0,r.uX)(),(0,r.Wv)(g,{key:1,href:"https://console.cloud.tencent.com/cam/capi",target:"_blank",type:"primary"},{default:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.eW)("如何获取AccessKey？",-1)])),_:1,__:[10]})):(0,r.Q3)("",!0)]),_:1})],512),[[i.aG,2==s.active]])]),_:1},8,["model","rules"])]),_:1},8,["model-value","onClose"])}var Ou={name:"CreateCloud",props:{modelValue:Boolean},emits:["update:modelValue","success"],data(){const e=JSON.parse(localStorage.getItem("cloudHostForm")||"{}");return{active:1,form:{cloud:e.cloud||"",secret_id:e.secret_id||"",secret_key:e.secret_key||""},formRules:{cloud:[{required:!0,message:"请选择",trigger:"blur"}],secret_id:[{required:!0,message:"请输入密钥ID",trigger:"blur"},{min:20,message:"密钥ID长度应不小于20个字符",trigger:"blur"}],secret_key:[{required:!0,message:"请输入密钥Key",trigger:"blur"},{min:20,message:"密钥Key长度应不小于20个字符",trigger:"blur"}]},tencentParamMap:{secret_id:"accessKey",secret_key:"secretKey"}}},methods:{dialogClose(){console.log("[CreateCloud] 对话框关闭事件触发"),localStorage.setItem("cloudHostForm",JSON.stringify(this.form)),this.$emit("update:modelValue",!1),this.resetForm()},resetForm(){console.log("[CreateCloud] 重置表单状态"),this.form={cloud:"",secret_id:"",secret_key:""},this.active=1},dialogToggle(e){if(console.log(`[CreateCloud] 对话框切换: ${e}`),"pre"===e)this.active--<2&&(this.active=1);else if("next"===e){if(1===this.active&&!this.form.cloud)return void this.$message.warning("请先选择云服务商");this.active++>2&&(this.active=1)}},async submit(){try{if(console.log("[CreateCloud] 开始验证表单..."),!this.form.secret_id||!this.form.secret_id.trim())return void this.$message.warning("请输入正确的AccessKey ID");if(!this.form.secret_key||!this.form.secret_key.trim())return void this.$message.warning("请输入正确的AccessKey Secret");if(this.form.secret_id.trim().length<16)return void this.$message.warning("请输入正确的AccessKey ID（长度不能少于16个字符）");if(this.form.secret_key.trim().length<20)return void this.$message.warning("请输入正确的AccessKey Secret（长度不能少于20个字符）");let e;if(await this.$refs.formRef.validate(),console.log("[CreateCloud] 表单验证通过，开始导入云主机..."),"aliyun"===this.form.cloud)console.log("[CreateCloud] 导入阿里云主机..."),e=await this.$api.hostcloudcreatealiyun(this.form);else if("tencent"===this.form.cloud){console.log("[CreateCloud] 导入腾讯云主机...");const a={accessKey:this.form.secret_id,secretKey:this.form.secret_key};e=await this.$api.hostcloudcreatetencent(a)}this.$message.success("导入成功"),console.log("[CreateCloud] 导入成功，重置表单状态..."),this.resetForm(),console.log("[CreateCloud] 触发success事件..."),this.$emit("success",{success:!0,cloud:this.form.cloud,shouldClose:!0}),this.$emit("update:modelValue",!1)}catch(e){console.error("[CreateCloud] 导入失败:",e),e.response&&200===e.response.status||this.$message.error("导入失败: "+(e.message||"未知错误")),this.$emit("success",{success:!1,error:e.message})}}}};const Qu=(0,p.A)(Ou,[["render",ju],["__scopeId","data-v-40af1afa"]]);var Gu=Qu;const Yu={class:"ssh-container",ref:"sshContainer"},Ju={class:"ssh-layout"},Zu={class:"tree-section"},ep={class:"terminal-section"};function ap(e,a,t,l,s,o){const n=(0,r.g2)("Search"),i=(0,r.g2)("el-icon"),d=(0,r.g2)("el-input"),c=(0,r.g2)("Platform"),u=(0,r.g2)("FolderRemove"),p=(0,r.g2)("FolderOpened"),m=(0,r.g2)("Folder"),g=(0,r.g2)("el-tree"),v=(0,r.g2)("el-card"),h=(0,r.g2)("terminal");return(0,r.uX)(),(0,r.CE)("div",Yu,[(0,r.Lk)("div",Ju,[(0,r.Lk)("div",Zu,[(0,r.bF)(v,{shadow:"never",class:"group-card"},{default:(0,r.k6)(()=>[a[1]||(a[1]=(0,r.Lk)("div",{slot:"header",class:"card-header"},[(0,r.Lk)("h3",null,"资产分组")],-1)),(0,r.bF)(d,{modelValue:s.groupSearchText,"onUpdate:modelValue":a[0]||(a[0]=e=>s.groupSearchText=e),placeholder:"搜索分组",clearable:"",size:"medium",class:"search-input",onInput:o.handleGroupSearch},{prefix:(0,r.k6)(()=>[(0,r.bF)(i,null,{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1})]),_:1},8,["modelValue","onInput"]),(0,r.bF)(g,{ref:"groupTree",data:s.groupList,props:s.defaultProps,"node-key":"id","expanded-keys":s.expandedKeys,"highlight-current":!0,onNodeClick:o.handleGroupClick,onNodeDblclick:o.handleGroupDblClick,onNodeExpand:o.handleNodeExpand,onNodeCollapse:o.handleNodeCollapse,class:"group-tree",onDblclick:o.handleNativeDblClick},{default:(0,r.k6)(({node:e,data:a})=>[(0,r.Lk)("span",{class:(0,x.C4)({"font-weight-bold":!a.parentId,"host-node":a.isHost})},[a.isHost?((0,r.uX)(),(0,r.Wv)(i,{key:0,class:"tree-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:1})):a.parentId?((0,r.uX)(),(0,r.Wv)(i,{key:1,class:"tree-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(u)]),_:1})):((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[s.expandedKeys.includes(e.key)?((0,r.uX)(),(0,r.Wv)(i,{key:0,class:"tree-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1})):((0,r.uX)(),(0,r.Wv)(i,{key:1,class:"tree-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(m)]),_:1}))],64)),(0,r.eW)(" "+(0,x.v_)(e.label),1)],2)]),_:1},8,["data","props","expanded-keys","onNodeClick","onNodeDblclick","onNodeExpand","onNodeCollapse","onDblclick"])]),_:1,__:[1]})]),(0,r.Lk)("div",ep,[(0,r.bF)(v,{shadow:"never",class:"terminal-card"},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.Lk)("div",{slot:"header",class:"card-header"},[(0,r.Lk)("h3",null,"模拟终端")],-1),(0,r.Lk)("div",{class:"terminal-content"},[(0,r.Lk)("div",{class:"terminal-welcome"},[(0,r.Lk)("h2",null,"欢迎访问 devops 业务终端系统")]),(0,r.Lk)("div",{class:"terminal-prompt"},[(0,r.Lk)("p",null,"user@devops:~$ _")])],-1)])),_:1,__:[2]})])]),(0,r.bF)(h,{ref:"terminal","current-host":s.currentHost},null,8,["current-host"])],512)}const tp={key:0,class:"custom-dialog-wrapper"},lp={class:"custom-dialog-header"},sp={class:"custom-dialog-title"},op={class:"custom-dialog-body"},np={class:"terminal-header"};function ip(e,a,t,l,s,o){const n=(0,r.g2)("el-button"),d=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",null,[s.visible?((0,r.uX)(),(0,r.CE)("div",tp,[(0,r.Lk)("div",{class:"custom-dialog-overlay",onClick:a[0]||(a[0]=(...e)=>o.handleOverlayClick&&o.handleOverlayClick(...e))}),(0,r.Lk)("div",{class:"custom-dialog",ref:"customDialog",onClick:a[2]||(a[2]=(0,i.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",lp,[(0,r.Lk)("span",sp,(0,x.v_)(s.drawerTitle),1),(0,r.Lk)("button",{class:"custom-dialog-close",onClick:a[1]||(a[1]=(...e)=>o.onClose&&o.onClose(...e))},"×")]),(0,r.Lk)("div",op,[(0,r.Lk)("div",np,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(n,{size:"mini",onClick:o.connect,disabled:s.isConnecting||!t.currentHost},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.isConnected?"重新连接":"连接"),1)]),_:1},8,["onClick","disabled"])),[[d,["cmdb:ecs:connecthost"]]]),(0,r.bF)(n,{size:"mini",onClick:o.disconnect,disabled:!s.isConnected||s.isConnecting},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)(" 断开 ",-1)])),_:1,__:[3]},8,["onClick","disabled"]),(0,r.bF)(n,{size:"mini",onClick:o.clear,disabled:!s.term},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)(" 清屏 ",-1)])),_:1,__:[4]},8,["onClick","disabled"]),(0,r.bF)(n,{size:"mini",class:"close-button",onClick:o.onClose},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)(" 关闭 ",-1)])),_:1,__:[5]},8,["onClick"])]),a[6]||(a[6]=(0,r.Lk)("div",{id:"xterm",class:"xterm",style:{height:"calc(100% - 50px)"}},null,-1))])],512)])):(0,r.Q3)("",!0)])}var rp=t(7856),dp=t(3616),cp={mounted(){window.addEventListener("resize",this.handleResize)},beforeUnmount(){window.removeEventListener("resize",this.handleResize),this.socket&&(this.socket.close(),this.socket=null),this.isConnected=!1,this.isConnecting=!1,this._inputHandlerBound=!1,this._termInitialized=!1},name:"Terminal",props:{currentHost:{type:Object,default:null}},data(){return{visible:!1,term:null,fitAddon:null,socket:null,isConnecting:!1,isConnected:!1,drawerTitle:"SSH终端",_inputHandlerBound:!1,_termInitialized:!1}},methods:{async initTerm(){try{if(this._termInitialized)return;if(this.term)try{this.fitAddon&&!1===this.fitAddon._disposed&&this.fitAddon.dispose(),this.term.dispose()}catch(e){console.warn("Terminal dispose error:",e)}this._termInitialized=!0,this.term=new rp.Terminal({fontSize:12,cursorBlink:!0,theme:{background:"#060101",foreground:"white",cursor:"help",selection:"#ffffff80"},fontFamily:"Menlo, Monaco, monospace",cols:250,rows:30,convertEol:!1,allowTransparency:!1,windowsMode:!1,lineHeight:1,letterSpacing:0,scrollback:1e3,tabStopWidth:8,bellStyle:"none",rendererType:"canvas",disableStdin:!1,rightClickSelectsWord:!0,drawBoldTextInBrightColors:!0,experimentalCharAtlas:"dynamic",allowProposedApi:!0,screenReaderMode:!1,wordSeparator:" ()[]{}'\"`",cursorStyle:"underline",cursorBlink:!0,scrollSensitivity:1,fastScrollModifier:"alt",macOptionClickForcesSelection:!0,overrideGlobalSettings:!0,allowProposedApi:!0,experimentalCharAtlas:"none"}),this.fitAddon=new dp.FitAddon;const a=document.getElementById("xterm");if(a.style.width="100%",a.style.overflow="hidden",this.term.loadAddon(this.fitAddon),this.term.open(a),!this._inputHandlerBound){this._inputHandlerBound=!0;let e=0;this.term.onData(a=>{const t=Date.now();console.group("Terminal Input");a.includes("\n")||a.includes("\r");console.groupEnd(),t-e<50||(e=t,this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(a))})}setTimeout(()=>{this.fitAddon.fit(),this.term.focus()},100),this.term.clear(),this.term.writeln("[1;32m欢迎使用SSH终端[0m"),this.term.writeln('[1;34m请点击"连接"按钮开始SSH连接[0m'),this.term.writeln("[1;33m终端宽度: "+this.term.cols+" 列[0m")}catch(a){throw console.error("Terminal initialization failed:",a),a}},show(){this.visible=!0,this.$nextTick(()=>{this.applyCustomDialogStyles(),!this.term||this.term._core._isDisposed?this.initTerm():(this.term.clear(),this.term.writeln("[1;32m终端已重新打开[0m"),this.term.writeln('[1;34m可以点击"连接"按钮开始SSH连接[0m'))})},handleOverlayClick(){},applyCustomDialogStyles(){if(this.$refs.customDialog){const e=this.$refs.customDialog;e.style.position="fixed",e.style.left="550px",e.style.right="30px",e.style.top="60px",e.style.bottom="10px",e.style.backgroundColor="#2a3f54",e.style.border="3px solid #2a3f54",e.style.borderRadius="15px",e.style.boxShadow="0 10px 30px rgba(0, 0, 0, 0.3), inset 0 0 20px rgba(0, 0, 0, 0.2)",e.style.display="flex",e.style.flexDirection="column",e.style.zIndex="2000"}},async connectTerminal(){if(this.currentHost&&!this.isConnecting){this.socket&&(this.disconnectTerminal(),await new Promise(e=>setTimeout(e,500))),this.isConnecting=!0;try{const e=P.getItem("token"),a="https:"===window.location.protocol?"wss:":"ws:",t=window.location.host,l=`${a}//${t}/api/v1/cmdb/hostssh/connect/${this.currentHost.id}?token=${encodeURIComponent(e)}`;this.socket=new WebSocket(l);const s=setTimeout(()=>{this.socket.readyState===WebSocket.CONNECTING&&(this.socket.close(),this.term.write("\r\n[31m连接超时，请检查:[0m\r\n"),this.term.write("1. 后端WebSocket服务是否运行\r\n"),this.term.write("2. 防火墙/网络配置是否允许连接\r\n"))},5e3);this.socket.onopen=()=>{clearTimeout(s),this.isConnected=!0,this.isConnecting=!1,this.drawerTitle=`SSH终端 - ${this.currentHost.hostName}`,this.term.write("[32m终端正在连接中[0m\r\n"),this.fitTerminal()},this.socket.onmessage=e=>{try{let t=e.data;console.group("Terminal Output"),console.groupEnd();try{const e=JSON.parse(t);if(e&&e.resize)return;e&&e.data&&(t=e.data)}catch(a){}t.includes("\n")||t.includes("\r");this.term.write(t)}catch(t){console.error("Terminal write error:",t)}},this.socket.onclose=e=>{clearTimeout(s),this.isConnected=!1,this.isConnecting=!1;let a=`\r\n\r\n[31m连接超时已关闭，请检查配置 (code: ${e.code}`;e.reason&&(a+=`, reason: ${e.reason}`),a+=")[0m\r\n",setTimeout(()=>this.term.write(a),200)},this.socket.onerror=e=>{clearTimeout(s),this.isConnected=!1,this.isConnecting=!1,this.term.write("\r\n[31mWebSocket连接错误:[0m\r\n"),this.term.write(`- ${e.message||"未知错误"}\r\n`),this.term.write("请检查:\r\n"),this.term.write("1. 后端服务是否运行\r\n"),this.term.write("2. WebSocket路由配置是否正确\r\n"),this.term.write("3. 防火墙是否允许连接\r\n")},this.term.onResize(({cols:e,rows:a})=>{this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({resize:[e,a]}))})}catch(e){this.isConnecting=!1,this.term.write(`\r\n[31m连接失败: ${e.message}[0m\r\n`)}}},fitTerminal(){this.fitAddon&&(this.fitAddon.fit(),this.term.focus())},disconnectTerminal(){this.socket&&(this.socket.close(),this.socket=null),this.isConnected=!1,this.isConnecting=!1,this.drawerTitle="SSH终端",this.term&&(this.term.writeln("\r\nSSH连接已手动断开"),this.term.writeln('可以点击"连接"按钮重新连接'))},clearTerminal(){this.term&&(this.term.clear(),this.term.writeln("终端已清屏"))},connect(){this._termInitialized?this.connectTerminal():this.initTerm().then(()=>{this.connectTerminal()})},disconnect(){this.disconnectTerminal()},clear(){this.clearTerminal()},onClose(){this.visible=!1;try{this.socket&&(this.socket.close(),this.socket=null),this.isConnected=!1,this.isConnecting=!1,this._termInitialized=!1,this.term&&(this.term.clear(),this.term.writeln("[1;32m终端已关闭[0m"),this.term.writeln("[1;34m可以重新打开终端连接[0m"),this.fitAddon&&!1===this.fitAddon._disposed&&this.fitAddon.dispose())}catch(e){console.error("Error while closing terminal:",e)}},handleResize(){this.fitTerminal()},handleKeyEvent(e){return"PageUp"===e.code&&"keydown"===e.type?(this.term.scrollPages(-1),!1):"PageDown"!==e.code||"keydown"!==e.type||(this.term.scrollPages(1),!1)}}};const up=(0,p.A)(cp,[["render",ip],["__scopeId","data-v-5795ae01"]]);var pp=up,mp={components:{Terminal:pp},data(){return{groupSearchText:"",expandedKeys:[],groupList:[],defaultProps:{children:"children",label:"name"},currentHost:null,showTerminalDrawer:!1}},mounted(){window.addEventListener("resize",this.handleResize),this.setContainerBackground()},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},created(){this.loadGroupList()},methods:{handleResize(){},setContainerBackground(){this.$refs.sshContainer&&(this.$refs.sshContainer.style.backgroundColor="#f5f5f5",this.$refs.sshContainer.style.background="#f5f5f5"),setTimeout(()=>{this.$refs.sshContainer&&(this.$refs.sshContainer.style.backgroundColor="#f5f5f5",this.$refs.sshContainer.style.background="#f5f5f5")},0)},async loadGroupList(){try{const e=await this.$api.getGroupListWithHosts();200===e.data.code&&(this.groupList=e.data.data.map(e=>({...e,children:e.children?e.children.map(e=>({...e,children:e.hosts?e.hosts.map(e=>({id:e.id,name:e.hostName,isHost:!0,hostData:e})):[]})):[]})),this.groupList.length>0&&(this.expandedKeys=[this.groupList[0].id]))}catch(e){console.error("加载分组列表失败:",e),this.$message.error("加载分组列表失败")}},handleGroupClick(e,a){console.log("点击事件触发测试"),a.data.isHost&&(console.log("点击的是主机节点"),this.currentHost={id:a.data.hostData.id,hostName:a.data.hostData.hostName,sshName:a.data.hostData.sshName,sshIp:a.data.hostData.sshIp,sshPort:a.data.hostData.sshPort})},handleGroupDblClick(e,a){a.data.isHost&&(this.currentHost={id:a.data.hostData.id,hostName:a.data.hostData.hostName,sshName:a.data.hostData.sshName,sshIp:a.data.hostData.sshIp,sshPort:a.data.hostData.sshPort},this.$refs.terminal&&this.$refs.terminal.show())},handleGroupSearch(){if(this.groupSearchText)try{const e=(a,t)=>{for(const l of a){if(l.name.includes(t))return l;if(l.children&&l.children.length>0){const a=e(l.children,t);if(a)return a}}return null},a=e(this.groupList,this.groupSearchText);if(a){const e=(a,t,l=[])=>{for(const s of a){if(s.id===t)return[...l,s.id];if(s.children&&s.children.length>0){const a=e(s.children,t,[...l,s.id]);if(a)return a}}return null},t=e(this.groupList,a.id);t&&(this.expandedKeys=t.slice(0,-1),this.$nextTick(()=>{this.$refs.groupTree.setCurrentKey(a.id)}))}else this.$message.warning("未找到匹配的分组")}catch(e){console.error("搜索分组失败:",e),this.$message.error("搜索分组失败")}else this.expandedKeys=[]},handleNodeExpand(e,a){this.expandedKeys.includes(a.key)||this.expandedKeys.push(a.key)},handleNodeCollapse(e,a){this.expandedKeys=this.expandedKeys.filter(e=>e!==a.key)},handleNativeDblClick(e){const a=e.target.closest(".el-tree-node");if(a){const e=a.getAttribute("data-key"),t=(e,a)=>{for(const t of e)for(const e of t.children||[])for(const t of e.children||[])if(t.id==a)return t.hostData;return null},l=t(this.groupList,e);l&&(this.currentHost={id:l.id,hostName:l.hostName,sshName:l.sshName,sshIp:l.sshIp,sshPort:l.sshPort},this.$refs.terminal&&this.$refs.terminal.show())}}}};const gp=(0,p.A)(mp,[["render",ap],["__scopeId","data-v-0708e7fa"]]);var vp=gp;const hp={key:0,class:"el-upload__tip"};function kp(e,a,t,l,s,o){const n=(0,r.g2)("Download"),d=(0,r.g2)("el-icon"),c=(0,r.g2)("el-button"),u=(0,r.g2)("el-form-item"),p=(0,r.g2)("el-cascader"),m=(0,r.g2)("el-upload"),g=(0,r.g2)("el-progress"),v=(0,r.g2)("el-form"),h=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(h,{title:"Excel导入主机",modelValue:o.dialogVisible,"onUpdate:modelValue":a[2]||(a[2]=e=>o.dialogVisible=e),width:"25%",onClose:o.handleClose},{footer:(0,r.k6)(()=>[(0,r.bF)(c,{onClick:a[1]||(a[1]=e=>o.dialogVisible=!1)},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.eW)("取消",-1)])),_:1,__:[6]}),(0,r.bF)(c,{type:"primary",onClick:o.submitImport,loading:s.uploading,disabled:!s.form.file||!s.form.groupId},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.eW)(" 导入主机 ",-1)])),_:1,__:[7]},8,["onClick","loading","disabled"])]),default:(0,r.k6)(()=>[(0,r.bF)(v,{model:s.form,"label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"模板下载"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",onClick:o.downloadTemplate,loading:s.downloading},{default:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1}),a[3]||(a[3]=(0,r.eW)("下载模板 ",-1))]),_:1,__:[3]},8,["onClick","loading"])]),_:1}),(0,r.bF)(u,{label:"选择分组",prop:"groupId"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.form.groupId,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.groupId=e),options:s.groupList,props:{checkStrictly:!0,value:"id",label:"name",children:"children",disabled:e=>e.children&&e.children.length>0},placeholder:"请选择分组",style:{width:"100%"},clearable:"",filterable:"",onChange:o.handleGroupChange},null,8,["modelValue","options","props","onChange"])]),_:1}),(0,r.bF)(u,{label:"上传Excel",prop:"file"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{class:"upload-demo","auto-upload":!1,"on-change":o.handleFileChange,"on-remove":o.handleFileRemove,"show-file-list":!1,accept:".xlsx,.xls"},{tip:(0,r.k6)(()=>[s.form.file?((0,r.uX)(),(0,r.CE)("div",hp,[(0,r.eW)(" 已选择: "+(0,x.v_)(s.form.file.name)+" ",1),(0,r.bF)(c,{type:"danger",text:"",icon:"Close",circle:"",size:"small",onClick:(0,i.D$)(o.handleFileRemove,["stop"]),style:{"margin-left":"8px"}},null,8,["onClick"])])):(0,r.Q3)("",!0),a[5]||(a[5]=(0,r.Lk)("div",{class:"el-upload__tip",style:{color:"#999","margin-top":"15px"}}," 请上传Excel文件（.xlsx或.xls格式） ",-1))]),default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary"},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("选择文件",-1)])),_:1,__:[4]})]),_:1},8,["on-change","on-remove"])]),_:1}),s.uploading?((0,r.uX)(),(0,r.Wv)(g,{key:0,percentage:s.uploadProgress,status:100===s.uploadProgress?"success":""},null,8,["percentage","status"])):(0,r.Q3)("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","onClose"])}t(4603),t(7566),t(8721);var bp={name:"CreateExcel",components:{Download:vc.Download},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],data(){return{form:{groupId:"",file:null},groupList:[],downloading:!1,uploading:!1,uploadProgress:0}},computed:{dialogVisible:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}}},created(){this.getGroupList()},methods:{async getGroupList(){try{const{data:e}=await this.$api.getAllCmdbGroups();if(200===e.code){this.groupList=e.data;const a=this.groupList.find(e=>"业务组"===e.name);a&&(this.form.groupId=a.id)}}catch(e){console.error("获取分组列表失败:",e),this.$message.error("获取分组列表失败")}},handleGroupChange(e){if(e&&e.length>0)this.form.groupId=e[e.length-1];else{const e=this.groupList.find(e=>e.isDefault);e&&(this.form.groupId=e.id)}},async downloadTemplate(){this.downloading=!0;try{const e=await this.$api.DownloadHostTemplate(),a=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a");t.href=a,t.setAttribute("download","主机导入模板.xlsx"),document.body.appendChild(t),t.click(),document.body.removeChild(t),this.$message.success("模板下载成功")}catch(e){console.error("模板下载失败:",e),this.$message.error("模板下载失败")}finally{this.downloading=!1}},handleFileChange(e){this.form.file=e.raw},handleFileRemove(){this.form.file=null},async submitImport(){if(!this.form.file)return this.$message.warning("请选择要上传的文件");if(!this.form.groupId)return this.$message.warning("请选择分组");this.uploading=!0,this.uploadProgress=0;try{const e=new FormData;e.append("file",this.form.file),e.append("groupId",this.form.groupId);const{data:a}=await this.$api.ImportHostsFromExcel(e,{onUploadProgress:e=>{this.uploadProgress=Math.round(100*e.loaded/e.total)}});200===a.code?(this.$message.success("导入成功"),this.dialogVisible=!1,this.$emit("success")):this.$message.error(a.message||"导入失败")}catch(e){console.error("导入失败:",e),this.$message.error("导入失败")}finally{this.uploading=!1}},handleClose(){this.form={groupId:"",file:null},this.uploadProgress=0}}};const fp=(0,p.A)(bp,[["render",kp]]);var yp=fp;const _p={class:"group-tree-section"},wp={class:"group-card"},Lp={class:"card-header"},Fp={class:"title-wrapper"},Cp={class:"title-icon"},Vp={class:"stats-indicator"},xp={class:"stats-text"},Sp=["title"],Ip=["src"],Ap={class:"search-container"},Rp={class:"search-wrapper"},Dp={class:"search-input-wrapper"},Pp={class:"tree-container"},$p=["onContextmenu"],Tp={class:"node-content"},Mp={class:"node-icon-wrapper"},Ep=["src"],Wp=["src"],zp={key:1,class:"child-icon"},Np=["src"],Kp={class:"node-text"},Up={class:"node-label"},Xp={key:0,class:"host-count"},qp={key:0,class:"connection-line"};function Hp(e,a,l,s,o,n){const d=(0,r.g2)("DataBoard"),c=(0,r.g2)("el-icon"),u=(0,r.g2)("Search"),p=(0,r.g2)("el-input"),m=(0,r.g2)("el-tree"),g=(0,r.g2)("Plus"),v=(0,r.g2)("FolderAdd"),h=(0,r.g2)("EditPen"),k=(0,r.g2)("Edit"),b=(0,r.g2)("Delete"),f=(0,r.g2)("el-form-item"),y=(0,r.g2)("el-tree-select"),_=(0,r.g2)("el-form"),w=(0,r.g2)("el-button"),L=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.CE)("div",_p,[(0,r.Lk)("div",wp,[(0,r.Lk)("div",Lp,[(0,r.Lk)("div",Fp,[(0,r.Lk)("div",Cp,[a[12]||(a[12]=(0,r.Lk)("div",{class:"pulse-ring"},null,-1)),(0,r.bF)(c,{class:"main-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(d)]),_:1})]),a[13]||(a[13]=(0,r.Lk)("div",{class:"title-content"},[(0,r.Lk)("h3",{class:"title"},"资产分组"),(0,r.Lk)("span",{class:"subtitle"},"Asset Groups")],-1))]),(0,r.Lk)("div",Vp,[(0,r.Lk)("span",xp,(0,x.v_)(l.groupList.length),1),a[14]||(a[14]=(0,r.Lk)("span",{class:"stats-label"},"Groups",-1)),(0,r.Lk)("div",{class:"toggle-btn",onClick:a[0]||(a[0]=(...e)=>n.toggleAll&&n.toggleAll(...e)),title:o.isExpanded?"折叠全部":"展开全部"},[(0,r.Lk)("img",{src:t(2272),class:(0,x.C4)(["toggle-icon",{expanded:o.isExpanded}]),alt:"折叠展开"},null,10,Ip)],8,Sp)])]),(0,r.Lk)("div",Ap,[(0,r.Lk)("div",Rp,[(0,r.Lk)("div",Dp,[(0,r.bF)(p,{modelValue:o.groupSearchText,"onUpdate:modelValue":a[1]||(a[1]=e=>o.groupSearchText=e),placeholder:"搜索分组...",clearable:"",size:"small",onInput:n.handleGroupSearch,class:"tech-input"},{prefix:(0,r.k6)(()=>[(0,r.bF)(c,{class:"search-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(u)]),_:1})]),_:1},8,["modelValue","onInput"]),a[15]||(a[15]=(0,r.Lk)("div",{class:"search-glow"},null,-1))])])]),(0,r.Lk)("div",Pp,[(0,r.bF)(m,{ref:"groupTree",data:l.groupList,props:o.defaultProps,"node-key":"id","expanded-keys":l.expandedKeys,"highlight-current":!0,"default-expanded-keys":l.expandedKeys,onNodeClick:n.handleGroupClick,onNodeExpand:n.handleNodeExpand,onNodeCollapse:n.handleNodeCollapse,class:"tech-tree"},{default:(0,r.k6)(({node:e,data:s})=>[(0,r.Lk)("div",{class:(0,x.C4)(["tree-node",{"parent-node":!s.parentId}]),onContextmenu:(0,i.D$)(a=>n.showContextMenu(a,e,s),["prevent"])},[(0,r.Lk)("div",Tp,[(0,r.Lk)("div",Mp,[s.parentId?((0,r.uX)(),(0,r.CE)("div",zp,[a[17]||(a[17]=(0,r.Lk)("div",{class:"dot-indicator"},null,-1)),(0,r.Lk)("img",{src:t(7878),class:"child-icon-img",alt:"子分组"},null,8,Np)])):((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,x.C4)(["parent-icon",{expanded:l.expandedKeys.includes(e.key)}])},[a[16]||(a[16]=(0,r.Lk)("div",{class:"icon-bg"},null,-1)),l.expandedKeys.includes(e.key)?((0,r.uX)(),(0,r.CE)("img",{key:0,src:t(4415),class:"parent-icon-img",alt:"打开文件夹"},null,8,Ep)):((0,r.uX)(),(0,r.CE)("img",{key:1,src:t(2172),class:"parent-icon-img",alt:"关闭文件夹"},null,8,Wp))],2))]),(0,r.Lk)("div",Kp,[(0,r.Lk)("span",Up,[(0,r.eW)((0,x.v_)(e.label)+" ",1),void 0!==s.hostCount?((0,r.uX)(),(0,r.CE)("span",Xp,"("+(0,x.v_)(s.hostCount)+")",1)):(0,r.Q3)("",!0)]),s.parentId?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",qp))])]),a[18]||(a[18]=(0,r.Lk)("div",{class:"hover-effect"},null,-1))],42,$p)]),_:1},8,["data","props","expanded-keys","default-expanded-keys","onNodeClick","onNodeExpand","onNodeCollapse"])])]),o.contextMenuVisible?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"context-menu",style:(0,x.Tr)({left:o.contextMenuPosition.x+"px",top:o.contextMenuPosition.y+"px"}),onClick:a[7]||(a[7]=(0,i.D$)(()=>{},["stop"]))},[(0,r.Lk)("div",{class:"context-menu-item",onClick:a[2]||(a[2]=(...e)=>n.createRootGroup&&n.createRootGroup(...e))},[(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(g)]),_:1}),a[19]||(a[19]=(0,r.Lk)("span",null,"创建根分组",-1))]),o.contextMenuData.data?((0,r.uX)(),(0,r.CE)("div",{key:0,class:"context-menu-item",onClick:a[3]||(a[3]=(...e)=>n.createSubGroup&&n.createSubGroup(...e))},[(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[20]||(a[20]=(0,r.Lk)("span",null,"创建子分组",-1))])):(0,r.Q3)("",!0),o.contextMenuData.data&&1!==o.contextMenuData.data.id?((0,r.uX)(),(0,r.CE)("div",{key:1,class:"context-menu-item",onClick:a[4]||(a[4]=(...e)=>n.renameGroup&&n.renameGroup(...e))},[(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),a[21]||(a[21]=(0,r.Lk)("span",null,"重命名",-1))])):(0,r.Q3)("",!0),o.contextMenuData.data&&1!==o.contextMenuData.data.id?((0,r.uX)(),(0,r.CE)("div",{key:2,class:"context-menu-item",onClick:a[5]||(a[5]=(...e)=>n.editGroup&&n.editGroup(...e))},[(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[22]||(a[22]=(0,r.Lk)("span",null,"修改分组",-1))])):(0,r.Q3)("",!0),o.contextMenuData.data&&1!==o.contextMenuData.data.id?((0,r.uX)(),(0,r.CE)("div",{key:3,class:"context-menu-item danger",onClick:a[6]||(a[6]=(...e)=>n.deleteGroup&&n.deleteGroup(...e))},[(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1}),a[23]||(a[23]=(0,r.Lk)("span",null,"删除分组",-1))])):(0,r.Q3)("",!0)],4)):(0,r.Q3)("",!0),(0,r.bF)(L,{title:n.getDialogTitle(),modelValue:o.groupDialogVisible,"onUpdate:modelValue":a[11]||(a[11]=e=>o.groupDialogVisible=e),width:"400px",onClose:n.handleDialogClose},{footer:(0,r.k6)(()=>[(0,r.bF)(w,{onClick:a[10]||(a[10]=e=>o.groupDialogVisible=!1)},{default:(0,r.k6)(()=>a[24]||(a[24]=[(0,r.eW)("取消",-1)])),_:1,__:[24]}),(0,r.bF)(w,{type:"primary",onClick:n.submitGroupForm},{default:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)("确定",-1)])),_:1,__:[25]},8,["onClick"])]),default:(0,r.k6)(()=>[(0,r.bF)(_,{model:o.groupForm,rules:o.groupRules,ref:"groupFormRef","label-width":"80px"},{default:(0,r.k6)(()=>[(0,r.bF)(f,{label:"分组名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:o.groupForm.name,"onUpdate:modelValue":a[8]||(a[8]=e=>o.groupForm.name=e),placeholder:"请输入分组名称",disabled:1===o.groupForm.id},null,8,["modelValue","disabled"])]),_:1}),"create"===o.dialogMode||"edit"===o.dialogMode?((0,r.uX)(),(0,r.Wv)(f,{key:0,label:"父级分组",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{modelValue:o.groupForm.parentId,"onUpdate:modelValue":a[9]||(a[9]=e=>o.groupForm.parentId=e),data:o.groupSelectOptions,props:{label:"name",value:"id",disabled:e=>e.id===o.groupForm.id},"check-strictly":"",placeholder:"请选择父级分组（不选择为根分组）",clearable:"",disabled:1===o.groupForm.id},null,8,["modelValue","data","props","disabled"])]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])])}var Bp={name:"CmdbGroup",props:{groupList:{type:Array,required:!0},expandedKeys:{type:Array,default:()=>[]}},data(){return{groupSearchText:"",isExpanded:!1,defaultProps:{children:"children",label:"name"},contextMenuVisible:!1,contextMenuPosition:{x:0,y:0},contextMenuData:{},groupDialogVisible:!1,dialogMode:"create",groupForm:{id:null,name:"",parentId:null},groupRules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"}]},groupSelectOptions:[]}},watch:{expandedKeys:{handler(e){this.$nextTick(()=>{const a=this.$refs.groupTree;if(a)if(0===e.length){const e=a.store.nodesMap;Object.keys(e).forEach(a=>{const t=e[a];t.expanded&&t.collapse()})}else a.setExpandedKeys(e)})},deep:!0,immediate:!0},groupList:{handler(e){this.groupSelectOptions=this.formatGroupOptions(e)},deep:!0,immediate:!0}},computed:{formatGroupOptions(){return e=>e.map(e=>({...e,children:e.children&&e.children.length>0?this.formatGroupOptions(e.children):[]}))}},mounted(){document.addEventListener("click",this.hideContextMenu)},beforeUnmount(){document.removeEventListener("click",this.hideContextMenu)},methods:{handleGroupSearch(){this.$emit("group-search",this.groupSearchText)},handleGroupClick(e,a){this.$emit("group-click",e,a)},handleNodeExpand(e,a){this.$emit("node-expand",e,a)},handleNodeCollapse(e,a){this.$emit("node-collapse",e,a)},toggleAll(){this.isExpanded=!this.isExpanded,this.isExpanded?this.$emit("expand-all"):this.$emit("collapse-all")},showContextMenu(e,a,t){e.preventDefault(),e.stopPropagation();const l=this.$el.querySelector(".group-card"),s=l.getBoundingClientRect();this.contextMenuPosition={x:e.clientX-s.left+10,y:e.clientY-s.top+5},console.log("菜单位置:",this.contextMenuPosition),console.log("卡片位置:",s),console.log("鼠标位置:",e.clientX,e.clientY),this.contextMenuData={node:a,data:t},this.contextMenuVisible=!0},hideContextMenu(){this.contextMenuVisible=!1},createRootGroup(){this.dialogMode="create",this.groupForm={id:null,name:"",parentId:null},this.groupDialogVisible=!0,this.hideContextMenu()},createSubGroup(){this.dialogMode="create",this.groupForm={id:null,name:"",parentId:this.contextMenuData.data.id},this.groupDialogVisible=!0,this.hideContextMenu()},renameGroup(){this.dialogMode="rename",this.groupForm={id:this.contextMenuData.data.id,name:this.contextMenuData.data.name,parentId:this.contextMenuData.data.parentId||null},this.groupDialogVisible=!0,this.hideContextMenu()},editGroup(){this.dialogMode="edit",this.groupForm={id:this.contextMenuData.data.id,name:this.contextMenuData.data.name,parentId:this.contextMenuData.data.parentId||null},this.groupDialogVisible=!0,this.hideContextMenu()},async deleteGroup(){const e=this.contextMenuData.data;try{await this.$confirm(`确定要删除分组"${e.name}"吗？如果该分组下有主机，将无法删除。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),this.$emit("delete-group",e.id),this.hideContextMenu()}catch{}},getDialogTitle(){switch(this.dialogMode){case"create":return"创建分组";case"rename":return"重命名分组";case"edit":return"编辑分组";default:return"分组管理"}},async submitGroupForm(){try{await this.$refs.groupFormRef.validate();const e={...this.groupForm,parentId:this.groupForm.parentId||0};console.log("提交分组数据:",e),"create"===this.dialogMode?this.$emit("create-group",e):"edit"!==this.dialogMode&&"rename"!==this.dialogMode||this.$emit("update-group",e),this.groupDialogVisible=!1}catch(e){console.error("表单验证失败:",e)}},handleDialogClose(){this.$refs.groupFormRef?.resetFields()}}};const jp=(0,p.A)(Bp,[["render",Hp],["__scopeId","data-v-3c662d50"]]);var Op=jp,Qp=t(6570),Gp=t.p+"static/img/公.9cebbb07.svg",Yp=t.p+"static/img/内.ab48ffea.svg",Jp=t.p+"static/img/进程.21863113.svg",Zp=t.p+"static/img/端口.a1e81e07.svg",em=t.p+"static/img/配置.55d0cc2e.svg";const am={class:"table-section"},tm={key:0,class:"ip-row public-ip"},lm={key:1,class:"ip-row private-ip"},sm=["onClick"],om=["onClick"],nm={class:"config-cell"},im={class:"status-cell"},rm=["src","alt"],dm={class:"vendor-cell"},cm={class:"table-operation"};function um(e,a,l,s,o,n){const i=(0,r.g2)("el-table-column"),d=(0,r.g2)("el-link"),c=(0,r.g2)("DocumentCopy"),u=(0,r.g2)("el-icon"),p=(0,r.g2)("el-progress"),m=(0,r.g2)("el-tooltip"),g=(0,r.g2)("el-tag"),v=(0,r.g2)("OfficeBuilding"),h=(0,r.g2)("el-button"),k=(0,r.g2)("el-button-group"),b=(0,r.g2)("el-table"),f=(0,r.g2)("monitor-dialog"),y=(0,r.g2)("process-monitor-dialog"),_=(0,r.g2)("tcp-port-monitor-dialog"),w=(0,r.gN)("authority"),L=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",am,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{data:n.hostListWithMonitor,stripe:"",style:{width:"100%"},class:"host-table"},{default:(0,r.k6)(()=>[(0,r.Q3)("",!0),(0,r.bF)(i,{label:"主机名称",width:"180","show-overflow-tooltip":""},{default:(0,r.k6)(t=>[(0,r.Lk)("div",{class:"host-name-cell",onMouseenter:a[0]||(a[0]=e=>n.showCopyIcon(e,"hostname")),onMouseleave:a[1]||(a[1]=(...e)=>n.hideCopyIcon&&n.hideCopyIcon(...e))},[a[7]||(a[7]=(0,r.Lk)("img",{src:Qp,alt:"linux",style:{height:"20px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.bF)(d,{type:"primary",onClick:a=>e.$emit("show-detail",t.row)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(t.row.hostName),1)]),_:2},1032,["onClick"]),(0,r.bF)(u,{class:"copy-icon",onClick:e=>n.copyToClipboard(t.row.hostName,"主机名称",e),style:{display:"none","margin-left":"5px",cursor:"pointer",color:"#409EFF"}},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:2},1032,["onClick"])],32)]),_:1}),(0,r.bF)(i,{label:"IP地址",width:"150","show-overflow-tooltip":""},{default:(0,r.k6)(e=>[(0,r.Lk)("div",{class:"ip-cell",onMouseenter:a[2]||(a[2]=e=>n.showCopyIcon(e,"ip")),onMouseleave:a[3]||(a[3]=(...e)=>n.hideCopyIcon&&n.hideCopyIcon(...e))},[e.row.publicIp?((0,r.uX)(),(0,r.CE)("div",tm,[a[8]||(a[8]=(0,r.Lk)("img",{src:Gp,alt:"公网",class:"ip-icon"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.publicIp||"无公网IP"),1),(0,r.bF)(u,{class:"copy-icon",onClick:a=>n.copyToClipboard(e.row.publicIp,"公网IP",a),style:{display:"none","margin-left":"5px",cursor:"pointer",color:"#409EFF"}},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:2},1032,["onClick"])])):(0,r.Q3)("",!0),e.row.privateIp?((0,r.uX)(),(0,r.CE)("div",lm,[a[9]||(a[9]=(0,r.Lk)("img",{src:Yp,alt:"内网",class:"ip-icon"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.privateIp||"无内网IP"),1),(0,r.bF)(u,{class:"copy-icon",onClick:a=>n.copyToClipboard(e.row.privateIp,"内网IP",a),style:{display:"none","margin-left":"5px",cursor:"pointer",color:"#67C23A"}},{default:(0,r.k6)(()=>[(0,r.bF)(c)]),_:2},1032,["onClick"])])):(0,r.Q3)("",!0)],32)]),_:1}),(0,r.bF)(i,{label:"CPU使用率"},{default:(0,r.k6)(e=>[(0,r.bF)(p,{percentage:e.row.cpuUsage||0,color:n.getUsageColor(e.row.cpuUsage),"show-text":!0},null,8,["percentage","color"])]),_:1}),(0,r.bF)(i,{label:"内存使用率"},{default:(0,r.k6)(e=>[(0,r.bF)(p,{percentage:e.row.memoryUsage||0,color:n.getUsageColor(e.row.memoryUsage),"show-text":!0},null,8,["percentage","color"])]),_:1}),(0,r.bF)(i,{label:"磁盘使用率"},{default:(0,r.k6)(e=>[(0,r.bF)(p,{percentage:e.row.diskUsage||0,color:n.getUsageColor(e.row.diskUsage),"show-text":!0},null,8,["percentage","color"])]),_:1}),(0,r.bF)(i,{label:"进程",width:"70",align:"center"},{default:(0,r.k6)(e=>[(0,r.bF)(m,{class:"item",effect:"light",content:"查看进程监控",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("img",{src:Jp,alt:"进程",style:{width:"24px",height:"24px",cursor:"pointer"},onClick:a=>n.showProcessMonitor(e.row)},null,8,sm)]),_:2},1024)]),_:1}),(0,r.bF)(i,{label:"端口",width:"70",align:"center"},{default:(0,r.k6)(e=>[(0,r.bF)(m,{class:"item",effect:"light",content:"查看TCP端口监控",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("img",{src:Zp,alt:"端口",style:{width:"24px",height:"24px",cursor:"pointer"},onClick:a=>n.showTcpPortMonitor(e.row)},null,8,om)]),_:2},1024)]),_:1}),(0,r.bF)(i,{label:"配置信息","show-overflow-tooltip":""},{default:(0,r.k6)(e=>[(0,r.Lk)("div",nm,[a[10]||(a[10]=(0,r.Lk)("img",{src:em,alt:"配置",style:{width:"16px",height:"16px","margin-right":"6px","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.cpu)+"核"+(0,x.v_)(e.row.memory)+"G",1)])]),_:1}),(0,r.bF)(i,{label:"存活状态"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",im,[(0,r.Lk)("img",{src:e.row.isAlive?t(5428):t(9129),alt:e.row.isAlive?"在线":"离线",style:{width:"16px",height:"16px","margin-right":"6px","flex-shrink":"0"}},null,8,rm),(0,r.bF)(g,{type:e.row.isAlive?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.isAlive?"在线":"离线"),1)]),_:2},1032,["type"])])]),_:1}),(0,r.bF)(i,{label:"认证状态"},{default:(0,r.k6)(e=>[(0,r.bF)(g,{type:n.getStatusTagType(e.row.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(n.getStatusText(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(i,{label:"主机类型",prop:"vendor","show-overflow-tooltip":""},{default:(0,r.k6)(e=>[(0,r.Lk)("div",dm,[1==e.row.vendor?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(u,{size:18,color:"#409EFF"},{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[11]||(a[11]=(0,r.Lk)("span",null,"自建",-1))],64)):2==e.row.vendor?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[a[12]||(a[12]=(0,r.Lk)("img",{src:Xu,style:{width:"18px",height:"18px"}},null,-1)),a[13]||(a[13]=(0,r.Lk)("span",null,"阿里",-1))],64)):3==e.row.vendor?((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[a[14]||(a[14]=(0,r.Lk)("img",{src:qu,style:{width:"18px",height:"18px"}},null,-1)),a[15]||(a[15]=(0,r.Lk)("span",null,"腾讯",-1))],64)):4==e.row.vendor?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[a[16]||(a[16]=(0,r.Lk)("img",{src:Hu,style:{width:"18px",height:"18px"}},null,-1)),a[17]||(a[17]=(0,r.Lk)("span",null,"百度",-1))],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:4},[(0,r.eW)((0,x.v_)(e.row.vendor),1)],64))])]),_:1}),(0,r.bF)(i,{label:"操作",fixed:"right",width:"280","min-width":"280"},{default:(0,r.k6)(a=>[(0,r.Lk)("div",cm,[(0,r.bF)(k,null,{default:(0,r.k6)(()=>[(0,r.bF)(m,{class:"item",effect:"light",content:"编辑",placement:"top-end"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"primary",icon:"Edit",size:"mini",circle:"",plain:"",onClick:t=>e.$emit("edit-host",a.row.id)},null,8,["onClick"]),[[w,["cmdb:ecs:edit"]]])]),_:2},1024),(0,r.bF)(m,{class:"item",effect:"light",content:"上传",placement:"top-end"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"primary",icon:"Upload",size:"mini",circle:"",plain:"",onClick:t=>e.$emit("show-upload",a.row)},null,8,["onClick"]),[[w,["cmdb:ecs:upload"]]])]),_:2},1024),(0,r.bF)(m,{class:"item",effect:"light",content:"执行命令",placement:"top-end"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"success",icon:"Position",size:"mini",circle:"",plain:"",onClick:t=>e.$emit("execute-command",a.row)},null,8,["onClick"]),[[w,["cmdb:ecs:shell"]]])]),_:2},1024),(0,r.bF)(m,{class:"item",effect:"light",content:"删除",placement:"top-end"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"danger",icon:"Delete",size:"mini",circle:"",plain:"",onClick:t=>e.$emit("delete-host",a.row)},null,8,["onClick"]),[[w,["cmdb:ecs:delete"]]])]),_:2},1024),(0,r.bF)(m,{class:"item",effect:"light",content:"监控",placement:"top-end"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"info",icon:"Monitor",size:"mini",circle:"",plain:"",onClick:e=>n.showMonitor(a.row)},null,8,["onClick"]),[[w,["cmdb:ecs:monitor"]]])]),_:2},1024)]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[L,l.loading]]),o.showMonitorDialog?((0,r.uX)(),(0,r.Wv)(f,{key:0,modelValue:o.showMonitorDialog,"onUpdate:modelValue":a[4]||(a[4]=e=>o.showMonitorDialog=e),"host-id":o.currentHostId,style:{"z-index":"2001"}},null,8,["modelValue","host-id"])):(0,r.Q3)("",!0),o.showProcessDialog?((0,r.uX)(),(0,r.Wv)(y,{key:1,modelValue:o.showProcessDialog,"onUpdate:modelValue":a[5]||(a[5]=e=>o.showProcessDialog=e),"host-id":o.currentProcessHostId,style:{"z-index":"2002"}},null,8,["modelValue","host-id"])):(0,r.Q3)("",!0),o.showTcpPortDialog?((0,r.uX)(),(0,r.Wv)(_,{key:2,modelValue:o.showTcpPortDialog,"onUpdate:modelValue":a[6]||(a[6]=e=>o.showTcpPortDialog=e),"host-id":o.currentTcpPortHostId,style:{"z-index":"2003"}},null,8,["modelValue","host-id"])):(0,r.Q3)("",!0)])}const pm={class:"time-selector"},mm={key:0,class:"preset-buttons"},gm={key:1,class:"custom-time"},vm={class:"metric-header"},hm={class:"metric-title"},km={class:"metric-header"},bm={class:"disk-io-tags"},fm={class:"metric-chart",ref:"chart-diskIO"},ym={class:"metric-header"},_m={class:"network-io-tags"},wm={class:"metric-chart",ref:"chart-networkIO"};function Lm(e,a,t,l,s,o){const n=(0,r.g2)("el-radio-button"),i=(0,r.g2)("el-radio-group"),d=(0,r.g2)("el-button"),c=(0,r.g2)("el-date-picker"),u=(0,r.g2)("el-tag"),p=(0,r.g2)("el-card"),m=(0,r.g2)("el-col"),g=(0,r.g2)("el-row"),v=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(v,{title:"主机监控",visible:o.dialogVisible,"onUpdate:visible":a[2]||(a[2]=e=>o.dialogVisible=e),width:"80%",top:"5vh",onClose:o.handleClose,"custom-class":"monitor-dialog",modal:!0,"append-to-body":!0,"lock-scroll":!1,style:{"z-index":"2001"}},{default:(0,r.k6)(()=>[(0,r.Lk)("div",pm,[(0,r.bF)(i,{modelValue:s.timeRangeType,"onUpdate:modelValue":a[0]||(a[0]=e=>s.timeRangeType=e),size:"small",onChange:o.handleTimeRangeChange},{default:(0,r.k6)(()=>[(0,r.bF)(n,{label:"preset"},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)("预设时间",-1)])),_:1,__:[3]}),(0,r.bF)(n,{label:"custom"},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("自定义时间",-1)])),_:1,__:[4]})]),_:1},8,["modelValue","onChange"]),"preset"===s.timeRangeType?((0,r.uX)(),(0,r.CE)("div",mm,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.presetDurations,e=>((0,r.uX)(),(0,r.Wv)(d,{key:e.value,size:"mini",type:s.activeDuration===e.value?"primary":"",onClick:a=>o.selectPresetDuration(e.value)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label),1)]),_:2},1032,["type","onClick"]))),128))])):((0,r.uX)(),(0,r.CE)("div",gm,[(0,r.bF)(c,{modelValue:s.customTimeRange,"onUpdate:modelValue":a[1]||(a[1]=e=>s.customTimeRange=e),type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":null,onInput:o.handleRawDateChange},null,8,["modelValue","onInput"]),(0,r.bF)(d,{size:"mini",type:"primary",style:{"margin-left":"10px"},onClick:o.handleQueryClick,disabled:!s.customTimeRange||2!==s.customTimeRange.length},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)(" 查询 ",-1)])),_:1,__:[5]},8,["onClick","disabled"])]))]),(0,r.bF)(g,{gutter:20,class:"monitor-row"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.nonNetworkIOMetrics,(e,a)=>((0,r.uX)(),(0,r.Wv)(m,{span:8,key:e.key},{default:(0,r.k6)(()=>[(0,r.bF)(p,{class:"metric-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",vm,[(0,r.Lk)("span",hm,(0,x.v_)(e.title),1),(0,r.bF)(u,{size:"mini",type:o.getMetricStatus(e.value)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.value)+" "+(0,x.v_)(e.unit),1)]),_:2},1032,["type"])]),(0,r.Lk)("div",{class:"metric-chart",ref_for:!0,ref:"chart-"+e.key},null,512)]),_:2},1024)]),_:2},1024))),128)),(0,r.bF)(m,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(p,{class:"metric-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",km,[a[6]||(a[6]=(0,r.Lk)("span",{class:"metric-title"},"磁盘I/O速率",-1)),(0,r.Lk)("div",bm,[(0,r.bF)(u,{size:"mini",type:"success",style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.eW)(" 读: "+(0,x.v_)(o.diskReadMetric.value)+" "+(0,x.v_)(o.diskReadMetric.unit),1)]),_:1}),(0,r.bF)(u,{size:"mini",type:"warning"},{default:(0,r.k6)(()=>[(0,r.eW)(" 写: "+(0,x.v_)(o.diskWriteMetric.value)+" "+(0,x.v_)(o.diskWriteMetric.unit),1)]),_:1})])]),(0,r.Lk)("div",fm,null,512)]),_:1})]),_:1}),(0,r.bF)(m,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(p,{class:"metric-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ym,[a[7]||(a[7]=(0,r.Lk)("span",{class:"metric-title"},"网络I/O速率",-1)),(0,r.Lk)("div",_m,[(0,r.bF)(u,{size:"mini",type:"info",style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.eW)(" 接收: "+(0,x.v_)(o.networkReceiveMetric.value)+" "+(0,x.v_)(o.networkReceiveMetric.unit),1)]),_:1}),(0,r.bF)(u,{size:"mini",type:"primary"},{default:(0,r.k6)(()=>[(0,r.eW)(" 发送: "+(0,x.v_)(o.networkSendMetric.value)+" "+(0,x.v_)(o.networkSendMetric.unit),1)]),_:1})])]),(0,r.Lk)("div",wm,null,512)]),_:1})]),_:1})]),_:1})]),_:1},8,["visible","onClose"])}t(5093);var Fm={name:"MonitorDialog",components:{},model:{prop:"visible",event:"change"},props:{visible:{type:Boolean,default:!1},hostId:{type:String,required:!0}},data(){return{timeRangeType:"preset",activeDuration:"30m",presetDurations:[{label:"30分钟",value:"30m"},{label:"1小时",value:"1h"},{label:"3小时",value:"3h"},{label:"6小时",value:"6h"},{label:"12小时",value:"12h"},{label:"24小时",value:"24h"}],customTimeRange:[],chartInstances:[],metrics:[{title:"CPU使用率",key:"cpu",unit:"%",value:0,chartData:{xAxis:[],series:[]}},{title:"内存使用率",key:"memory",unit:"%",value:0,chartData:{xAxis:[],series:[]}},{title:"磁盘使用率",key:"disk",unit:"%",value:0,chartData:{xAxis:[],series:[]}},{title:"磁盘读取速率",key:"diskReadKB",unit:"KB/s",value:0,chartData:{xAxis:[],series:[]}},{title:"磁盘写入速率",key:"diskWriteKB",unit:"KB/s",value:0,chartData:{xAxis:[],series:[]}},{title:"网络接收",key:"networkReceive",unit:"KB/s",value:0,chartData:{xAxis:[],series:[]}},{title:"网络发送",key:"networkSend",unit:"KB/s",value:0,chartData:{xAxis:[],series:[]}},{title:"1分钟负载",key:"load1min",unit:"",value:0,chartData:{xAxis:[],series:[]}},{title:"5分钟负载",key:"load5min",unit:"",value:0,chartData:{xAxis:[],series:[]}},{title:"15分钟负载",key:"load15min",unit:"",value:0,chartData:{xAxis:[],series:[]}},{title:"进程总数",key:"totalProcesses",unit:"",value:0,chartData:{xAxis:[],series:[]}}],refreshInterval:null}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("change",e)}},nonNetworkIOMetrics(){return this.metrics.filter(e=>"diskReadKB"!==e.key&&"diskWriteKB"!==e.key&&"networkReceive"!==e.key&&"networkSend"!==e.key)},diskReadMetric(){return this.metrics.find(e=>"diskReadKB"===e.key)||{value:0,unit:"KB/s"}},diskWriteMetric(){return this.metrics.find(e=>"diskWriteKB"===e.key)||{value:0,unit:"KB/s"}},networkReceiveMetric(){return this.metrics.find(e=>"networkReceive"===e.key)||{value:0,unit:"KB/s"}},networkSendMetric(){return this.metrics.find(e=>"networkSend"===e.key)||{value:0,unit:"KB/s"}}},methods:{getMetricStatus(e){return e>80?"danger":e>60?"warning":"success"},async fetchMetrics(){try{console.log("开始获取监控数据...");const e={id:this.hostId};if(console.log("初始请求参数:",JSON.stringify(e,null,2)),"preset"===this.timeRangeType)console.log("使用预设时间范围:",this.activeDuration),e.duration=this.activeDuration;else if(this.customTimeRange&&2===this.customTimeRange.length){console.log("使用自定义时间范围:",this.customTimeRange),console.log("原始时间值:",{start:this.customTimeRange[0],end:this.customTimeRange[1]});const a=e=>{if(!e)return e;const a=e instanceof Date?e:new Date(e);if(isNaN(a.getTime()))return console.error("无效的日期:",e),e;const t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),o=String(a.getHours()).padStart(2,"0"),n=String(a.getMinutes()).padStart(2,"0"),i=String(a.getSeconds()).padStart(2,"0");return`${t}-${l}-${s}+${o}:${n}:${i}`},t=e=>e,l=this.customTimeRange[0]instanceof Date?this.customTimeRange[0]:new Date(this.customTimeRange[0]),s=this.customTimeRange[1]instanceof Date?this.customTimeRange[1]:new Date(this.customTimeRange[1]);e.start=t(a(l)),e.end=t(a(s)),console.log("最终请求参数:",{start:e.start,end:e.end,fullURL:`start=${e.start}&end=${e.end}`}),console.log("原始时间对象:",{start:l,end:s}),console.log("格式化后的时间:",{start:a(l),end:a(s)}),console.log("编码后的参数:",{start:e.start,end:e.end}),console.log("完整请求URL:",`start=${e.start}&end=${e.end}`),console.log("原始时间输入:",{start:this.customTimeRange[0],end:this.customTimeRange[1]}),console.log("验证时间格式:",{start:new Date(this.customTimeRange[0]),end:new Date(this.customTimeRange[1])})}console.log("请求参数:",JSON.stringify(e,null,2)),console.log("编码后URL:",`start=${e.start}&end=${e.end}`),console.log("最终请求参数:",JSON.stringify(e,null,2));const a=await this.$api.getHostMonitorData(e);console.log("API响应:",{status:a.status,data:a.data}),console.log("完整响应:",a),console.log("响应数据:",JSON.stringify(a.data,null,2)),200===a.data.code&&await this.updateMetrics(a.data.data)}catch(e){console.error("获取监控指标失败:",e)}},async updateMetrics(e){if(console.log("更新指标数据 - 开始处理"),e){await this.$nextTick();for(let t=0;t<this.metrics.length;t++){const l=this.metrics[t];if("diskReadKB"===l.key||"diskWriteKB"===l.key||"networkReceive"===l.key||"networkSend"===l.key){const a=e[l.key]||[],t=a.filter(e=>e&&"number"===typeof e.value&&!isNaN(e.value)&&"number"===typeof e.timestamp);if(t.length>0){const e=t.reduce((e,a)=>e+a.value,0),a=e/t.length;l.value=Math.max(0,a).toFixed(2)}else l.value="0.00";continue}try{const a=e[l.key]||[],t=a.filter(e=>e&&"number"===typeof e.value&&!isNaN(e.value)&&"number"===typeof e.timestamp);if(0===t.length){l.value="0.00",this.createEmptyChart(l.key,l);continue}const s=t.reduce((e,a)=>e+a.value,0);let o=s/t.length;"cpu"===l.key||"memory"===l.key||"disk"===l.key?(o=o<1?100*o:o,l.value=Math.max(0,Math.min(100,o)).toFixed(2)):l.value=Math.max(0,o).toFixed(2);const n=[],i=[];t.forEach(e=>{const a=new Date(1e3*e.timestamp),t=`${a.getHours()}:${a.getMinutes().toString().padStart(2,"0")}`;n.push(t);let s=e.value;"cpu"===l.key||"memory"===l.key||"disk"===l.key?(s=s<1?100*s:s,s=Math.max(0,Math.min(100,s))):s=Math.max(0,s);const o=parseFloat(s.toFixed(2));i.push(isFinite(o)?o:0)}),console.log(`准备渲染图表 ${l.key} - 数据点: ${i.length}`);const r=this.$refs[`chart-${l.key}`];if(!r||!r[0]){console.error(`图表容器chart-${l.key}未找到`,r);continue}this.renderSingleChart(r[0],l,n,i)}catch(a){console.error(`更新图表 ${l.key} 失败:`,a)}}this.renderDiskIOChart(e),this.renderNetworkIOChart(e),console.log("更新指标数据 - 完成")}else console.error("metricsData为空")},renderSingleChart(e,a,t,l){try{console.log(`渲染图表 ${a.key} - DOM:`,e);let s=this.chartInstances[a.key];s||(s=Z.Ts(e,"dark"),this.chartInstances[a.key]=s);const o={backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"#00d8ff",borderWidth:1,textStyle:{color:"#00d8ff"},axisPointer:{type:"line",lineStyle:{color:"#00d8ff",width:1,opacity:.8}},formatter:function(e){if(e&&e.length>0){let t=`<div style="color: #00d8ff; font-weight: bold;">${e[0].axisValue}</div>`;return t+=`<div style="color: #00d8ff; margin-top: 5px;">• ${e[0].seriesName}: ${e[0].value} ${a.unit}</div>`,t}return""}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:t,axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED"}},yAxis:{type:"value",name:a.unit,nameTextStyle:{color:"#E4E7ED"},axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED"},splitLine:{lineStyle:{color:["#2D3A4B"]}}},series:[{name:a.title,type:"line",data:l,smooth:!0,symbol:"none",lineStyle:{color:"#00d8ff",width:1},itemStyle:{color:"#00d8ff"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(0, 216, 255, 0.2)"},{offset:1,color:"rgba(0, 216, 255, 0)"}]}}}]};s.setOption(o,!0),console.log(`图表 ${a.key} 渲染成功`)}catch(s){console.error(`渲染图表 ${a.key} 失败:`,s)}},renderDiskIOChart(e){try{const a=this.$refs["chart-diskIO"];if(!a)return void console.error("磁盘I/O图表容器未找到");const t=e["diskReadKB"]||[],l=e["diskWriteKB"]||[],s=t.filter(e=>e&&"number"===typeof e.value&&!isNaN(e.value)&&"number"===typeof e.timestamp),o=l.filter(e=>e&&"number"===typeof e.value&&!isNaN(e.value)&&"number"===typeof e.timestamp);if(0===s.length&&0===o.length)return void this.createEmptyChart("diskIO",{key:"diskIO",title:"磁盘I/O速率"});let n=this.chartInstances["diskIO"];n||(n=Z.Ts(a,"dark"),this.chartInstances["diskIO"]=n);const i=s.length>0?s:o,r=i.map(e=>{const a=new Date(1e3*e.timestamp);return`${a.getHours()}:${a.getMinutes().toString().padStart(2,"0")}`}),d=s.map(e=>{const a=Math.max(0,e.value);return isFinite(a)?parseFloat(a.toFixed(2)):0}),c=o.map(e=>{const a=Math.max(0,e.value);return isFinite(a)?parseFloat(a.toFixed(2)):0}),u={backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"#00d8ff",borderWidth:1,textStyle:{color:"#00d8ff"},axisPointer:{type:"line",lineStyle:{color:"#00d8ff",width:1,opacity:.8}},formatter:function(e){if(!e||0===e.length)return"";let a=`<div style="color: #00d8ff; font-weight: bold;">${e[0].axisValue}</div>`;return e.forEach(e=>{const t="磁盘读取"===e.seriesName?"#00d8ff":"#ff9800";a+=`<div style="color: ${t}; margin-top: 3px;">• ${e.seriesName}: ${e.value} KB/s</div>`}),a}},legend:{data:["磁盘读取","磁盘写入"],textStyle:{color:"#E4E7ED"},top:0},grid:{left:"3%",right:"4%",bottom:"3%",top:"20%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:r,axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED"}},yAxis:{type:"value",name:"KB/s",nameTextStyle:{color:"#E4E7ED"},axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED"},splitLine:{lineStyle:{color:["#2D3A4B"]}}},series:[{name:"磁盘读取",type:"line",data:d,smooth:!0,symbol:"none",lineStyle:{color:"#00d8ff",width:1},itemStyle:{color:"#00d8ff"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(0, 216, 255, 0.2)"},{offset:1,color:"rgba(0, 216, 255, 0)"}]}}},{name:"磁盘写入",type:"line",data:c,smooth:!0,symbol:"none",lineStyle:{color:"#ff9800",width:1},itemStyle:{color:"#ff9800"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(255, 152, 0, 0.2)"},{offset:1,color:"rgba(255, 152, 0, 0)"}]}}}]};n.setOption(u,!0),console.log("磁盘I/O合并图表渲染成功")}catch(a){console.error("渲染磁盘I/O图表失败:",a)}},renderNetworkIOChart(e){try{const a=this.$refs["chart-networkIO"];if(!a)return void console.error("网络I/O图表容器未找到");const t=e["networkReceive"]||[],l=e["networkSend"]||[],s=t.filter(e=>e&&"number"===typeof e.value&&!isNaN(e.value)&&"number"===typeof e.timestamp),o=l.filter(e=>e&&"number"===typeof e.value&&!isNaN(e.value)&&"number"===typeof e.timestamp);if(0===s.length&&0===o.length)return void this.createEmptyChart("networkIO",{key:"networkIO",title:"网络I/O速率"});let n=this.chartInstances["networkIO"];n||(n=Z.Ts(a,"dark"),this.chartInstances["networkIO"]=n);const i=s.length>0?s:o,r=i.map(e=>{const a=new Date(1e3*e.timestamp);return`${a.getHours()}:${a.getMinutes().toString().padStart(2,"0")}`}),d=s.map(e=>{const a=Math.max(0,e.value);return isFinite(a)?parseFloat(a.toFixed(2)):0}),c=o.map(e=>{const a=Math.max(0,e.value);return isFinite(a)?parseFloat(a.toFixed(2)):0}),u={backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"#00d8ff",borderWidth:1,textStyle:{color:"#00d8ff"},axisPointer:{type:"line",lineStyle:{color:"#00d8ff",width:1,opacity:.8}},formatter:function(e){if(!e||0===e.length)return"";let a=`<div style="color: #00d8ff; font-weight: bold;">${e[0].axisValue}</div>`;return e.forEach(e=>{const t="网络接收"===e.seriesName?"#17a2b8":"#6610f2";a+=`<div style="color: ${t}; margin-top: 3px;">• ${e.seriesName}: ${e.value} KB/s</div>`}),a}},legend:{data:["网络接收","网络发送"],textStyle:{color:"#E4E7ED"},top:0},grid:{left:"3%",right:"4%",bottom:"3%",top:"20%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:r,axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED"}},yAxis:{type:"value",name:"KB/s",nameTextStyle:{color:"#E4E7ED"},axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED"},splitLine:{lineStyle:{color:["#2D3A4B"]}}},series:[{name:"网络接收",type:"line",data:d,smooth:!0,symbol:"none",lineStyle:{color:"#17a2b8",width:1},itemStyle:{color:"#17a2b8"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(23, 162, 184, 0.2)"},{offset:1,color:"rgba(23, 162, 184, 0)"}]}}},{name:"网络发送",type:"line",data:c,smooth:!0,symbol:"none",lineStyle:{color:"#6610f2",width:1},itemStyle:{color:"#6610f2"},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(102, 16, 242, 0.2)"},{offset:1,color:"rgba(102, 16, 242, 0)"}]}}}]};n.setOption(u,!0),console.log("网络I/O合并图表渲染成功")}catch(a){console.error("渲染网络I/O图表失败:",a)}},createEmptyChart(e,a){try{const t=this.$refs[`chart-${e}`];if(!t&&!t[0])return void console.error(`图表容器chart-${e}未找到`);const l="diskIO"===e?t:t[0]||t;this.chartInstances[e]||(this.chartInstances[e]=Z.Ts(l,"dark"));const s={backgroundColor:"transparent",graphic:{type:"text",left:"center",top:"middle",style:{text:"暂无数据",fontSize:14,fill:"#6E7079"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:[],axisLine:{lineStyle:{color:"#6E7079"}}},yAxis:{type:"value",axisLine:{lineStyle:{color:"#6E7079"}},splitLine:{lineStyle:{color:["#2D3A4B"]}}},series:[{name:a.title,type:"line",data:[]}]};this.chartInstances[e].setOption(s,!0),console.log(`创建空图表 ${a.key} 成功`)}catch(t){console.error(`创建空图表 ${a.key} 失败:`,t)}},startRefresh(){console.log("=== startRefresh 开始 ===",{hostId:this.hostId,currentVisible:this.visible}),this.hostId?(this.timeRangeType="preset",this.activeDuration="30m",console.log("默认时间范围设置:",{type:this.timeRangeType,duration:this.activeDuration}),this.stopRefresh(),console.log("开始加载初始数据..."),this.fetchMetrics().then(()=>{console.log("初始数据加载完成")}).catch(e=>{console.error("初始数据加载失败:",e)}),this.refreshInterval=setInterval(()=>{console.log("定时刷新数据..."),this.fetchMetrics().catch(e=>{console.error("定时刷新失败:",e)})},1e4),console.log("定时器已设置，间隔10秒"),console.log("=== startRefresh 结束 ===")):console.error("hostId 未设置，无法加载数据")},stopRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)},mounted(){window.addEventListener("resize",this.handleResize)},beforeDestroy(){console.log("MonitorDialog beforeDestroy - 清理资源"),window.removeEventListener("resize",this.handleResize),this.stopRefresh(),this.chartInstances.forEach(e=>{e&&e.dispose()}),this.chartInstances=[]},handleResize(){this.chartInstances.forEach(e=>{e&&e.resize()})},selectPresetDuration(e){this.activeDuration=e,this.fetchMetrics()},handleTimeRangeChange(){this.fetchMetrics()},handleRawDateChange(e){if(!e||2!==e.length)return;const a=e=>{const a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),n=String(e.getSeconds()).padStart(2,"0");return`${a}-${t}-${l} ${s}:${o}:${n}`};this.customTimeRange=[a(e[0]),a(e[1])],console.log("格式化后的时间范围:",this.customTimeRange)},handleCustomTimeChange(){},handleQueryClick(){console.log("查询按钮点击事件触发"),console.log("当前时间范围:",this.customTimeRange),this.customTimeRange&&2===this.customTimeRange.length?(console.log("准备发送请求..."),this.fetchMetrics()):(console.warn("时间范围无效，无法发送请求"),this.$message.warning("请选择完整的时间范围"))},handleClose(){this.stopRefresh(),this.chartInstances.forEach(e=>{e&&e.dispose()}),this.$emit("change",!1)}},mounted(){console.log("MonitorDialog mounted, visible:",this.visible,"hostId:",this.hostId),window.addEventListener("resize",this.handleResize),this.hostId?(console.log("Component mounted, immediately starting refresh"),this.timeRangeType="preset",this.activeDuration="30m",this.$nextTick(()=>{setTimeout(()=>{this.startRefresh()},200)})):console.warn("Component mounted but hostId is not provided")},watch:{visible:{handler(e,a){console.log("visible prop changed:",e,"oldVal:",a),e&&!a?(console.log("Dialog became visible, starting refresh immediately"),this.timeRangeType="preset",this.activeDuration="30m",this.startRefresh()):!e&&a&&(console.log("Dialog became hidden, stopping refresh"),this.stopRefresh())}},hostId:{handler(e,a){console.log("hostId changed:",e,"oldVal:",a),e&&e!==a&&(console.log("HostId changed, restarting refresh"),this.timeRangeType="preset",this.activeDuration="30m",this.$nextTick(()=>{this.startRefresh()}))}}}};const Cm=(0,p.A)(Fm,[["render",Lm],["__scopeId","data-v-3403f706"]]);var Vm=Cm;const xm={class:"process-monitor-header"},Sm={class:"host-info"},Im={class:"host-name"},Am={class:"update-time"},Rm={class:"chart-header"},Dm={class:"chart-container",ref:"cpuChart"},Pm={class:"chart-header"},$m={class:"chart-container",ref:"memoryChart"};function Tm(e,a,t,l,s,o){const n=(0,r.g2)("el-button"),i=(0,r.g2)("el-tag"),d=(0,r.g2)("el-card"),c=(0,r.g2)("el-col"),u=(0,r.g2)("el-row"),p=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(p,{title:"进程监控",visible:o.dialogVisible,"onUpdate:visible":a[0]||(a[0]=e=>o.dialogVisible=e),width:"80%",top:"5vh",onClose:o.handleClose,"custom-class":"process-monitor-dialog",modal:!0,"append-to-body":!0},{default:(0,r.k6)(()=>[(0,r.Lk)("div",xm,[(0,r.Lk)("div",Sm,[(0,r.Lk)("span",Im,(0,x.v_)(s.processData.hostName||"未知主机"),1),(0,r.Lk)("span",Am,"最后更新: "+(0,x.v_)(o.formatTime(s.processData.updateTime)),1)]),(0,r.bF)(n,{type:"primary",size:"mini",icon:"Refresh",loading:s.loading,onClick:o.fetchProcessData},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)(" 手动刷新 ",-1)])),_:1,__:[1]},8,["loading","onClick"])]),(0,r.bF)(u,{gutter:20,class:"process-charts"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{class:"chart-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Rm,[a[3]||(a[3]=(0,r.Lk)("h4",null,"Top CPU 进程",-1)),(0,r.bF)(i,{size:"mini",type:"info"},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)("CPU使用率 %",-1)])),_:1,__:[2]})]),(0,r.Lk)("div",Dm,null,512)]),_:1})]),_:1}),(0,r.bF)(c,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{class:"chart-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Pm,[a[5]||(a[5]=(0,r.Lk)("h4",null,"Top 内存 进程",-1)),(0,r.bF)(i,{size:"mini",type:"warning"},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("内存使用率 %",-1)])),_:1,__:[4]})]),(0,r.Lk)("div",$m,null,512)]),_:1})]),_:1})]),_:1})]),_:1},8,["visible","onClose"])}var Mm={name:"ProcessMonitorDialog",model:{prop:"visible",event:"change"},props:{visible:{type:Boolean,default:!1},hostId:{type:[String,Number],required:!0}},data(){return{loading:!1,processData:{},cpuChart:null,memoryChart:null,refreshInterval:null}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("change",e)}}},watch:{visible(e){e?this.startMonitoring():this.stopMonitoring()},hostId(e){e&&this.visible&&this.startMonitoring()}},methods:{async fetchProcessData(){if(this.hostId){this.loading=!0;try{const{data:e}=await this.$api.getHostTopProcesses(this.hostId);200===e.code&&(this.processData=e.data,this.$nextTick(()=>{this.renderCharts()}))}catch(e){console.error("获取进程数据失败:",e),this.$message.error("获取进程数据失败")}finally{this.loading=!1}}},renderCharts(){this.renderCpuChart(),this.renderMemoryChart()},renderCpuChart(){if(!this.processData.topCPU||!this.$refs.cpuChart)return;this.cpuChart||(this.cpuChart=Z.Ts(this.$refs.cpuChart,"dark"));const e=this.processData.topCPU.slice(0,5).map(e=>({name:e.name,value:parseFloat(e.cpuPercent.toFixed(2)),pid:e.pid})),a={backgroundColor:"transparent",tooltip:{trigger:"item",backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"#00d8ff",borderWidth:1,textStyle:{color:"#00d8ff",fontSize:12},confine:!0,enterable:!0,hideDelay:100,showDelay:50,formatter:function(e){return`\n              <div style="color: #00d8ff; padding: 8px; font-size: 12px;">\n                <div style="font-weight: bold; margin-bottom: 5px; font-size: 13px;">${e.data.name}</div>\n                <div>PID: ${e.data.pid}</div>\n                <div>CPU使用率: ${e.data.value}%</div>\n              </div>\n            `}},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",data:e.map(e=>e.name),axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{rotate:0,fontSize:14,color:"#E4E7ED",interval:0,formatter:function(e){return e.length>6?e.substring(0,6)+"...":e}},axisTick:{show:!0,lineStyle:{color:"#6E7079"}}},yAxis:{type:"value",name:"CPU %",nameTextStyle:{color:"#E4E7ED",fontSize:14},axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED",fontSize:13},splitLine:{lineStyle:{color:["#2D3A4B"],type:"dashed"}}},series:[{type:"bar",data:e,barWidth:"40%",itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#00d8ff"},{offset:.5,color:"#3A4DE9"},{offset:1,color:"#1890ff"}]},borderRadius:[4,4,0,0],shadowColor:"rgba(0, 216, 255, 0.3)",shadowBlur:10,shadowOffsetY:2},emphasis:{itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#00f5ff"},{offset:.5,color:"#4169E1"},{offset:1,color:"#1E90FF"}]},shadowColor:"rgba(0, 245, 255, 0.5)",shadowBlur:15}},animationDuration:1e3,animationEasing:"cubicOut"}]};this.cpuChart.setOption(a,!0)},renderMemoryChart(){if(!this.processData.topMemory||!this.$refs.memoryChart)return;this.memoryChart||(this.memoryChart=Z.Ts(this.$refs.memoryChart,"dark"));const e=this.processData.topMemory.slice(0,5).map(e=>({name:e.name,value:parseFloat(e.memPercent.toFixed(2)),pid:e.pid})),a={backgroundColor:"transparent",tooltip:{trigger:"item",backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"#ff9800",borderWidth:1,textStyle:{color:"#ff9800",fontSize:12},confine:!0,enterable:!0,hideDelay:100,showDelay:50,formatter:function(e){return`\n              <div style="color: #ff9800; padding: 8px; font-size: 12px;">\n                <div style="font-weight: bold; margin-bottom: 5px; font-size: 13px;">${e.data.name}</div>\n                <div>PID: ${e.data.pid}</div>\n                <div>内存使用率: ${e.data.value}%</div>\n              </div>\n            `}},grid:{left:"3%",right:"4%",bottom:"15%",top:"10%",containLabel:!0},xAxis:{type:"category",data:e.map(e=>e.name),axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{rotate:0,fontSize:14,color:"#E4E7ED",interval:0,formatter:function(e){return e.length>6?e.substring(0,6)+"...":e}},axisTick:{show:!0,lineStyle:{color:"#6E7079"}}},yAxis:{type:"value",name:"内存 %",nameTextStyle:{color:"#E4E7ED",fontSize:14},axisLine:{lineStyle:{color:"#6E7079"}},axisLabel:{color:"#E4E7ED",fontSize:13},splitLine:{lineStyle:{color:["#2D3A4B"],type:"dashed"}}},series:[{type:"bar",data:e,barWidth:"40%",itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#ffb74d"},{offset:.5,color:"#ff9800"},{offset:1,color:"#f57c00"}]},borderRadius:[4,4,0,0],shadowColor:"rgba(255, 152, 0, 0.3)",shadowBlur:10,shadowOffsetY:2},emphasis:{itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#ffc947"},{offset:.5,color:"#ffab00"},{offset:1,color:"#ff6f00"}]},shadowColor:"rgba(255, 171, 0, 0.5)",shadowBlur:15}},animationDuration:1e3,animationEasing:"cubicOut"}]};this.memoryChart.setOption(a,!0)},formatTime(e){if(!e)return"未知时间";const a=new Date(1e3*e);return a.toLocaleString()},startMonitoring(){console.log("=== startMonitoring 开始 ===",{hostId:this.hostId,visible:this.visible}),this.hostId?(this.stopMonitoring(),console.log("开始加载初始数据..."),this.fetchProcessData().then(()=>{console.log("初始数据加载完成")}).catch(e=>{console.error("初始数据加载失败:",e)}),this.refreshInterval=setInterval(()=>{console.log("定时刷新进程数据..."),this.fetchProcessData().catch(e=>{console.error("定时刷新失败:",e)})},1e4),console.log("定时器已设置，间雔10秒"),console.log("=== startMonitoring 结束 ===")):console.error("hostId 未设置，无法加载数据")},stopMonitoring(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)},handleClose(){this.stopMonitoring(),this.dialogVisible=!1},handleResize(){this.cpuChart&&this.cpuChart.resize(),this.memoryChart&&this.memoryChart.resize()}},mounted(){console.log("ProcessMonitorDialog mounted, visible:",this.visible,"hostId:",this.hostId),window.addEventListener("resize",this.handleResize),this.hostId&&(console.log("Component mounted with hostId, immediately starting monitoring"),this.$nextTick(()=>{setTimeout(()=>{this.startMonitoring()},100)}))},beforeUnmount(){window.removeEventListener("resize",this.handleResize),this.stopMonitoring(),this.cpuChart&&this.cpuChart.dispose(),this.memoryChart&&this.memoryChart.dispose()}};const Em=(0,p.A)(Mm,[["render",Tm],["__scopeId","data-v-06134203"]]);var Wm=Em;const zm={class:"tcp-port-monitor-header"},Nm={class:"host-info"},Km={class:"host-name"},Um={class:"update-time"},Xm={class:"port-summary"},qm={class:"port-filters"},Hm={class:"pid-text"},Bm={class:"service-cell"},jm={class:"service-name"},Om={key:0},Qm={key:1,class:"text-muted"},Gm={key:0},Ym={key:1,class:"text-muted"};function Jm(e,a,t,l,s,o){const n=(0,r.g2)("el-tag"),i=(0,r.g2)("el-button"),d=(0,r.g2)("el-input"),c=(0,r.g2)("el-col"),u=(0,r.g2)("el-option"),p=(0,r.g2)("el-select"),m=(0,r.g2)("Download"),g=(0,r.g2)("el-icon"),v=(0,r.g2)("el-row"),h=(0,r.g2)("el-table-column"),k=(0,r.g2)("Setting"),b=(0,r.g2)("CircleCheck"),f=(0,r.g2)("CircleClose"),y=(0,r.g2)("el-progress"),_=(0,r.g2)("el-table"),w=(0,r.g2)("el-descriptions-item"),L=(0,r.g2)("el-descriptions"),F=(0,r.g2)("el-dialog"),C=(0,r.gN)("loading");return(0,r.uX)(),(0,r.Wv)(F,{title:"TCP端口监控",visible:o.dialogVisible,"onUpdate:visible":a[5]||(a[5]=e=>o.dialogVisible=e),width:"60%",top:"8vh",onClose:o.handleClose,"custom-class":"tcp-port-monitor-dialog",modal:!0,"append-to-body":!0},{default:(0,r.k6)(()=>[(0,r.Lk)("div",zm,[(0,r.Lk)("div",Nm,[(0,r.Lk)("span",Km,(0,x.v_)(s.portData.hostName||"未知主机"),1),(0,r.Lk)("span",Um,"最后更新: "+(0,x.v_)(o.formatTime(s.portData.updateTime)),1),(0,r.Lk)("div",Xm,[(0,r.bF)(n,{type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)("总端口数: "+(0,x.v_)(s.portData.total||0),1)]),_:1}),(0,r.bF)(n,{type:"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)("监听中: "+(0,x.v_)(o.listeningPortsCount),1)]),_:1})])]),(0,r.bF)(i,{type:"primary",size:"mini",icon:"Refresh",loading:s.loading,onClick:o.fetchPortData},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.eW)(" 手动刷新 ",-1)])),_:1,__:[6]},8,["loading","onClick"])]),(0,r.Lk)("div",qm,[(0,r.bF)(v,{gutter:12},{default:(0,r.k6)(()=>[(0,r.bF)(c,{span:5},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.searchPort,"onUpdate:modelValue":a[0]||(a[0]=e=>s.searchPort=e),placeholder:"端口号",clearable:"","prefix-icon":"Search",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{span:5},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.searchService,"onUpdate:modelValue":a[1]||(a[1]=e=>s.searchService=e),placeholder:"服务名",clearable:"","prefix-icon":"Search",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{span:4},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.statusFilter,"onUpdate:modelValue":a[2]||(a[2]=e=>s.statusFilter=e),placeholder:"状态",clearable:"",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"全部",value:""}),(0,r.bF)(u,{label:"监听中",value:1}),(0,r.bF)(u,{label:"未监听",value:0})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,{span:5},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.resourceFilter,"onUpdate:modelValue":a[3]||(a[3]=e=>s.resourceFilter=e),placeholder:"资源筛选",clearable:"",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"全部",value:""}),(0,r.bF)(u,{label:"高CPU (>5%)",value:"high-cpu"}),(0,r.bF)(u,{label:"高内存 (>5%)",value:"high-mem"}),(0,r.bF)(u,{label:"高负载",value:"high-load"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,{span:5},{default:(0,r.k6)(()=>[(0,r.bF)(i,{type:"primary",size:"small",onClick:o.exportPorts},{default:(0,r.k6)(()=>[(0,r.bF)(g,null,{default:(0,r.k6)(()=>[(0,r.bF)(m)]),_:1}),a[7]||(a[7]=(0,r.eW)(" 导出 ",-1))]),_:1,__:[7]},8,["onClick"])]),_:1})]),_:1})]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(_,{data:o.filteredPorts,stripe:"",border:"",height:"450",class:"port-table",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{label:"端口",prop:"port",sortable:"",width:"100",align:"center"},{default:(0,r.k6)(e=>[(0,r.bF)(n,{type:1===e.row.status?"success":"info",size:"mini"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.port),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(h,{label:"PID",prop:"pid",sortable:"",width:"110",align:"center"},{default:(0,r.k6)(e=>[(0,r.Lk)("span",Hm,(0,x.v_)(e.row.pid),1)]),_:1}),(0,r.bF)(h,{label:"服务名称",prop:"service","show-overflow-tooltip":"",width:"180"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Bm,[(0,r.bF)(g,{size:"12"},{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),(0,r.Lk)("span",jm,(0,x.v_)(e.row.service||"未知"),1)])]),_:1}),(0,r.bF)(h,{label:"状态",prop:"status",width:"110",align:"center"},{default:(0,r.k6)(e=>[(0,r.bF)(n,{type:1===e.row.status?"success":"danger",size:"mini"},{default:(0,r.k6)(()=>[1===e.row.status?((0,r.uX)(),(0,r.Wv)(g,{key:0,size:"10"},{default:(0,r.k6)(()=>[(0,r.bF)(b)]),_:1})):((0,r.uX)(),(0,r.Wv)(g,{key:1,size:"10"},{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1})),(0,r.eW)(" "+(0,x.v_)(1===e.row.status?"监听":"停止"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(h,{label:"CPU%",prop:"cpuUsage",sortable:"",width:"130",align:"center"},{default:(0,r.k6)(e=>[void 0!==e.row.cpuUsage&&null!==e.row.cpuUsage?((0,r.uX)(),(0,r.CE)("div",Om,[(0,r.bF)(y,{percentage:Math.min(parseFloat(e.row.cpuUsage.toFixed(2)),100),color:o.getUsageColor(e.row.cpuUsage),"stroke-width":4,"show-text":!0,format:()=>`${e.row.cpuUsage.toFixed(1)}%`},null,8,["percentage","color","format"])])):((0,r.uX)(),(0,r.CE)("span",Qm,"-"))]),_:1}),(0,r.bF)(h,{label:"内存%",prop:"memUsage",sortable:"",width:"130",align:"center"},{default:(0,r.k6)(e=>[void 0!==e.row.memUsage&&null!==e.row.memUsage?((0,r.uX)(),(0,r.CE)("div",Gm,[(0,r.bF)(y,{percentage:Math.min(parseFloat(e.row.memUsage.toFixed(2)),100),color:o.getUsageColor(e.row.memUsage),"stroke-width":4,"show-text":!0,format:()=>`${e.row.memUsage.toFixed(1)}%`},null,8,["percentage","color","format"])])):((0,r.uX)(),(0,r.CE)("span",Ym,"-"))]),_:1}),(0,r.bF)(h,{label:"协议",width:"80",align:"center"},{default:(0,r.k6)(e=>[(0,r.bF)(n,{type:"info",size:"mini"},{default:(0,r.k6)(()=>a[8]||(a[8]=[(0,r.eW)("TCP",-1)])),_:1,__:[8]})]),_:1}),(0,r.bF)(h,{label:"操作","min-width":"90",align:"center"},{default:(0,r.k6)(e=>[(0,r.bF)(i,{type:"primary",size:"mini",icon:"InfoFilled",circle:"",onClick:a=>o.showPortDetails(e.row),title:"查看详情"},null,8,["onClick"])]),_:1})]),_:1},8,["data"])),[[C,s.loading]]),(0,r.bF)(F,{title:"端口详情",modelValue:s.showDetailDialog,"onUpdate:modelValue":a[4]||(a[4]=e=>s.showDetailDialog=e),width:"50%","append-to-body":""},{default:(0,r.k6)(()=>[s.selectedPort?((0,r.uX)(),(0,r.Wv)(L,{key:0,column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(w,{label:"端口号"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{type:1===s.selectedPort.status?"success":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.selectedPort.port),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(w,{label:"进程ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.selectedPort.pid),1)]),_:1}),(0,r.bF)(w,{label:"服务名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.selectedPort.service||"未知服务"),1)]),_:1}),(0,r.bF)(w,{label:"监听状态"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{type:1===s.selectedPort.status?"success":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(1===s.selectedPort.status?"监听中":"未监听"),1)]),_:1},8,["type"])]),_:1}),void 0!==s.selectedPort.cpuUsage?((0,r.uX)(),(0,r.Wv)(w,{key:0,label:"CPU使用率"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{percentage:Math.min(parseFloat(s.selectedPort.cpuUsage.toFixed(2)),100),color:o.getUsageColor(s.selectedPort.cpuUsage),"stroke-width":8,"show-text":!0,format:()=>`${s.selectedPort.cpuUsage.toFixed(2)}%`},null,8,["percentage","color","format"])]),_:1})):(0,r.Q3)("",!0),void 0!==s.selectedPort.memUsage?((0,r.uX)(),(0,r.Wv)(w,{key:1,label:"内存使用率"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{percentage:Math.min(parseFloat(s.selectedPort.memUsage.toFixed(2)),100),color:o.getUsageColor(s.selectedPort.memUsage),"stroke-width":8,"show-text":!0,format:()=>`${s.selectedPort.memUsage.toFixed(2)}%`},null,8,["percentage","color","format"])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(w,{label:"协议类型"},{default:(0,r.k6)(()=>a[9]||(a[9]=[(0,r.eW)("TCP",-1)])),_:1,__:[9]}),(0,r.bF)(w,{label:"最后更新"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o.formatTime(s.portData.updateTime)),1)]),_:1})]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["modelValue"])]),_:1},8,["visible","onClose"])}var Zm={name:"TcpPortMonitorDialog",model:{prop:"visible",event:"change"},props:{visible:{type:Boolean,default:!1},hostId:{type:[String,Number],required:!0}},data(){return{loading:!1,portData:{},refreshInterval:null,searchPort:"",searchService:"",statusFilter:"",resourceFilter:"",showDetailDialog:!1,selectedPort:null}},computed:{dialogVisible:{get(){return this.visible},set(e){this.$emit("change",e)}},listeningPortsCount(){return this.portData.ports?this.portData.ports.filter(e=>1===e.status).length:0},filteredPorts(){if(!this.portData.ports)return[];let e=this.portData.ports;return this.searchPort&&(e=e.filter(e=>e.port.toString().includes(this.searchPort))),this.searchService&&(e=e.filter(e=>(e.service||"").toLowerCase().includes(this.searchService.toLowerCase()))),""!==this.statusFilter&&(e=e.filter(e=>e.status===this.statusFilter)),this.resourceFilter&&(e=e.filter(e=>{const a=e.cpuUsage||0,t=e.memUsage||0;switch(this.resourceFilter){case"high-cpu":return a>5;case"high-mem":return t>5;case"high-load":return a>5||t>5;default:return!0}})),e}},watch:{visible(e){e?this.startMonitoring():this.stopMonitoring()},hostId(e){e&&this.visible&&this.startMonitoring()}},methods:{async fetchPortData(){if(this.hostId){this.loading=!0;try{const{data:e}=await this.$api.getHostTcpPorts(this.hostId);200===e.code?this.portData=e.data:this.$message.error(e.message||"获取端口数据失败")}catch(e){console.error("获取端口数据失败:",e),this.$message.error("获取端口数据失败")}finally{this.loading=!1}}},formatTime(e){if(!e)return"未知时间";const a=new Date(1e3*e);return a.toLocaleString()},startMonitoring(){this.hostId?(this.stopMonitoring(),this.fetchPortData(),this.refreshInterval=setInterval(()=>{this.fetchPortData()},6e4)):console.error("hostId 未设置，无法加载数据")},stopMonitoring(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)},handleClose(){this.stopMonitoring(),this.dialogVisible=!1,this.resetFilters()},resetFilters(){this.searchPort="",this.searchService="",this.statusFilter="",this.resourceFilter=""},showPortDetails(e){this.selectedPort=e,this.showDetailDialog=!0},getUsageColor(e){return e?e>80?"#F56C6C":e>60?"#E6A23C":"#67C23A":"#909399"},exportPorts(){if(!this.filteredPorts||0===this.filteredPorts.length)return void this.$message.warning("没有数据可导出");const e=["端口号","进程ID","服务名称","监听状态","CPU使用率(%)","内存使用率(%)","协议类型"],a=[e.join(","),...this.filteredPorts.map(e=>[e.port,e.pid,`"${e.service||"未知服务"}"`,1===e.status?"监听中":"未监听",void 0!==e.cpuUsage?e.cpuUsage.toFixed(2):"-",void 0!==e.memUsage?e.memUsage.toFixed(2):"-","TCP"].join(","))].join("\n"),t=new Blob(["\ufeff"+a],{type:"text/csv;charset=utf-8;"}),l=`${this.portData.hostName||"unknown"}_tcp_ports_${(new Date).toISOString().slice(0,10)}.csv`,s=document.createElement("a"),o=URL.createObjectURL(t);s.setAttribute("href",o),s.setAttribute("download",l),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s),this.$message.success("数据导出成功")}},mounted(){this.hostId&&this.$nextTick(()=>{setTimeout(()=>{this.startMonitoring()},100)})},beforeUnmount(){this.stopMonitoring()}};const eg=(0,p.A)(Zm,[["render",Jm],["__scopeId","data-v-ff3f6024"]]);var ag=eg,tg={name:"CmdbHostTable",components:{MonitorDialog:Vm,ProcessMonitorDialog:Wm,TcpPortMonitorDialog:ag},props:{hostList:{type:Array,required:!0},loading:{type:Boolean,default:!1}},data(){return{monitorData:{},refreshInterval:null,refreshRate:1e4,showMonitorDialog:!1,currentHostId:"",showProcessDialog:!1,currentProcessHostId:"",showTcpPortDialog:!1,currentTcpPortHostId:"",isFirstOpen:!0}},watch:{hostList:{immediate:!0,deep:!0,handler(e){e&&e.length>0&&(this.stopRefresh(),this.fetchMonitorData(),this.startRefresh())}}},computed:{hostListWithMonitor(){const e=this.hostList.map(e=>{const a=this.monitorData[e.id]||{},t={...e,cpuUsage:a.cpuUsage,memoryUsage:a.memoryUsage,diskUsage:a.diskUsage,isAlive:0===a.onlineStatus};return t});return e}},methods:{getStatusText(e){const a={1:"认证成功",2:"未认证",3:"认证失败"};return a[e]||"未知状态"},getStatusTagType(e){const a={1:"success",2:"warning",3:"danger"};return a[e]||"info"},getUsageColor(e){return e?e>80?"#F56C6C":e>60?"#E6A23C":"#67C23A":"#909399"},async fetchMonitorData(){if(!this.hostList||0===this.hostList.length)return;const e=this.hostList.filter(e=>e?.id);if(0===e.length)return;const a=e.map(e=>e.id).join(","),t=await this.$api.getHostsMonitorData(a);200===t.data.code&&(this.monitorData={...this.monitorData,...t.data.data})},startRefresh(){this.fetchMonitorData(),this.refreshInterval=setInterval(()=>{this.fetchMonitorData()},this.refreshRate)},stopRefresh(){this.refreshInterval&&(clearInterval(this.refreshInterval),this.refreshInterval=null)},showMonitor(e){this.currentHostId=e.id,this.showMonitorDialog=!0,this.isFirstOpen=!0},showProcessMonitor(e){this.currentProcessHostId=e.id,this.showProcessDialog=!0},showTcpPortMonitor(e){this.currentTcpPortHostId=e.id,this.showTcpPortDialog=!0},showCopyIcon(e,a){const t=e.currentTarget.querySelectorAll(".copy-icon");t.forEach(e=>{e.style.display="inline-block"})},hideCopyIcon(e){const a=e.currentTarget.querySelectorAll(".copy-icon");a.forEach(e=>{e.style.display="none"})},async copyToClipboard(e,a,t){try{if(await navigator.clipboard.writeText(e),this.$message.success(`${a} 已复制: ${e}`),t&&t.target){const e=t.target.closest(".copy-icon");e&&(e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},1e3))}}catch(l){const o=document.createElement("textarea");o.value=e,document.body.appendChild(o),o.focus(),o.select();try{if(document.execCommand("copy"),this.$message.success(`${a} 已复制: ${e}`),t&&t.target){const e=t.target.closest(".copy-icon");e&&(e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},1e3))}}catch(s){this.$message.error("复制失败，请手动复制")}document.body.removeChild(o)}}},mounted(){this.hostList&&this.hostList.length>0&&this.fetchMonitorData(),this.startRefresh()},beforeUnmount(){this.stopRefresh()},beforeRouteEnter(e,a,t){t(e=>{e.stopRefresh(),e.fetchMonitorData(),e.startRefresh()})},beforeRouteUpdate(e,a,t){this.stopRefresh(),this.fetchMonitorData(),this.startRefresh(),t()},activated(){this.stopRefresh(),this.fetchMonitorData(),this.startRefresh()}};const lg=(0,p.A)(tg,[["render",um],["__scopeId","data-v-8a8b3024"]]);var sg=lg;const og={class:"group-option-content"},ng={style:{display:"flex","align-items":"center"}},ig={style:{display:"flex","align-items":"center",gap:"8px"}},rg={slot:"footer",class:"dialog-footer"},dg={slot:"footer",class:"dialog-footer"};function cg(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),i=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-col"),c=(0,r.g2)("el-tag"),u=(0,r.g2)("el-option"),p=(0,r.g2)("el-select"),m=(0,r.g2)("el-row"),g=(0,r.g2)("el-button"),v=(0,r.g2)("el-form"),h=(0,r.g2)("el-radio"),k=(0,r.g2)("el-radio-group"),b=(0,r.g2)("el-alert"),f=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(f,{title:"新增主机",modelValue:s.dialogVisible,"onUpdate:modelValue":a[17]||(a[17]=e=>s.dialogVisible=e),width:"40%",onClose:o.handleClose},{default:(0,r.k6)(()=>[(0,r.bF)(v,{model:s.form,rules:s.rules,ref:"formRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"主机名称",prop:"hostName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.form.hostName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.hostName=e),placeholder:"请输入主机名称"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"所属分组",prop:"groupId"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.form.groupId,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.groupId=e),placeholder:"请选择分组",style:{width:"100%"},clearable:"",filterable:"",onChange:o.handleGroupChange},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.selectableGroups,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.displayName,value:e.id,class:(0,x.C4)(e.isBusinessGroup?"business-group-option":"sub-group-option")},{default:(0,r.k6)(()=>[(0,r.Lk)("div",og,[(0,r.Lk)("span",{class:(0,x.C4)(e.isBusinessGroup?"business-group-text":"sub-group-text")},(0,x.v_)(e.displayName),3),e.isBusinessGroup?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"success",size:"small",class:"business-tag"},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)(" 默认 ",-1)])),_:1,__:[18]})):(0,r.Q3)("",!0)])]),_:2},1032,["label","value","class"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"SSH连接",prop:"sshConnection"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ng,[(0,r.bF)(n,{modelValue:s.form.username,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.username=e),placeholder:"用户名",style:{width:"120px","margin-right":"8px"}},null,8,["modelValue"]),a[19]||(a[19]=(0,r.Lk)("span",{style:{margin:"0 4px"}},"@",-1)),(0,r.bF)(n,{modelValue:s.form.ip,"onUpdate:modelValue":a[3]||(a[3]=e=>s.form.ip=e),placeholder:"IP地址",style:{width:"150px","margin-right":"8px"}},null,8,["modelValue"]),a[20]||(a[20]=(0,r.Lk)("span",{style:{margin:"0 4px"}},"-p",-1)),(0,r.bF)(n,{modelValue:s.form.port,"onUpdate:modelValue":a[4]||(a[4]=e=>s.form.port=e),placeholder:"端口",style:{width:"50px"}},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"认证凭据",prop:"authId"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ig,[(0,r.bF)(p,{modelValue:s.form.authId,"onUpdate:modelValue":a[5]||(a[5]=e=>s.form.authId=e),placeholder:"请选择认证凭据",style:{flex:"1"},filterable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.authList,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,r.bF)(g,{type:"warning",icon:"Plus",size:"default",class:"create-credential-btn",onClick:o.showCreateCredentialDialog},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)(" 创建凭据 ",-1)])),_:1,__:[21]},8,["onClick"])])]),_:1})]),_:1})]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"备注",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.form.remark,"onUpdate:modelValue":a[6]||(a[6]=e=>s.form.remark=e),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.Lk)("span",rg,[(0,r.bF)(g,{type:"primary",onClick:o.submitForm},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("确 定",-1)])),_:1,__:[22]},8,["onClick"]),(0,r.bF)(g,{onClick:a[7]||(a[7]=e=>s.dialogVisible=!1)},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)("取 消",-1)])),_:1,__:[23]})])]),_:1},8,["model","rules"]),(0,r.bF)(f,{title:"创建凭据",modelValue:s.credentialDialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>s.credentialDialogVisible=e),width:"50%",modal:!1,onClose:o.handleCredentialDialogClose},{default:(0,r.k6)(()=>[(0,r.bF)(v,{model:s.credentialForm,rules:s.credentialRules,ref:"credentialFormRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"凭据名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.credentialForm.name,"onUpdate:modelValue":a[8]||(a[8]=e=>s.credentialForm.name=e),placeholder:"请输入凭据名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"用户名",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.credentialForm.username,"onUpdate:modelValue":a[9]||(a[9]=e=>s.credentialForm.username=e),placeholder:"请输入用户名"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"端口",prop:"port"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.credentialForm.port,"onUpdate:modelValue":a[10]||(a[10]=e=>s.credentialForm.port=e),modelModifiers:{number:!0},type:"number",min:1,max:65535,placeholder:"请输入端口"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(i,{label:"认证类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{modelValue:s.credentialForm.type,"onUpdate:modelValue":a[11]||(a[11]=e=>s.credentialForm.type=e)},{default:(0,r.k6)(()=>[(0,r.bF)(h,{label:1},{default:(0,r.k6)(()=>a[24]||(a[24]=[(0,r.eW)("密码认证",-1)])),_:1,__:[24]}),(0,r.bF)(h,{label:2},{default:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)("密钥认证",-1)])),_:1,__:[25]}),(0,r.bF)(h,{label:3},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("公钥认证",-1)])),_:1,__:[26]})]),_:1},8,["modelValue"])]),_:1}),3===s.credentialForm.type?((0,r.uX)(),(0,r.Wv)(i,{key:0,label:"配置说明"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{title:"公钥认证配置说明",type:"info",closable:!1,"show-icon":""},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.Lk)("div",{style:{"line-height":"1.6","margin-top":"8px"}},[(0,r.Lk)("ol",{style:{margin:"0","padding-left":"20px"}},[(0,r.Lk)("li",null,[(0,r.eW)("复制DevOps服务器的公钥: "),(0,r.Lk)("code",{style:{background:"#f5f5f5",padding:"2px 4px","border-radius":"3px"}},"cat ~/.ssh/id_rsa.pub")]),(0,r.Lk)("li",null,[(0,r.eW)("将公钥添加到目标主机: "),(0,r.Lk)("code",{style:{background:"#f5f5f5",padding:"2px 4px","border-radius":"3px"}},'echo "公钥内容" >> /root/.ssh/authorized_keys')])]),(0,r.Lk)("p",{style:{margin:"12px 0 0 0",color:"#909399","font-size":"13px"}}," 💡 提示:公钥认证无需存储密码或密钥，系统会自动使用DevOps服务器的私钥进行认证。 ")],-1)])),_:1})]),_:1})):(0,r.Q3)("",!0),1===s.credentialForm.type?((0,r.uX)(),(0,r.Wv)(i,{key:1,label:"密码",prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.credentialForm.password,"onUpdate:modelValue":a[12]||(a[12]=e=>s.credentialForm.password=e),"show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})):(0,r.Q3)("",!0),2===s.credentialForm.type?((0,r.uX)(),(0,r.Wv)(i,{key:2,label:"配置说明"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{title:"密钥认证配置说明",type:"warning",closable:!1,"show-icon":""},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.Lk)("div",{style:{"line-height":"1.6","margin-top":"8px"}},[(0,r.Lk)("p",{style:{margin:"0 0 8px 0","font-weight":"600"}},"请按以下步骤配置密钥认证："),(0,r.Lk)("ol",{style:{margin:"0","padding-left":"20px"}},[(0,r.Lk)("li",null,[(0,r.eW)("在目标主机执行: "),(0,r.Lk)("code",{style:{background:"#f5f5f5",padding:"2px 4px","border-radius":"3px"}},"cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys")]),(0,r.Lk)("li",null,"复制目标主机的私钥内容到下方文本框"),(0,r.Lk)("li",null,"私钥格式应包含完整的BEGIN和END标记")]),(0,r.Lk)("p",{style:{margin:"12px 0 0 0",color:"#909399","font-size":"13px"}}," 💡 提示：密钥认证需要预先在目标主机配置公钥，然后上传对应的私钥内容。 ")],-1)])),_:1})]),_:1})):(0,r.Q3)("",!0),2===s.credentialForm.type?((0,r.uX)(),(0,r.Wv)(i,{key:3,label:"私钥内容",prop:"publicKey"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.credentialForm.publicKey,"onUpdate:modelValue":a[13]||(a[13]=e=>s.credentialForm.publicKey=e),type:"textarea",rows:8,placeholder:"请输入SSH私钥内容，格式如下：\n-----BEGIN OPENSSH PRIVATE KEY-----\nxxxxxxxxxxx\n-----END OPENSSH PRIVATE KEY-----"},null,8,["modelValue"])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(i,{label:"备注",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.credentialForm.remark,"onUpdate:modelValue":a[14]||(a[14]=e=>s.credentialForm.remark=e),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),(0,r.Lk)("span",dg,[(0,r.bF)(g,{type:"primary",onClick:o.submitCredentialForm},{default:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)("确 定",-1)])),_:1,__:[29]},8,["onClick"]),(0,r.bF)(g,{onClick:a[15]||(a[15]=e=>s.credentialDialogVisible=!1)},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("取 消",-1)])),_:1,__:[30]})])]),_:1},8,["modelValue","onClose"])]),_:1},8,["modelValue","onClose"])}var ug={name:"CreateHost",props:{visible:{type:Boolean,default:!1},groupList:{type:Array,required:!0},authList:{type:Array,required:!0}},data(){return{dialogVisible:this.visible,credentialDialogVisible:!1,form:{hostName:"",ip:"",port:22,username:"",authId:"",groupId:"",remark:""},credentialForm:{name:"",type:void 0,username:"",password:"",publicKey:"",port:"",remark:""},rules:{hostName:[{required:!0,message:"请输入主机名称",trigger:"blur"}],ip:[{required:!0,message:"请输入IP地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}],username:[{required:!0,message:"请输入连接用户名",trigger:"blur"}],authId:[{required:!0,message:"请选择认证凭据",trigger:"change"}],groupId:[{required:!0,message:"请选择所属分组",trigger:"change"}]},credentialRules:{name:[{required:!0,message:"请输入凭据名称",trigger:"blur"}],type:[{required:!0,message:"请选择认证类型",trigger:"change"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur",validator:(e,a,t)=>{1!==this.credentialForm.type||a?t():t(new Error("请输入密码"))}}],publicKey:[{required:!0,message:"请输入公钥",trigger:"blur",validator:(e,a,t)=>{2!==this.credentialForm.type||a?t():t(new Error("请输入公钥"))}}],port:[{required:!0,message:"请输入端口号",trigger:"blur",validator:(e,a,t)=>{a?isNaN(a)||a<1||a>65535?t(new Error("请输入1-65535之间的有效端口号")):t():t(new Error("请输入端口号"))}}]}}},computed:{selectableGroups(){const e=[],a=(a,t="")=>{a.forEach(a=>{("业务组"===a.name||a.isDefault)&&e.push({id:a.id,name:a.name,displayName:a.name,isBusinessGroup:!0}),a.children&&a.children.length>0&&a.children.forEach(t=>{t.children&&0!==t.children.length||e.push({id:t.id,name:t.name,displayName:t.name,parentName:a.name,isBusinessGroup:!1})})})};return a(this.groupList),e}},watch:{visible(e){this.dialogVisible=e}},methods:{handleClose(){this.$refs.formRef.resetFields(),this.$emit("close")},handleGroupChange(e){if(e)this.form.groupId=e;else{const e=this.selectableGroups.find(e=>e.isBusinessGroup);e&&(this.form.groupId=e.id)}},showCreateCredentialDialog(){this.credentialForm={name:"",type:void 0,username:"",password:"",publicKey:"",port:"",remark:""},this.credentialDialogVisible=!0},handleCredentialDialogClose(){this.$refs.credentialFormRef?.resetFields()},async submitCredentialForm(){try{await this.$refs.credentialFormRef.validate();const e=Number(this.credentialForm.type);if(1!==e&&2!==e&&3!==e)throw new Error("请选择有效的认证类型");const a={id:"",name:this.credentialForm.name,type:e,username:this.credentialForm.username,password:this.credentialForm.password||"",publicKey:this.credentialForm.publicKey||"",port:this.credentialForm.port,remark:this.credentialForm.remark||""};console.log("Creating credential with data:",a);const t=await Uu.createEcsAuth(a);if(200===t.data.code){this.$message.success("创建凭据成功"),this.credentialDialogVisible=!1,this.$emit("refresh-auth-list");const e=t.data.data;e&&e.id&&(this.form.authId=e.id)}else this.$message.error(t.data.message||"创建凭据失败")}catch(e){console.error("创建凭据失败:",e),this.$message.error("创建凭据失败: "+(e.response?.data?.message||e.message))}},async submitForm(){try{await this.$refs.formRef.validate();const e=this.authList.some(e=>e.id===this.form.authId);if(!e)return this.$message.error("选择的认证凭据不存在，请刷新凭据列表后重试");const a={groupId:this.form.groupId,hostName:this.form.hostName,remark:this.form.remark,sshIp:this.form.ip,sshKeyId:this.form.authId,sshName:this.form.username,sshPort:this.form.port};this.$emit("submit",a)}catch(e){console.error("表单验证失败:",e)}}}};const pg=(0,p.A)(ug,[["render",cg],["__scopeId","data-v-03197938"]]);var mg=pg;const gg={class:"group-option-content"},vg={style:{display:"flex","align-items":"center"}},hg={style:{display:"flex","align-items":"center",gap:"8px"}},kg={slot:"footer",class:"dialog-footer"};function bg(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),i=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-col"),c=(0,r.g2)("el-tag"),u=(0,r.g2)("el-option"),p=(0,r.g2)("el-select"),m=(0,r.g2)("el-row"),g=(0,r.g2)("OfficeBuilding"),v=(0,r.g2)("el-icon"),h=(0,r.g2)("el-button"),k=(0,r.g2)("el-form"),b=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(b,{title:"编辑主机",modelValue:s.dialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>s.dialogVisible=e),width:"40%",onClose:o.handleClose},{default:(0,r.k6)(()=>[(0,r.bF)(k,{model:s.form,rules:s.rules,ref:"formRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"主机名称",prop:"hostName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.form.hostName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.form.hostName=e),placeholder:"请输入主机名称"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"所属分组",prop:"groupId"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.form.groupId,"onUpdate:modelValue":a[1]||(a[1]=e=>s.form.groupId=e),placeholder:"请选择分组",style:{width:"100%"},clearable:"",filterable:"",onChange:o.handleGroupChange},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.selectableGroups,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.displayName,value:e.id,class:(0,x.C4)(e.isBusinessGroup?"business-group-option":"sub-group-option")},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gg,[(0,r.Lk)("span",{class:(0,x.C4)(e.isBusinessGroup?"business-group-text":"sub-group-text")},(0,x.v_)(e.displayName),3),e.isBusinessGroup?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:"success",size:"small",class:"business-tag"},{default:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.eW)(" 默认 ",-1)])),_:1,__:[10]})):(0,r.Q3)("",!0)])]),_:2},1032,["label","value","class"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"SSH连接",prop:"sshConnection"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",vg,[(0,r.bF)(n,{modelValue:s.form.username,"onUpdate:modelValue":a[2]||(a[2]=e=>s.form.username=e),placeholder:"用户名",style:{width:"120px","margin-right":"8px"}},null,8,["modelValue"]),a[11]||(a[11]=(0,r.Lk)("span",{style:{margin:"0 4px"}},"@",-1)),(0,r.bF)(n,{modelValue:s.form.ip,"onUpdate:modelValue":a[3]||(a[3]=e=>s.form.ip=e),placeholder:"IP地址",style:{width:"150px","margin-right":"8px"}},null,8,["modelValue"]),a[12]||(a[12]=(0,r.Lk)("span",{style:{margin:"0 4px"}},"-p",-1)),(0,r.bF)(n,{modelValue:s.form.port,"onUpdate:modelValue":a[4]||(a[4]=e=>s.form.port=e),placeholder:"端口",style:{width:"100px"}},null,8,["modelValue"])])]),_:1})]),_:1})]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"认证凭据",prop:"authId"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.form.authId,"onUpdate:modelValue":a[5]||(a[5]=e=>s.form.authId=e),placeholder:"请选择认证凭据",style:{width:"100%"},filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(t.authList,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(d,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"主机类型",prop:"vendor"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:s.form.vendor,"onUpdate:modelValue":a[6]||(a[6]=e=>s.form.vendor=e),placeholder:"请选择主机类型",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(u,{value:1,label:"自建主机"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",hg,[(0,r.bF)(v,{size:18,color:"#409EFF"},{default:(0,r.k6)(()=>[(0,r.bF)(g)]),_:1}),a[13]||(a[13]=(0,r.Lk)("span",null,"自建主机",-1))])]),_:1}),(0,r.bF)(u,{value:2,label:"阿里云"},{default:(0,r.k6)(()=>a[14]||(a[14]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:Xu,style:{width:"18px",height:"18px"}}),(0,r.Lk)("span",null,"阿里云")],-1)])),_:1,__:[14]}),(0,r.bF)(u,{value:3,label:"腾讯云"},{default:(0,r.k6)(()=>a[15]||(a[15]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:qu,style:{width:"18px",height:"18px"}}),(0,r.Lk)("span",null,"腾讯云")],-1)])),_:1,__:[15]}),(0,r.bF)(u,{value:4,label:"百度云"},{default:(0,r.k6)(()=>a[16]||(a[16]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:Hu,style:{width:"18px",height:"18px"}}),(0,r.Lk)("span",null,"百度云")],-1)])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{span:24},{default:(0,r.k6)(()=>[(0,r.bF)(i,{label:"备注",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.form.remark,"onUpdate:modelValue":a[7]||(a[7]=e=>s.form.remark=e),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.Lk)("span",kg,[(0,r.bF)(h,{type:"primary",onClick:o.submitForm},{default:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.eW)("确 定",-1)])),_:1,__:[17]},8,["onClick"]),(0,r.bF)(h,{onClick:a[8]||(a[8]=e=>s.dialogVisible=!1)},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)("取 消",-1)])),_:1,__:[18]})])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","onClose"])}var fg={name:"EditHost",props:{visible:{type:Boolean,default:!1},hostInfo:{type:Object,required:!0},groupList:{type:Array,required:!0},authList:{type:Array,required:!0}},data(){return{dialogVisible:this.visible,formReady:!1,form:{id:"",hostName:"",groupId:"",remark:"",ip:"",port:22,username:"",authId:"",vendor:1},rules:{hostName:[{required:!0,message:"请输入主机名称",trigger:"blur"}],ip:[{required:!0,message:"请输入IP地址",trigger:"blur"},{pattern:/^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$/,message:"请输入有效的IP地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"},{type:"number",message:"端口号必须为数字",trigger:"blur"},{min:1,max:65535,message:"端口号范围1-65535",trigger:"blur"}],username:[{required:!0,message:"请输入连接用户名",trigger:"blur"},{min:1,max:32,message:"用户名长度1-32个字符",trigger:"blur"}],authId:[{required:!0,message:"请选择认证凭据",trigger:"change"}],groupId:[{required:!0,message:"请选择所属分组",trigger:"change"}],vendor:[{required:!0,message:"请选择主机类型",trigger:"change"}]}}},computed:{selectableGroups(){const e=[],a=(a,t="")=>{a.forEach(a=>{("业务组"===a.name||a.isDefault)&&e.push({id:a.id,name:a.name,displayName:a.name,isBusinessGroup:!0}),a.children&&a.children.length>0&&a.children.forEach(t=>{t.children&&0!==t.children.length||e.push({id:t.id,name:t.name,displayName:t.name,parentName:a.name,isBusinessGroup:!1})})})};return a(this.groupList),e}},watch:{visible(e){this.dialogVisible=e,e&&this.$nextTick(()=>{this.initForm()})},hostInfo:{deep:!0,immediate:!0,handler(e){e&&(this.form={id:e.id||"",hostName:e.hostName||"",groupId:e.groupId||(this.groupList.length>0?this.groupList[0].id:""),remark:e.remark||"",ip:e.sshIp||e.ip||"",port:e.sshPort||e.port||22,username:e.sshName||e.username||"root",authId:e.sshKeyId||e.authId||(this.authList.length>0?this.authList[0].id:""),vendor:e.vendor||1})}}},mounted(){this.visible&&this.initForm()},methods:{async initForm(){await this.$nextTick(),this.formReady=!!this.$refs.formRef,this.formReady||console.error("表单初始化失败",{refs:this.$refs,formRef:this.$refs.formRef})},handleClose(){this.formReady&&this.$refs.formRef.resetFields(),this.$emit("close")},handleGroupChange(e){if(e)this.form.groupId=e;else{const e=this.selectableGroups.find(e=>e.isBusinessGroup);e&&(this.form.groupId=e.id)}},async submitForm(){try{return await this.$nextTick(),this.$refs.formRef&&this.$refs.formRef.validate?new Promise(e=>{this.$refs.formRef.validate(a=>{if(a){const a=this.authList.some(e=>e.id===this.form.authId);if(!a)return this.$message.error("选择的认证凭据不存在，请刷新凭据列表后重试"),e(!1);const t=Number(this.form.port);if(isNaN(t)||t<1||t>65535)return this.$message.error("端口号必须为1-65535之间的数字"),e(!1);const l={id:this.form.id,groupId:this.form.groupId,hostName:this.form.hostName,remark:this.form.remark,sshIp:this.form.ip,sshKeyId:this.form.authId,sshName:this.form.username,sshPort:t,vendor:this.form.vendor};this.$emit("submit",l),this.dialogVisible=!1,e(!0)}else this.$message.error("请填写完整的表单信息"),e(!1)})}):(console.error("表单引用无效:",this.$refs.formRef),this.$message.error("表单组件未准备好，请稍后再试"))}catch(e){return console.error("表单提交失败:",e),this.$message.error(`表单提交失败: ${e.message}`),!1}}}};const yg=(0,p.A)(fg,[["render",bg],["__scopeId","data-v-3df94a55"]]);var _g=yg,wg={components:{CreateCloud:Gu,HostSSH:vp,CreateExcel:yp,CmdbGroup:Op,CmdbHostTable:sg,CreateHost:mg,EditHost:_g},data(){return{ExcelDialogVisible:!1,commandDialog:null,expandedKeys:[],statusList:[{value:2,label:"未认证"},{value:1,label:"认证成功"},{value:3,label:"认证失败"}],loading:!1,queryParams:{pageNum:1,pageSize:10,hostName:"",ip:"",status:"",groupId:""},hostList:[],total:0,addDialogVisible:!1,editDialogVisible:!1,cloudDialogVisible:!1,groupList:[],defaultProps:{children:"children",label:"name"},currentGroupId:null,authList:[],addForm:{hostName:"",ip:"",port:22,username:"",authId:"",groupId:"",remark:""},addFormRules:{hostName:[{required:!0,message:"请输入主机名称",trigger:"blur"}],ip:[{required:!0,message:"请输入IP地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}],username:[{required:!0,message:"请输入连接用户名",trigger:"blur"}],authId:[{required:!0,message:"请选择认证凭据",trigger:"change"}],groupId:[{required:!0,message:"请选择所属分组",trigger:"change"}]},hostInfo:{},editFormRules:{hostName:[{required:!0,message:"请输入主机名称",trigger:"blur"}],ip:[{required:!0,message:"请输入IP地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur"}],username:[{required:!0,message:"请输入连接用户名",trigger:"blur"}],authId:[{required:!0,message:"请选择认证凭据",trigger:"change"}],groupId:[{required:!0,message:"请选择所属分组",trigger:"change"}]},sshDialogVisible:!1,currentHostId:null,uploadDialogVisible:!1,uploadForm:{hostId:null,file:null,targetPath:"/tmp"},currentUploadHost:null,uploadRules:{file:[{required:!0,message:"请选择上传文件",trigger:"change"}],targetPath:[{required:!0,message:"请输入目标路径",trigger:["blur","change"],validator:(e,a,t)=>{"/tmp"===a||a&&""!==a.trim()?t():t(new Error("请输入目标路径"))}}]},isUploading:!1,uploadProgress:0,detailDrawer:!1,syncLoading:!1,hostDetail:{hostName:"",groupId:"",privateIp:"",publicIp:"",sshIp:"",sshName:"",sshKeyId:"",sshPort:22,remark:"",vendor:"",region:"",instanceId:"",os:"",status:0,cpu:"",memory:"",disk:"",billingType:"",createTime:"",expireTime:"",updateTime:"",name:""}}},created(){this.getAllGroups(),this.getAuthList(),this.getHostList()},beforeRouteEnter(e,a,t){t(e=>{e.getHostList().then(()=>{e.$refs.hostTable?.fetchMonitorData()})})},beforeRouteUpdate(e,a,t){this.getHostList().then(()=>{this.$refs.hostTable?.fetchMonitorData(),t()})},methods:{async getAllGroups(){const{data:e}=await this.$api.getAllCmdbGroups();if(200===e.code){this.groupList=e.data;const a=this.groupList.find(e=>"业务组"===e.name);a&&(this.addForm.groupId=a.id)}},async handleGroupSearch(e){if(this.groupSearchText=e,this.groupSearchText)try{const{data:e}=await this.$api.getCmdbGroupByName(this.groupSearchText);if(200===e.code&&e.data){const a=this.$refs.cmdbGroup,t=a?a.$refs.groupTree:null;if(!t)return void console.error("树组件引用不存在");const l=(e,a,t=[])=>{for(const s of e){if(s.id===a)return[...t,s.id];if(s.children&&s.children.length>0){const e=l(s.children,a,[...t,s.id]);if(e)return e}}return null},s=l(this.groupList,e.data.id);s?(this.expandedKeys=s.slice(0,-1),this.$nextTick(()=>{t.setCurrentKey(e.data.id),setTimeout(()=>{},500)})):(console.warn("未找到匹配分组的路径"),this.$message.warning("未找到匹配的分组路径"))}else console.warn("未找到匹配分组")}catch(a){console.error("搜索分组失败:",a),this.$message.error("搜索分组失败: "+(a?.message||"未知错误"))}else this.expandedKeys=[]},async getAuthList(){try{const e=await Uu.getEcsAuthList({page:1,pageSize:100});if(e&&e.data){const a=e.data;200===a.code?(this.authList=Array.isArray(a.data?.list)?a.data.list:[],0===this.authList.length&&(console.warn("认证凭据列表为空"),this.$message.warning("未获取到认证凭据，请先配置凭据"))):(console.error("获取认证凭据失败:",a.message||"未知错误"),this.$message.error(`获取认证凭据失败: ${a.message||"未知错误"}`))}else console.error("无效的响应格式:",e),this.$message.error("获取认证凭据失败: 无效的响应格式")}catch(e){console.error("获取认证凭据异常:",e),this.$message.error(`获取认证凭据异常: ${e?.message||"未知错误"}`),this.authList=[{id:1,name:"默认凭据",username:"root"},{id:2,name:"测试凭据",username:"test"}],console.warn("使用模拟凭据数据:",this.authList)}},async getHostList(){this.loading=!0;try{let e;const{hostName:a,ip:t,status:l,pageNum:s,pageSize:o}=this.queryParams,n={page:s,pageSize:o,_t:Date.now()};e=!a||t||l?!t||a||l?!l||a||t?await this.$api.getCmdbHostList(n):await this.$api.GetCmdbHostsByStatus(l,n):await this.$api.GetCmdbHostsByIP(t,n):await this.$api.GetCmdbHostsByHostNameLike(a,n);const i=e?.data?e:{data:e};if(!i||"object"!==typeof i)throw new Error("API返回无效响应格式");const r=i.data;if(!r||"object"!==typeof r)throw new Error("无效的响应数据结构");if(void 0===r.code||200!==r.code)throw new Error(r.message||"获取主机列表失败");if(void 0===r.data)throw new Error("响应缺少data字段");Array.isArray(r.data)?(this.hostList=r.data,this.total=r.data.length):r.data?.list?(this.hostList=r.data.list,this.total=r.data.total,r.data.page&&(this.queryParams.pageNum=r.data.page),r.data.pageSize&&(this.queryParams.pageSize=r.data.pageSize)):(this.hostList=[],this.total=0),this.$nextTick(()=>{this.$refs.hostTable?.fetchMonitorData()})}catch(e){console.error("获取主机列表异常:",{error:e?.message||"未知错误",stack:e?.stack||"无堆栈信息",queryParams:this.queryParams}),this.$message.error(`获取主机列表失败: ${e?.message||"未知错误"}`),this.hostList=[],this.total=0}finally{this.loading=!1}},handleGroupChange(e){if(e&&e.length>0)this.addForm.groupId=e[e.length-1],this.hostInfo.groupId=e[e.length-1];else{const e=this.groupList.find(e=>e.isDefault);e&&(this.addForm.groupId=e.id,this.hostInfo.groupId=e.id)}},async getHostsByGroup(e){this.loading=!0,this.queryParams.groupId=e;try{const{data:a}=await this.$api.getCmdbHostsByGroupId(e,{page:this.queryParams.pageNum,pageSize:this.queryParams.pageSize});200===a.code&&(this.hostList=a.data||[],this.total=a.data?.length||0)}catch(a){console.error("获取主机列表失败:",a),this.hostList=[],this.total=0}finally{this.loading=!1}},handleGroupClick(e,a){let t;a&&a.data&&a.data.id?t=a.data.id:a&&a.id?t=a.id:e&&e.key&&(t=e.key),t?(this.currentGroupId=t,this.getHostsByGroup(t)):this.$message.warning("无法获取分组ID")},handleNodeExpand(e,a){this.expandedKeys.includes(a.key)||this.expandedKeys.push(a.key)},handleNodeCollapse(e,a){this.expandedKeys=this.expandedKeys.filter(e=>e!==a.key)},handleCollapseAll(){this.expandedKeys=[]},handleExpandAll(){const e=[],a=t=>{t.forEach(t=>{e.push(t.id),t.children&&t.children.length>0&&a(t.children)})};a(this.groupList),this.expandedKeys=e},handleQuery(){this.queryParams.pageNum=1,this.getHostList()},resetQuery(){this.queryParams={pageNum:1,pageSize:10,hostName:"",ip:"",status:"",groupId:""},this.currentGroupId=null,this.getHostList()},handleSizeChange(e){this.queryParams.pageSize=e,this.getHostList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getHostList()},async addHost(e){try{const{data:a}=await this.$api.createCmdbHost(e);200===a.code?(this.$message.success("新增主机成功，正在同步主机信息..."),this.addDialogVisible=!1,await this.getHostList(),setTimeout(async()=>{await this.getHostList(),this.$message.success("主机信息同步完成")},3e3)):426===a.code?(this.$message.error(`认证凭据不存在(凭据ID: ${e.sshKeyId})，请检查后重试`),await this.getAuthList()):this.$message.error(a.message||"新增主机失败")}catch(a){console.error("新增主机失败:",a),this.$message.error("新增主机失败: "+a.message)}},async showEditHostDialog(e){const{data:a}=await this.$api.getCmdbHostById(e);200===a.code&&(this.hostInfo={id:a.data.id,hostName:a.data.hostName,groupId:a.data.groupId,remark:a.data.remark,ip:a.data.sshIp,port:a.data.sshPort,username:a.data.sshName,authId:a.data.sshKeyId},this.editDialogVisible=!0)},editDialogClosed(){this.$refs.editFormRef.resetFields()},async editHost(e){try{const a=this.authList.some(a=>a.id===e.sshKeyId);if(!a)return this.$message.error("选择的认证凭据不存在，请刷新凭据列表后重试"),!1;const t=Number(e.sshPort);if(isNaN(t)||t<1||t>65535)return this.$message.error("端口号必须为1-65535之间的数字"),!1;const{data:l}=await this.$api.updateCmdbHost(e);return 200===l.code?(this.$message.success("修改主机成功"),this.editDialogVisible=!1,this.getHostList(),!0):426===l.code?(this.$message.error(`认证凭据不存在(凭据ID: ${e.sshKeyId})，请检查后重试`),await this.getAuthList(),!1):(this.$message.error(l.message||"修改主机失败"),!1)}catch(a){return console.error("修改主机失败:",a),this.$message.error("修改主机失败: "+a.message),!1}},getGroupName(e){if(!e)return"未分组";const a=(e,t)=>{for(const l of e){if(l.id===t)return l.name;if(l.children&&l.children.length>0){const e=a(l.children,t);if(e)return e}}return null};return a(this.groupList,e)||"未知分组"},async showHostDetail(e){try{const{data:a}=await this.$api.getCmdbHostById(e.id);200===a.code?(this.hostDetail=a.data,this.detailDrawer=!0):(console.error("获取主机详情失败:",a.message),this.$message.error(a.message||"获取主机详情失败"))}catch(a){console.error("获取主机详情失败:",a),this.$message.error("获取主机详情失败: "+a.message)}},handleDetailClose(){this.detailDrawer=!1},handleCloudImportSuccess(){this.cloudDialogVisible=!1,this.getHostList()},handleExcelImportSuccess(){this.getHostList()},handleHostSSH(){if(!this.hostList.length)return void this.$message.warning("请先选择主机");const e=this.hostList[0];this.$router.push({path:"/cmdb/ssh",query:{hostId:e.id}})},handleFileChange(e){this.uploadForm.file=e.raw,this.$refs.uploadFormRef.validateField("file")},handleFileRemove(){this.uploadForm.file=null,this.$refs.uploadFormRef.validateField("file")},showUploadDialog(e){this.currentUploadHost=e,this.uploadForm={hostId:e.id,file:null,targetPath:"/tmp"},this.$nextTick(()=>{this.$refs.uploadFormRef?.clearValidate("targetPath")}),this.uploadDialogVisible=!0},handleDropdownVisibleChange(e){if(console.log("下拉框显示状态变化:",e),e){const e=this.checkPermission(["cmdb:ecs:add"]);if(console.log("权限检查结果:",e),!e)return this.$message.warning("您没有新建主机的权限"),this.$nextTick(()=>{this.$refs.createDropdown?.hide()}),!1}},handleCreateClick(e){console.log("点击了新建按钮")},handleCreateCommand(e){switch(console.log("选择了下拉框选项:",e),e){case"importHost":this.addDialogVisible=!0;break;case"excelImport":this.ExcelDialogVisible=!0;break;case"cloudHost":this.cloudDialogVisible=!0;break}},checkPermission(e){return console.log("checkPermission被调用，权限列表:",e),console.log("权限检查通过"),!0},async executeCommand(e){try{this.commandDialog={visible:!0,loading:!1,command:"",output:"",status:"",hostName:e.hostName},this.currentHostId=e.id,this.$nextTick(()=>{this.commandDialog.visible=!0})}catch(a){console.error("执行命令初始化失败:",a),this.$message.error("命令执行初始化失败: "+a.message)}},async submitCommand(){if(!this.commandDialog.command)return console.warn("未输入命令"),void this.$message.warning("请输入要执行的命令");this.commandDialog.loading=!0;try{const{data:e}=await this.$api.executeHostCommand(this.currentHostId,this.commandDialog.command);e&&200===e.code?(this.commandDialog.status="执行成功",this.commandDialog.output=e.data?.output||"命令执行成功但无输出"):(console.warn("命令执行失败:",e?.message),this.commandDialog.status="执行失败",this.commandDialog.output=e?.message||"未知错误")}catch(e){console.error("API请求异常:",e),this.commandDialog.status="请求失败",this.commandDialog.output=e.message||"API请求异常"}finally{this.commandDialog.loading=!1}},async handleUpload(){try{if(await this.$refs.uploadFormRef.validate(),!this.uploadForm.file)return this.$message.warning("请选择上传文件");if(this.uploadForm.file.size>5242880)return this.$message.warning("文件大小不能超过5MB");if(this.isUploading)return this.$message.warning("已有文件正在上传，请等待完成");this.isUploading=!0,this.uploadProgress=0;const e=this.uploadForm.targetPath||"/tmp",a=new FormData;a.append("file",this.uploadForm.file),a.append("destPath",e);const t={headers:{"Content-Type":"multipart/form-data"},timeout:6e4,onUploadProgress:e=>{const a=Math.round(100*e.loaded/e.total);this.uploadProgress=a}},{data:l}=await this.$api.uploadFileToHost(this.uploadForm.hostId,a,t);200===l.code?(this.$message.success("文件上传成功"),this.uploadDialogVisible=!1,this.resetUploadForm()):this.$message.error(l.message||"文件上传失败")}catch(e){console.error("文件上传失败:",e),this.$message.error("文件上传失败: "+e.message)}finally{this.isUploading=!1}},resetUploadForm(){this.uploadForm={hostId:this.currentUploadHost?.id||null,file:null,targetPath:"/tmp"},this.uploadProgress=0,this.$nextTick(()=>{this.$refs.uploadFormRef?.clearValidate("targetPath")})},async handleHostDelete(e){const a=await this.$confirm('是否确认删除主机"'+e.hostName+'"?',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await this.$api.deleteCmdbHost(e.id);200===t.code&&(this.$message.success("删除成功"),this.getHostList())},async handleHostSync(){try{if(!this.hostDetail||!this.hostDetail.id)return void this.$message.warning("请先选择要同步的主机");this.syncLoading=!0;const{data:e}=await this.$api.syncHostConfig(this.hostDetail.id);200===e.code?(this.$message.success(e.data?.message||"开始同步主机信息，请稍后查看结果"),setTimeout(()=>{this.getHostList(),this.detailDrawer&&this.hostDetail.id&&this.showHostDetail({id:this.hostDetail.id})},3e3)):this.$message.error(e.message||"同步失败")}catch(e){console.error("同步主机配置失败:",e),this.$message.error("同步失败: "+(e.message||"未知错误"))}finally{this.syncLoading=!1}},async handleCreateGroup(e){try{console.log("创建分组数据:",e);const{data:a}=await ue.createCmdbGroup(e);200===a.code?(this.$message.success("创建分组成功"),await this.getAllGroups()):this.$message.error(a.message||"创建分组失败")}catch(a){console.error("创建分组失败:",a),this.$message.error("创建分组失败: "+(a.response?.data?.message||a.message))}},async handleUpdateGroup(e){try{console.log("更新分组数据:",e);const{data:a}=await ue.updateCmdbGroup(e);200===a.code?(this.$message.success("更新分组成功"),await this.getAllGroups()):this.$message.error(a.message||"更新分组失败")}catch(a){console.error("更新分组失败:",a),this.$message.error("更新分组失败: "+(a.response?.data?.message||a.message))}},async handleDeleteGroup(e){try{console.log("删除分组ID:",e);const{data:a}=await ue.deleteCmdbGroup(e);200===a.code?(this.$message.success("删除分组成功"),await this.getAllGroups(),this.currentGroupId===e&&(this.currentGroupId=null,this.getHostList())):this.$message.error(a.message||"删除分组失败")}catch(a){console.error("删除分组失败:",a),this.$message.error("删除分组失败: "+(a.response?.data?.message||a.message))}}}};const Lg=(0,p.A)(wg,[["render",Ku],["__scopeId","data-v-04ac4df5"]]);var Fg=Lg;const Cg={class:"cmdb-group-management"},Vg={class:"search-section"},xg={class:"table-section"},Sg={class:"time-cell"},Ig={key:0,class:"operation-buttons"},Ag={key:1,class:"default-group-tag"},Rg={slot:"footer",class:"dialog-footer"},Dg={slot:"footer",class:"dialog-footer"};function Pg(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-button"),u=(0,r.g2)("el-form"),p=(0,r.g2)("el-card"),m=(0,r.g2)("el-icon"),g=(0,r.g2)("el-tag"),v=(0,r.g2)("el-table-column"),h=(0,r.g2)("Clock"),k=(0,r.g2)("Edit"),b=(0,r.g2)("el-tooltip"),f=(0,r.g2)("Delete"),y=(0,r.g2)("el-table"),_=(0,r.g2)("el-tree-select"),w=(0,r.g2)("el-dialog"),L=(0,r.gN)("authority"),F=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Cg,[(0,r.bF)(p,{shadow:"hover",class:"header-card"},{header:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"分组管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",Vg,[(0,r.bF)(u,{inline:!0,model:s.queryParams,ref:"queryForm",class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"分组名称",prop:"groupName"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.queryParams.groupName,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.groupName=e),placeholder:"请输入分组名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(c,{type:"primary",icon:e.Search,size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>a[11]||(a[11]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[11]},8,["icon","onClick"]),(0,r.bF)(c,{icon:e.Refresh,size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>a[12]||(a[12]=[(0,r.eW)(" 重置 ",-1)])),_:1,__:[12]},8,["icon","onClick"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(c,{type:"success",icon:e.Plus,size:"small",onClick:a[1]||(a[1]=e=>s.addGroupDialogVisible=!0)},{default:(0,r.k6)(()=>a[13]||(a[13]=[(0,r.eW)(" 创建分组 ",-1)])),_:1,__:[13]},8,["icon"])),[[L,["cmdb:group:add"]]]),(0,r.bF)(c,{type:"info",icon:e.Sort,size:"small",onClick:o.toggleExpandAll},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.isExpandAll?"折叠":"展开"),1)]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["model"])])]),_:1}),(0,r.bF)(p,{shadow:"hover",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",xg,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(y,{data:s.groupList,"row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"},"default-expand-all":s.isExpandAll,key:s.refreshTable,class:"modern-table","header-cell-style":{background:"transparent",color:"#606266",fontWeight:"500",borderBottom:"1px solid #ebeef5"}},{default:(0,r.k6)(()=>[(0,r.bF)(v,{label:"分组名称",prop:"name","min-width":"200"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",{class:(0,x.C4)(["group-name-cell",o.getGroupLevelClass(e.row)])},[(0,r.bF)(m,{class:(0,x.C4)(["group-icon",o.getGroupIconClass(e.row)])},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(o.getGroupIcon(e.row))))]),_:2},1032,["class"]),(0,r.Lk)("span",{class:(0,x.C4)(["group-name",o.getGroupNameClass(e.row)])},(0,x.v_)(e.row.name),3),0===e.row.parentId?((0,r.uX)(),(0,r.Wv)(g,{key:0,size:"small",type:"primary",class:"level-tag"},{default:(0,r.k6)(()=>a[14]||(a[14]=[(0,r.eW)("一级",-1)])),_:1,__:[14]})):((0,r.uX)(),(0,r.Wv)(g,{key:1,size:"small",type:"info",class:"level-tag"},{default:(0,r.k6)(()=>a[15]||(a[15]=[(0,r.eW)("二级",-1)])),_:1,__:[15]}))],2)]),_:1}),(0,r.bF)(v,{label:"创建时间",prop:"createTime","min-width":"180"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",Sg,[(0,r.bF)(m,{class:"time-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(h)]),_:1}),(0,r.Lk)("span",null,(0,x.v_)(e.row.createTime),1)])]),_:1}),(0,r.bF)(v,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(e=>[e.row.id!==s.DEFAULT_GROUP_ID?((0,r.uX)(),(0,r.CE)("div",Ig,[(0,r.bF)(b,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(c,{type:"warning",size:"small",circle:"",onClick:a=>o.showEditGroupDialog(e.row.id)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1})]),_:2},1032,["onClick"])),[[L,["cmdb:group:update"]]])]),_:2},1024),(0,r.bF)(b,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(c,{type:"danger",size:"small",circle:"",onClick:a=>o.handleGroupDelete(e.row)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1})]),_:2},1032,["onClick"])),[[L,["cmdb:group:delete"]]])]),_:2},1024)])):((0,r.uX)(),(0,r.CE)("div",Ag,[(0,r.bF)(g,{type:"info",size:"small"},{default:(0,r.k6)(()=>a[16]||(a[16]=[(0,r.eW)("默认分组",-1)])),_:1,__:[16]})]))]),_:1})]),_:1},8,["data","default-expand-all"])),[[F,s.loading]])])]),_:1}),(0,r.bF)(w,{title:"新增业务分组",modelValue:s.addGroupDialogVisible,"onUpdate:modelValue":a[5]||(a[5]=e=>s.addGroupDialogVisible=e),width:"30%",onClose:o.addGroupDialogClosed},{default:(0,r.k6)(()=>[(0,r.bF)(u,{model:s.addGroupForm,rules:s.addGroupFormRules,ref:"addGroupFormRef","label-width":"80px"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"分组名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.addGroupForm.name,"onUpdate:modelValue":a[2]||(a[2]=e=>s.addGroupForm.name=e)},null,8,["modelValue"])]),_:1}),s.optionsGroupList.length>0?((0,r.uX)(),(0,r.Wv)(d,{key:0,label:"父级分组",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{modelValue:s.addGroupForm.parentId,"onUpdate:modelValue":a[3]||(a[3]=e=>s.addGroupForm.parentId=e),data:s.optionsGroupList,props:{label:"name",value:"id",disabled:e=>e.id===s.DEFAULT_GROUP_ID},"check-strictly":"",placeholder:"请选择父级分组"},null,8,["modelValue","data","props"])]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["model","rules"]),(0,r.Lk)("span",Rg,[(0,r.bF)(c,{type:"primary",onClick:o.addGroup},{default:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.eW)("确 定",-1)])),_:1,__:[17]},8,["onClick"]),(0,r.bF)(c,{type:"primary",onClick:a[4]||(a[4]=e=>s.addGroupDialogVisible=!1)},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)("取 消",-1)])),_:1,__:[18]})])]),_:1},8,["modelValue","onClose"]),(0,r.bF)(w,{title:"编辑业务分组",modelValue:s.editGroupDialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>s.editGroupDialogVisible=e),width:"30%"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{model:s.groupInfo,rules:s.editGroupFormRules,ref:"editGroupFormRef","label-width":"80px"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"分组名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.groupInfo.name,"onUpdate:modelValue":a[6]||(a[6]=e=>s.groupInfo.name=e),disabled:s.groupInfo.id===s.DEFAULT_GROUP_ID},null,8,["modelValue","disabled"])]),_:1}),s.optionsGroupList.length>0?((0,r.uX)(),(0,r.Wv)(d,{key:0,label:"父级分组",prop:"parentId"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{modelValue:s.groupInfo.parentId,"onUpdate:modelValue":a[7]||(a[7]=e=>s.groupInfo.parentId=e),data:s.optionsGroupList,props:{label:"name",value:"id",disabled:e=>e.id===s.DEFAULT_GROUP_ID||s.groupInfo.id===s.DEFAULT_GROUP_ID},"check-strictly":"",placeholder:"请选择父级分组",disabled:s.groupInfo.id===s.DEFAULT_GROUP_ID},null,8,["modelValue","data","props","disabled"])]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["model","rules"]),(0,r.Lk)("span",Dg,[(0,r.bF)(c,{type:"primary",onClick:o.editGroup},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("确 定",-1)])),_:1,__:[19]},8,["onClick"]),(0,r.bF)(c,{type:"primary",onClick:a[8]||(a[8]=e=>s.editGroupDialogVisible=!1)},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)("取 消",-1)])),_:1,__:[20]})])]),_:1},8,["modelValue"])])}var $g={data(){return{DEFAULT_GROUP_ID:1,queryParams:{},loading:!0,groupList:[],addGroupDialogVisible:!1,addGroupForm:{parentId:0},addGroupFormRules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"}]},optionsGroupList:[],editGroupDialogVisible:!1,groupInfo:{},editGroupFormRules:{name:[{required:!0,message:"请输入分组名称",trigger:"blur"}]},isExpandAll:!0,refreshTable:!0}},methods:{async getList(){this.loading=!0;let e=0;const a=2,t=async()=>{try{const{data:e}=await ue.getAllCmdbGroups({params:this.queryParams});if(200!==e.code)throw new Error(e.message||"获取数据失败");const a=e=>e.map(e=>({...e,children:e.children&&e.children.length>0?a(e.children):[],hasChildren:!(!e.children||!e.children.length)})),t=a(e.data);return this.groupList=t,this.optionsGroupList=t,!0}catch(l){if(console.error("获取数据失败:",l),e<a)return e++,console.log(`重试第 ${e} 次...`),await new Promise(e=>setTimeout(e,1e3)),t();throw l}};try{await t()}catch(l){this.$message.error(`获取分组列表失败: ${l?.message||"未知错误"}`)}finally{this.loading=!1}},toggleExpandAll(){this.refreshTable=!1,this.isExpandAll=!this.isExpandAll,this.$nextTick(()=>{this.refreshTable=!0})},async handleQuery(){if(this.queryParams.groupName&&this.queryParams.groupName.trim())try{const{data:e}=await ue.getCmdbGroupByName(this.queryParams.groupName.trim());200===e.code?(this.groupList=e.data?Array.isArray(e.data)?e.data:[e.data]:[],this.$message.success("查询成功")):this.$message.error(e.message||"查询失败")}catch(e){this.$message.error("查询失败: "+(e.message||"未知错误"))}else this.$message.warning("请输入分组名称")},resetQuery(){this.queryParams={},this.getList(),this.$message.success("重置成功")},addGroupDialogClosed(){this.$refs.addGroupFormRef?.resetFields(),this.addGroupForm={}},async addGroup(){try{await this.$refs.addGroupFormRef.validate();const{data:e}=await ue.createCmdbGroup(this.addGroupForm);200!==e.code?this.$message.error(e.message):(this.$message.success("新增分组成功"),this.addGroupDialogVisible=!1,await this.getList())}catch(e){console.error("新增分组失败:",e),this.$message.error("新增分组失败，请检查网络连接")}},async showEditGroupDialog(e){const a=this.findGroupById(this.groupList,e);a?(this.groupInfo={id:a.id,name:a.name,parentId:a.parentId},this.editGroupDialogVisible=!0):this.$message.error("未找到分组信息")},findGroupById(e,a){for(const t of e){if(t.id===a)return t;if(t.children&&t.children.length>0){const e=this.findGroupById(t.children,a);if(e)return e}}return null},async editGroup(){let e=0;const a=2,t=async()=>{try{await this.$refs.editGroupFormRef.validate();const{data:e}=await ue.updateCmdbGroup({...this.groupInfo,id:this.groupInfo.id});if(200!==e.code)throw new Error(e.message||"更新分组失败");return this.editGroupDialogVisible=!1,await this.getList(),this.$message.success("修改分组成功"),!0}catch(l){if(console.error("修改分组失败:",l),e<a)return e++,console.log(`重试第 ${e} 次...`),await new Promise(e=>setTimeout(e,1e3)),t();throw l}};try{await t()}catch(l){this.$message.error(`修改分组失败: ${l.message}`)}},getGroupLevelClass(e){return 0===e.parentId?"level-1-group":"level-2-group"},getGroupIcon(e){return 0===e.parentId?"FolderOpened":"Folder"},getGroupIconClass(e){return 0===e.parentId?"level-1-icon":"level-2-icon"},getGroupNameClass(e){return 0===e.parentId?"level-1-name":"level-2-name"},async handleGroupDelete(e){if(e.id!==this.DEFAULT_GROUP_ID)try{const a=await this.$confirm(`是否确认删除分组"${e.name}"?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch(e=>e);if("confirm"!==a)return this.$message.info("已取消删除");const{data:t}=await ue.deleteCmdbGroup(e.id);200!==t.code?this.$message.error(t.message):(await this.getList(),this.$message.success("删除分组成功"))}catch(a){console.error("删除分组失败:",a),this.$message.error("删除分组失败，请检查网络连接")}else this.$message.warning("默认分组不能删除")}},created(){this.getList()}};const Tg=(0,p.A)($g,[["render",Pg],["__scopeId","data-v-a34418f6"]]);var Mg=Tg;const Eg={class:"cmdb-db-management"},Wg={class:"search-section"},zg={style:{display:"flex","align-items":"center",gap:"8px"}},Ng=["src","alt"],Kg={class:"action-section"},Ug={class:"table-section"},Xg={class:"db-name-container"},qg=["src","alt"],Hg={class:"operation-buttons"},Bg={style:{float:"left"}},jg={style:{float:"right",color:"#8492a6","font-size":"13px"}},Og={slot:"footer",class:"dialog-footer"};function Qg(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select"),p=(0,r.g2)("Search"),m=(0,r.g2)("el-icon"),g=(0,r.g2)("el-button"),v=(0,r.g2)("Refresh"),h=(0,r.g2)("el-form"),k=(0,r.g2)("Plus"),b=(0,r.g2)("el-table-column"),f=(0,r.g2)("el-tag"),y=(0,r.g2)("Edit"),_=(0,r.g2)("el-tooltip"),w=(0,r.g2)("Delete"),L=(0,r.g2)("el-table"),F=(0,r.g2)("el-col"),C=(0,r.g2)("el-row"),V=(0,r.g2)("el-cascader"),S=(0,r.g2)("el-dialog"),I=(0,r.g2)("el-card"),A=(0,r.gN)("authority"),R=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Eg,[(0,r.bF)(I,{shadow:"hover",class:"db-card"},{header:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"数据库管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",Wg,[(0,r.bF)(h,{inline:!0,model:s.queryParams,ref:"queryForm",class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"数据库名称"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.queryParams.name,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.name=e),placeholder:"请输入数据库名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(o.handleQuery,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{label:"数据库类型"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.queryParams.type,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.type=e),placeholder:"请选择数据库类型",clearable:"",size:"small",style:{width:"180px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.dbTypeOptions,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("div",zg,[(0,r.Lk)("img",{src:o.getDbIcon(e.value),alt:e.label,style:{width:"16px",height:"16px","object-fit":"contain","flex-shrink":"0"}},null,8,Ng),(0,r.Lk)("span",null,(0,x.v_)(e.label),1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(g,{type:"primary",size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1}),a[11]||(a[11]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[11]},8,["onClick"]),(0,r.bF)(g,{type:"warning",size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(v)]),_:1}),a[12]||(a[12]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[12]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",Kg,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"success",size:"small",onClick:o.showAddDialog},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),a[13]||(a[13]=(0,r.eW)(" 创建数据库 ",-1))]),_:1,__:[13]},8,["onClick"])),[[A,["cmdb:db:add"]]])]),(0,r.Lk)("div",Ug,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(L,{data:s.dbList,stripe:"",style:{width:"100%"},class:"db-table"},{default:(0,r.k6)(()=>[(0,r.bF)(b,{prop:"name",label:"数据库名称","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Xg,[(0,r.Lk)("img",{src:o.getDbIcon(e.type),alt:o.getDbName(e.type),class:"db-icon"},null,8,qg),(0,r.bF)(g,{type:"primary",link:"",onClick:a=>o.goToDetails(e.id),class:"db-name-link"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.name),1)]),_:2},1032,["onClick"])])]),_:1}),(0,r.bF)(b,{prop:"accountAlias",label:"所属账号","min-width":"140"}),(0,r.bF)(b,{prop:"charset",label:"标签","min-width":"120","show-overflow-tooltip":""}),(0,r.bF)(b,{prop:"type",label:"数据库类型","min-width":"140"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(f,{type:o.getDbTagType(e.type),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o.getDbName(e.type)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(b,{prop:"createdAt",label:"创建时间","min-width":"180"}),(0,r.bF)(b,{prop:"remark",label:"备注","min-width":"150","show-overflow-tooltip":""}),(0,r.bF)(b,{label:"操作",width:"140",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Hg,[(0,r.bF)(_,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"warning",size:"small",circle:"",onClick:a=>o.showEditDialog(e)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(y)]),_:1})]),_:2},1032,["onClick"])),[[A,["cmdb:db:edit"]]])]),_:2},1024),(0,r.bF)(_,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(g,{type:"danger",size:"small",circle:"",onClick:a=>o.handleDelete(e)},{default:(0,r.k6)(()=>[(0,r.bF)(m,null,{default:(0,r.k6)(()=>[(0,r.bF)(w)]),_:1})]),_:2},1032,["onClick"])),[[A,["cmdb:db:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[R,s.loading]])]),(0,r.bF)(S,{title:s.dialogTitle,modelValue:s.dialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>s.dialogVisible=e),width:"40%"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{model:s.formData,rules:s.formRules,ref:"formRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(C,null,{default:(0,r.k6)(()=>[(0,r.bF)(F,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"数据库名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.name,"onUpdate:modelValue":a[2]||(a[2]=e=>s.formData.name=e)},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(F,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"数据库类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.formData.type,"onUpdate:modelValue":a[3]||(a[3]=e=>s.formData.type=e),placeholder:"请选择数据库类型"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"MySQL",value:1}),(0,r.bF)(c,{label:"PostgreSQL",value:2}),(0,r.bF)(c,{label:"Redis",value:3}),(0,r.bF)(c,{label:"MongoDB",value:4}),(0,r.bF)(c,{label:"Elasticsearch",value:5})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(C,null,{default:(0,r.k6)(()=>[(0,r.bF)(F,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"所属账号",prop:"accountId"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.formData.accountId,"onUpdate:modelValue":a[4]||(a[4]=e=>s.formData.accountId=e),placeholder:"请选择所属账号",filterable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.accountList,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.id,label:e.alias,value:e.id},{default:(0,r.k6)(()=>[(0,r.Lk)("span",Bg,(0,x.v_)(e.alias),1),(0,r.Lk)("span",jg,(0,x.v_)(o.getDbName(e.type)),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(F,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"业务分组",prop:"groupId"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.formData.groupId,"onUpdate:modelValue":a[5]||(a[5]=e=>s.formData.groupId=e),options:s.groupList,props:{checkStrictly:!0,value:"id",label:"name",children:"children",expandTrigger:"hover"},placeholder:"请选择业务分组",clearable:"",filterable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(C,null,{default:(0,r.k6)(()=>[(0,r.bF)(F,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"标签",prop:"tags"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.tags,"onUpdate:modelValue":a[6]||(a[6]=e=>s.formData.tags=e),placeholder:"多个标签用逗号分隔"},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(F,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"描述",prop:"description"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.description,"onUpdate:modelValue":a[7]||(a[7]=e=>s.formData.description=e)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"]),(0,r.Lk)("span",Og,[(0,r.bF)(g,{type:"primary",onClick:o.submitForm},{default:(0,r.k6)(()=>a[14]||(a[14]=[(0,r.eW)("确 定",-1)])),_:1,__:[14]},8,["onClick"]),(0,r.bF)(g,{onClick:a[8]||(a[8]=e=>s.dialogVisible=!1)},{default:(0,r.k6)(()=>a[15]||(a[15]=[(0,r.eW)("取 消",-1)])),_:1,__:[15]})])]),_:1},8,["title","modelValue"])]),_:1})])}var Gg={components:{Edit:vc.Edit,Delete:vc.Delete,Search:vc.Search,Refresh:vc.Refresh,Plus:vc.Plus},data(){return{queryParams:{name:"",type:void 0},dbTypeOptions:[{label:"MySQL",value:1},{label:"PostgreSQL",value:2},{label:"Redis",value:3},{label:"MongoDB",value:4},{label:"Elasticsearch",value:5}],loading:!1,dbList:[],accountList:[],groupList:[],dialogVisible:!1,dialogTitle:"",formData:{id:"",name:"",type:void 0,accountId:void 0,groupId:void 0,tags:"",description:""},formRules:{name:[{required:!0,message:"请输入数据库名称",trigger:"blur"}],type:[{required:!0,message:"请选择数据库类型",trigger:"change"}],accountId:[{required:!0,message:"请选择所属账号",trigger:"change"}],groupId:[{required:!0,message:"请选择业务分组",trigger:"change"}]}}},methods:{getDbIcon(e){const a={1:t(4154),2:t(7646),3:t(1873),4:t(4702),5:t(4801)};return a[e]||t(4154)},getDbName(e){const a={1:"MySQL",2:"PostgreSQL",3:"Redis",4:"MongoDB",5:"Elasticsearch"};return a[e]||"MySQL"},getDbTagType(e){const a={1:"success",2:"warning",3:"danger",4:"info",5:"primary"};return a[e]||"success"},goToDetails(e){this.$router.push({path:"/cmdb/dbdetails",query:{id:e}})},async getList(){this.loading=!0;try{const e=await ue.listDatabases();200===e.data?.code?this.dbList=e.data?.data?.list?.map(e=>{const a=this.accountList.find(a=>a.id===e.accountId);return{...e,accountAlias:a?a.alias:e.accountId,charset:e.tags||"",collation:e.description||"",remark:e.description||"",createdAt:e.createdAt,updatedAt:e.updatedAt}})||[]:this.$message.error(e.data?.message||"获取数据库列表失败")}catch(e){console.error("获取数据库列表失败:",e),this.$message.error("获取数据库列表失败")}finally{this.loading=!1}},async getAccountList(){try{console.log("开始获取账号列表...");const e=await Uu.listAccountAuth({page:1,pageSize:100});console.log("账号列表API完整响应:",JSON.stringify(e,null,2)),200===e.data?.code?(console.log("API返回数据:",JSON.stringify(e.data.data,null,2)),this.accountList=(e.data.data?.list||[]).map(e=>({id:e.id,alias:e.alias.trim(),type:e.type})),console.log("格式化后的账号列表:",JSON.stringify(this.accountList,null,2)),this.$nextTick(()=>{const e=document.querySelector(".el-select");console.log("选择器DOM状态:",e),console.log("选择器选项数量:",document.querySelectorAll(".el-select-dropdown__item").length)})):(console.error("API返回错误:",e.data?.message),this.$message.error("获取账号列表失败: "+(e.data?.message||"未知错误")))}catch(e){console.error("获取账号列表异常:",e),this.$message.error("获取账号列表失败: "+e.message)}},async getGroupList(){try{const e=await ue.getAllCmdbGroups();200===e.data?.code&&(this.groupList=e.data?.data||[])}catch(e){console.error("获取业务分组列表失败:",e)}},async handleQuery(){this.loading=!0;try{let e;e=this.queryParams.name?await ue.getDatabasesByName(this.queryParams.name):this.queryParams.type?await ue.getDatabasesByType(this.queryParams.type):await ue.listDatabases(),200===e.data?.code?this.dbList=e.data?.data||[]:this.$message.error(e.data?.message||"查询失败")}catch(e){console.error("查询失败:",e),this.$message.error("查询失败")}finally{this.loading=!1}},resetQuery(){this.queryParams={name:"",type:void 0},this.getList()},showAddDialog(){this.dialogTitle="创建数据库",this.$nextTick(()=>{this.formData={name:"",type:void 0,accountId:void 0,groupId:1,tags:"",description:""},this.dialogVisible=!0})},showEditDialog(e){this.dialogTitle="修改数据库",this.$nextTick(()=>{this.formData={id:e.id,name:e.name,type:e.type,accountId:Number(e.accountId),groupId:e.groupId,tags:e.tags,description:e.description},console.log("编辑表单数据:",this.formData),this.dialogVisible=!0})},async submitForm(){try{await this.$refs.formRef.validate();let e=this.formData.groupId;Array.isArray(e)&&(e=e[e.length-1]);const a={name:this.formData.name,type:Number(this.formData.type),accountId:Number(this.formData.accountId),groupId:e?Number(e):1,tags:this.formData.tags,description:this.formData.description};let t;console.log("处理后的groupId:",e),this.formData.id&&(a.id=Number(this.formData.id)),console.log("提交给API的数据:",JSON.stringify(a,null,2)),t=a.id?await ue.updateDatabase(a):await ue.createDatabase(a),200===t.data.code?(this.$message.success(a.id?"修改成功":"创建成功"),this.dialogVisible=!1,await this.getList()):this.$message.error(t.data.message||(a.id?"修改失败":"创建失败"))}catch(e){console.error("操作失败:",e),this.$message.error("操作失败: "+e.message)}},async handleDelete(e){try{await this.$confirm(`确定删除数据库"${e.name}"?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await ue.deleteDatabase(e.id);200===a.data.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(a.data.message||"删除失败")}catch(a){console.error("删除失败:",a)}}},created(){this.getList(),this.getAccountList().then(()=>{console.log("账号列表加载完成:",this.accountList)}),this.getGroupList()},mounted(){console.log("组件挂载完成，检查账号选择器:"),this.$nextTick(()=>{const e=document.querySelector(".el-select");console.log("选择器DOM:",e)})}};const Yg=(0,p.A)(Gg,[["render",Qg],["__scopeId","data-v-69c52d9c"]]);var Jg=Yg;const Zg={class:"db-details-container"},ev={class:"card-header"},av={class:"sql-execute-container"},tv={class:"sql-form-container"},lv={key:0,style:{"margin-left":"10px"}},sv={class:"result-container"};function ov(e,a,t,l,s,o){const n=(0,r.g2)("Refresh"),i=(0,r.g2)("el-icon"),d=(0,r.g2)("el-button"),c=(0,r.g2)("el-descriptions-item"),u=(0,r.g2)("el-tag"),p=(0,r.g2)("el-descriptions"),m=(0,r.g2)("el-card"),g=(0,r.g2)("el-input"),v=(0,r.g2)("el-form-item"),h=(0,r.g2)("el-option"),k=(0,r.g2)("el-select"),b=(0,r.g2)("el-form");return(0,r.uX)(),(0,r.CE)("div",Zg,[(0,r.bF)(m,null,{header:(0,r.k6)(()=>[(0,r.Lk)("div",ev,[a[5]||(a[5]=(0,r.Lk)("span",null,"数据库详情",-1)),(0,r.bF)(d,{type:"primary",size:"small",onClick:e.getDBDetails,style:{"margin-left":"10px"}},{default:(0,r.k6)(()=>[(0,r.bF)(i,null,{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1}),a[4]||(a[4]=(0,r.Lk)("span",null,"刷新",-1))]),_:1,__:[4]},8,["onClick"])])]),default:(0,r.k6)(()=>[(0,r.bF)(p,{column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"数据库名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.dbInfo.name),1)]),_:1}),(0,r.bF)(c,{label:"数据库类型"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:1===l.dbInfo.type?"success":2===l.dbInfo.type?"warning":"danger"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(1===l.dbInfo.type?"MySQL":2===l.dbInfo.type?"PostgreSQL":"Redis"),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(c,{label:"所属账号"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.dbInfo.accountAlias),1)]),_:1}),(0,r.bF)(c,{label:"业务分组"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.dbInfo.groupName),1)]),_:1}),(0,r.bF)(c,{label:"标签"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.dbInfo.tags),1)]),_:1}),(0,r.bF)(c,{label:"描述"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.dbInfo.description),1)]),_:1}),(0,r.bF)(c,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.formatDate(l.dbInfo.createdAt)),1)]),_:1}),(0,r.bF)(c,{label:"更新时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(l.formatDate(l.dbInfo.updatedAt)),1)]),_:1})]),_:1})]),_:1}),(0,r.Lk)("div",av,[(0,r.bF)(m,null,{header:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"SQL执行")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",tv,[(0,r.bF)(b,{model:l.sqlForm,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{label:"数据库名称"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:l.dbInfo.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.dbInfo.name=e),disabled:""},null,8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"选择数据库"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{modelValue:l.sqlForm.databaseName,"onUpdate:modelValue":a[1]||(a[1]=e=>l.sqlForm.databaseName=e),placeholder:"请选择数据库",onFocus:l.getDatabaseList},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(l.databaseList,e=>((0,r.uX)(),(0,r.Wv)(h,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onFocus"]),l.dbConnectionInfo&&l.dbConnectionInfo.host?((0,r.uX)(),(0,r.CE)("span",lv)):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(v,{label:"SQL类型"},{default:(0,r.k6)(()=>[(0,r.bF)(k,{modelValue:l.sqlForm.sqlType,"onUpdate:modelValue":a[2]||(a[2]=e=>l.sqlForm.sqlType=e),placeholder:"请选择SQL类型",onChange:e.updateSQLPlaceholder},{default:(0,r.k6)(()=>[(0,r.bF)(h,{label:"查询",value:"select"},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.Lk)("span",{style:{float:"left"}},"查询",-1),(0,r.Lk)("span",{style:{float:"right",color:"#8492a6","font-size":"13px"}},"select id,name from 表名;",-1)])),_:1,__:[7]}),(0,r.bF)(h,{label:"插入",value:"insert"},{default:(0,r.k6)(()=>a[8]||(a[8]=[(0,r.Lk)("span",{style:{float:"left"}},"插入",-1),(0,r.Lk)("span",{style:{float:"right",color:"#8492a6","font-size":"13px"}},"INSERT INTO `表名` (`字段1`, `字段2`) VALUES ('值1', '值2');",-1)])),_:1,__:[8]}),(0,r.bF)(h,{label:"更新",value:"update"},{default:(0,r.k6)(()=>a[9]||(a[9]=[(0,r.Lk)("span",{style:{float:"left"}},"更新",-1),(0,r.Lk)("span",{style:{float:"right",color:"#8492a6","font-size":"13px"}},"UPDATE `表名` SET `字段1`='新值1' WHERE `id`=1;",-1)])),_:1,__:[9]}),(0,r.bF)(h,{label:"删除",value:"delete"},{default:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.Lk)("span",{style:{float:"left"}},"删除",-1),(0,r.Lk)("span",{style:{float:"right",color:"#8492a6","font-size":"13px"}},"DELETE FROM `表名` WHERE `id`=1;",-1)])),_:1,__:[10]}),(0,r.bF)(h,{label:"原生SQL",value:"raw"})]),_:1},8,["modelValue","onChange"])]),_:1}),(0,r.bF)(v,{label:"SQL语句"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:l.sqlForm.sql,"onUpdate:modelValue":a[3]||(a[3]=e=>l.sqlForm.sql=e),type:"textarea",rows:5,placeholder:e.sqlPlaceholder},null,8,["modelValue","placeholder"])]),_:1}),(0,r.bF)(v,null,{default:(0,r.k6)(()=>[(0,r.bF)(d,{type:"primary",onClick:l.executeSQL},{default:(0,r.k6)(()=>a[11]||(a[11]=[(0,r.eW)("执行",-1)])),_:1,__:[11]},8,["onClick"])]),_:1})]),_:1},8,["model"])])]),_:1}),(0,r.bF)(m,null,{header:(0,r.k6)(()=>a[12]||(a[12]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",null,"执行结果")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",sv,[(0,r.Lk)("pre",null,(0,x.v_)(l.executionResult),1)])]),_:1})])])}var nv={setup(){const e=(0,v.lq)(),a=(0,Y.KR)({name:"",type:void 0,accountAlias:"",groupName:"",tags:"",description:"",createdAt:"",updatedAt:""}),t=(0,Y.KR)({sqlType:"select",sql:"",databaseName:""}),l=(0,Y.KR)("-- 查询（SELECT）\nSELECT * FROM `表名` WHERE `字段1` = '值1';\nSELECT * FROM `表名` WHERE `字段1` = '值1' AND `字段2` = '值2';\nSELECT * FROM `表名` WHERE `字段1` = '值1' OR `字段2` = '值2';\nSELECT * FROM `表名` WHERE `字段` LIKE '%关键词%';\nSELECT * FROM `表名` WHERE `id` IN (1, 2, 3);\n-- 插入（INSERT\nINSERT INTO `表名` (`字段1`, `字段2`, `字段3`) VALUES ('值1', '值2', '值3');\nINSERT INTO `表名` (`字段1`, `字段2`) VALUES ('值1a', '值2a'), ('值1b', '值2b'), ('值1c', '值2c');\n-- 修改（UPDATE）\nUPDATE `表名` SET `字段1` = '新值1' WHERE `id` = 1;\nUPDATE `表名` SET `字段1` = '新值1' WHERE `字段A` = '条件A' AND `字段B` = '条件B';\nUPDATE `表名` SET `字段1` = '新值1', `字段2` = '新值2' WHERE `id` = 1;\n-- 删除（DELETE）\nDELETE FROM `表名` WHERE `id` = 1;\nDELETE FROM `表名` WHERE `字段1` = '值1' AND `字段2` = '值2';\nDELETE FROM `表名` WHERE `id` IN (1, 2, 3, 4, 5);"),s=(0,Y.KR)([]),o=(0,Y.KR)({host:"",port:""}),n=(0,Y.KR)(!1),i=((0,Y.KR)("请输入SQL语句"),async()=>{try{const a=e.params.id||e.query.id;if(!a)return void J.nk.error("数据库ID不能为空");n.value=!0;const t=await ue.executeDatabase({databaseId:Number(a)});200===t.data?.code&&t.data.data?(s.value=t.data.data.databases||[],o.value={host:t.data.data.host||"",port:t.data.data.port||""},s.value.length>0?J.nk.success(`成功获取 ${s.value.length} 个数据库`):J.nk.warning("该数据库实例中没有数据库")):J.nk.error(t.data?.message||"获取数据库列表失败")}catch(a){console.error("获取数据库列表失败:",a),J.nk.error("获取数据库列表失败: "+a.message)}finally{n.value=!1}}),d=async()=>{try{const t=e.params.id||e.query.id;if(console.log("从路由获取的ID:",t),!t)return void J.nk.error("数据库ID不能为空");const l=await oe({url:"cmdb/database/info",method:"get",params:{id:String(t)}});if(200===l.data?.code){const e=l.data.data;a.value={name:e.name,type:e.type,accountAlias:`账号ID: ${e.accountId}`,groupName:`分组ID: ${e.groupId}`,tags:e.tags,description:e.description,createdAt:e.createdAt,updatedAt:e.updatedAt}}else J.nk.error(l.data?.message||"获取数据库详情失败")}catch(t){console.error("获取数据库详情失败:",t),J.nk.error("获取数据库详情失败: "+t.message)}},c=async()=>{if(!t.value.sql)return void J.nk.warning("请输入SQL语句");if(!t.value.databaseName)return void J.nk.warning("请选择数据库");const a={databaseId:Number(e.params.id||e.query.id),databaseName:t.value.databaseName,sql:t.value.sql};console.log("准备执行SQL，请求数据:",JSON.stringify(a,null,2)),console.log("SQL类型:",t.value.sqlType);try{let e;switch(t.value.sqlType){case"select":console.log("调用executeSelectSQL"),e=await ue.executeSelectSQL(a);break;case"insert":console.log("调用executeInsertSQL"),e=await ue.executeInsertSQL(a);break;case"update":console.log("调用executeUpdateSQL"),e=await ue.executeUpdateSQL(a);break;case"delete":console.log("调用executeDeleteSQL"),e=await ue.executeDeleteSQL(a);break;case"raw":console.log("调用executeRawSQL"),e=await ue.executeRawSQL(a);break;default:return void J.nk.warning("请选择有效的SQL类型")}console.log("API响应:",JSON.stringify(e?.data,null,2)),200===e.data?.code?(l.value=JSON.stringify(e.data.data,null,2),J.nk.success("执行成功")):(l.value=JSON.stringify(e.data,null,2),J.nk.error(e.data?.message||"执行失败"))}catch(s){console.error("执行SQL失败:",s),l.value=s.message,J.nk.error("执行失败: "+s.message)}},u=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})};return(0,r.sV)(()=>{d()}),{dbInfo:a,sqlForm:t,executionResult:l,databaseList:s,dbConnectionInfo:o,isLoadingDatabases:n,executeSQL:c,formatDate:u,getDatabaseList:i}}};const iv=(0,p.A)(nv,[["render",ov],["__scopeId","data-v-049c17d0"]]);var rv=iv;const dv=[{path:"/cmdb/ecs",component:Fg,meta:{sTitle:"资产管理",tTitle:"主机管理"}},{path:"/cmdb/group",component:Mg,meta:{sTitle:"资产管理",tTitle:"业务分组"}},{path:"/cmdb/db",component:Jg,meta:{sTitle:"资产管理",tTitle:"数据管理"}},{path:"/cmdb/ssh",component:vp,meta:{sTitle:"资产管理",tTitle:"终端登录"}},{path:"/cmdb/dbdetails",component:rv,meta:{sTitle:"数据管理",tTitle:"数据库操作"}}];var cv=dv,uv=(t(7642),t(8004),t(3853),t(5876),t(4856),t(5024),t(1698),t(7918));const pv={style:{display:"flex",height:"500px"}},mv={style:{width:"250px","border-right":"1px solid #ebeef5","padding-right":"10px","overflow-y":"auto"}},gv={class:"group-header"},vv={class:"tree-node"},hv={key:2,class:"host-count"},kv={style:{flex:"1","padding-left":"10px","overflow-y":"auto"}},bv={class:"table-header"},fv={class:"selection-info"},yv={key:0},_v={key:1,class:"text-muted"},wv={class:"table-actions"},Lv={class:"host-cell"},Fv={class:"host-cell"},Cv={key:0,class:"host-cell"},Vv={key:1,class:"text-muted"},xv={key:0,class:"pagination"},Sv={class:"dialog-footer"},Iv={class:"footer-info"},Av={key:0},Rv={class:"footer-actions"};var Dv={__name:"HostSelector",props:{modelValue:{type:Boolean,default:!1},selectedHosts:{type:Array,default:()=>[]},nodeType:{type:String,default:"Master"},multiple:{type:Boolean,default:!0},excludeHosts:{type:Array,default:()=>[]}},emits:["update:modelValue","hosts-selected"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(!1),o=(0,Y.KR)(!1),n=(0,Y.KR)(!1),i=(0,Y.KR)(!1),d=(0,Y.KR)([]),c=(0,Y.KR)([]),u=(0,Y.KR)([]),p=(0,Y.KR)(),m=(0,Y.KR)({pageNum:1,pageSize:20,total:0}),g=(0,Y.KR)(null),v=(0,Y.KR)("");(0,r.wB)(()=>t.nodeType,e=>{v.value=`选择${e}节点主机`},{immediate:!0});const h=async()=>{try{n.value=!0;const e=await ue.getGroupListWithHosts();200===e.data?.code&&(d.value=e.data.data?.map(e=>({id:e.id,name:e.name,hostCount:e.hostCount||0}))||[])}catch(e){console.error("获取分组列表失败:",e),J.nk.error("获取分组列表失败")}finally{n.value=!1}},k=async()=>{g.value=null,await b()},b=async()=>{try{i.value=!0;const e=await ue.getCmdbHostList({page:m.value.pageNum,pageSize:m.value.pageSize});if(200===e.data?.code){const a=e.data.data?.list||[];c.value=a.map(e=>({id:e.id,name:e.hostName||e.name,ip:e.ip||e.privateIp,privateIp:e.privateIp,publicIp:e.publicIp,os:e.os||e.osType,status:e.status,remark:e.remark||e.description})),m.value.total=e.data.data?.total||0}}catch(e){console.error("获取主机列表失败:",e),J.nk.error("获取主机列表失败"),c.value=[]}finally{i.value=!1}},f=async e=>{g.value=e.id,m.value.pageNum=1;try{i.value=!0;const a=await ue.getCmdbHostsByGroupId(e.id,{page:m.value.pageNum,pageSize:m.value.pageSize});if(200===a.data?.code){const e=a.data.data||[];c.value=e.map(e=>({id:e.id,name:e.hostName||e.name,ip:e.ip||e.privateIp,privateIp:e.privateIp,publicIp:e.publicIp,os:e.os||e.osType,status:e.status,remark:e.remark||e.description})),m.value.total=e.length}}catch(a){console.error("获取分组主机失败:",a),J.nk.error("获取分组主机失败"),c.value=[]}finally{i.value=!1}},y=e=>{m.value.pageNum=e,g.value?f({id:g.value}):b()},_=e=>{m.value.pageSize=e,m.value.pageNum=1,g.value?f({id:g.value}):b()},w=e=>{u.value=e},L=e=>!t.excludeHosts.includes(e.id),F=()=>{p.value?.clearSelection(),u.value=[]},C=()=>{(0,r.dY)(()=>{c.value.forEach(e=>{L(e)&&p.value?.toggleRowSelection(e,!0)})})},V=e=>{const a={1:"success",0:"danger",2:"warning"};return a[e]||"info"},S=e=>{const a={1:"在线",0:"离线",2:"维护中"};return a[e]||"未知"},I=()=>{0!==u.value.length?(l("hosts-selected",u.value),A()):J.nk.warning("请选择至少一台主机")},A=()=>{u.value=[],F(),s.value=!1};return(0,r.wB)(()=>t.modelValue,e=>{s.value=e,e&&(h(),b())}),(0,r.wB)(s,e=>{l("update:modelValue",e)}),(0,r.sV)(()=>{h()}),(a,t)=>{const l=(0,r.g2)("el-button"),g=(0,r.g2)("el-icon"),h=(0,r.g2)("el-tree"),b=(0,r.g2)("el-table-column"),R=(0,r.g2)("el-tag"),D=(0,r.g2)("el-table"),P=(0,r.g2)("el-pagination"),$=(0,r.g2)("el-dialog"),T=(0,r.gN)("loading");return(0,r.uX)(),(0,r.Wv)($,{title:v.value,modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),width:"70%","before-close":A},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",Sv,[(0,r.Lk)("div",Iv,[u.value.length>0?((0,r.uX)(),(0,r.CE)("span",Av,[t[6]||(t[6]=(0,r.eW)(" 将添加 ",-1)),(0,r.Lk)("strong",null,(0,x.v_)(u.value.length),1),(0,r.eW)(" 台主机到"+(0,x.v_)(e.nodeType)+"节点 ",1)])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Rv,[(0,r.bF)(l,{onClick:A},{default:(0,r.k6)(()=>t[7]||(t[7]=[(0,r.eW)("取消",-1)])),_:1,__:[7]}),(0,r.bF)(l,{type:"primary",onClick:I,disabled:0===u.value.length},{default:(0,r.k6)(()=>[(0,r.eW)(" 确认选择 ("+(0,x.v_)(u.value.length)+") ",1)]),_:1},8,["disabled"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",pv,[(0,r.Lk)("div",mv,[(0,r.Lk)("div",gv,[(0,r.bF)(l,{type:"primary",size:"small",onClick:k,loading:o.value},{default:(0,r.k6)(()=>t[1]||(t[1]=[(0,r.eW)(" 显示全部主机 ",-1)])),_:1,__:[1]},8,["loading"])]),(0,r.bF)(h,{data:d.value,props:{label:"name",children:"children"},"node-key":"id","highlight-current":"",onNodeClick:f,loading:n.value},{default:(0,r.k6)(({node:e,data:a})=>[(0,r.Lk)("span",vv,[e.expanded?((0,r.uX)(),(0,r.Wv)(g,{key:0,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.FolderOpened))]),_:1})):((0,r.uX)(),(0,r.Wv)(g,{key:1,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Folder))]),_:1})),(0,r.eW)(" "+(0,x.v_)(e.label)+" ",1),void 0!==a.hostCount?((0,r.uX)(),(0,r.CE)("span",hv,"("+(0,x.v_)(a.hostCount)+")",1)):(0,r.Q3)("",!0)])]),_:1},8,["data","loading"])]),(0,r.Lk)("div",kv,[(0,r.Lk)("div",bv,[(0,r.Lk)("div",fv,[u.value.length>0?((0,r.uX)(),(0,r.CE)("span",yv,[t[2]||(t[2]=(0,r.eW)(" 已选择 ",-1)),(0,r.Lk)("strong",null,(0,x.v_)(u.value.length),1),t[3]||(t[3]=(0,r.eW)(" 台主机 ",-1))])):((0,r.uX)(),(0,r.CE)("span",_v,"请从下方表格中选择主机"))]),(0,r.Lk)("div",wv,[(0,r.bF)(l,{size:"small",onClick:F,disabled:0===u.value.length},{default:(0,r.k6)(()=>t[4]||(t[4]=[(0,r.eW)(" 清空选择 ",-1)])),_:1,__:[4]},8,["disabled"]),(0,r.bF)(l,{size:"small",type:"primary",onClick:C,disabled:0===c.value.length},{default:(0,r.k6)(()=>t[5]||(t[5]=[(0,r.eW)(" 全选当前页 ",-1)])),_:1,__:[5]},8,["disabled"])])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(D,{data:c.value,border:"",stripe:"",style:{width:"100%"},onSelectionChange:w,ref_key:"hostTableRef",ref:p},{default:(0,r.k6)(()=>[(0,r.bF)(b,{type:"selection",width:"55",selectable:L}),(0,r.bF)(b,{prop:"name",label:"主机名称",width:"150","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Lv,[(0,r.bF)(g,{class:"host-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("span",null,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(b,{prop:"ip",label:"IP地址",width:"120","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Fv,[(0,r.bF)(g,{class:"ip-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Connection))]),_:1}),(0,r.Lk)("span",null,(0,x.v_)(e.ip||e.privateIp),1)])]),_:1}),(0,r.bF)(b,{prop:"publicIp",label:"公网IP",width:"120","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[e.publicIp?((0,r.uX)(),(0,r.CE)("div",Cv,[(0,r.bF)(g,{class:"public-ip-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Globe))]),_:1}),(0,r.Lk)("span",null,(0,x.v_)(e.publicIp),1)])):((0,r.uX)(),(0,r.CE)("span",Vv,"-"))]),_:1}),(0,r.bF)(b,{prop:"os",label:"操作系统",width:"120","show-overflow-tooltip":""}),(0,r.bF)(b,{prop:"status",label:"状态",width:"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(R,{type:V(e.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(S(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(b,{prop:"remark",label:"备注","show-overflow-tooltip":""})]),_:1},8,["data"])),[[T,i.value]]),m.value.total>0?((0,r.uX)(),(0,r.CE)("div",xv,[(0,r.bF)(P,{onCurrentChange:y,onSizeChange:_,"current-page":m.value.pageNum,"page-sizes":[10,20,50,100],"page-size":m.value.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:m.value.total,small:""},null,8,["current-page","page-size","total"])])):(0,r.Q3)("",!0)])])]),_:1},8,["title","modelValue"])}}};const Pv=(0,p.A)(Dv,[["__scopeId","data-v-007925ac"]]);var $v=Pv,Tv=t(496),Mv=t.p+"static/img/k8s-io.9aa81989.svg";const Ev={class:"cluster-table-container"},Wv={class:"search-section"},zv={class:"table-section"},Nv={class:"cluster-name-container"},Kv={class:"version-container"},Uv={class:"version-text"},Xv={class:"description-container"},qv={class:"description-text"},Hv={class:"operation-buttons"};var Bv={__name:"ClusterTable",props:{refreshTrigger:{type:Number,default:0}},emits:["cluster-sync","cluster-edit","cluster-delete","view-credential"],setup(e,{expose:a,emit:t}){const l=(0,v.rd)(),s=e,o=t,n=(0,Y.KR)(!1),d=(0,Y.Kh)({clusterName:"",status:"",version:""}),c=[{label:"全部",value:""},{label:"创建中",value:1},{label:"运行中",value:2},{label:"离线",value:3}],u=(0,Y.KR)([]),p=async()=>{try{n.value=!0;const e={};d.clusterName&&(e.name=d.clusterName),d.version&&(e.version=d.version),d.status&&(e.status=d.status);const a=await ce.getClusterList(Object.keys(e).length>0?e:void 0),t=a.data||a;if(console.log("API响应数据:",t),200===t.code||t.success){const e=t.data?.list||t.data||[];u.value=e.map(e=>({id:e.id,clusterName:e.name,version:e.version||"",nodeCount:e.nodeCount||0,status:m(e.status),credential:e.credential||"",description:e.description||e.remark||"",createTime:e.createdAt?new Date(e.createdAt).toLocaleString():e.createTime})),console.log("集群列表加载成功:",u.value)}else J.nk.error(t.message||"获取集群列表失败"),u.value=[]}catch(e){console.error("获取集群列表失败:",e),"ERR_NETWORK"===e.code||e.message?.includes("ERR_CONNECTION_REFUSED")||e.message?.includes("Failed to fetch")?J.nk.warning("后端服务连接失败，请检查服务状态"):401===e.response?.status?J.nk.error("认证失败，请重新登录"):403===e.response?.status?J.nk.error("权限不足，请联系管理员"):console.warn("API调用异常，但可能数据已正确加载"),u.value=[]}finally{n.value=!1}},m=e=>{const a={1:"creating",2:"online",3:"offline"};return a[e]||"unknown"},g=()=>{d.clusterName="",d.status="",d.version="",p()},h=e=>{l.push(`/k8s/cluster/${e.id}`)},k=async e=>{try{await navigator.clipboard.writeText(e.clusterName),J.nk.success(`集群名称 "${e.clusterName}" 已复制到剪贴板`)}catch(a){console.error("复制失败:",a);try{const a=document.createElement("textarea");a.value=e.clusterName,a.style.position="fixed",a.style.opacity="0",document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),J.nk.success(`集群名称 "${e.clusterName}" 已复制到剪贴板`)}catch(t){console.error("降级复制也失败:",t),J.nk.error("复制失败，请手动复制")}}},b=async e=>{try{if(!e.credential||!e.credential.trim())return void J.nk.warning("该集群没有配置凭证，无法进行同步操作");const a=await ce.syncCluster(e.id),t=a.data||a;if(console.log("同步集群API响应:",t),200===t.code||t.success||"成功"===t.message)J.nk.success(`集群 ${e.clusterName} 同步成功`),o("cluster-sync",e),await p();else if(500===t.code){const a=t.message&&(t.message.includes("timeout")||t.message.includes("Timeout exceeded")||t.message.includes("connection")||t.message.includes("已将集群状态设为离线"));a?(J.nk.warning(`集群 ${e.clusterName} 连接超时，已设为离线状态`),console.log("检测到超时错误，准备延迟刷新状态"),await p(),setTimeout(async()=>{console.log("延迟刷新集群状态"),await p()},1e3)):J.nk.error(t.message||"同步失败"),o("cluster-sync",e)}else J.nk.error(t.message||"同步失败"),await p(),o("cluster-sync",e)}catch(a){console.error("同步集群失败:",a);const t=a.message||a.toString(),l=t.includes("timeout")||t.includes("Network Error")||t.includes("ERR_NETWORK");l?(J.nk.warning(`集群 ${e.clusterName} 网络连接超时`),setTimeout(async()=>{console.log("网络超时后延迟刷新"),await p()},1e3)):J.nk.error("同步集群失败，请检查网络连接"),o("cluster-sync",e)}},f=async e=>{o("cluster-edit",e)},y=e=>{o("view-credential",e)},_=e=>{uv.s.confirm(`确定要删除集群 ${e.clusterName} 吗？此操作不可逆！`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const a=await ce.deleteCluster(e.id),t=a.data||a;console.log("删除集群API响应:",t),200===t.code||t.success||"成功"===t.message?(J.nk.success(`集群 ${e.clusterName} 已删除`),o("cluster-delete",e),p()):J.nk.error(t.message||"删除失败")}catch(a){console.error("删除集群失败:",a),J.nk.error("删除集群失败，请检查网络连接")}}).catch(()=>{J.nk.info("已取消删除")})},w=e=>{const a={creating:"info",online:"success",offline:"warning"};return a[e]||"info"},L=e=>{const a={creating:"创建中",online:"运行中",offline:"离线"};return a[e]||"未知"};return(0,r.wB)(()=>s.refreshTrigger,(e,a)=>{console.log(`表格刷新触发器变化: ${a} -> ${e}`),p()}),a({handleQuery:p,resetQuery:g}),(0,r.sV)(()=>{p()}),(e,a)=>{const t=(0,r.g2)("el-input"),l=(0,r.g2)("el-form-item"),s=(0,r.g2)("el-option"),o=(0,r.g2)("el-select"),m=(0,r.g2)("el-button"),v=(0,r.g2)("el-form"),F=(0,r.g2)("el-tooltip"),C=(0,r.g2)("el-table-column"),V=(0,r.g2)("el-tag"),S=(0,r.g2)("el-table"),I=(0,r.gN)("authority"),A=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Ev,[(0,r.Lk)("div",Wv,[(0,r.bF)(v,{inline:!0,model:d,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{label:"集群名称"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:d.clusterName,"onUpdate:modelValue":a[0]||(a[0]=e=>d.clusterName=e),placeholder:"请输入集群名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(p,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(l,{label:"集群状态"},{default:(0,r.k6)(()=>[(0,r.bF)(o,{modelValue:d.status,"onUpdate:modelValue":a[1]||(a[1]=e=>d.status=e),placeholder:"请选择状态",clearable:"",size:"small",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(c,e=>(0,r.bF)(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(l,{label:"集群版本"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:d.version,"onUpdate:modelValue":a[2]||(a[2]=e=>d.version=e),placeholder:"请输入版本",clearable:"",size:"small",style:{width:"150px"},onKeyup:(0,i.jR)(p,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:p},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[3]},8,["icon"]),(0,r.bF)(m,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:g},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)(" 重置 ",-1)])),_:1,__:[4]},8,["icon"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",zv,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(S,{data:u.value,stripe:"",style:{width:"100%"},class:"cluster-table"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{prop:"clusterName",label:"集群名称","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Nv,[a[5]||(a[5]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"},null,-1)),(0,r.bF)(m,{type:"primary",link:"",onClick:a=>h(e),class:"cluster-name-link"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.clusterName),1)]),_:2},1032,["onClick"]),(0,r.bF)(F,{content:"复制集群名称",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"info",icon:(0,Y.R1)(vc.DocumentCopy),size:"small",circle:"",onClick:(0,i.D$)(a=>k(e),["stop"]),class:"copy-name-btn"},null,8,["icon","onClick"])]),_:2},1024)])]),_:1}),(0,r.bF)(C,{prop:"version",label:"集群版本","min-width":"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Kv,[a[6]||(a[6]=(0,r.Lk)("img",{src:Mv,alt:"k8s-io",class:"k8s-io-icon"},null,-1)),(0,r.Lk)("span",Uv,(0,x.v_)(e.version),1)])]),_:1}),(0,r.bF)(C,{prop:"nodeCount",label:"节点数量","min-width":"110"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(V,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.nodeCount)+" 个 ",1)]),_:2},1024)]),_:1}),(0,r.bF)(C,{prop:"status",label:"集群状态","min-width":"110"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(V,{type:w(e.status),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(L(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(C,{label:"集群凭证",width:"100",align:"center"},{default:(0,r.k6)(({row:e})=>[e.credential&&e.credential.trim()?((0,r.uX)(),(0,r.Wv)(F,{key:0,content:"查看集群凭证",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"primary",icon:(0,Y.R1)(vc.View),size:"small",circle:"",onClick:a=>y(e)},null,8,["icon","onClick"])]),_:2},1024)):((0,r.uX)(),(0,r.Wv)(V,{key:1,size:"small",type:"info"},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.eW)("未设置",-1)])),_:1,__:[7]}))]),_:1}),(0,r.bF)(C,{prop:"description",label:"备注信息","min-width":"160"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Xv,[(0,r.bF)(F,{content:e.description||"暂无备注",placement:"top",disabled:!e.description||e.description.length<=20},{default:(0,r.k6)(()=>[(0,r.Lk)("span",qv,(0,x.v_)(e.description?e.description.length>20?e.description.substring(0,20)+"...":e.description:"暂无备注"),1)]),_:2},1032,["content","disabled"])])]),_:1}),(0,r.bF)(C,{prop:"createTime",label:"创建时间","min-width":"180"}),(0,r.bF)(C,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Hv,[(0,r.bF)(F,{content:e.credential&&e.credential.trim()?"同步集群":"未配置凭证，无法同步",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"primary",icon:(0,Y.R1)(vc.Connection),size:"small",circle:"",disabled:!e.credential||!e.credential.trim(),onClick:a=>b(e)},null,8,["icon","disabled","onClick"]),[[I,["cloud:k8s:rsync"]]])]),_:2},1032,["content"]),(0,r.bF)(F,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"warning",icon:(0,Y.R1)(vc.Edit),size:"small",circle:"",onClick:a=>f(e)},null,8,["icon","onClick"]),[[I,["cloud:k8s:edit"]]])]),_:2},1024),(0,r.bF)(F,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",onClick:a=>_(e)},null,8,["icon","onClick"]),[[I,["cloud:k8s:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[A,n.value]])])])}}};const jv=(0,p.A)(Bv,[["__scopeId","data-v-85538526"]]);var Ov=jv,Qv=t(11),Gv=t(5603),Yv=t(5262),Jv=t(1058),Zv=t(6347),eh=t(9510);t(6943);function ah(e,a){let t="";t="string"===typeof e?e.replace(/\\r\\n|\\n\\r|\\r/g,"\n").replace(/\r\n|\n\r|\r/g,"\n"):JSON.stringify(e,null,2).replace(/\\r\\n|\\n\\r|\\r/g,"\n").replace(/\r\n|\n\r|\r/g,"\n");const l=a?Qv.A.highlight(t,{language:a}).value:Qv.A.highlightAuto(t).value;return l.replace(/\n/g,"<br>")}Qv.A.registerLanguage("javascript",Gv.A),Qv.A.registerLanguage("python",Yv.A),Qv.A.registerLanguage("go",Jv.A),Qv.A.registerLanguage("yaml",Zv.A),Qv.A.registerLanguage("bash",eh.A);const th={class:"code-editor"},lh=["value","readonly"],sh=["innerHTML"];var oh={__name:"CodeEditor",props:{modelValue:{type:String,default:""},language:{type:String,default:null},height:{type:String,default:"300px"},readonly:{type:Boolean,default:!1},fontSize:{type:String,default:"14px"},searchText:{type:String,default:""},searchResults:{type:Array,default:()=>[]},currentSearchIndex:{type:Number,default:-1}},emits:["update:modelValue"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=(0,Y.KR)(null),n=(0,Y.KR)(null),i=()=>{o.value&&!l.readonly&&o.value.focus()},d=(0,r.EW)(()=>{let e=l.modelValue||"",a=ah(e,l.language);if(e&&!e.endsWith("\n")&&(a+="\n"),l.searchText&&l.searchText.trim()){const e=l.searchText.toLowerCase(),t=a.split("\n");a=t.map((a,t)=>{let s=a;const o=a.toLowerCase();let n=0,i=0;while(1){const a=o.indexOf(e,i);if(-1===a)break;const r=l.searchResults.some((e,s)=>e.lineIndex===t&&e.matchIndex===a&&s===l.currentSearchIndex),d=s.substring(0,a+n),c=s.substring(a+n,a+n+e.length),u=s.substring(a+n+e.length),p=r?"search-highlight-current":"search-highlight";s=d+`<span class="${p}">${c}</span>`+u;const m=`<span class="${p}"></span>`.length;n+=m,i=a+e.length}return s}).join("\n")}return a}),c=e=>{l.readonly||(s("update:modelValue",e.target.value),setTimeout(()=>{p()},0))},u=e=>{setTimeout(()=>{p()},0)},p=()=>{if(n.value&&o.value){const e=o.value.scrollHeight,a=n.value.scrollHeight;Math.abs(e-a)>2&&(n.value.style.height=e+"px",n.value.style.minHeight=e+"px");const t=o.value.scrollTop,l=o.value.scrollLeft;n.value.scrollTop=t,n.value.scrollLeft=l,setTimeout(()=>{n.value&&o.value&&(Math.abs(n.value.scrollTop-o.value.scrollTop)>1&&(n.value.scrollTop=o.value.scrollTop),Math.abs(n.value.scrollLeft-o.value.scrollLeft)>1&&(n.value.scrollLeft=o.value.scrollLeft))},1)}},m=()=>{if(n.value&&o.value){const e=window.getComputedStyle(o.value),a=n.value;a.style.fontSize=e.fontSize,a.style.fontFamily=e.fontFamily,a.style.lineHeight=e.lineHeight,a.style.letterSpacing=e.letterSpacing,a.style.wordSpacing=e.wordSpacing,a.style.tabSize=e.tabSize,a.style.width=e.width,a.style.height=e.height,a.style.padding=e.padding,a.style.margin=e.margin,a.style.boxSizing=e.boxSizing;const t=o.value.scrollHeight,l=a.scrollHeight;Math.abs(t-l)>2&&(a.style.height=t+"px",a.style.minHeight=t+"px");const s=o.value.getBoundingClientRect(),i=a.getBoundingClientRect();Math.abs(s.height-i.height)>1&&(a.style.minHeight=s.height+"px"),p()}};return(0,r.sV)(()=>{if(setTimeout(()=>{m()},100),o.value&&window.ResizeObserver){const e=new ResizeObserver(()=>{m()});e.observe(o.value),(0,r.hi)(()=>{e.disconnect()})}}),(0,r.wB)(()=>l.modelValue,()=>{setTimeout(()=>{m()},10)}),a({focus:i}),(a,t)=>((0,r.uX)(),(0,r.CE)("div",th,[(0,r.Lk)("textarea",{ref_key:"textarea",ref:o,value:e.modelValue,onInput:c,onScroll:p,onKeydown:u,onClick:p,onFocus:p,class:"code-editor__textarea",style:(0,x.Tr)({height:e.height,fontSize:e.fontSize}),readonly:e.readonly},null,44,lh),(0,r.Lk)("pre",{ref_key:"highlightRef",ref:n,class:"code-editor__highlight",innerHTML:d.value,style:(0,x.Tr)({height:e.height,fontSize:e.fontSize}),onClick:i},null,12,sh)]))}};const nh=(0,p.A)(oh,[["__scopeId","data-v-e04c589a"]]);var ih=nh;const rh={class:"credential-editor-container"},dh={class:"credential-editor"},ch={class:"credential-actions"};var uh={__name:"CredentialEditor",props:{modelValue:{type:String,default:""},height:{type:String,default:"200px"},placeholder:{type:String,default:"请输入或上传集群凭证配置"},disabled:{type:Boolean,default:!1},maxFileSize:{type:Number,default:5242880},acceptedFileNames:{type:Array,default:()=>["config"]}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(null),o=(0,r.EW)({get:()=>t.modelValue,set:e=>l("update:modelValue",e)}),n=()=>{t.disabled?J.nk.warning("当前状态不允许上传文件"):s.value?s.value.click():J.nk.error("文件选择器初始化失败，请刷新页面重试")},i=e=>{const a=e.target.files[0];if(!a)return;console.log("选择的文件:",a.name,"文件大小:",a.size);const l=a.name,s=t.acceptedFileNames.some(e=>l===e||l.toLowerCase().endsWith(`.${e}`));if(!s){const a=t.acceptedFileNames.join('", "');return J.nk.error(`请上传名为 "${a}" 的文件`),void(e.target.value="")}if(a.size>t.maxFileSize){const a=(t.maxFileSize/1048576).toFixed(1);return J.nk.error(`文件大小不能超过 ${a}MB`),void(e.target.value="")}const n=new FileReader;n.onload=a=>{try{const e=a.target.result;e&&e.trim()?(o.value=e.trim(),J.nk.success(`凭证文件 ${l} 上传成功`)):J.nk.warning("文件内容为空")}catch(t){console.error("读取文件失败:",t),J.nk.error("读取文件失败，请检查文件格式")}e.target.value=""},n.onerror=a=>{console.error("文件读取错误:",a),J.nk.error("文件读取失败"),e.target.value=""},n.readAsText(a,"UTF-8")},d=()=>{t.disabled?J.nk.warning("当前状态不允许清空"):o.value.trim()?uv.s.confirm("确定要清空凭证内容吗？","清空确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{o.value="",J.nk.success("凭证内容已清空")}).catch(()=>{}):J.nk.info("凭证内容已经为空")};return(a,t)=>{const l=(0,r.g2)("el-icon"),c=(0,r.g2)("el-button");return(0,r.uX)(),(0,r.CE)("div",rh,[(0,r.Lk)("div",dh,[(0,r.bF)(ih,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),language:"yaml",height:e.height,class:"editor"},null,8,["modelValue","height"])]),(0,r.Lk)("div",ch,[(0,r.Lk)("input",{ref_key:"fileInputRef",ref:s,type:"file",accept:"*",style:{display:"none"},onChange:i},null,544),(0,r.bF)(c,{size:"small",type:"success",onClick:n,disabled:e.disabled,class:"upload-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Upload))]),_:1}),t[1]||(t[1]=(0,r.eW)(" 上传config文件 ",-1))]),_:1,__:[1]},8,["disabled"]),(0,r.bF)(c,{size:"small",type:"warning",onClick:d,plain:"",disabled:e.disabled},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Delete))]),_:1}),t[2]||(t[2]=(0,r.eW)(" 清空 ",-1))]),_:1,__:[2]},8,["disabled"])])])}}};const ph=(0,p.A)(uh,[["__scopeId","data-v-77c886a8"]]);var mh=ph;const gh={class:"credential-content"},vh={class:"credential-header"},hh={class:"code-container"},kh=["innerHTML"],bh={class:"credential-info"};var fh={__name:"CredentialDialog",props:{visible:{type:Boolean,default:!1},credential:{type:Object,default:()=>({clusterName:"",content:""})}},emits:["update:visible","closed"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(!1),o=(0,Y.KR)(!1),n=(0,r.EW)({get:()=>t.visible,set:e=>l("update:visible",e)}),i=(0,r.EW)(()=>t.credential.content?ah(t.credential.content,"yaml"):'<span style="color: #909399; font-style: italic;">暂无凭证内容</span>'),d=async()=>{if(t.credential.content?.trim())try{s.value=!0,await navigator.clipboard.writeText(t.credential.content),J.nk.success("凭证内容已复制到剪贴板")}catch(e){console.error("复制失败:",e);try{const e=document.createElement("textarea");e.value=t.credential.content,e.style.position="fixed",e.style.opacity="0",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),J.nk.success("凭证内容已复制到剪贴板")}catch(a){console.error("降级复制也失败:",a),J.nk.error("复制失败，请手动复制")}}finally{s.value=!1}else J.nk.warning("凭证内容为空，无法复制")},c=()=>{if(t.credential.content?.trim())if(t.credential.clusterName?.trim())try{o.value=!0;const e=new Blob([t.credential.content],{type:"text/plain;charset=utf-8"}),a=URL.createObjectURL(e),l=document.createElement("a");l.href=a,l.download=`${t.credential.clusterName}-config`,l.style.display="none",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(a),J.nk.success("凭证文件下载成功")}catch(e){console.error("下载失败:",e),J.nk.error("下载失败，请重试")}finally{o.value=!1}else J.nk.warning("集群名称为空，无法生成文件名");else J.nk.warning("凭证内容为空，无法下载")},u=()=>{l("closed")};return(0,r.wB)(()=>t.credential,e=>{t.visible&&e&&(e.clusterName?.trim()||console.warn("凭证对话框：集群名称为空"),e.content?.trim()||console.warn("凭证对话框：凭证内容为空"))},{deep:!0,immediate:!0}),(a,t)=>{const l=(0,r.g2)("el-button"),p=(0,r.g2)("el-tag"),m=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(m,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),title:`查看集群凭证 - ${e.credential.clusterName}`,width:"700px",class:"credential-view-dialog",onClosed:u},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gh,[(0,r.Lk)("div",vh,[(0,r.bF)(l,{size:"small",onClick:d,icon:(0,Y.R1)(vc.DocumentCopy),loading:s.value},{default:(0,r.k6)(()=>t[1]||(t[1]=[(0,r.eW)(" 复制凭证 ",-1)])),_:1,__:[1]},8,["icon","loading"]),(0,r.bF)(l,{size:"small",onClick:c,icon:(0,Y.R1)(vc.Download),loading:o.value},{default:(0,r.k6)(()=>t[2]||(t[2]=[(0,r.eW)(" 下载文件 ",-1)])),_:1,__:[2]},8,["icon","loading"])]),(0,r.Lk)("div",hh,[(0,r.Lk)("pre",{class:"code-block yaml-code",innerHTML:i.value},null,8,kh)]),(0,r.Lk)("div",bh,[(0,r.bF)(p,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)(" 字符数："+(0,x.v_)(e.credential.content?.length||0),1)]),_:1}),(0,r.bF)(p,{size:"small",type:"success",style:{"margin-left":"8px"}},{default:(0,r.k6)(()=>t[3]||(t[3]=[(0,r.eW)(" 格式：YAML/Config ",-1)])),_:1,__:[3]}),e.credential.content?.trim()?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(p,{key:0,size:"small",type:"warning",style:{"margin-left":"8px"}},{default:(0,r.k6)(()=>t[4]||(t[4]=[(0,r.eW)(" 内容为空 ",-1)])),_:1,__:[4]}))])])]),_:1},8,["modelValue","title"])}}};const yh=(0,p.A)(fh,[["__scopeId","data-v-4cf577d0"]]);var _h=yh;const wh={class:"dialog-footer"};var Lh={__name:"RegisterDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","success","closed"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(null),o=(0,Y.KR)(!1),n=(0,r.EW)({get:()=>t.visible,set:e=>l("update:visible",e)}),i=(0,Y.Kh)({clusterName:"",credential:"",description:""}),d=()=>{i.clusterName="",i.credential="",i.description="",s.value&&s.value.clearValidate()},c=async()=>{try{if(!s.value)return void J.nk.error("表单验证失败");const e=await s.value.validate().catch(()=>!1);if(!e)return;o.value=!0;const a=await ce.registerExternalCluster({name:i.clusterName,description:i.description,clusterType:2,kubeconfig:i.credential}),t=a.data||a;console.log("注册集群API响应:",t),200===t.code||t.success?(J.nk.success("集群注册成功，正在同步集群信息..."),n.value=!1,d(),l("success",t)):J.nk.error(t.message||"注册集群失败")}catch(e){console.error("注册集群失败:",e),400===e.response?.status?J.nk.error("请求参数错误，请检查集群信息"):409===e.response?.status?J.nk.error("集群名称已存在，请使用其他名称"):"ERR_NETWORK"===e.code?J.nk.error("网络连接失败，请检查网络状态"):J.nk.error("注册集群失败，请重试")}finally{o.value=!1}},u=()=>{n.value=!1},p=()=>{d(),l("closed")};return(0,r.wB)(()=>t.visible,e=>{e&&d()}),(e,a)=>{const t=(0,r.g2)("el-input"),l=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-form"),m=(0,r.g2)("el-button"),g=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(g,{modelValue:n.value,"onUpdate:modelValue":a[3]||(a[3]=e=>n.value=e),title:"注册 K8s 集群",width:"600px",class:"register-dialog",onClosed:p},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",wh,[(0,r.bF)(m,{onClick:u,disabled:o.value},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("取消",-1)])),_:1,__:[4]},8,["disabled"]),(0,r.bF)(m,{type:"primary",onClick:c,loading:o.value},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)(" 注册 ",-1)])),_:1,__:[5]},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(d,{model:i,"label-width":"120px",ref_key:"formRef",ref:s},{default:(0,r.k6)(()=>[(0,r.bF)(l,{label:"集群名称",required:"",prop:"clusterName",rules:[{required:!0,message:"请输入集群名称",trigger:"blur"},{min:2,max:50,message:"集群名称长度在 2 到 50 个字符",trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:i.clusterName,"onUpdate:modelValue":a[0]||(a[0]=e=>i.clusterName=e),placeholder:"请输入集群名称",clearable:"",disabled:o.value},null,8,["modelValue","disabled"])]),_:1}),(0,r.bF)(l,{label:"集群凭证",required:"",prop:"credential",rules:[{required:!0,message:"请输入集群凭证",trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(mh,{modelValue:i.credential,"onUpdate:modelValue":a[1]||(a[1]=e=>i.credential=e),height:"200px",placeholder:"请输入或上传集群凭证配置",disabled:o.value},null,8,["modelValue","disabled"])]),_:1}),(0,r.bF)(l,{label:"描述信息"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:i.description,"onUpdate:modelValue":a[2]||(a[2]=e=>i.description=e),type:"textarea",rows:2,placeholder:"请输入集群描述",disabled:o.value,maxlength:"200","show-word-limit":""},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}};const Fh=(0,p.A)(Lh,[["__scopeId","data-v-64d7442c"]]);var Ch=Fh;const Vh={class:"version-tip"},xh={class:"dialog-footer"};var Sh={__name:"EditDialog",props:{visible:{type:Boolean,default:!1},cluster:{type:Object,default:()=>({id:"",clusterName:"",version:"",credential:"",description:""})}},emits:["update:visible","success","closed"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(null),o=(0,Y.KR)(!1),n=(0,r.EW)({get:()=>t.visible,set:e=>l("update:visible",e)}),i=(0,Y.Kh)({id:"",clusterName:"",version:"",credential:"",description:""}),d=()=>{i.id="",i.clusterName="",i.version="",i.credential="",i.description="",s.value&&s.value.clearValidate()},c=e=>{console.log("🔄 填充编辑表单数据:",{clusterId:e.id,clusterName:e.clusterName||e.name,hasCredential:!(!e.credential&&!e.kubeconfig),credentialLength:(e.credential||e.kubeconfig||"").length}),i.id=e.id||"",i.clusterName=e.clusterName||e.name||"",i.version=e.version||"",i.credential=e.credential||e.kubeconfig||"",i.description=e.description||e.remark||""},u=async()=>{try{if(!s.value)return void J.nk.error("表单验证失败");const e=await s.value.validate().catch(()=>!1);if(!e)return;if(!i.id)return void J.nk.error("集群ID不能为空");o.value=!0;const a={name:i.clusterName,credential:i.credential,description:i.description};console.log("📤 发送更新请求:",{clusterId:i.id,url:`/api/v1/k8s/cluster/${i.id}`,data:{...a,credential:a.credential?`${a.credential.substring(0,100)}...`:""}});const t=await ce.updateCluster(i.id,a),r=t.data||t;console.log("📥 更新集群API响应:",r),200===r.code||r.success?(J.nk.success("集群信息更新成功"),n.value=!1,d(),l("success",r)):J.nk.error(r.message||"更新集群信息失败")}catch(e){console.error("更新集群信息失败:",e),400===e.response?.status?J.nk.error("请求参数错误，请检查集群信息"):404===e.response?.status?J.nk.error("集群不存在或已被删除"):409===e.response?.status?J.nk.error("集群名称已存在，请使用其他名称"):"ERR_NETWORK"===e.code?J.nk.error("网络连接失败，请检查网络状态"):J.nk.error("更新集群信息失败，请重试")}finally{o.value=!1}},p=()=>{n.value=!1},m=()=>{d(),l("closed")};return(0,r.wB)(()=>t.cluster,e=>{e&&t.visible&&c(e)},{deep:!0,immediate:!0}),(0,r.wB)(()=>t.visible,e=>{e&&t.cluster?c(t.cluster):e||d()}),(e,a)=>{const t=(0,r.g2)("el-input"),l=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-icon"),c=(0,r.g2)("el-text"),g=(0,r.g2)("el-form"),v=(0,r.g2)("el-button"),h=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(h,{modelValue:n.value,"onUpdate:modelValue":a[4]||(a[4]=e=>n.value=e),title:"编辑 K8s 集群",width:"600px",class:"edit-dialog",onClosed:m},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",xh,[(0,r.bF)(v,{onClick:p,disabled:o.value},{default:(0,r.k6)(()=>a[6]||(a[6]=[(0,r.eW)("取消",-1)])),_:1,__:[6]},8,["disabled"]),(0,r.bF)(v,{type:"primary",onClick:u,loading:o.value},{default:(0,r.k6)(()=>a[7]||(a[7]=[(0,r.eW)(" 更新 ",-1)])),_:1,__:[7]},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(g,{model:i,"label-width":"120px",ref_key:"formRef",ref:s},{default:(0,r.k6)(()=>[(0,r.bF)(l,{label:"集群名称",required:"",prop:"clusterName",rules:[{required:!0,message:"请输入集群名称",trigger:"blur"},{min:2,max:50,message:"集群名称长度在 2 到 50 个字符",trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:i.clusterName,"onUpdate:modelValue":a[0]||(a[0]=e=>i.clusterName=e),placeholder:"请输入集群名称",clearable:"",disabled:o.value},null,8,["modelValue","disabled"])]),_:1}),(0,r.bF)(l,{label:"集群版本"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:i.version,"onUpdate:modelValue":a[1]||(a[1]=e=>i.version=e),readonly:"",style:{width:"100%"},placeholder:"集群版本信息",disabled:o.value},{prefix:(0,r.k6)(()=>[(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Setting))]),_:1})]),_:1},8,["modelValue","disabled"]),(0,r.Lk)("div",Vh,[(0,r.bF)(c,{size:"small",type:"info"},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)("集群版本为只读信息，无法修改",-1)])),_:1,__:[5]})])]),_:1}),(0,r.bF)(l,{label:"集群凭证"},{default:(0,r.k6)(()=>[(0,r.bF)(mh,{modelValue:i.credential,"onUpdate:modelValue":a[2]||(a[2]=e=>i.credential=e),height:"180px",placeholder:"请输入或上传集群凭证配置",disabled:o.value},null,8,["modelValue","disabled"])]),_:1}),(0,r.bF)(l,{label:"描述信息"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{modelValue:i.description,"onUpdate:modelValue":a[3]||(a[3]=e=>i.description=e),type:"textarea",rows:2,placeholder:"请输入集群描述",disabled:o.value,maxlength:"200","show-word-limit":""},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])}}};const Ih=(0,p.A)(Sh,[["__scopeId","data-v-33f27a8e"]]);var Ah=Ih;const Rh={class:"k8s-cluster-management"},Dh={class:"card-header"},Ph={class:"header-actions"},$h={class:"form-row"},Th={class:"form-row"},Mh={class:"mode-tip"},Eh={class:"nodes-selection"},Wh={class:"node-section"},zh={class:"node-header"},Nh={class:"node-count"},Kh={key:0,class:"selected-tags"},Uh={class:"node-section"},Xh={class:"node-header"},qh={class:"node-count"},Hh={key:0,class:"selected-tags"},Bh={class:"node-section"},jh={class:"node-header"},Oh={class:"node-count"},Qh={key:0,class:"selected-tags"},Gh={key:1,class:"etcd-tip"},Yh={class:"plugin-single-line"},Jh={class:"plugin-group"},Zh={class:"plugin-buttons"},ek={class:"plugin-group"},ak={class:"plugin-buttons"},tk={class:"plugin-single-line"},lk={class:"plugin-group full-width"},sk={class:"plugin-buttons"},ok={class:"form-row"},nk={key:0,class:"private-registry-config"},ik={class:"form-row"},rk={class:"form-row"},dk={class:"dialog-footer"};var ck={__name:"k8s-clusters",setup(e){(0,v.rd)();const a=(0,Y.KR)(!1),t=(0,Y.KR)(null),l=(0,Y.KR)(0),s=(0,Y.KR)(!1),o=(0,Y.KR)(!1),n=(0,Y.KR)(!1),i=(0,Y.KR)(!1),d=(0,Y.Kh)({id:"",clusterName:"",version:"",credential:"",description:""}),c=(0,Y.Kh)({name:"",version:"1.30.4",description:"",nodeConfig:{masterHostIds:[],workerHostIds:[],etcdHostIds:[]},autoDeploy:!1,deploymentMode:1,networkPlugin:"calico",enabledComponents:["coredns"],usePrivateRegistry:!1,registryConfig:{privateRegistry:"crpi-aj3vgoxp9kzh2jx4.cn-hangzhou.personal.cr.aliyuncs.com/zhangfan_k8s",registryUsername:"zhangfan5391621",registryPassword:"zf5391621"}}),u=(0,Y.KR)(!1),p=(0,Y.KR)("Master"),m=(0,Y.KR)([]),g=(0,Y.KR)([]),h=(0,Y.KR)([]),k=(0,Y.Kh)({clusterName:"",content:""}),b=[{label:"Calico",value:"calico",description:"高性能网络插件，支持网络策略"},{label:"Flannel",value:"flannel",description:"轻量级网络插件，配置简单"}],f=[{label:"CoreDNS",value:"coredns",description:"Kubernetes集群DNS服务",required:!0}],y=[{label:"Metrics Server",value:"metrics-server",description:"集群资源监控"},{label:"Ingress Nginx",value:"ingress-nginx",description:"HTTP/HTTPS负载均衡"},{label:"Dashboard",value:"dashboard",description:"Kubernetes Web管理界面"},{label:"Prometheus",value:"prometheus",description:"监控和告警系统"},{label:"Grafana",value:"grafana",description:"监控数据可视化"}],_=[{label:"v1.30.4",value:"1.30.4"},{label:"v1.31.0",value:"1.31.0"},{label:"v1.32.0",value:"1.32.0"}],w=e=>{l.value++},L=e=>{l.value++},F=async e=>{console.log("handleClusterEdit 被调用，参数:",e);try{a.value=!0,console.log("调用后端API获取集群详情，ID:",e.id);const t=await ce.getClusterById(e.id),l=t.data||t;if(console.log("获取集群详情API响应:",l),200===l.code||l.success){const a=l.data.cluster||l.data;console.log("原始集群数据:",a),d.id=a.id||e.id,d.clusterName=a.name||e.clusterName,d.version=a.version||e.version||"",d.credential=a.credential||a.kubeconfig||e.credential||"",d.description=a.description||a.remark||e.description||"",console.log("编辑集群数据已填充:",{id:d.id,clusterName:d.clusterName,credentialLength:d.credential?.length||0}),n.value=!0}else J.nk.error(l.message||"获取集群详情失败")}catch(t){console.error("获取集群详情失败:",t),J.nk.error("获取集群详情失败，请检查网络连接")}finally{a.value=!1}},C=e=>{k.clusterName=e.clusterName,k.content=e.credential||"",i.value=!0},V=()=>{s.value=!0},S=()=>{o.value=!0,I()},I=async()=>{try{await ce.getClusterList()}catch(e){("ERR_NETWORK"===e.code||e.message.includes("ERR_CONNECTION_REFUSED"))&&J.nk.warning("后端服务未启动，主机选择功能可能不可用")}},A=e=>{p.value=e,u.value=!0},R=e=>{const a=e.map(e=>e.id);if("Master"===p.value){if(1===c.deploymentMode&&e.length>1)return void J.nk.warning("单节点模式只能选择一台Master节点主机");m.value=e,c.nodeConfig.masterHostIds=a,0===h.value.length&&(h.value=[...e],c.nodeConfig.etcdHostIds=[...a])}else"Worker"===p.value?(g.value=e,c.nodeConfig.workerHostIds=a):"ETCD"===p.value&&(h.value=e,c.nodeConfig.etcdHostIds=a);J.nk.success(`已选择 ${e.length} 台${p.value}节点主机`)},D=(e,a)=>{"Master"===a?(m.value=m.value.filter(a=>a.id!==e),c.nodeConfig.masterHostIds=c.nodeConfig.masterHostIds.filter(a=>a!==e)):"Worker"===a?(g.value=g.value.filter(a=>a.id!==e),c.nodeConfig.workerHostIds=c.nodeConfig.workerHostIds.filter(a=>a!==e)):"ETCD"===a&&(h.value=h.value.filter(a=>a.id!==e),c.nodeConfig.etcdHostIds=c.nodeConfig.etcdHostIds.filter(a=>a!==e))},P=()=>{const e=[...c.nodeConfig.masterHostIds,...c.nodeConfig.workerHostIds,...c.nodeConfig.etcdHostIds];return[...new Set(e)]},$=()=>{1===c.deploymentMode&&m.value.length>1&&uv.s.confirm("切换到单节点模式将只保留第一个Master节点，其他Master节点将被移除。是否继续？","模式切换确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=m.value[0];m.value=[e],c.nodeConfig.masterHostIds=[e.id],(0===h.value.length||h.value.some(a=>a.id===e.id))&&(h.value=[e],c.nodeConfig.etcdHostIds=[e.id]),J.nk.success("已切换到单节点模式，只保留一个Master节点")}).catch(()=>{c.deploymentMode=2})},T=()=>{console.log("注册成功，触发立即刷新"),l.value++,t.value&&t.value.handleQuery(),setTimeout(()=>{console.log("延时刷新，等待后端同步完成"),l.value++,t.value&&t.value.handleQuery()},3e3)},M=()=>{console.log("注册对话框已关闭")},E=()=>{console.log("编辑成功，触发表格刷新"),l.value++},W=()=>{console.log("编辑对话框已关闭")},z=async()=>{try{if(!c.name)return void J.nk.warning("请输入集群名称");if(!c.nodeConfig.masterHostIds.length)return void J.nk.warning("请选择Master节点");if(1===c.deploymentMode&&c.nodeConfig.masterHostIds.length>1)return void J.nk.warning("单节点模式只能选择1个Master节点");if(2===c.deploymentMode&&c.nodeConfig.masterHostIds.length<3)return void J.nk.warning("集群模式至少需要选择3个Master节点以确保高可用");c.nodeConfig.etcdHostIds.length||(c.nodeConfig.etcdHostIds=[...c.nodeConfig.masterHostIds]),c.enabledComponents.includes("coredns")||c.enabledComponents.push("coredns"),c.enabledComponents.includes(c.networkPlugin)||c.enabledComponents.push(c.networkPlugin);const e=await ce.createCluster(c),a=e.data||e;console.log("创建集群API响应:",a),200===a.code||a.success?(J.nk.success("K8s集群创建任务已提交成功！"),o.value=!1,N(),l.value++):J.nk.error(a.message||"创建集群失败")}catch(e){console.error("创建集群失败:",e),J.nk.error(e.response?.data?.message||"创建集群失败，请检查网络连接")}},N=()=>{c.name="",c.version="1.30.4",c.description="",c.nodeConfig.masterHostIds=[],c.nodeConfig.workerHostIds=[],c.nodeConfig.etcdHostIds=[],c.autoDeploy=!1,c.deploymentMode=1,c.networkPlugin="calico",c.enabledComponents=["coredns"],c.usePrivateRegistry=!1,c.registryConfig.privateRegistry="crpi-aj3vgoxp9kzh2jx4.cn-hangzhou.personal.cr.aliyuncs.com/zhangfan_k8s",c.registryConfig.registryUsername="zhangfan5391621",c.registryConfig.registryPassword="zf5391621",m.value=[],g.value=[],h.value=[]},K=e=>{const a=c.enabledComponents.indexOf(e);a>-1?"coredns"!==e&&c.enabledComponents.splice(a,1):c.enabledComponents.push(e)};return(0,r.sV)(()=>{}),(e,a)=>{const v=(0,r.g2)("el-button"),I=(0,r.g2)("el-card"),N=(0,r.g2)("el-input"),U=(0,r.g2)("el-form-item"),X=(0,r.g2)("el-option"),q=(0,r.g2)("el-select"),H=(0,r.g2)("el-radio"),B=(0,r.g2)("el-radio-group"),j=(0,r.g2)("el-switch"),O=(0,r.g2)("el-tag"),Q=(0,r.g2)("el-form"),G=(0,r.g2)("el-dialog"),J=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",Rh,[(0,r.bF)(I,{shadow:"hover",class:"cluster-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",Dh,[a[20]||(a[20]=(0,r.Lk)("span",{class:"title"},"K8s 集群管理",-1)),(0,r.Lk)("div",Ph,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:V},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)(" 注册集群 ",-1)])),_:1,__:[18]},8,["icon"])),[[J,["cloud:k8s:register"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"success",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:S},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)(" 创建集群 ",-1)])),_:1,__:[19]},8,["icon"])),[[J,["cloud:k8s:add"]]])])])]),default:(0,r.k6)(()=>[(0,r.bF)(Ov,{ref_key:"clusterTableRef",ref:t,"refresh-trigger":l.value,onClusterSync:w,onClusterEdit:F,onClusterDelete:L,onViewCredential:C},null,8,["refresh-trigger"])]),_:1}),(0,r.bF)(Ch,{visible:s.value,"onUpdate:visible":a[0]||(a[0]=e=>s.value=e),onSuccess:T,onClosed:M},null,8,["visible"]),(0,r.bF)(Ah,{visible:n.value,"onUpdate:visible":a[1]||(a[1]=e=>n.value=e),cluster:d,onSuccess:E,onClosed:W},null,8,["visible","cluster"]),(0,r.bF)(G,{modelValue:o.value,"onUpdate:modelValue":a[15]||(a[15]=e=>o.value=e),title:"创建 K8s 集群",width:"700px",class:"create-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",dk,[(0,r.bF)(v,{onClick:a[14]||(a[14]=e=>o.value=!1)},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("取消",-1)])),_:1,__:[31]}),(0,r.bF)(v,{type:"success",onClick:z},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.eW)("创建",-1)])),_:1,__:[32]})])]),default:(0,r.k6)(()=>[(0,r.bF)(Q,{model:c,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",$h,[(0,r.bF)(U,{label:"集群名称",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:c.name,"onUpdate:modelValue":a[2]||(a[2]=e=>c.name=e),placeholder:"请输入集群名称",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(U,{label:"K8s版本",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(q,{modelValue:c.version,"onUpdate:modelValue":a[3]||(a[3]=e=>c.version=e),style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(_,e=>(0,r.bF)(X,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),(0,r.Lk)("div",Th,[(0,r.bF)(U,{label:"部署模式",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:c.deploymentMode,"onUpdate:modelValue":a[4]||(a[4]=e=>c.deploymentMode=e),onChange:$,size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(H,{label:1},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)("单节点",-1)])),_:1,__:[21]}),(0,r.bF)(H,{label:2},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("集群",-1)])),_:1,__:[22]})]),_:1},8,["modelValue"]),(0,r.Lk)("div",Mh,(0,x.v_)(1===c.deploymentMode?"适合测试":"适合生产"),1)]),_:1}),(0,r.bF)(U,{label:"自动部署",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(j,{modelValue:c.autoDeploy,"onUpdate:modelValue":a[5]||(a[5]=e=>c.autoDeploy=e),"active-text":"立即部署","inactive-text":"稍后部署",size:"small"},null,8,["modelValue"]),a[23]||(a[23]=(0,r.Lk)("div",{class:"auto-deploy-tip"}," 开启后自动执行部署脚本 ",-1))]),_:1,__:[23]})]),(0,r.bF)(U,{label:"节点配置",required:"",class:"nodes-config"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Eh,[(0,r.Lk)("div",Wh,[(0,r.Lk)("div",zh,[(0,r.bF)(v,{type:"primary",size:"small",onClick:a[6]||(a[6]=e=>A("Master"))},{default:(0,r.k6)(()=>[(0,r.eW)(" Master"+(0,x.v_)(1===c.deploymentMode?"(1台)":"(≥3台)"),1)]),_:1}),(0,r.Lk)("span",Nh,(0,x.v_)(m.value.length)+"台",1)]),m.value.length>0?((0,r.uX)(),(0,r.CE)("div",Kh,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,e=>((0,r.uX)(),(0,r.Wv)(O,{key:e.id,closable:"",onClose:a=>D(e.id,"Master"),type:"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.name),1)]),_:2},1032,["onClose"]))),128))])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Uh,[(0,r.Lk)("div",Xh,[(0,r.bF)(v,{type:"info",size:"small",onClick:a[7]||(a[7]=e=>A("Worker"))},{default:(0,r.k6)(()=>a[24]||(a[24]=[(0,r.eW)(" Worker(可选) ",-1)])),_:1,__:[24]}),(0,r.Lk)("span",qh,(0,x.v_)(g.value.length)+"台",1)]),g.value.length>0?((0,r.uX)(),(0,r.CE)("div",Hh,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,e=>((0,r.uX)(),(0,r.Wv)(O,{key:e.id,closable:"",onClose:a=>D(e.id,"Worker"),type:"primary",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.name),1)]),_:2},1032,["onClose"]))),128))])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",Bh,[(0,r.Lk)("div",jh,[(0,r.bF)(v,{type:"warning",size:"small",onClick:a[8]||(a[8]=e=>A("ETCD"))},{default:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)(" ETCD(可选) ",-1)])),_:1,__:[25]}),(0,r.Lk)("span",Oh,(0,x.v_)(h.value.length)+"台",1)]),h.value.length>0?((0,r.uX)(),(0,r.CE)("div",Qh,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.value,e=>((0,r.uX)(),(0,r.Wv)(O,{key:e.id,closable:"",onClose:a=>D(e.id,"ETCD"),type:"warning",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.name),1)]),_:2},1032,["onClose"]))),128))])):((0,r.uX)(),(0,r.CE)("div",Gh,"默认使用Master节点"))])])]),_:1}),(0,r.bF)(U,{label:"网络插件",required:""},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Yh,[(0,r.Lk)("div",Jh,[(0,r.Lk)("div",Zh,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(b,e=>(0,r.bF)(v,{key:e.value,type:c.networkPlugin===e.value?"primary":"",plain:c.networkPlugin!==e.value,size:"small",onClick:a=>c.networkPlugin=e.value},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label),1)]),_:2},1032,["type","plain","onClick"])),64))])]),(0,r.Lk)("div",ek,[a[27]||(a[27]=(0,r.Lk)("span",{class:"plugin-label"},"必选组件:",-1)),(0,r.Lk)("div",ak,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(f,e=>(0,r.bF)(v,{key:e.value,type:"success",size:"small",disabled:""},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label)+" ",1),(0,r.bF)(O,{type:"success",size:"small",style:{"margin-left":"4px"}},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("必选",-1)])),_:1,__:[26]})]),_:2},1024)),64))])])])]),_:1}),(0,r.bF)(U,{label:"可选组件"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",tk,[(0,r.Lk)("div",lk,[(0,r.Lk)("div",sk,[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(y,e=>(0,r.bF)(v,{key:e.value,type:c.enabledComponents.includes(e.value)?"warning":"",plain:!c.enabledComponents.includes(e.value),size:"small",onClick:a=>K(e.value)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label),1)]),_:2},1032,["type","plain","onClick"])),64))])])])]),_:1}),(0,r.bF)(U,{label:"镜像仓库",class:"registry-config"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ok,[(0,r.bF)(U,{label:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(j,{modelValue:c.usePrivateRegistry,"onUpdate:modelValue":a[9]||(a[9]=e=>c.usePrivateRegistry=e),"active-text":"使用私有仓库","inactive-text":"使用默认仓库",size:"small"},null,8,["modelValue"])]),_:1})]),c.usePrivateRegistry?((0,r.uX)(),(0,r.CE)("div",nk,[(0,r.Lk)("div",ik,[(0,r.bF)(U,{label:"",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:c.registryConfig.privateRegistry,"onUpdate:modelValue":a[10]||(a[10]=e=>c.registryConfig.privateRegistry=e),placeholder:"私有镜像仓库地址，如：registry.example.com",size:"small"},{prepend:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)("仓库地址",-1)])),_:1},8,["modelValue"])]),_:1})]),(0,r.Lk)("div",rk,[(0,r.bF)(U,{label:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:c.registryConfig.registryUsername,"onUpdate:modelValue":a[11]||(a[11]=e=>c.registryConfig.registryUsername=e),placeholder:"仓库用户名",size:"small"},{prepend:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)("用户名",-1)])),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(U,{label:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:c.registryConfig.registryPassword,"onUpdate:modelValue":a[12]||(a[12]=e=>c.registryConfig.registryPassword=e),type:"password",placeholder:"仓库密码",size:"small","show-password":""},{prepend:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("密码",-1)])),_:1},8,["modelValue"])]),_:1})])])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(U,{label:"描述信息"},{default:(0,r.k6)(()=>[(0,r.bF)(N,{modelValue:c.description,"onUpdate:modelValue":a[13]||(a[13]=e=>c.description=e),type:"textarea",rows:2,placeholder:"请输入集群描述",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(_h,{visible:i.value,"onUpdate:visible":a[16]||(a[16]=e=>i.value=e),credential:k},null,8,["visible","credential"]),(0,r.bF)($v,{modelValue:u.value,"onUpdate:modelValue":a[17]||(a[17]=e=>u.value=e),"node-type":p.value,"exclude-hosts":P(),multiple:!("Master"===p.value&&1===c.deploymentMode),onHostsSelected:R},null,8,["modelValue","node-type","exclude-hosts","multiple"])])}}};const uk=(0,p.A)(ck,[["__scopeId","data-v-7c924854"]]);var pk=uk,mk=t.p+"static/img/标签.a19053ad.svg";const gk={class:"table-section"},vk={class:"node-name-container"},hk={class:"version-text"},kk={class:"label-container"},bk={class:"resource-info"},fk={class:"resource-item"},yk={class:"resource-value"},_k={class:"resource-item"},wk={class:"resource-value"},Lk={class:"taint-container"},Fk={class:"operation-buttons"};var Ck={__name:"NodesTable",props:{tableData:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},selectedClusterId:{type:[String,Number],required:!0}},emits:["viewResources","manageTaints","manageLabels","viewNodeLabels","toggleCordon","drainNode"],setup(e,{emit:a}){const t=e,l=a,s=(0,v.rd)(),o=e=>{s.push(`/k8s/cluster/${t.selectedClusterId}/node/${e.nodeName}`)},n=e=>{switch(e){case"Ready":return"success";case"NotReady":return"danger";case"SchedulingDisabled":return"warning";default:return"info"}},i=e=>{switch(e){case"Ready":return"就绪";case"NotReady":return"未就绪";case"SchedulingDisabled":return"调度禁用";default:return"未知"}},d=e=>{switch(e){case"master":case"control-plane":return"danger";case"worker":return"success";default:return"info"}},c=e=>{switch(e){case"master":case"control-plane":return"主节点";case"worker":return"工作节点";default:return"未知"}},u=e=>e?Object.keys(e).length:0,p=e=>{l("viewResources",e)},m=e=>{l("manageTaints",e)},g=e=>{l("manageLabels",e)},h=e=>{l("viewNodeLabels",e)},k=e=>{l("toggleCordon",e)},b=e=>{l("drainNode",e)};return(a,t)=>{const l=(0,r.g2)("el-button"),s=(0,r.g2)("el-table-column"),v=(0,r.g2)("el-tag"),f=(0,r.g2)("el-badge"),y=(0,r.g2)("el-icon"),_=(0,r.g2)("el-tooltip"),w=(0,r.g2)("el-table"),L=(0,r.gN)("authority"),F=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",gk,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(w,{data:e.tableData,stripe:"",style:{width:"100%"},class:"nodes-table"},{default:(0,r.k6)(()=>[(0,r.bF)(s,{prop:"nodeName",label:"节点名称","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",vk,[t[0]||(t[0]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"},null,-1)),(0,r.bF)(l,{type:"primary",link:"",onClick:a=>o(e),class:"node-name-link"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.nodeName),1)]),_:2},1032,["onClick"])])]),_:1}),(0,r.bF)(s,{prop:"status",label:"状态","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:n(e.status),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(i(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(s,{prop:"role",label:"角色","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:d(e.role),size:"small",effect:"plain"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c(e.role)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(s,{prop:"version",label:"Kubelet版本","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",hk,(0,x.v_)(e.version),1)]),_:1}),(0,r.bF)(s,{label:"标签","min-width":"100",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",kk,[(0,r.bF)(f,{value:u(e.labels),max:99,class:"label-badge"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{type:"text",size:"small",circle:"",onClick:a=>h(e),class:"label-icon-button"},{default:(0,r.k6)(()=>t[1]||(t[1]=[(0,r.Lk)("img",{src:mk,alt:"标签",width:"14",height:"14"},null,-1)])),_:2,__:[1]},1032,["onClick"])]),_:2},1032,["value"])])]),_:1}),(0,r.bF)(s,{prop:"age",label:"运行时间","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.age),1)]),_:2},1024)]),_:1}),(0,r.bF)(s,{label:"CPU/内存","min-width":"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",bk,[(0,r.Lk)("div",fk,[t[2]||(t[2]=(0,r.Lk)("span",{class:"resource-label"},"CPU:",-1)),(0,r.Lk)("span",yk,(0,x.v_)(e.cpu),1)]),(0,r.Lk)("div",_k,[t[3]||(t[3]=(0,r.Lk)("span",{class:"resource-label"},"Memory:",-1)),(0,r.Lk)("span",wk,(0,x.v_)(e.memory),1)])])]),_:1}),(0,r.bF)(s,{prop:"pods",label:"Pod数量","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{size:"small",type:"warning"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.pods),1)]),_:2},1024)]),_:1}),(0,r.bF)(s,{label:"调度状态","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:e.schedulable?"success":"danger",size:"small",icon:e.schedulable?(0,Y.R1)(vc.CircleCheck):(0,Y.R1)(vc.Lock)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.schedulable?"可调度":"已封锁"),1)]),_:2},1032,["type","icon"])]),_:1}),(0,r.bF)(s,{label:"污点数量","min-width":"90",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Lk,[(0,r.bF)(f,{value:e.taints.length,max:99,class:"taint-badge"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{size:"18",class:"taint-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Warning))]),_:1})]),_:2},1032,["value"])])]),_:1}),(0,r.bF)(s,{label:"操作",width:"280",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Fk,[(0,r.bF)(_,{content:"资源详情",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(l,{type:"success",icon:(0,Y.R1)(vc.Monitor),size:"small",circle:"",onClick:a=>p(e)},null,8,["icon","onClick"]),[[L,["k8s:node:details"]]])]),_:2},1024),(0,r.bF)(_,{content:"管理污点",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(l,{type:"warning",icon:(0,Y.R1)(vc.Warning),size:"small",circle:"",onClick:a=>m(e)},null,8,["icon","onClick"]),[[L,["k8s:node:stain"]]])]),_:2},1024),(0,r.bF)(_,{content:"管理标签",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(l,{type:"info",icon:(0,Y.R1)(vc.Edit),size:"small",circle:"",onClick:a=>g(e)},null,8,["icon","onClick"]),[[L,["k8s:node:label"]]])]),_:2},1024),(0,r.bF)(_,{content:e.schedulable?"封锁节点":"解封节点",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(l,{type:e.schedulable?"danger":"success",icon:e.schedulable?(0,Y.R1)(vc.Lock):(0,Y.R1)(vc.Unlock),size:"small",circle:"",onClick:a=>k(e)},null,8,["type","icon","onClick"]),[[L,["k8s:node:close"]]])]),_:2},1032,["content"]),(0,r.bF)(_,{content:"驱逐节点",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(l,{type:"danger",icon:(0,Y.R1)(vc.SwitchButton),size:"small",circle:"",onClick:a=>b(e),disabled:!e.schedulable},null,8,["icon","onClick","disabled"]),[[L,["k8s:node:expel"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[F,e.loading]])])}}};const Vk=(0,p.A)(Ck,[["__scopeId","data-v-926660e2"]]);var xk=Vk;const Sk={class:"k8s-nodes-management"},Ik={class:"card-header"},Ak={class:"header-actions"},Rk={class:"cluster-option"},Dk={class:"cluster-name"},Pk={class:"search-section"},$k={key:0,class:"resources-content"},Tk={class:"resources-overview"},Mk={class:"resource-progress"},Ek={class:"resource-details"},Wk={class:"resource-progress"},zk={class:"resource-details"},Nk={class:"resource-progress"},Kk={class:"resource-details"},Uk={key:0,class:"pods-section"},Xk={class:"effect-option"},qk={class:"effect-label"},Hk={class:"effect-description"},Bk={class:"taint-option"},jk={class:"dialog-footer"},Ok={class:"label-option"},Qk={class:"dialog-footer"},Gk={class:"dialog-footer"},Yk={key:0,class:"labels-view-content"},Jk={key:0,class:"labels-section"},Zk={class:"labels-list"},eb={key:1,class:"labels-section"},ab={class:"labels-list"},tb={key:2,class:"no-labels"},lb=e=>e<60?"#67c23a":e<80?"#e6a23c":"#f56c6c";var sb={__name:"k8s-nodes",setup(e){const a=(0,v.rd)(),t=(0,Y.KR)(!1),l=(0,Y.Kh)({nodeName:"",status:"",role:""}),s=[{label:"全部",value:""},{label:"就绪",value:"Ready"},{label:"未就绪",value:"NotReady"},{label:"不可调度",value:"SchedulingDisabled"},{label:"未知",value:"Unknown"}],o=[{label:"全部",value:""},{label:"Master",value:"master"},{label:"Worker",value:"worker"},{label:"Control-plane",value:"control-plane"}],n=(0,Y.KR)([]),d=(0,Y.KR)(""),c=(0,Y.KR)([]),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(!1),g=(0,Y.KR)(!1),h=(0,Y.KR)(!1),k=(0,Y.KR)({}),b=(0,Y.Kh)({operation:"add",key:"",value:"",effect:"NoSchedule",selectedTaint:null}),f=(0,Y.Kh)({operation:"add",key:"",value:"",selectedLabel:null}),y=(0,Y.Kh)({force:!1,deleteLocalData:!1,ignoreDaemonSets:!0,gracePeriodSeconds:30}),_=(0,Y.KR)({}),w=[{label:"NoSchedule - 禁止调度",value:"NoSchedule",description:"不允许新Pod调度到此节点，但不影响已运行的Pod"},{label:"PreferNoSchedule - 尽量避免调度",value:"PreferNoSchedule",description:"尽量避免新Pod调度到此节点，但在资源不足时仍可调度"},{label:"NoExecute - 禁止执行",value:"NoExecute",description:"不允许新Pod调度，且会驱逐不能容忍此污点的已运行Pod"}],L=async()=>{try{const e=await ce.getClusterList(),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];if(c.value=e.map(e=>({id:e.id,name:e.name,status:e.status})),c.value.length>0&&!d.value){const e=c.value.find(e=>2===e.status);d.value=e?e.id:c.value[0].id}console.log("集群列表加载成功:",c.value)}else J.nk.error(a.message||"获取集群列表失败")}catch(e){console.error("获取集群列表失败:",e),J.nk.warning("无法获取集群列表，请检查后端服务")}},F=async()=>{try{if(!d.value)return void J.nk.warning("请选择一个集群");t.value=!0;const e={};l.nodeName&&(e.name=l.nodeName),l.status&&(e.status=l.status),l.role&&(e.role=l.role);const a=await ce.getClusterNodes(d.value,Object.keys(e).length>0?e:void 0),s=a.data||a;if(console.log("节点列表API响应:",s),200===s.code||s.success){const e=s.data||[];n.value=e.map(e=>({id:e.name,nodeName:e.name,status:e.status||"Unknown",role:"control-plane,master"===e.roles?"master":"worker",version:e.runtime?.kubeletVersion||"Unknown",age:C(e.createdAt),cpu:`${e.resources?.cpu?.allocatable||"Unknown"}`,memory:V(e.resources?.memory?.allocatable||"0"),pods:`${e.podMetrics?.allocated||0}/${e.podMetrics?.total||0}`,schedulable:!e.scheduling?.unschedulable,taints:e.scheduling?.taints||[],labels:e.configuration?.labels||{},conditions:e.conditions||[],nodeInfo:e.runtime||{},allocatedResources:e.resources||{},internalIP:e.internalIP,externalIP:e.externalIP,configuration:e.configuration,runtime:e.runtime})),console.log("节点列表加载成功:",n.value)}else J.nk.error(s.message||"获取节点列表失败"),n.value=[]}catch(e){console.error("获取节点列表失败:",e),"ERR_NETWORK"===e.code||e.message?.includes("ERR_CONNECTION_REFUSED")||e.message?.includes("Failed to fetch")?J.nk.warning("后端服务连接失败，请检查服务状态"):401===e.response?.status?J.nk.error("认证失败，请重新登录"):403===e.response?.status?J.nk.error("权限不足，请联系管理员"):console.warn("API调用异常，但可能数据已正确加载"),n.value=[]}finally{t.value=!1}},C=e=>{if(!e)return"Unknown";const a=new Date,t=new Date(e),l=Math.floor((a-t)/1e3);return l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:l<86400?`${Math.floor(l/3600)}h`:`${Math.floor(l/86400)}d`},V=e=>{if(!e||"0"===e)return"Unknown";if(e.endsWith("Ki")){const a=parseInt(e.replace("Ki","")),t=(a/1024/1024).toFixed(1);return`${t}GB`}if(e.endsWith("Mi")){const a=parseInt(e.replace("Mi","")),t=(a/1024).toFixed(1);return`${t}GB`}if(e.endsWith("Gi")){const a=parseInt(e.replace("Gi",""));return`${a}GB`}return e},S=()=>{l.nodeName="",l.status="",l.role="",F()},I=()=>{a.push("/k8s/monitoring")},A=()=>{d.value?F():n.value=[]},R=async e=>{try{t.value=!0;const a=await ce.getNodeResources(d.value,e.nodeName),l=a.data||a;if(200===l.code||l.success){const a=l.data;_.value={cpu:{capacity:a.capacity?.cpu||"0",allocatable:a.allocatable?.cpu||"0",allocated:a.allocated?.cpu||"0"},memory:{capacity:a.capacity?.memory||"0",allocatable:a.allocatable?.memory||"0",allocated:q(a.allocated?.memory||"0")},pods:{capacity:parseInt(a.capacity?.pods||"0"),allocatable:parseInt(a.allocatable?.pods||"0"),allocated:a.podList?.length||0},podList:a.podList||[]},k.value=e,m.value=!0,console.log("资源详情数据:",_.value)}else J.nk.error(l.message||"获取资源详情失败")}catch(a){console.error("获取资源详情失败:",a),J.nk.error("获取资源详情失败，请检查网络连接")}finally{t.value=!1}},D=e=>{k.value=e,b.operation="add",b.key="",b.value="",b.effect="NoSchedule",b.selectedTaint=null,u.value=!0},P=e=>{k.value=e,f.operation="add",f.key="",f.value="",f.selectedLabel=null,p.value=!0},$=async e=>{try{const a=e.schedulable?"封锁":"解封";await uv.s.confirm(`确定要${a}节点 ${e.nodeName} 吗？`,`${a}节点确认`,{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await ce.cordonNode(d.value,e.nodeName,{unschedulable:e.schedulable,reason:`手动${a}节点`}),l=t.data||t;200===l.code||l.success?(J.nk.success(`节点 ${e.nodeName} ${a}成功`),F()):J.nk.error(l.message||`${a}节点失败`)}catch(a){"cancel"===a?J.nk.info("已取消操作"):(console.error("节点封锁操作失败:",a),J.nk.error("操作失败，请检查网络连接"))}},T=e=>{k.value=e,y.force=!1,y.deleteLocalData=!1,y.ignoreDaemonSets=!0,y.gracePeriodSeconds=30,g.value=!0},M=async()=>{try{let e={};if("add"===b.operation){if(!b.key)return void J.nk.warning("请输入污点键名");e={key:b.key,value:b.value,effect:b.effect}}else{if(!b.selectedTaint)return void J.nk.warning("请选择要移除的污点");e={key:b.selectedTaint.key,effect:b.selectedTaint.effect},b.selectedTaint.value&&(e.value=b.selectedTaint.value)}const a="add"===b.operation?ce.addNodeTaint(d.value,k.value.nodeName,e):ce.removeNodeTaint(d.value,k.value.nodeName,e),t=await a,l=t.data||t;200===l.code||l.success?(J.nk.success(`污点${"add"===b.operation?"添加":"移除"}成功`),u.value=!1,F()):J.nk.error(l.message||"操作失败")}catch(e){console.error("污点操作失败:",e),J.nk.error("操作失败，请检查网络连接")}},E=async()=>{try{let e={};if("add"===f.operation){if(!f.key)return void J.nk.warning("请输入标签键名");e={key:f.key,value:f.value}}else{if(!f.selectedLabel)return void J.nk.warning("请选择要移除的标签");e={key:f.selectedLabel.key}}const a="add"===f.operation?ce.addNodeLabel(d.value,k.value.nodeName,e):ce.removeNodeLabel(d.value,k.value.nodeName,e),t=await a,l=t.data||t;200===l.code||l.success?(J.nk.success(`标签${"add"===f.operation?"添加":"移除"}成功`),p.value=!1,F()):J.nk.error(l.message||"操作失败")}catch(e){console.error("标签操作失败:",e),J.nk.error("操作失败，请检查网络连接")}},W=async()=>{try{await uv.s.confirm(`确定要驱逐节点 ${k.value.nodeName} 上的所有Pod吗？这将会影响运行中的服务！`,"驱逐节点确认",{confirmButtonText:"确定驱逐",cancelButtonText:"取消",type:"warning"});const e=await ce.drainNode(d.value,k.value.nodeName,y),a=e.data||e;200===a.code||a.success?(J.nk.success(`节点 ${k.value.nodeName} 驱逐成功`),g.value=!1,F()):J.nk.error(a.message||"驱逐失败")}catch(e){"cancel"===e?J.nk.info("已取消驱逐操作"):(console.error("节点驱逐失败:",e),J.nk.error("驱逐失败，请检查网络连接"))}},z=(0,r.EW)(()=>k.value&&k.value.taints?k.value.taints.map(e=>({label:`${e.key}=${e.value||""}:${e.effect}`,value:e,taint:e})):[]),N=(0,r.EW)(()=>{if(!k.value||!k.value.labels)return[];const e=["kubernetes.io/","beta.kubernetes.io/","node-role.kubernetes.io/","node.kubernetes.io/"];return Object.entries(k.value.labels).filter(([a])=>!e.some(e=>a.startsWith(e))).map(([e,a])=>({label:`${e}=${a}`,value:{key:e,value:a},labelData:{key:e,value:a}}))}),K=e=>{const a={1:"info",2:"success",3:"warning",4:"danger",5:"info"};return a[e]||"info"},U=e=>{const a={1:"创建中",2:"运行中",3:"已停止",4:"异常",5:"已删除"};return a[e]||"未知"},X=async(e,a="已复制到剪贴板")=>{try{await navigator.clipboard.writeText(e),J.nk.success(a)}catch(t){console.error("复制失败:",t);const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select();try{document.execCommand("copy"),J.nk.success(a)}catch(l){J.nk.error("复制失败，请手动复制")}document.body.removeChild(s)}},q=e=>{if(!e||"0"===e)return"0Ki";const a=parseInt(e);if(isNaN(a))return"0Ki";const t=Math.round(a/1024);return`${t}Ki`},H=e=>{if(!e||!e.allocatable||!e.allocated)return 0;const a=e=>e?e.endsWith("m")?parseFloat(e.replace("m","")):1e3*parseFloat(e):0,t=a(e.allocatable),l=a(e.allocated);return console.log("CPU计算:",{allocatable:e.allocatable,allocated:e.allocated,allocatableMillicores:t,allocatedMillicores:l,percentage:t>0?Math.round(l/t*100):0}),0===t?0:Math.round(l/t*100)},B=e=>{if(!e||!e.allocatable||!e.allocated)return 0;const a=e=>e?e.endsWith("Ki")?parseInt(e.replace("Ki","")):e.endsWith("Mi")?1024*parseInt(e.replace("Mi","")):e.endsWith("Gi")?1024*parseInt(e.replace("Gi",""))*1024:parseInt(e)||0:0,t=a(e.allocatable),l=a(e.allocated);return 0===t?0:Math.round(l/t*100)},j=e=>{if(!e||!e.allocatable||"undefined"===typeof e.allocated)return 0;const a=parseInt(e.allocatable)||0,t=parseInt(e.allocated)||0;return 0===a?0:Math.round(t/a*100)},O=e=>{k.value=e,h.value=!0},Q=e=>{if(!e)return{};const a=["kubernetes.io/","beta.kubernetes.io/","node-role.kubernetes.io/","node.kubernetes.io/"],t={};return Object.entries(e).forEach(([e,l])=>{a.some(a=>e.startsWith(a))||(t[e]=l)}),t},G=e=>{if(!e)return{};const a=["kubernetes.io/","beta.kubernetes.io/","node-role.kubernetes.io/","node.kubernetes.io/"],t={};return Object.entries(e).forEach(([e,l])=>{a.some(a=>e.startsWith(a))&&(t[e]=l)}),t};return(0,r.sV)(async()=>{await L(),d.value&&F()}),(e,a)=>{const v=(0,r.g2)("el-tag"),L=(0,r.g2)("el-option"),C=(0,r.g2)("el-select"),q=(0,r.g2)("el-input"),J=(0,r.g2)("el-form-item"),Z=(0,r.g2)("el-button"),ee=(0,r.g2)("el-form"),ae=(0,r.g2)("el-card"),te=(0,r.g2)("el-progress"),le=(0,r.g2)("el-col"),se=(0,r.g2)("el-row"),oe=(0,r.g2)("el-table-column"),ne=(0,r.g2)("el-table"),ie=(0,r.g2)("el-dialog"),re=(0,r.g2)("el-radio"),de=(0,r.g2)("el-radio-group"),ce=(0,r.g2)("el-alert"),ue=(0,r.g2)("el-switch"),pe=(0,r.g2)("el-input-number"),me=(0,r.g2)("el-icon"),ge=(0,r.g2)("el-empty");return(0,r.uX)(),(0,r.CE)("div",Sk,[(0,r.bF)(ae,{shadow:"hover",class:"nodes-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",Ik,[a[25]||(a[25]=(0,r.Lk)("span",{class:"title"},"K8s 节点管理",-1)),(0,r.Lk)("div",Ak,[(0,r.bF)(C,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"请选择集群",size:"small",style:{width:"250px"},onChange:A,loading:!c.value.length},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(c.value,e=>((0,r.uX)(),(0,r.Wv)(L,{key:e.id,label:`${e.name} ${U(e.status)}`,value:e.id,disabled:2!==e.status},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Rk,[(0,r.Lk)("span",Dk,(0,x.v_)(e.name),1),(0,r.bF)(v,{type:K(e.status),size:"small",class:"cluster-status-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(U(e.status)),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",Pk,[(0,r.bF)(ee,{inline:!0,model:l,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(J,{label:"节点名称"},{default:(0,r.k6)(()=>[(0,r.bF)(q,{modelValue:l.nodeName,"onUpdate:modelValue":a[1]||(a[1]=e=>l.nodeName=e),placeholder:"请输入节点名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(F,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(J,{label:"节点状态"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:l.status,"onUpdate:modelValue":a[2]||(a[2]=e=>l.status=e),placeholder:"请选择状态",clearable:"",size:"small",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(s,e=>(0,r.bF)(L,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(J,{label:"节点角色"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:l.role,"onUpdate:modelValue":a[3]||(a[3]=e=>l.role=e),placeholder:"请选择角色",clearable:"",size:"small",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(o,e=>(0,r.bF)(L,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(J,null,{default:(0,r.k6)(()=>[(0,r.bF)(Z,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:F},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[26]},8,["icon"]),(0,r.bF)(Z,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:S},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.eW)(" 重置 ",-1)])),_:1,__:[27]},8,["icon"]),(0,r.bF)(Z,{icon:(0,Y.R1)(vc.Monitor),type:"success",size:"small",onClick:I},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)(" 监控仪表板 ",-1)])),_:1,__:[28]},8,["icon"])]),_:1})]),_:1},8,["model"])]),(0,r.bF)(xk,{"table-data":n.value,loading:t.value,"selected-cluster-id":d.value,onViewResources:R,onManageTaints:D,onManageLabels:P,onViewNodeLabels:O,onToggleCordon:$,onDrainNode:T},null,8,["table-data","loading","selected-cluster-id"])]),_:1}),(0,r.bF)(ie,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=e=>m.value=e),title:`资源详情 - ${k.value.nodeName||""}`,width:"900px",class:"resources-dialog"},{default:(0,r.k6)(()=>[_.value?((0,r.uX)(),(0,r.CE)("div",$k,[(0,r.Lk)("div",Tk,[(0,r.bF)(se,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(le,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(ae,{class:"resource-card"},{default:(0,r.k6)(()=>[a[29]||(a[29]=(0,r.Lk)("div",{class:"resource-header"},[(0,r.Lk)("span",{class:"resource-title"},"CPU"),(0,r.Lk)("span",{class:"resource-unit"},"cores")],-1)),(0,r.Lk)("div",Mk,[(0,r.bF)(te,{percentage:H(_.value.cpu),color:lb(H(_.value.cpu))},null,8,["percentage","color"])]),(0,r.Lk)("div",Ek,[(0,r.Lk)("span",null,"已分配: "+(0,x.v_)(_.value.cpu?.allocated||"0"),1),(0,r.Lk)("span",null,"总容量: "+(0,x.v_)(_.value.cpu?.allocatable||"0"),1)])]),_:1,__:[29]})]),_:1}),(0,r.bF)(le,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(ae,{class:"resource-card"},{default:(0,r.k6)(()=>[a[30]||(a[30]=(0,r.Lk)("div",{class:"resource-header"},[(0,r.Lk)("span",{class:"resource-title"},"内存"),(0,r.Lk)("span",{class:"resource-unit"},"GB")],-1)),(0,r.Lk)("div",Wk,[(0,r.bF)(te,{percentage:B(_.value.memory),color:lb(B(_.value.memory))},null,8,["percentage","color"])]),(0,r.Lk)("div",zk,[(0,r.Lk)("span",null,"已分配: "+(0,x.v_)(V(_.value.memory?.allocated||"0")),1),(0,r.Lk)("span",null,"总容量: "+(0,x.v_)(V(_.value.memory?.allocatable||"0")),1)])]),_:1,__:[30]})]),_:1}),(0,r.bF)(le,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(ae,{class:"resource-card"},{default:(0,r.k6)(()=>[a[31]||(a[31]=(0,r.Lk)("div",{class:"resource-header"},[(0,r.Lk)("span",{class:"resource-title"},"Pod"),(0,r.Lk)("span",{class:"resource-unit"},"个")],-1)),(0,r.Lk)("div",Nk,[(0,r.bF)(te,{percentage:j(_.value.pods),color:lb(j(_.value.pods))},null,8,["percentage","color"])]),(0,r.Lk)("div",Kk,[(0,r.Lk)("span",null,"运行中: "+(0,x.v_)(_.value.pods?.allocated||0),1),(0,r.Lk)("span",null,"最大容量: "+(0,x.v_)(_.value.pods?.allocatable||0),1)])]),_:1,__:[31]})]),_:1})]),_:1})]),_.value.podList&&_.value.podList.length>0?((0,r.uX)(),(0,r.CE)("div",Uk,[a[32]||(a[32]=(0,r.Lk)("h4",null,"Pod列表",-1)),(0,r.bF)(ne,{data:_.value.podList,size:"small",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{prop:"name",label:"Pod名称","min-width":"200"}),(0,r.bF)(oe,{prop:"namespace",label:"命名空间","min-width":"120"}),(0,r.bF)(oe,{label:"CPU请求","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.requests?.cpu||"-"),1)]),_:1}),(0,r.bF)(oe,{label:"内存请求","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.requests?.memory||"-"),1)]),_:1}),(0,r.bF)(oe,{label:"CPU限制","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.limits?.cpu||"-"),1)]),_:1}),(0,r.bF)(oe,{label:"内存限制","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.limits?.memory||"-"),1)]),_:1})]),_:1},8,["data"])])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"]),(0,r.bF)(ie,{modelValue:u.value,"onUpdate:modelValue":a[11]||(a[11]=e=>u.value=e),title:`管理污点 - ${k.value.nodeName||""}`,width:"500px",class:"taint-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",jk,[(0,r.bF)(Z,{onClick:a[10]||(a[10]=e=>u.value=!1)},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)("取消",-1)])),_:1,__:[35]}),(0,r.bF)(Z,{type:"primary",onClick:M,disabled:"remove"===b.operation&&0===z.value.length},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)("add"===b.operation?"添加污点":"移除污点"),1)]),_:1},8,["disabled"])])]),default:(0,r.k6)(()=>[(0,r.bF)(ee,{model:b,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(J,{label:"操作类型",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(de,{modelValue:b.operation,"onUpdate:modelValue":a[5]||(a[5]=e=>b.operation=e)},{default:(0,r.k6)(()=>[(0,r.bF)(re,{label:"add"},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("添加污点",-1)])),_:1,__:[33]}),(0,r.bF)(re,{label:"remove"},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("移除污点",-1)])),_:1,__:[34]})]),_:1},8,["modelValue"])]),_:1}),"add"===b.operation?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(J,{label:"污点键名",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(q,{modelValue:b.key,"onUpdate:modelValue":a[6]||(a[6]=e=>b.key=e),placeholder:"请输入污点键名，如：maintenance"},null,8,["modelValue"])]),_:1}),(0,r.bF)(J,{label:"污点值"},{default:(0,r.k6)(()=>[(0,r.bF)(q,{modelValue:b.value,"onUpdate:modelValue":a[7]||(a[7]=e=>b.value=e),placeholder:"请输入污点值，如：scheduled（可选）"},null,8,["modelValue"])]),_:1}),(0,r.bF)(J,{label:"污点效果",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:b.effect,"onUpdate:modelValue":a[8]||(a[8]=e=>b.effect=e),style:{width:"100%"},placeholder:"请选择污点效果"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(w,e=>(0,r.bF)(L,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Xk,[(0,r.Lk)("div",qk,(0,x.v_)(e.label),1),(0,r.Lk)("div",Hk,(0,x.v_)(e.description),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[z.value.length>0?((0,r.uX)(),(0,r.Wv)(J,{key:0,label:"选择污点",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:b.selectedTaint,"onUpdate:modelValue":a[9]||(a[9]=e=>b.selectedTaint=e),style:{width:"100%"},placeholder:"请选择要移除的污点","value-key":"key"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(z.value,e=>((0,r.uX)(),(0,r.Wv)(L,{key:e.label,label:e.label,value:e.taint},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Bk,[(0,r.bF)(v,{type:"warning",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):((0,r.uX)(),(0,r.Wv)(J,{key:1},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{title:"该节点没有污点",type:"info",description:"当前节点没有污点，无需移除操作","show-icon":"",closable:!1})]),_:1}))],64))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,r.bF)(ie,{modelValue:p.value,"onUpdate:modelValue":a[17]||(a[17]=e=>p.value=e),title:`管理标签 - ${k.value.nodeName||""}`,width:"500px",class:"label-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Qk,[(0,r.bF)(Z,{onClick:a[16]||(a[16]=e=>p.value=!1)},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)("取消",-1)])),_:1,__:[38]}),(0,r.bF)(Z,{type:"primary",onClick:E,disabled:"remove"===f.operation&&0===N.value.length},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)("add"===f.operation?"添加标签":"移除标签"),1)]),_:1},8,["disabled"])])]),default:(0,r.k6)(()=>[(0,r.bF)(ee,{model:f,"label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(J,{label:"操作类型",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(de,{modelValue:f.operation,"onUpdate:modelValue":a[12]||(a[12]=e=>f.operation=e)},{default:(0,r.k6)(()=>[(0,r.bF)(re,{label:"add"},{default:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.eW)("添加标签",-1)])),_:1,__:[36]}),(0,r.bF)(re,{label:"remove"},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)("移除标签",-1)])),_:1,__:[37]})]),_:1},8,["modelValue"])]),_:1}),"add"===f.operation?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(J,{label:"标签键名",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(q,{modelValue:f.key,"onUpdate:modelValue":a[13]||(a[13]=e=>f.key=e),placeholder:"请输入标签键名，如：environment"},null,8,["modelValue"])]),_:1}),(0,r.bF)(J,{label:"标签值",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(q,{modelValue:f.value,"onUpdate:modelValue":a[14]||(a[14]=e=>f.value=e),placeholder:"请输入标签值，如：production"},null,8,["modelValue"])]),_:1})],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[N.value.length>0?((0,r.uX)(),(0,r.Wv)(J,{key:0,label:"选择标签",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(C,{modelValue:f.selectedLabel,"onUpdate:modelValue":a[15]||(a[15]=e=>f.selectedLabel=e),style:{width:"100%"},placeholder:"请选择要移除的标签","value-key":"key"},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(N.value,e=>((0,r.uX)(),(0,r.Wv)(L,{key:e.label,label:e.label,value:e.labelData},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Ok,[(0,r.bF)(v,{type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label),1)]),_:2},1024)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):((0,r.uX)(),(0,r.Wv)(J,{key:1},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{title:"该节点没有可移除的标签",type:"info",description:"当前节点没有用户自定义标签，只有系统标签无法移除","show-icon":"",closable:!1})]),_:1}))],64))]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,r.bF)(ie,{modelValue:g.value,"onUpdate:modelValue":a[23]||(a[23]=e=>g.value=e),title:`驱逐节点 - ${k.value.nodeName||""}`,width:"500px",class:"drain-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Gk,[(0,r.bF)(Z,{onClick:a[22]||(a[22]=e=>g.value=!1)},{default:(0,r.k6)(()=>a[43]||(a[43]=[(0,r.eW)("取消",-1)])),_:1,__:[43]}),(0,r.bF)(Z,{type:"danger",onClick:W},{default:(0,r.k6)(()=>a[44]||(a[44]=[(0,r.eW)("驱逐",-1)])),_:1,__:[44]})])]),default:(0,r.k6)(()=>[(0,r.bF)(ee,{model:y,"label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(J,{label:"强制驱逐"},{default:(0,r.k6)(()=>[(0,r.bF)(ue,{modelValue:y.force,"onUpdate:modelValue":a[18]||(a[18]=e=>y.force=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"]),a[39]||(a[39]=(0,r.Lk)("div",{class:"form-tip"},"强制驱逐会删除不受控制器管理的Pod",-1))]),_:1,__:[39]}),(0,r.bF)(J,{label:"删除本地数据"},{default:(0,r.k6)(()=>[(0,r.bF)(ue,{modelValue:y.deleteLocalData,"onUpdate:modelValue":a[19]||(a[19]=e=>y.deleteLocalData=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"]),a[40]||(a[40]=(0,r.Lk)("div",{class:"form-tip"},"删除使用emptyDir的Pod",-1))]),_:1,__:[40]}),(0,r.bF)(J,{label:"忽略DaemonSet"},{default:(0,r.k6)(()=>[(0,r.bF)(ue,{modelValue:y.ignoreDaemonSets,"onUpdate:modelValue":a[20]||(a[20]=e=>y.ignoreDaemonSets=e),"active-text":"是","inactive-text":"否"},null,8,["modelValue"]),a[41]||(a[41]=(0,r.Lk)("div",{class:"form-tip"},"忽略DaemonSet管理的Pod",-1))]),_:1,__:[41]}),(0,r.bF)(J,{label:"优雅终止时间"},{default:(0,r.k6)(()=>[(0,r.bF)(pe,{modelValue:y.gracePeriodSeconds,"onUpdate:modelValue":a[21]||(a[21]=e=>y.gracePeriodSeconds=e),min:0,max:300,style:{width:"100%"}},null,8,["modelValue"]),a[42]||(a[42]=(0,r.Lk)("div",{class:"form-tip"},"Pod优雅终止等待时间（秒）",-1))]),_:1,__:[42]})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,r.bF)(ie,{modelValue:h.value,"onUpdate:modelValue":a[24]||(a[24]=e=>h.value=e),title:`节点标签 - ${k.value.nodeName||""}`,width:"700px",class:"node-labels-view-dialog"},{default:(0,r.k6)(()=>[k.value.labels?((0,r.uX)(),(0,r.CE)("div",Yk,[Object.keys(Q(k.value.labels)).length>0?((0,r.uX)(),(0,r.CE)("div",Jk,[a[45]||(a[45]=(0,r.Lk)("h4",null,"用户标签",-1)),(0,r.Lk)("div",Zk,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Q(k.value.labels),(e,a)=>((0,r.uX)(),(0,r.Wv)(v,{key:a,type:"primary",size:"default",class:"label-tag",onClick:t=>X(`${a}=${e}`,"标签信息已复制")},{default:(0,r.k6)(()=>[(0,r.bF)(me,{class:"tag-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.eW)(" "+(0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])])):(0,r.Q3)("",!0),Object.keys(G(k.value.labels)).length>0?((0,r.uX)(),(0,r.CE)("div",eb,[a[46]||(a[46]=(0,r.Lk)("h4",null,"系统标签",-1)),(0,r.Lk)("div",ab,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(G(k.value.labels),(e,a)=>((0,r.uX)(),(0,r.Wv)(v,{key:a,type:"info",size:"default",class:"label-tag system-label",onClick:t=>X(`${a}=${e}`,"标签信息已复制")},{default:(0,r.k6)(()=>[(0,r.bF)(me,{class:"tag-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.eW)(" "+(0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])])):(0,r.Q3)("",!0),k.value.labels&&0!==Object.keys(k.value.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",tb,[(0,r.bF)(ge,{description:"该节点没有标签","image-size":60})]))])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"])])}}};const ob=(0,p.A)(sb,[["__scopeId","data-v-08667eea"]]);var nb=ob,ib=t.p+"static/img/扩容.5447243c.svg",rb=t.p+"static/img/重启.e44f3247.svg",db=t(382);const cb={class:"cluster-option"},ub={class:"cluster-name"};var pb={__name:"ClusterSelector",props:{modelValue:{type:String,default:""}},emits:["update:modelValue","change"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)([]),o=async()=>{try{const e=await ce.getClusterList(),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];if(s.value=e.map(e=>({id:e.id,name:e.name,status:e.status})),s.value.length>0&&!t.modelValue){const e=s.value.find(e=>2===e.status),a=e?e.id:s.value[0].id;l("update:modelValue",a),l("change",a)}console.log("集群列表加载成功:",s.value)}else J.nk.error(a.message||"获取集群列表失败")}catch(e){console.error("获取集群列表失败:",e),J.nk.warning("无法获取集群列表，请检查后端服务")}},n=e=>{l("update:modelValue",e),l("change",e)},i=e=>{const a={1:"info",2:"success",3:"warning",0:"danger"};return a[e]||"info"},d=e=>{const a={0:"离线",1:"连接中",2:"在线",3:"异常"};return a[e]||"未知"};return(0,r.sV)(()=>{o()}),(a,t)=>{const l=(0,r.g2)("el-tag"),o=(0,r.g2)("el-option"),c=(0,r.g2)("el-select");return(0,r.uX)(),(0,r.Wv)(c,{"model-value":e.modelValue,placeholder:"请选择集群",size:"small",style:{width:"200px","margin-right":"12px"},onChange:n,loading:!s.value.length},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value,e=>((0,r.uX)(),(0,r.Wv)(o,{key:e.id,label:`${e.name} ${d(e.status)}`,value:e.id,disabled:2!==e.status},{default:(0,r.k6)(()=>[(0,r.Lk)("div",cb,[(0,r.Lk)("span",ub,(0,x.v_)(e.name),1),(0,r.bF)(l,{type:i(e.status),size:"small",class:"cluster-status-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(d(e.status)),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["model-value","loading"])}}};const mb=(0,p.A)(pb,[["__scopeId","data-v-e4a8e762"]]);var gb=mb;const vb={class:"namespace-option"},hb={class:"namespace-name"};var kb={__name:"NamespaceSelector",props:{modelValue:{type:String,default:"default"},clusterId:{type:String,required:!0}},emits:["update:modelValue","change"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)([]),o=(0,Y.KR)(!1);let n=null;const i=async(e=!1)=>{if(!t.clusterId)return s.value=[],void(n=null);if(o.value&&!e&&n)try{await n}catch(a){}else if(!(s.value.length>0)||e)try{o.value=!0,n=ce.getNamespaces(t.clusterId);const e=await n,a=e.data||e;if(console.log("命名空间列表API响应:",a),200===a.code||a.success){const e=a.data?.namespaces||a.data||[],o=Array.isArray(e)?e:[];if(s.value=o.map(e=>({name:e.name||e,status:e.status||"Active",resourceCount:e.resourceCount||{},createdAt:e.createdAt})),!t.modelValue&&s.value.length>0){const e=s.value.find(e=>"default"===e.name),a=e?"default":s.value[0].name;l("update:modelValue",a),l("change",a)}console.log("命名空间列表加载成功:",s.value)}else console.error("获取命名空间列表失败:",a.message),s.value=[]}catch(a){console.error("获取命名空间列表失败:",a),s.value=[],401===a.response?.status?J.nk.error("认证失败，请重新登录"):403===a.response?.status?J.nk.error("权限不足，请联系管理员"):"ECONNABORTED"===a.code?J.nk.warning("请求超时，命名空间加载时间较长，请稍后重试"):e||console.warn("命名空间列表加载失败，错误已记录")}finally{o.value=!1,n=null}},d=e=>{l("update:modelValue",e),l("change",e)};return(0,r.wB)(()=>t.clusterId,e=>{e?(s.value=[],l("update:modelValue","default"),i(!0)):(s.value=[],l("update:modelValue",""))},{immediate:!0}),(a,t)=>{const l=(0,r.g2)("el-button"),n=(0,r.g2)("el-tag"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select");return(0,r.uX)(),(0,r.Wv)(u,{"model-value":e.modelValue,placeholder:"请选择命名空间",size:"small",style:{width:"200px"},onChange:d,onFocus:i,disabled:!e.clusterId,loading:o.value,"loading-text":"命名空间加载中，请稍候...","no-data-text":"暂无命名空间数据"},(0,r.eX)({default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value,e=>((0,r.uX)(),(0,r.Wv)(c,{key:e.name,label:e.name,value:e.name},{default:(0,r.k6)(()=>[(0,r.Lk)("div",vb,[(0,r.Lk)("span",hb,(0,x.v_)(e.name),1),(0,r.bF)(n,{type:"Active"===e.status?"success":"warning",size:"small",class:"namespace-status-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.status),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:2},[!o.value&&e.clusterId&&0===s.value.length?{name:"prefix",fn:(0,r.k6)(()=>[(0,r.bF)(l,{type:"text",size:"small",onClick:t[0]||(t[0]=e=>i(!0)),style:{color:"#409eff",padding:"0","margin-right":"4px"}},{default:(0,r.k6)(()=>t[1]||(t[1]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[1]})]),key:"0"}:void 0]),1032,["model-value","disabled","loading"])}}};const bb=(0,p.A)(kb,[["__scopeId","data-v-1ed71136"]]);var fb=bb,yb=t.p+"static/img/重构.1e3dfd87.svg",_b=t.p+"static/img/事件.e3b9545f.svg";const wb={class:"pod-name-container"},Lb={class:"pod-name"},Fb={class:"ip-info"},Cb={class:"ip-item"},Vb={class:"ip-value"},xb={class:"ip-item"},Sb={class:"ip-value"},Ib={class:"resource-info"},Ab={class:"resource-item"},Rb={class:"resource-value"},Db={class:"resource-item"},Pb={class:"resource-value"},$b={class:"time-info"},Tb={key:0,class:"running-time"},Mb={class:"operation-buttons"};var Eb={__name:"PodListDialog",props:{visible:{type:Boolean,default:!1},workload:{type:Object,default:()=>({})}},emits:["update:visible","close","view-logs","view-yaml","rebuild-pod","view-events"],setup(e,{emit:a}){const t=a,l=()=>{t("update:visible",!1),t("close")},s=e=>e&&"0"!==e&&""!==e?e:"-",o=e=>{if(!e||"0"===e||""===e)return"-";if(e.endsWith("Ki")){const a=parseInt(e.replace("Ki",""));if(a<1024)return e;const t=(a/1024).toFixed(1);return`${t}Mi`}if(e.endsWith("Mi")){const a=parseInt(e.replace("Mi",""));if(a<1024)return e;const t=(a/1024).toFixed(1);return`${t}Gi`}return e.endsWith("Gi"),e},n=e=>{if(!e)return"-";const a=e.match(/^(\d+h)?(\d+m)?(\d+(?:\.\d+)?s)?$/);if(!a)return e;const[,t,l,s]=a;let o="";if(t&&(o+=t),l&&(o+=l),s&&!t&&!l){const e=parseFloat(s.replace("s",""));o+=`${Math.round(e)}s`}return o||e},i=e=>{const a={Running:"success",Pending:"warning",Failed:"danger",Succeeded:"success",Unknown:"info"};return a[e]||"info"},d=e=>{const a={Running:"运行中",Pending:"等待中",Failed:"失败",Succeeded:"成功",Unknown:"未知"};return a[e]||e};return(a,t)=>{const c=(0,r.g2)("el-table-column"),u=(0,r.g2)("el-tag"),p=(0,r.g2)("el-button"),m=(0,r.g2)("el-tooltip"),g=(0,r.g2)("el-table"),v=(0,r.g2)("el-dialog"),h=(0,r.gN)("authority");return(0,r.uX)(),(0,r.Wv)(v,{"model-value":e.visible,title:`Pod列表 - ${e.workload.name||""}`,width:"1200px",class:"pod-list-dialog","onUpdate:modelValue":l},{default:(0,r.k6)(()=>[(0,r.bF)(g,{data:e.workload.pods||[],stripe:"",style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{prop:"name",label:"Pod名称","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",wb,[t[0]||(t[0]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"},null,-1)),(0,r.Lk)("span",Lb,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(c,{prop:"status",label:"状态","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(u,{type:i(e.status),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(d(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(c,{prop:"restartCount",label:"重启次数","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(u,{size:"small",type:e.restartCount>0?"warning":"success"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.restartCount),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(c,{prop:"nodeName",label:"节点","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(u,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.nodeName),1)]),_:2},1024)]),_:1}),(0,r.bF)(c,{label:"IP地址","min-width":"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Fb,[(0,r.Lk)("div",Cb,[t[1]||(t[1]=(0,r.Lk)("span",{class:"ip-label"},"Pod:",-1)),(0,r.Lk)("span",Vb,(0,x.v_)(e.podIP),1)]),(0,r.Lk)("div",xb,[t[2]||(t[2]=(0,r.Lk)("span",{class:"ip-label"},"Host:",-1)),(0,r.Lk)("span",Sb,(0,x.v_)(e.hostIP),1)])])]),_:1}),(0,r.bF)(c,{label:"资源","min-width":"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Ib,[(0,r.Lk)("div",Ab,[t[3]||(t[3]=(0,r.Lk)("span",{class:"resource-label"},"CPU:",-1)),(0,r.Lk)("span",Rb,(0,x.v_)(s(e.resources?.requests?.cpu)),1)]),(0,r.Lk)("div",Db,[t[4]||(t[4]=(0,r.Lk)("span",{class:"resource-label"},"Memory:",-1)),(0,r.Lk)("span",Pb,(0,x.v_)(o(e.resources?.requests?.memory)),1)])])]),_:1}),(0,r.bF)(c,{prop:"age",label:"运行时间","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",$b,[(0,r.bF)(u,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.age),1)]),_:2},1024),e.runningTime?((0,r.uX)(),(0,r.CE)("div",Tb," 运行: "+(0,x.v_)(n(e.runningTime)),1)):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(c,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Mb,[(0,r.bF)(m,{content:"日志",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",icon:(0,Y.R1)(vc.Document),size:"small",circle:"",onClick:t=>a.$emit("view-logs",e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(m,{content:"YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"success",icon:(0,Y.R1)(vc.View),size:"small",circle:"",onClick:t=>a.$emit("view-yaml",e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(m,{content:"重构",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(p,{type:"warning",size:"small",circle:"",onClick:t=>a.$emit("rebuild-pod",e)},{default:(0,r.k6)(()=>t[5]||(t[5]=[(0,r.Lk)("img",{src:yb,alt:"重构",width:"14",height:"14",style:{filter:"brightness(0) invert(1)"}},null,-1)])),_:2,__:[5]},1032,["onClick"])),[[h,["k8s:workload:restart"]]])]),_:2},1024),(0,r.bF)(m,{content:"事件",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"danger",size:"small",circle:"",onClick:t=>a.$emit("view-events",e)},{default:(0,r.k6)(()=>t[6]||(t[6]=[(0,r.Lk)("img",{src:_b,alt:"事件",width:"14",height:"14"},null,-1)])),_:2,__:[6]},1032,["onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])]),_:1},8,["model-value","title"])}}};const Wb=(0,p.A)(Eb,[["__scopeId","data-v-89155c1e"]]);var zb=Wb;const Nb={key:0,class:"loading-container"},Kb={key:1,class:"empty-events"},Ub={key:2,class:"events-container"},Xb={class:"event-reason"},qb={class:"event-message"},Hb={class:"timestamp"},Bb={class:"timestamp"},jb={class:"dialog-footer"};var Ob={__name:"PodEventsDialog",props:{visible:{type:Boolean,default:!1},clusterId:{type:String,default:""},namespaceName:{type:String,default:""},podName:{type:String,default:""}},emits:["update:visible","close"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(!1),o=(0,Y.KR)([]);(0,r.wB)(()=>t.visible,e=>{e&&t.clusterId&&t.namespaceName&&t.podName&&i()});const n=()=>{l("update:visible",!1),l("close")},i=async()=>{if(t.clusterId&&t.namespaceName&&t.podName){s.value=!0;try{const e=await ce.getPodEvents(t.clusterId,t.namespaceName,t.podName),a=e.data||e;200===a.code&&a.data?o.value=a.data.events||[]:(J.nk.error(a.message||"获取Pod事件失败"),o.value=[])}catch(e){console.error("获取Pod事件失败:",e),J.nk.error("获取Pod事件失败，请重试"),o.value=[]}finally{s.value=!1}}},d=()=>{i()},c=e=>{const a={Warning:"danger",Normal:"success"};return a[e]||"info"},u=e=>{if(!e)return"-";try{const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(a){return e}};return(a,t)=>{const l=(0,r.g2)("el-skeleton"),i=(0,r.g2)("el-empty"),p=(0,r.g2)("el-tag"),m=(0,r.g2)("el-table-column"),g=(0,r.g2)("el-table"),v=(0,r.g2)("el-button"),h=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(h,{"model-value":e.visible,title:`Pod事件 - ${e.podName}`,width:"1000px",class:"pod-events-dialog","onUpdate:modelValue":n},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",jb,[(0,r.bF)(v,{onClick:n},{default:(0,r.k6)(()=>t[0]||(t[0]=[(0,r.eW)("关闭",-1)])),_:1,__:[0]}),(0,r.bF)(v,{type:"primary",onClick:d,loading:s.value},{default:(0,r.k6)(()=>t[1]||(t[1]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[1]},8,["loading"])])]),default:(0,r.k6)(()=>[s.value?((0,r.uX)(),(0,r.CE)("div",Nb,[(0,r.bF)(l,{rows:8,animated:""})])):0===o.value.length?((0,r.uX)(),(0,r.CE)("div",Kb,[(0,r.bF)(i,{description:"暂无事件记录"})])):((0,r.uX)(),(0,r.CE)("div",Ub,[(0,r.bF)(g,{data:o.value,stripe:"",style:{width:"100%"},size:"small","default-sort":{prop:"lastTime",order:"descending"}},{default:(0,r.k6)(()=>[(0,r.bF)(m,{prop:"type",label:"类型",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(p,{type:c(e.type),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.type),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(m,{prop:"reason",label:"原因",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",Xb,(0,x.v_)(e.reason),1)]),_:1}),(0,r.bF)(m,{prop:"message",label:"消息","min-width":"300"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",qb,(0,x.v_)(e.message),1)]),_:1}),(0,r.bF)(m,{prop:"count",label:"次数",width:"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(p,{size:"small",type:e.count>1?"warning":"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.count),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(m,{prop:"firstTime",label:"首次发生",width:"180",sortable:""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Hb,(0,x.v_)(u(e.firstTime)),1)]),_:1}),(0,r.bF)(m,{prop:"lastTime",label:"最后发生",width:"180",sortable:""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Bb,(0,x.v_)(u(e.lastTime)),1)]),_:1})]),_:1},8,["data"])]))]),_:1},8,["model-value","title"])}}};const Qb=(0,p.A)(Ob,[["__scopeId","data-v-ad2f7e70"]]);var Gb=Qb;const Yb={class:"yaml-content"},Jb={class:"yaml-controls"},Zb={class:"control-group"},ef={class:"target-info"},af={class:"target-item"},tf={class:"target-item"},lf={class:"status-indicators"},sf={class:"yaml-editor-container"},of={key:0,class:"yaml-viewer"},nf={class:"yaml-text"},rf={key:0,class:"validation-result"},df={class:"action-buttons"};var cf={__name:"PodYamlDialog",props:{visible:{type:Boolean,default:!1},yamlContent:{type:String,default:""},resourceName:{type:String,default:""},resourceType:{type:String,default:"Pod"},editable:{type:Boolean,default:!1}},emits:["update:visible","close","save"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=(0,Y.KR)(null),n=(0,Y.KR)(""),i=(0,Y.KR)(!1),d=(0,Y.KR)(!1),c=(0,Y.KR)(null),u=(0,r.EW)(()=>{const e=l.editable?"编辑YAML":`${l.resourceType} YAML`;return`${e} - ${l.resourceName||""}`}),p=(0,r.EW)(()=>{const e=l.editable?n.value:l.yamlContent;return e&&"string"===typeof e&&e.trim().length>0});(0,r.wB)(()=>l.visible,e=>{e&&(n.value=null!==l.yamlContent&&void 0!==l.yamlContent?String(l.yamlContent):"",c.value=null)}),(0,r.wB)(()=>l.yamlContent,e=>{n.value=null!==e&&void 0!==e?String(e):"",c.value=null});const m=()=>{s("update:visible",!1),s("close")},g=async()=>{console.log("Copy button clicked");try{const e=l.editable?n.value:l.yamlContent;if(console.log("Text to copy:","string"===typeof e?e.substring(0,100)+"...":e),!e||"string"!==typeof e||""===e.trim())return void J.nk.warning("没有内容可以复制");await navigator.clipboard.writeText(e),J.nk.success("YAML已复制到剪贴板")}catch(e){console.error("复制失败:",e);try{const e=document.createElement("textarea");e.value=l.editable?n.value:l.yamlContent,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),J.nk.success("YAML已复制到剪贴板")}catch(a){console.error("备用复制方案也失败:",a),J.nk.error("复制失败，请手动复制")}}},v=async()=>{console.log("Validate button clicked");const e=l.editable?n.value:l.yamlContent;if(console.log("YAML to validate:","string"===typeof e?e.substring(0,100)+"...":e),!e||"string"!==typeof e||!e.trim())return c.value={success:!1,message:"验证失败",details:"YAML内容不能为空"},J.nk.warning("YAML内容不能为空"),!1;d.value=!0;try{const t=e.split("\n");let l=!1,s=!1,o=!1,n=[];t.forEach(e=>{e.includes("apiVersion:")&&(l=!0),e.includes("kind:")&&(s=!0),e.includes("metadata:")&&(o=!0)}),l||n.push("缺少 apiVersion 字段"),s||n.push("缺少 kind 字段"),o||n.push("缺少 metadata 字段");try{console.log("YAML基本检查通过，跳过详细语法验证")}catch(a){n.push("YAML语法错误: "+a.message)}return n.length>0?(c.value={success:!1,message:"格式验证失败",details:n.join("; ")},!1):(c.value={success:!0,message:"YAML格式验证通过",details:"所有必需字段都存在，格式正确"},!0)}catch(t){return console.error("YAML验证失败:",t),c.value={success:!1,message:"验证异常",details:"验证过程中发生错误: "+t.message},!1}finally{d.value=!1}},h=async()=>{const e=await v();if(e){i.value=!0;try{s("save",{yamlContent:n.value,resourceName:l.resourceName,resourceType:l.resourceType})}finally{i.value=!1}}};return a({setSaving:e=>{i.value=e},getYamlContent:()=>n.value}),(a,t)=>{const l=(0,r.g2)("el-button"),s=(0,r.g2)("el-tooltip"),k=(0,r.g2)("el-tag"),b=(0,r.g2)("el-alert"),f=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(f,{"model-value":e.visible,title:u.value,width:"80%",class:"pod-yaml-dialog","close-on-click-modal":!1,"onUpdate:modelValue":m},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Yb,[(0,r.Lk)("div",Jb,[(0,r.Lk)("div",Zb,[(0,r.bF)(s,{content:"YAML格式验证",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{icon:(0,Y.R1)(vc.Search),type:"primary",size:"small",circle:"",onClick:v,loading:d.value,disabled:!p.value,class:"validate-btn"},null,8,["icon","loading","disabled"])]),_:1}),(0,r.bF)(s,{content:"复制YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{icon:(0,Y.R1)(vc.DocumentCopy),type:"success",size:"small",circle:"",onClick:g,disabled:!p.value,class:"copy-btn"},null,8,["icon","disabled"])]),_:1}),(0,r.Lk)("div",ef,[(0,r.Lk)("div",af,[t[1]||(t[1]=(0,r.Lk)("span",{class:"target-label"},"资源类型:",-1)),(0,r.bF)(k,{type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.resourceType||"未知"),1)]),_:1})]),(0,r.Lk)("div",tf,[t[2]||(t[2]=(0,r.Lk)("span",{class:"target-label"},"资源名称:",-1)),(0,r.bF)(k,{type:"warning",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.resourceName||"未选择"),1)]),_:1})])])]),(0,r.Lk)("div",lf,[c.value?((0,r.uX)(),(0,r.Wv)(k,{key:0,type:c.value.success?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.success?"✓ 格式正确":"✗ 格式错误"),1)]),_:1},8,["type"])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",sf,[e.editable?((0,r.uX)(),(0,r.Wv)(ih,{key:1,ref_key:"yamlEditor",ref:o,modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=e=>n.value=e),language:"yaml",height:"500px",fontSize:"14px",readonly:!1,placeholder:"请输入YAML配置..."},null,8,["modelValue"])):((0,r.uX)(),(0,r.CE)("div",of,[(0,r.Lk)("pre",nf,(0,x.v_)(e.yamlContent),1)]))]),c.value?((0,r.uX)(),(0,r.CE)("div",rf,[(0,r.bF)(b,{title:c.value.message,type:c.value.success?"success":"error",description:c.value.details,"show-icon":"",closable:!1},null,8,["title","type","description"])])):(0,r.Q3)("",!0),(0,r.Lk)("div",df,[(0,r.bF)(l,{onClick:m},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.editable?"取消":"关闭"),1)]),_:1}),e.editable?((0,r.uX)(),(0,r.Wv)(l,{key:0,type:"primary",onClick:h,loading:i.value},{default:(0,r.k6)(()=>t[3]||(t[3]=[(0,r.eW)(" 保存YAML ",-1)])),_:1,__:[3]},8,["loading"])):(0,r.Q3)("",!0)])])]),_:1},8,["model-value","title"])}}};const uf=(0,p.A)(cf,[["__scopeId","data-v-e4c04d36"]]);var pf=uf;const mf={class:"resource-config"},gf={class:"resource-section"},vf={class:"resource-section"},hf={class:"env-vars-section"},kf={class:"dialog-footer"};var bf={__name:"PodConfigDialog",props:{visible:{type:Boolean,default:!1},workload:{type:Object,default:()=>({})}},emits:["update:visible","close","submit"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(!1),o=(0,Y.Kh)({cpuRequest:"",cpuLimit:"",memoryRequest:"",memoryLimit:"",envVars:[]});(0,r.wB)(()=>t.workload,e=>{e&&Object.keys(e).length>0&&(o.cpuRequest=e.resources?.requests?.cpu||"",o.cpuLimit=e.resources?.limits?.cpu||"",o.memoryRequest=e.resources?.requests?.memory||"",o.memoryLimit=e.resources?.limits?.memory||"",o.envVars=e.envVars||[])},{immediate:!0,deep:!0});const n=()=>{l("update:visible",!1),l("close")},i=async()=>{s.value=!0;try{const e={template:{labels:{app:t.workload.labels?.app||t.workload.name},containers:[{name:t.workload.containerName||t.workload.name||"nginx",image:t.workload.image||"nginx:latest",resources:{requests:{cpu:o.cpuRequest||"100m",memory:o.memoryRequest||"128Mi"},limits:{cpu:o.cpuLimit||"500m",memory:o.memoryLimit||"512Mi"}},env:o.envVars.filter(e=>e.name&&e.value).map(e=>({name:e.name,value:e.value}))}]}};t.workload.ports&&t.workload.ports.length>0&&(e.template.containers[0].ports=t.workload.ports),l("submit",e)}finally{s.value=!1}},d=()=>{o.envVars.push({name:"",value:""})},c=e=>{o.envVars.splice(e,1)};return(a,t)=>{const l=(0,r.g2)("el-input"),u=(0,r.g2)("el-form-item"),p=(0,r.g2)("el-col"),m=(0,r.g2)("el-row"),g=(0,r.g2)("el-button"),v=(0,r.g2)("el-form"),h=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(h,{"model-value":e.visible,title:`更新Pod配置 - ${e.workload.name||""}`,width:"600px",class:"pod-config-dialog","onUpdate:modelValue":n},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",kf,[(0,r.bF)(g,{onClick:n},{default:(0,r.k6)(()=>t[8]||(t[8]=[(0,r.eW)("取消",-1)])),_:1,__:[8]}),(0,r.bF)(g,{type:"primary",onClick:i,loading:s.value},{default:(0,r.k6)(()=>t[9]||(t[9]=[(0,r.eW)("更新配置",-1)])),_:1,__:[9]},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(v,{model:o,"label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{label:"资源限制"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",mf,[(0,r.bF)(m,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(p,{span:12},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gf,[t[4]||(t[4]=(0,r.Lk)("h5",null,"CPU",-1)),(0,r.bF)(u,{label:"Request:",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:o.cpuRequest,"onUpdate:modelValue":t[0]||(t[0]=e=>o.cpuRequest=e),placeholder:"如: 100m",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"Limit:",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:o.cpuLimit,"onUpdate:modelValue":t[1]||(t[1]=e=>o.cpuLimit=e),placeholder:"如: 500m",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),_:1}),(0,r.bF)(p,{span:12},{default:(0,r.k6)(()=>[(0,r.Lk)("div",vf,[t[5]||(t[5]=(0,r.Lk)("h5",null,"内存",-1)),(0,r.bF)(u,{label:"Request:",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:o.memoryRequest,"onUpdate:modelValue":t[2]||(t[2]=e=>o.memoryRequest=e),placeholder:"如: 128Mi",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),(0,r.bF)(u,{label:"Limit:",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:o.memoryLimit,"onUpdate:modelValue":t[3]||(t[3]=e=>o.memoryLimit=e),placeholder:"如: 512Mi",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1})])]),_:1}),(0,r.bF)(u,{label:"环境变量"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",hf,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.envVars,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"env-var-item"},[(0,r.bF)(m,{gutter:10},{default:(0,r.k6)(()=>[(0,r.bF)(p,{span:10},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"变量名",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,r.bF)(p,{span:10},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:e.value,"onUpdate:modelValue":a=>e.value=a,placeholder:"变量值",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),(0,r.bF)(p,{span:4},{default:(0,r.k6)(()=>[(0,r.bF)(g,{type:"danger",size:"small",onClick:e=>c(a)},{default:(0,r.k6)(()=>t[6]||(t[6]=[(0,r.eW)(" 删除 ",-1)])),_:2,__:[6]},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),(0,r.bF)(g,{type:"text",size:"small",onClick:d},{default:(0,r.k6)(()=>t[7]||(t[7]=[(0,r.eW)("+ 添加环境变量",-1)])),_:1,__:[7]})])]),_:1})]),_:1},8,["model"])]),_:1},8,["model-value","title"])}}};const ff=(0,p.A)(bf,[["__scopeId","data-v-fbbbc6c0"]]);var yf=ff;const _f={class:"create-pod-content"},wf={class:"pod-controls"},Lf={class:"control-group"},Ff={class:"target-info"},Cf={class:"target-item"},Vf={class:"target-item"},xf={class:"status-indicators"},Sf={class:"yaml-editor-container"},If={key:0,class:"dryrun-result"},Af={class:"action-buttons"},Rf="apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: custom-deployment-${timestamp}\n  namespace: ${namespace}\n  labels:\n    app: custom-deployment\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: custom-deployment\n  template:\n    metadata:\n      labels:\n        app: custom-deployment\n    spec:\n      containers:\n      - name: main\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n        resources:\n          requests:\n            cpu: 100m\n            memory: 128Mi\n          limits:\n            cpu: 500m\n            memory: 512Mi";var Df={__name:"CreatePodDialog",props:{visible:{type:Boolean,default:!1},clusterId:{type:String,default:""},clusterName:{type:String,default:""},namespace:{type:String,default:""}},emits:["update:visible","close","preview","create"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=(0,Y.KR)(null),n=(0,Y.KR)(!1),i=(0,Y.KR)(null),d=(0,Y.KR)(""),c=()=>{const e=(new Date).getTime();let a=Rf.replace("${timestamp}",e).replace("${namespace}",l.namespace||"default");d.value=a};(0,r.wB)(()=>l.visible,e=>{e&&(c(),i.value=null,(0,r.dY)(()=>{o.value&&o.value.focus&&o.value.focus()}))});const u=()=>{s("update:visible",!1),s("close")},p=async()=>{d.value.trim()?s("preview",{yamlContent:d.value,dryRun:!0}):J.nk.warning("YAML内容不能为空")},m=async()=>{console.log("Copy button clicked");try{if(console.log("YAML content to copy:",d.value?d.value.substring(0,100)+"...":"empty"),!d.value||"string"!==typeof d.value||""===d.value.trim())return void J.nk.warning("没有内容可以复制");await navigator.clipboard.writeText(d.value),J.nk.success("YAML已复制到剪贴板")}catch(e){console.error("复制失败:",e);try{const e=document.createElement("textarea");e.value=d.value,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),J.nk.success("YAML已复制到剪贴板")}catch(a){console.error("备用复制方案也失败:",a),J.nk.error("复制失败，请手动复制")}}},g=async()=>{if(d.value.trim()){n.value=!0;try{s("create",{yamlContent:d.value,dryRun:!1})}finally{n.value=!1}}else J.nk.warning("YAML内容不能为空")};return a({setDryRunResult:e=>{i.value=e},setLoading:e=>{n.value=e}}),(a,t)=>{const l=(0,r.g2)("el-button"),s=(0,r.g2)("el-tooltip"),c=(0,r.g2)("el-tag"),v=(0,r.g2)("el-alert"),h=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(h,{"model-value":e.visible,title:"通过YAML创建工作负载",width:"80%",class:"create-pod-dialog","close-on-click-modal":!1,"onUpdate:modelValue":u},{default:(0,r.k6)(()=>[(0,r.Lk)("div",_f,[(0,r.Lk)("div",wf,[(0,r.Lk)("div",Lf,[(0,r.bF)(s,{content:"YAML创建校验",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{icon:(0,Y.R1)(vc.Search),type:"primary",size:"small",circle:"",onClick:p,loading:n.value,class:"validate-btn"},null,8,["icon","loading"])]),_:1}),(0,r.bF)(s,{content:"复制YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{icon:(0,Y.R1)(vc.DocumentCopy),type:"success",size:"small",circle:"",onClick:m,class:"copy-btn"},null,8,["icon"])]),_:1}),(0,r.Lk)("div",Ff,[(0,r.Lk)("div",Cf,[t[1]||(t[1]=(0,r.Lk)("span",{class:"target-label"},"目标集群:",-1)),(0,r.bF)(c,{type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.clusterName||"未选择"),1)]),_:1})]),(0,r.Lk)("div",Vf,[t[2]||(t[2]=(0,r.Lk)("span",{class:"target-label"},"目标命名空间:",-1)),(0,r.bF)(c,{type:"warning",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.namespace||"未选择"),1)]),_:1})])])]),(0,r.Lk)("div",xf,[i.value?((0,r.uX)(),(0,r.Wv)(c,{key:0,type:i.value.success?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(i.value.success?"✓ 可以创建":"✗ 创建失败"),1)]),_:1},8,["type"])):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",Sf,[(0,r.bF)(ih,{ref_key:"yamlEditor",ref:o,modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=e=>d.value=e),language:"yaml",height:"500px",fontSize:"14px",readonly:!1,placeholder:"请输入工作负载的YAML配置..."},null,8,["modelValue"])]),i.value?((0,r.uX)(),(0,r.CE)("div",If,[(0,r.bF)(v,{title:i.value.message,type:i.value.success?"success":"error",description:i.value.details,"show-icon":"",closable:!1},null,8,["title","type","description"])])):(0,r.Q3)("",!0),(0,r.Lk)("div",Af,[(0,r.bF)(l,{onClick:u},{default:(0,r.k6)(()=>t[3]||(t[3]=[(0,r.eW)("取消",-1)])),_:1,__:[3]}),(0,r.bF)(l,{type:"primary",onClick:g,loading:n.value},{default:(0,r.k6)(()=>t[4]||(t[4]=[(0,r.eW)(" 创建工作负载 ",-1)])),_:1,__:[4]},8,["loading"])])])]),_:1},8,["model-value"])}}};const Pf=(0,p.A)(Df,[["__scopeId","data-v-626d2b69"]]);var $f=Pf;t.p;const Tf={class:"k8s-workloads-management"},Mf={class:"card-header"},Ef={class:"header-actions"},Wf={class:"search-section"},zf={class:"workload-type-section"},Nf={class:"table-section"},Kf={class:"workload-name-container"},Uf={class:"workload-info"},Xf=["onClick"],qf={class:"workload-type-label"},Hf={class:"label-container"},Bf={class:"pod-status-container"},jf={class:"pod-status-text"},Of={class:"resource-info"},Qf={class:"resource-row"},Gf={class:"resource-values"},Yf={class:"request-value"},Jf={class:"limit-value"},Zf={class:"resource-row"},ey={class:"resource-values"},ay={class:"request-value"},ty={class:"limit-value"},ly={class:"images-list"},sy=["onClick"],oy={class:"full-image-name"},ny={class:"time-info"},iy={class:"datetime-text"},ry={class:"time-info"},dy={key:0,class:"datetime-text"},cy={key:1,class:"no-update"},uy={class:"operation-buttons"},py={class:"log-controls"},my={class:"log-content"},gy={class:"form-tip"},vy={class:"dialog-footer"},hy={key:0,class:"labels-view-content"},ky={key:0,class:"labels-section"},by={class:"labels-list"},fy={key:1,class:"labels-section"},yy={class:"labels-list"},_y={key:2,class:"no-labels"},wy={key:0,class:"images-view-content"},Ly={class:"images-section"},Fy={class:"all-images-list"},Cy={class:"image-info"},Vy={class:"image-name"},xy={class:"full-image-name"},Sy={class:"image-actions"},Iy={class:"image-details"},Ay={key:0,class:"no-images"},Ry={class:"dialog-footer"};var Dy={__name:"k8s-workloads",setup(e){const a=(0,v.rd)(),t=(0,Y.KR)(!1),l=(0,Y.KR)(""),s=(0,Y.Kh)({name:"",type:"",namespace:"default"}),o=(0,Y.KR)([]),n=(0,Y.KR)(""),d=(0,Y.KR)([]),c=(0,Y.KR)(!1),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(!1),g=(0,Y.KR)(!1),h=((0,Y.KR)(!1),(0,Y.KR)(!1)),k=(0,Y.KR)(!1),b=(0,Y.KR)(!1),f=(0,Y.KR)(!1),y=(0,Y.KR)(!1),_=(0,Y.KR)(!1),w=(0,Y.KR)({}),L=(0,Y.KR)({}),F=(0,Y.KR)({}),C=(0,Y.KR)(""),V=(0,Y.KR)(""),S=(0,Y.KR)(null),I=(0,Y.KR)(null),A=(0,Y.Kh)({replicas:1}),R=(0,Y.Kh)({container:"",lines:100,follow:!1}),D=async()=>{try{const e=await ce.getClusterList(),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];if(d.value=e.map(e=>({id:e.id,name:e.name,status:e.status})),d.value.length>0&&!n.value){const e=d.value.find(e=>2===e.status);n.value=e?e.id:d.value[0].id}console.log("集群列表加载成功:",d.value)}else J.nk.error(a.message||"获取集群列表失败")}catch(e){console.error("获取集群列表失败:",e),J.nk.warning("无法获取集群列表，请检查后端服务")}},P=e=>{console.log("标签页切换到:",e),l.value=e,s.type=e,$()};(0,r.wB)(l,e=>{s.type=e});const $=async()=>{const e=Date.now();try{if(!n.value)return void J.nk.warning("请选择一个集群");if(!s.namespace)return void J.nk.warning("请选择命名空间");console.log("🔍 开始查询工作负载:",{clusterId:n.value,namespace:s.namespace,type:s.type,name:s.name}),t.value=!0;const e={};s.type&&(e.type=s.type),s.name&&(e.name=s.name);const a=await ce.getWorkloadList(n.value,s.namespace,e),l=a.data||a;if(console.log("工作负载列表API响应:",l),200===l.code||l.success){const e=l.data?.workloads||l.data||[],a=Array.isArray(e)?e:[];o.value=a.map(e=>({id:e.name,name:e.name,type:e.type?.toLowerCase()||e.kind?.toLowerCase(),namespace:e.namespace,replicas:`${e.readyReplicas||0}/${e.replicas||0}`,readyReplicas:e.readyReplicas||0,totalReplicas:e.replicas||0,images:e.images||[],labels:e.labels||{},status:e.status||T(e),age:M(e.createdAt),updateTime:e.createdAt,updatedAt:e.updatedAt,conditions:e.conditions||[],resources:e.resources||{cpu:{requests:"0",limits:"0"},memory:{requests:"0",limits:"0"}},rawData:e})),console.log("工作负载列表加载成功:",o.value)}else{const e=l.message||"获取工作负载列表失败";e.includes("the server could not find the requested resource")?"cronjobs"===s.type?J.nk.warning("当前集群不支持CronJob资源，可能是Kubernetes版本过低"):s.type?J.nk.warning(`当前集群不支持${s.type}资源类型`):J.nk.warning("请求的资源不存在，请检查集群配置"):J.nk.error(e),o.value=[]}}catch(a){console.error("获取工作负载列表失败:",a),"ERR_NETWORK"===a.code||a.message?.includes("ERR_CONNECTION_REFUSED")||a.message?.includes("Failed to fetch")?J.nk.warning("后端服务连接失败，请检查服务状态"):401===a.response?.status?J.nk.error("认证失败，请重新登录"):403===a.response?.status?J.nk.error("权限不足，请联系管理员"):console.warn("API调用异常，但可能数据已正确加载"),o.value=[]}finally{t.value=!1,console.log("✅ 工作负载查询完成，耗时:",Date.now()-e+"ms")}},T=e=>{if(e.status)return e.status;const a=e.replicas||0,t=e.readyReplicas||0;return"job"===e.type||"Job"===e.kind?e.succeeded?"Completed":e.failed?"Failed":"Running":"cronjob"===e.type||"CronJob"===e.kind?e.lastScheduleTime?"Active":"Suspended":0===a?"Stopped":0===t?"Pending":t<a?"Partial":"Running"},M=e=>{if(!e)return"Unknown";const a=new Date,t=new Date(e),l=Math.floor((a-t)/1e3);return l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:l<86400?`${Math.floor(l/3600)}h`:`${Math.floor(l/86400)}d`},E=e=>{if(!e)return"-";const a=new Date(e),t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),o=String(a.getHours()).padStart(2,"0"),n=String(a.getMinutes()).padStart(2,"0");return`${t}-${l}-${s} ${o}:${n}`},W=()=>{s.name="",s.type="",$()},z=()=>{a.push("/k8s/monitoring")},N=()=>{n.value?s.namespace?_.value=!0:J.nk.warning("请先选择命名空间"):J.nk.warning("请先选择集群")},K=async e=>{try{I.value?.setLoading(!0);const a=await ce.validateYaml(n.value,e.yamlContent),t=a.data||a,l={success:200===t.code,message:t.message||(200===t.code?"可以创建工作负载":"创建预览失败"),details:t.data};I.value?.setDryRunResult(l),l.success?J.nk.success(l.message):J.nk.error(l.message)}catch(a){const e={success:!1,message:a.message||"工作负载创建预览失败",details:null};I.value?.setDryRunResult(e),J.nk.error("工作负载创建预览失败: "+(a.message||"网络错误"))}finally{I.value?.setLoading(!1)}},U=async e=>{try{I.value?.setLoading(!0);const a=await ce.createPodFromYaml(n.value,s.namespace,e),t=a.data||a;200===t.code?(J.nk.success("工作负载创建成功!"),_.value=!1,$()):J.nk.error(t.message||"工作负载创建失败")}catch(a){console.error("工作负载创建失败:",a),J.nk.error("工作负载创建失败: "+(a.message||"网络错误"))}finally{I.value?.setLoading(!1)}},X=async()=>{o.value=[],n.value&&s.namespace&&$()},q=()=>{n.value&&s.namespace?$():o.value=[]},H=async e=>{try{console.log("🔍 点击工作负载名称，跳转到Pod详情:",e),console.log("📊 工作负载详情:",{name:e.name,type:e.type,namespace:s.namespace});const t=await ce.getWorkloadPods(n.value,s.namespace,e.type.toLowerCase(),e.name),l=t.data||t;if(200===l.code&&l.data&&l.data.length>0){const e=l.data[0];console.log("🎯 跳转到第一个Pod:",e.name),a.push({path:`/k8s/pod/${n.value}/${s.namespace}/${e.name}`})}else J.nk.warning("该工作负载下暂无Pod或Pod信息获取失败")}catch(t){console.error("获取工作负载Pod信息失败:",t),J.nk.error("获取工作负载Pod信息失败，请检查网络连接")}},B=async e=>{try{t.value=!0,console.log("🔍 点击容器组数量，查看Pod列表:",e),console.log("📊 工作负载详情:",{name:e.name,type:e.type,namespace:s.namespace});const a=await ce.getWorkloadPods(n.value,s.namespace,e.type.toLowerCase(),e.name),l=a.data||a;if(200===l.code||l.success){const a=l.data||[];console.log("📋 获取到的Pod列表:",a.length,"个Pod"),console.log("📋 Pod详细信息:",a.map(e=>({name:e.name,status:e.status}))),w.value={...e,pods:a.map(e=>({name:e.name,status:e.status||e.phase||"Unknown",restartCount:e.restarts||e.restartCount||0,nodeName:e.nodeName||"Unknown",podIP:e.podIP||"Unknown",hostIP:e.hostIP||"Unknown",age:e.age||M(e.createdAt),runningTime:e.runningTime||"",containers:e.containers||[],resources:e.resources||{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:e.labels||{},conditions:e.conditions||[],rawData:e}))},c.value=!0}else J.nk.error(l.message||"获取Pod列表失败")}catch(a){console.error("获取Pod列表失败:",a),J.nk.error("获取Pod列表失败，请检查网络连接")}finally{t.value=!1}},j=async e=>{try{L.value=e,R.container=e.containers?.[0]?.name||"",t.value=!0;const a=await ce.getPodLogs(n.value,s.namespace,e.name,{container:R.container,tailLines:R.lines}),l=a.data||a;200===l.code||l.success?(C.value=l.data||"暂无日志",g.value=!0):J.nk.error(l.message||"获取Pod日志失败")}catch(a){console.error("获取Pod日志失败:",a),J.nk.error("获取Pod日志失败，请检查网络连接")}finally{t.value=!1}},O=e=>{F.value=e,u.value=!0},Q=async e=>{try{t.value=!0;const a=await ce.getPodYaml(n.value,s.namespace,e.name),l=a.data||a;200===l.code||l.success?(V.value=l.data||"apiVersion: v1\nkind: Pod\nmetadata:\n  name: "+e.name,L.value=e,p.value=!0):J.nk.error(l.message||"获取Pod YAML失败")}catch(a){console.error("获取Pod YAML失败:",a),J.nk.error("获取Pod YAML失败，请检查网络连接")}finally{t.value=!1}},G=async e=>{try{await uv.s.confirm(`确定要重构Pod "${e.name}" 吗？\n重构操作会删除当前Pod并自动创建新的Pod实例。`,"重构Pod确认",{confirmButtonText:"确定重构",cancelButtonText:"取消",type:"warning"});const a=await ce.deletePod(n.value,s.namespace,e.name),t=a.data||a;if(200===t.code||t.success){if(J.nk.success(`Pod ${e.name} 重构成功，新的Pod实例将自动创建`),c.value){const e=w.value;await B(e)}}else J.nk.error(t.message||"重构Pod失败")}catch(a){"cancel"===a?J.nk.info("已取消重构操作"):(console.error("重构Pod失败:",a),J.nk.error("重构Pod失败，请检查网络连接"))}},Z=e=>{oe(e)?(w.value=e,A.replicas=e.totalReplicas||1,h.value=!0):J.nk.warning("该工作负载不支持扩缩容操作")},ee=async()=>{try{const e=await ce.scaleDeployment(n.value,s.namespace,w.value.name,{replicas:A.replicas}),a=e.data||e;200===a.code||a.success?(J.nk.success(`${w.value.name} 扩缩容成功`),h.value=!1,$()):J.nk.error(a.message||"扩缩容失败")}catch(e){console.error("扩缩容失败:",e),J.nk.error("扩缩容失败，请检查网络连接")}},ae=async e=>{if(ne(e))try{await uv.s.confirm(`确定要重启 ${e.type} "${e.name}" 吗？`,"重启确认",{confirmButtonText:"确定重启",cancelButtonText:"取消",type:"warning"});const a=await ce.restartDeployment(n.value,s.namespace,e.name),t=a.data||a;200===t.code||t.success?(J.nk.success(`${e.name} 重启成功`),$()):J.nk.error(t.message||"重启失败")}catch(a){"cancel"===a?J.nk.info("已取消重启操作"):(console.error("重启失败:",a),J.nk.error("重启失败，请检查网络连接"))}else J.nk.warning("该工作负载不支持重启操作")},te=e=>{const a={deployment:"Deployment",statefulset:"StatefulSet",daemonset:"DaemonSet",job:"Job",cronjob:"CronJob",pod:"Pod"};return a[e]||e},le=async(e,a="已复制到剪贴板")=>{try{await navigator.clipboard.writeText(e),J.nk.success(a)}catch(t){console.error("复制失败:",t);const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select();try{document.execCommand("copy"),J.nk.success(a)}catch(l){J.nk.error("复制失败，请手动复制")}document.body.removeChild(s)}},se=e=>{const a=["kube-system","kube-public","kube-node-lease","calico-system","tigera-operator"];if(a.includes(e.namespace))return!0;const t=["kube-","calico-","coredns","metrics-server","node-local-dns","kubernetes-dashboard"];return!!t.some(a=>e.name.startsWith(a))},oe=e=>!!["deployment","statefulset"].includes(e.type)&&!se(e),ne=e=>"deployment"===e.type&&!se(e),ie=e=>!se(e),re=e=>!!["deployment","statefulset"].includes(e.type)&&!se(e),de=e=>!!["deployment","statefulset"].includes(e.type)&&!se(e),ue=e=>!se(e),pe=e=>{if(!e)return 0;const a=["kubernetes.io/","beta.kubernetes.io/","node-role.kubernetes.io/","node.kubernetes.io/","app.kubernetes.io/managed-by","pod-template-hash"];return Object.keys(e).filter(e=>!a.some(a=>e.startsWith(a))).length},me=(e,a)=>0===a?"info":0===e?"danger":e<a?"warning":"success",ge=(e,a)=>0===a?"已停止":0===e?"启动中":e<a?"部分就绪":"全部就绪",ve=(e,a)=>0===a?"status-stopped":0===e?"status-starting":e<a?"status-partial":"status-ready",he=e=>{w.value=e,k.value=!0},ke=e=>{w.value=e,b.value=!0},be=e=>{re(e)?(w.value=e,f.value=!0):J.nk.warning("该工作负载不支持Pod配置更新")},fe=e=>{de(e)?(w.value=e,y.value=!0):J.nk.warning("该工作负载不支持调度更新")},ye=async e=>{if(ue(e))try{t.value=!0,console.log("🔍 开始获取工作负载YAML...",e);try{const t=await ce.getWorkloadYaml(n.value,s.namespace,e.type,e.name),l=t.data||t;if(200===l.code||l.success){w.value=e;let t="";if(l.data&&l.data.yamlContent)t=l.data.yamlContent;else if(l.data&&l.data.yaml)try{t=db.Ay.dump(l.data.yaml,{indent:2,lineWidth:-1})}catch(a){console.error("YAML转换失败:",a),t=JSON.stringify(l.data.yaml,null,2)}else t="string"===typeof l.data?l.data:`apiVersion: apps/v1\nkind: ${e.type}\nmetadata:\n  name: ${e.name}`;return V.value=t,void(m.value=!0)}}catch(l){console.log("工作负载YAML获取失败，尝试通过Pod获取:",l)}console.log("🔍 通过获取工作负载Pod列表来获取Pod YAML...");const o=await ce.getWorkloadPods(n.value,s.namespace,e.type.toLowerCase(),e.name),i=o.data||o;if((200===i.code||i.success)&&i.data&&i.data.length>0){const t=i.data[0];console.log("🔍 获取Pod YAML:",t.name);const l=await ce.getPodYaml(n.value,s.namespace,t.name),o=l.data||l;if(200!==o.code)throw new Error(o.message||"Pod YAML获取失败");{w.value=e;let l="";if(o.data&&o.data.yamlContent)l=o.data.yamlContent;else if(o.data&&o.data.yaml)try{l=db.Ay.dump(o.data.yaml,{indent:2,lineWidth:-1})}catch(a){console.error("YAML转换失败:",a),l=JSON.stringify(o.data.yaml,null,2)}else l="string"===typeof o.data?o.data:`# Pod YAML for ${t.name}\n# 工作负载: ${e.name} (${e.type})\n`;V.value=l,m.value=!0}}else{console.log("⚠️ 没有找到Pod，生成基础YAML模板");const a=_e(e);w.value=e,V.value=a,m.value=!0,J.nk.warning("未找到实际YAML内容，显示基础模板")}}catch(a){console.error("获取工作负载YAML失败:",a),J.nk.error("获取工作负载YAML失败: "+(a.message||"请检查网络连接"))}finally{t.value=!1}else J.nk.warning("系统工作负载不允许编辑YAML")},_e=e=>{const a=e.type.charAt(0).toUpperCase()+e.type.slice(1);return`apiVersion: apps/v1\nkind: ${a}\nmetadata:\n  name: ${e.name}\n  namespace: ${s.namespace}\n  labels:\n    app: ${e.name}\nspec:\n  replicas: ${e.totalReplicas||1}\n  selector:\n    matchLabels:\n      app: ${e.name}\n  template:\n    metadata:\n      labels:\n        app: ${e.name}\n    spec:\n      containers:\n      - name: ${e.name}\n        image: nginx:latest\n        ports:\n        - containerPort: 80\n---\n# 注意: 这是一个基础模板，请根据实际需求修改\n# 工作负载类型: ${e.type}\n# 当前状态: ${e.status}\n# 副本数: ${e.replicas}`};(0,r.sV)(async()=>{try{console.log("🚀 开始加载k8s工作负载页面");const e=Date.now();console.log("📡 正在加载集群列表..."),await D(),console.log("✅ 集群列表加载完成，耗时:",Date.now()-e+"ms"),n.value&&(console.log("🔄 开始并行加载命名空间和工作负载数据"),s.namespace&&(console.log("📦 立即开始查询工作负载:",s.namespace),$().catch(e=>{console.error("工作负载初始查询失败:",e)}))),console.log("🎉 页面初始化完成，总耗时:",Date.now()-e+"ms")}catch(e){console.error("页面初始化失败:",e)}}),(0,r.wB)(m,e=>{e&&(0,r.dY)(()=>{S.value&&S.value.focus&&S.value.focus()})});const we=e=>e&&"0"!==e&&""!==e?e:"-",Le=e=>{if(!e||"0"===e||""===e)return"-";if(e.endsWith("Ki")){const a=parseInt(e.replace("Ki",""));if(a<1024)return e;const t=(a/1024).toFixed(1);return`${t}Mi`}if(e.endsWith("Mi")){const a=parseInt(e.replace("Mi",""));if(a<1024)return e;const t=(a/1024).toFixed(1);return`${t}Gi`}if(e.endsWith("Gi"))return e;const a=parseInt(e);return!isNaN(a)&&a>0?a<1024?`${a}B`:a<1048576?`${(a/1024).toFixed(1)}Ki`:a<1073741824?`${(a/1048576).toFixed(1)}Mi`:`${(a/1073741824).toFixed(1)}Gi`:e||"-"},Fe=e=>{if(!e)return"latest";const a=e.split(":");return a.length>1?a[a.length-1]:"latest"},Ce=e=>{if(!e)return"docker.io";const a=e.split("/");return 1===a.length?"docker.io":a[0].includes(".")||a[0].includes(":")?a[0]:"docker.io"},Ve=e=>{if(!e)return{};const a=["kubernetes.io/","beta.kubernetes.io/","node-role.kubernetes.io/","node.kubernetes.io/","app.kubernetes.io/managed-by","pod-template-hash"],t={};return Object.entries(e).forEach(([e,l])=>{a.some(a=>e.startsWith(a))||(t[e]=l)}),t},xe=e=>{if(!e)return{};const a=["kubernetes.io/","beta.kubernetes.io/","node-role.kubernetes.io/","node.kubernetes.io/","app.kubernetes.io/managed-by","pod-template-hash"],t={};return Object.entries(e).forEach(([e,l])=>{a.some(a=>e.startsWith(a))&&(t[e]=l)}),t},Se=async e=>{console.log("🔧 开始处理Pod配置更新:",{clusterId:n.value,namespace:s.namespace,workloadName:w.value.name,updateData:e});try{const a=await ce.updateDeployment(n.value,s.namespace,w.value.name,e),t=a.data||a;console.log("📤 API响应:",t),200===t.code||t.success?(J.nk.success(`${w.value.name} Pod配置更新成功`),f.value=!1,$()):(console.warn("❌ API返回错误:",t),J.nk.error(t.message||"Pod配置更新失败"))}catch(a){console.error("💥 Pod配置更新异常:",a),J.nk.error(`Pod配置更新失败: ${a.message||"请检查网络连接"}`)}},Ie=async()=>{try{const e={template:{nodeSelector:w.value.nodeSelector||{},tolerations:w.value.tolerations||[]}},a=await ce.updateDeployment(n.value,s.namespace,w.value.name,e),t=a.data||a;200===t.code||t.success?(J.nk.success(`${w.value.name} 调度配置更新成功`),y.value=!1,$()):J.nk.error(t.message||"调度配置更新失败")}catch(e){console.error("调度配置更新失败:",e),J.nk.error("调度配置更新失败，请检查网络连接")}},Ae=e=>{try{const a=db.Ay.load(e);if(!a||"object"!==typeof a)throw new Error("无效的YAML格式");const t=a.kind?.toLowerCase(),l=a.metadata?.name;if(!t||!l)throw new Error("YAML中缺少kind或metadata.name字段");return{workloadType:t,workloadName:l}}catch(a){throw console.error("解析YAML失败:",a),a}},Re=async e=>{try{if(V.value=e.yamlContent,"Pod"===e.resourceType){const a=await ce.updatePodYaml(n.value,s.namespace,e.resourceName,e.yamlContent),t=a.data||a;if(200!==t.code&&!t.success)throw new Error(t.message||"保存失败");J.nk.success(`${e.resourceName} YAML配置保存成功`),p.value=!1}else{const{workloadType:a,workloadName:t}=Ae(e.yamlContent),l=await ce.updateWorkloadYaml(n.value,s.namespace,a,t,e.yamlContent),o=l.data||l;if(200!==o.code&&!o.success)throw new Error(o.message||"保存失败");J.nk.success(`${t} YAML配置保存成功`),m.value=!1}$()}catch(a){console.error("YAML配置保存失败:",a),J.nk.error("YAML配置保存失败: "+(a.message||"请检查网络连接"))}},De=async e=>{if(ie(e))try{let a;switch(await uv.s.confirm(`确定要删除 ${te(e.type)} "${e.name}" 吗？此操作不可恢复！`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}),console.log("🗑️ 开始删除工作负载:",{clusterId:n.value,namespace:s.namespace,workloadType:e.type.toLowerCase(),workloadName:e.name}),e.type.toLowerCase()){case"pod":a=await ce.deletePod(n.value,s.namespace,e.name);break;case"deployment":a=await ce.deleteDeployment(n.value,s.namespace,e.name);break;default:a=await ce.deleteWorkload(n.value,s.namespace,e.type.toLowerCase(),e.name);break}console.log("📤 删除API响应:",a);const t=a.data||a;200===t.code||t.success?(J.nk.success(`${te(e.type)} "${e.name}" 删除成功`),await $()):J.nk.error(t.message||`删除 ${te(e.type)} 失败`)}catch(a){"cancel"===a?J.nk.info("已取消删除操作"):(console.error("删除工作负载失败:",a),J.nk.error(`删除失败: ${a.message||"请检查网络连接"}`))}else J.nk.warning("系统工作负载不允许删除")};return(e,a)=>{const v=(0,r.g2)("el-input"),S=(0,r.g2)("el-form-item"),D=(0,r.g2)("el-button"),T=(0,r.g2)("el-form"),M=(0,r.g2)("el-tab-pane"),J=(0,r.g2)("el-tabs"),se=(0,r.g2)("el-table-column"),ce=(0,r.g2)("el-badge"),_e=(0,r.g2)("el-icon"),Ae=(0,r.g2)("el-tag"),Pe=(0,r.g2)("el-tooltip"),$e=(0,r.g2)("el-table"),Te=(0,r.g2)("el-card"),Me=(0,r.g2)("el-option"),Ee=(0,r.g2)("el-select"),We=(0,r.g2)("el-input-number"),ze=(0,r.g2)("el-dialog"),Ne=(0,r.g2)("el-empty"),Ke=(0,r.g2)("el-switch"),Ue=(0,r.gN)("authority"),Xe=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Tf,[(0,r.bF)(Te,{shadow:"hover",class:"workloads-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",Mf,[a[31]||(a[31]=(0,r.Lk)("span",{class:"title"},"K8s 工作负载管理",-1)),(0,r.Lk)("div",Ef,[(0,r.bF)(gb,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),onChange:X},null,8,["modelValue"]),(0,r.bF)(fb,{modelValue:s.namespace,"onUpdate:modelValue":a[1]||(a[1]=e=>s.namespace=e),"cluster-id":n.value,onChange:q},null,8,["modelValue","cluster-id"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",Wf,[(0,r.bF)(T,{inline:!0,model:s,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{label:"工作负载名称"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:s.name,"onUpdate:modelValue":a[2]||(a[2]=e=>s.name=e),placeholder:"请输入名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)($,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(S,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:$},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[32]},8,["icon"]),(0,r.bF)(D,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:W},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)(" 重置 ",-1)])),_:1,__:[33]},8,["icon"]),(0,r.bF)(D,{icon:(0,Y.R1)(vc.Monitor),type:"success",size:"small",onClick:z},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)(" 监控仪表板 ",-1)])),_:1,__:[34]},8,["icon"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(D,{icon:(0,Y.R1)(vc.Plus),type:"primary",size:"small",onClick:N},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)(" 创建工作负载 ",-1)])),_:1,__:[35]},8,["icon"])),[[Ue,["k8s:workload:add"]]])]),_:1})]),_:1},8,["model"]),(0,r.Lk)("div",zf,[(0,r.bF)(J,{modelValue:l.value,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value=e),onTabChange:P,class:"workload-tabs"},{default:(0,r.k6)(()=>[(0,r.bF)(M,{label:"全部",name:""},{label:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.Lk)("span",{class:"tab-label"},"全部",-1)])),_:1}),(0,r.bF)(M,{label:"Deployment",name:"deployments"},{label:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.Lk)("span",{class:"tab-label"},"Deployment",-1)])),_:1}),(0,r.bF)(M,{label:"StatefulSet",name:"statefulsets"},{label:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.Lk)("span",{class:"tab-label"},"StatefulSet",-1)])),_:1}),(0,r.bF)(M,{label:"DaemonSet",name:"daemonsets"},{label:(0,r.k6)(()=>a[39]||(a[39]=[(0,r.Lk)("span",{class:"tab-label"},"DaemonSet",-1)])),_:1}),(0,r.bF)(M,{label:"Job",name:"jobs"},{label:(0,r.k6)(()=>a[40]||(a[40]=[(0,r.Lk)("span",{class:"tab-label"},"Job",-1)])),_:1}),(0,r.bF)(M,{label:"CronJob",name:"cronjobs"},{label:(0,r.k6)(()=>a[41]||(a[41]=[(0,r.Lk)("span",{class:"tab-label"},"CronJob",-1)])),_:1})]),_:1},8,["modelValue"])])]),(0,r.Lk)("div",Nf,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)($e,{data:o.value,stripe:"",style:{width:"100%"},class:"workloads-table"},{default:(0,r.k6)(()=>[(0,r.bF)(se,{prop:"name",label:"名称","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Kf,[a[42]||(a[42]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"},null,-1)),(0,r.Lk)("div",Uf,[(0,r.Lk)("div",{class:"workload-name clickable-name",onClick:a=>H(e)},(0,x.v_)(e.name),9,Xf),(0,r.Lk)("span",qf,(0,x.v_)(te(e.type)),1)])])]),_:1}),(0,r.bF)(se,{label:"标签","min-width":"100",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Hf,[(0,r.bF)(ce,{value:pe(e.labels),max:99,class:"label-badge"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{type:"text",size:"small",circle:"",onClick:a=>he(e),class:"label-icon-button"},{default:(0,r.k6)(()=>a[43]||(a[43]=[(0,r.Lk)("img",{src:mk,alt:"标签",width:"14",height:"14"},null,-1)])),_:2,__:[43]},1032,["onClick"])]),_:2},1032,["value"])])]),_:1}),(0,r.bF)(se,{label:"容器组数量","min-width":"120",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Bf,[(0,r.bF)(Ae,{type:me(e.readyReplicas,e.totalReplicas),size:"default",class:"pod-count-tag",onClick:a=>B(e)},{default:(0,r.k6)(()=>[(0,r.bF)(_e,{class:"pod-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.eW)(" "+(0,x.v_)(e.replicas),1)]),_:2},1032,["type","onClick"]),(0,r.Lk)("div",jf,[(0,r.Lk)("span",{class:(0,x.C4)(ve(e.readyReplicas,e.totalReplicas))},(0,x.v_)(ge(e.readyReplicas,e.totalReplicas)),3)])])]),_:1}),(0,r.bF)(se,{label:"Request/Limits","min-width":"160"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Of,[(0,r.Lk)("div",Qf,[a[45]||(a[45]=(0,r.Lk)("span",{class:"resource-type"},"CPU:",-1)),(0,r.Lk)("span",Gf,[(0,r.Lk)("span",Yf,(0,x.v_)(we(e.resources?.requests?.cpu)),1),a[44]||(a[44]=(0,r.Lk)("span",{class:"separator"},"/",-1)),(0,r.Lk)("span",Jf,(0,x.v_)(we(e.resources?.limits?.cpu)),1)])]),(0,r.Lk)("div",Zf,[a[47]||(a[47]=(0,r.Lk)("span",{class:"resource-type"},"Mem:",-1)),(0,r.Lk)("span",ey,[(0,r.Lk)("span",ay,(0,x.v_)(Le(e.resources?.requests?.memory)),1),a[46]||(a[46]=(0,r.Lk)("span",{class:"separator"},"/",-1)),(0,r.Lk)("span",ty,(0,x.v_)(Le(e.resources?.limits?.memory)),1)])])])]),_:1}),(0,r.bF)(se,{label:"镜像","min-width":"250"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",ly,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.images.slice(0,1),(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"image-tag-wrapper",onClick:a=>le(e,"镜像地址已复制")},[(0,r.bF)(_e,{class:"copy-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.Lk)("span",oy,(0,x.v_)(e),1)],8,sy))),128)),e.images.length>1?((0,r.uX)(),(0,r.Wv)(D,{key:0,type:"text",size:"small",class:"more-images-btn",onClick:a=>ke(e)},{default:(0,r.k6)(()=>[(0,r.eW)(" +"+(0,x.v_)(e.images.length-1)+"个镜像 ",1)]),_:2},1032,["onClick"])):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(se,{label:"创建时间","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",ny,[(0,r.Lk)("span",iy,(0,x.v_)(E(e.updateTime)),1)])]),_:1}),(0,r.bF)(se,{label:"更新时间","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",ry,[e.updatedAt?((0,r.uX)(),(0,r.CE)("span",dy,(0,x.v_)(E(e.updatedAt)),1)):((0,r.uX)(),(0,r.CE)("span",cy,"-"))])]),_:1}),(0,r.bF)(se,{label:"操作",width:"300",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",uy,[(0,r.bF)(Pe,{content:oe(e)?"伸缩":"不支持伸缩",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(D,{type:"primary",size:"small",circle:"",disabled:!oe(e),onClick:a=>Z(e)},{default:(0,r.k6)(()=>a[48]||(a[48]=[(0,r.Lk)("img",{src:ib,alt:"伸缩",width:"16",height:"16",style:{filter:"brightness(0) invert(1)"}},null,-1)])),_:2,__:[48]},1032,["disabled","onClick"])),[[Ue,["k8s:workload:expandable"]]])]),_:2},1032,["content"]),(0,r.bF)(Pe,{content:ne(e)?"重构":"不支持重构",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(D,{type:"warning",size:"small",circle:"",disabled:!ne(e),onClick:a=>ae(e)},{default:(0,r.k6)(()=>a[49]||(a[49]=[(0,r.Lk)("img",{src:rb,alt:"重启",width:"14",height:"14",style:{filter:"brightness(0) invert(1)"}},null,-1)])),_:2,__:[49]},1032,["disabled","onClick"])),[[Ue,["k8s:workload:restart"]]])]),_:2},1032,["content"]),(0,r.bF)(Pe,{content:re(e)?"更新Pod配置":"系统资源不可配置",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(D,{type:"success",icon:(0,Y.R1)(vc.Setting),size:"small",circle:"",disabled:!re(e),onClick:a=>be(e)},null,8,["icon","disabled","onClick"]),[[Ue,["k8s:workload:resource"]]])]),_:2},1032,["content"]),(0,r.bF)(Pe,{content:de(e)?"更新调度":"不支持调度更新",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(D,{type:"info",icon:(0,Y.R1)(vc.Monitor),size:"small",circle:"",disabled:!de(e),onClick:a=>fe(e)},null,8,["icon","disabled","onClick"]),[[Ue,["k8s:workload:dispatch"]]])]),_:2},1032,["content"]),(0,r.bF)(Pe,{content:ue(e)?"编辑YAML":"系统资源不可编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(D,{type:"primary",icon:(0,Y.R1)(vc.Document),size:"small",circle:"",disabled:!ue(e),onClick:a=>ye(e)},null,8,["icon","disabled","onClick"]),[[Ue,["k8s:workload:edityaml"]]])]),_:2},1032,["content"]),(0,r.bF)(Pe,{content:ie(e)?"删除":"系统资源不可删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(D,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",disabled:!ie(e),onClick:a=>De(e)},null,8,["icon","disabled","onClick"]),[[Ue,["k8s:workload:delete"]]])]),_:2},1032,["content"])])]),_:1})]),_:1},8,["data"])),[[Xe,t.value]])])]),_:1}),(0,r.bF)(zb,{visible:c.value,workload:w.value,"onUpdate:visible":a[4]||(a[4]=e=>c.value=e),onClose:a[5]||(a[5]=e=>c.value=!1),onViewLogs:j,onViewYaml:Q,onRebuildPod:G,onViewEvents:O},null,8,["visible","workload"]),(0,r.bF)(Gb,{visible:u.value,"cluster-id":n.value,"namespace-name":s.namespace,"pod-name":F.value.name||"","onUpdate:visible":a[6]||(a[6]=e=>u.value=e),onClose:a[7]||(a[7]=e=>u.value=!1)},null,8,["visible","cluster-id","namespace-name","pod-name"]),(0,r.bF)(ze,{modelValue:g.value,"onUpdate:modelValue":a[12]||(a[12]=e=>g.value=e),title:`Pod日志 - ${L.value.name||""}`,width:"1000px",class:"log-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",py,[(0,r.bF)(T,{inline:!0,size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{label:"容器"},{default:(0,r.k6)(()=>[(0,r.bF)(Ee,{modelValue:R.container,"onUpdate:modelValue":a[8]||(a[8]=e=>R.container=e),style:{width:"200px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.value.containers||[],e=>((0,r.uX)(),(0,r.Wv)(Me,{key:e.name,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(S,{label:"行数"},{default:(0,r.k6)(()=>[(0,r.bF)(We,{modelValue:R.lines,"onUpdate:modelValue":a[9]||(a[9]=e=>R.lines=e),min:10,max:1e3},null,8,["modelValue"])]),_:1}),(0,r.bF)(S,null,{default:(0,r.k6)(()=>[(0,r.bF)(D,{type:"primary",onClick:a[10]||(a[10]=e=>j(L.value))},{default:(0,r.k6)(()=>a[50]||(a[50]=[(0,r.eW)("刷新日志",-1)])),_:1,__:[50]}),(0,r.bF)(D,{onClick:a[11]||(a[11]=e=>le(C.value,"日志已复制"))},{default:(0,r.k6)(()=>a[51]||(a[51]=[(0,r.eW)("复制日志",-1)])),_:1,__:[51]})]),_:1})]),_:1})]),(0,r.Lk)("div",my,[(0,r.Lk)("pre",null,(0,x.v_)(C.value),1)])]),_:1},8,["modelValue","title"]),(0,r.bF)(pf,{visible:p.value,"yaml-content":V.value,"resource-name":L.value.name,"resource-type":"Pod",editable:!1,"onUpdate:visible":a[13]||(a[13]=e=>p.value=e),onClose:a[14]||(a[14]=e=>p.value=!1),onSave:Re},null,8,["visible","yaml-content","resource-name"]),(0,r.bF)(ze,{modelValue:h.value,"onUpdate:modelValue":a[17]||(a[17]=e=>h.value=e),title:`扩缩容 - ${w.value.name||""}`,width:"400px",class:"scale-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",vy,[(0,r.bF)(D,{onClick:a[16]||(a[16]=e=>h.value=!1)},{default:(0,r.k6)(()=>a[52]||(a[52]=[(0,r.eW)("取消",-1)])),_:1,__:[52]}),(0,r.bF)(D,{type:"primary",onClick:ee},{default:(0,r.k6)(()=>a[53]||(a[53]=[(0,r.eW)("确定",-1)])),_:1,__:[53]})])]),default:(0,r.k6)(()=>[(0,r.bF)(T,{model:A,"label-width":"80px"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{label:"副本数",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(We,{modelValue:A.replicas,"onUpdate:modelValue":a[15]||(a[15]=e=>A.replicas=e),min:0,max:100,style:{width:"100%"}},null,8,["modelValue"]),(0,r.Lk)("div",gy,"当前副本数: "+(0,x.v_)(w.value.totalReplicas),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,r.bF)(ze,{modelValue:k.value,"onUpdate:modelValue":a[18]||(a[18]=e=>k.value=e),title:`工作负载标签 - ${w.value.name||""}`,width:"700px",class:"workload-labels-view-dialog"},{default:(0,r.k6)(()=>[w.value.labels?((0,r.uX)(),(0,r.CE)("div",hy,[Object.keys(Ve(w.value.labels)).length>0?((0,r.uX)(),(0,r.CE)("div",ky,[a[54]||(a[54]=(0,r.Lk)("h4",null,"用户标签",-1)),(0,r.Lk)("div",by,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Ve(w.value.labels),(e,a)=>((0,r.uX)(),(0,r.Wv)(Ae,{key:a,type:"primary",size:"default",class:"label-tag",onClick:t=>le(`${a}=${e}`,"标签信息已复制")},{default:(0,r.k6)(()=>[(0,r.bF)(_e,{class:"tag-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.eW)(" "+(0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])])):(0,r.Q3)("",!0),Object.keys(xe(w.value.labels)).length>0?((0,r.uX)(),(0,r.CE)("div",fy,[a[55]||(a[55]=(0,r.Lk)("h4",null,"系统标签",-1)),(0,r.Lk)("div",yy,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(xe(w.value.labels),(e,a)=>((0,r.uX)(),(0,r.Wv)(Ae,{key:a,type:"info",size:"default",class:"label-tag system-label",onClick:t=>le(`${a}=${e}`,"标签信息已复制")},{default:(0,r.k6)(()=>[(0,r.bF)(_e,{class:"tag-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.eW)(" "+(0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])])):(0,r.Q3)("",!0),w.value.labels&&0!==Object.keys(w.value.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",_y,[(0,r.bF)(Ne,{description:"该工作负载没有标签","image-size":60})]))])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"]),(0,r.bF)(ze,{modelValue:b.value,"onUpdate:modelValue":a[19]||(a[19]=e=>b.value=e),title:`镜像列表 - ${w.value.name||""}`,width:"800px",class:"all-images-dialog"},{default:(0,r.k6)(()=>[w.value.images?((0,r.uX)(),(0,r.CE)("div",wy,[(0,r.Lk)("div",Ly,[(0,r.Lk)("h4",null,"容器镜像 ("+(0,x.v_)(w.value.images?.length||0)+"个)",1),(0,r.Lk)("div",Fy,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(w.value.images,(e,t)=>((0,r.uX)(),(0,r.Wv)(Te,{key:t,class:"image-card",shadow:"hover"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Cy,[(0,r.Lk)("div",Vy,[(0,r.bF)(_e,{class:"image-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Connection))]),_:1}),(0,r.Lk)("span",xy,(0,x.v_)(e),1)]),(0,r.Lk)("div",Sy,[(0,r.bF)(D,{type:"primary",size:"small",icon:(0,Y.R1)(vc.DocumentCopy),onClick:a=>le(e,"镜像地址已复制")},{default:(0,r.k6)(()=>a[56]||(a[56]=[(0,r.eW)(" 复制 ",-1)])),_:2,__:[56]},1032,["icon","onClick"])])]),(0,r.Lk)("div",Iy,[(0,r.bF)(Ae,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(Fe(e)),1)]),_:2},1024),(0,r.bF)(Ae,{size:"small",type:"success"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(Ce(e)),1)]),_:2},1024)])]),_:2},1024))),128))])]),w.value.images&&0!==w.value.images.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",Ay,[(0,r.bF)(Ne,{description:"该工作负载没有镜像","image-size":60})]))])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"]),(0,r.bF)(yf,{visible:f.value,workload:w.value,"onUpdate:visible":a[20]||(a[20]=e=>f.value=e),onClose:a[21]||(a[21]=e=>f.value=!1),onSubmit:Se},null,8,["visible","workload"]),(0,r.bF)(ze,{modelValue:y.value,"onUpdate:modelValue":a[26]||(a[26]=e=>y.value=e),title:`更新调度 - ${w.value.name||""}`,width:"500px",class:"scheduling-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Ry,[(0,r.bF)(D,{onClick:a[25]||(a[25]=e=>y.value=!1)},{default:(0,r.k6)(()=>a[59]||(a[59]=[(0,r.eW)("取消",-1)])),_:1,__:[59]}),(0,r.bF)(D,{type:"primary",onClick:Ie},{default:(0,r.k6)(()=>a[60]||(a[60]=[(0,r.eW)("更新调度",-1)])),_:1,__:[60]})])]),default:(0,r.k6)(()=>[(0,r.bF)(T,{model:w.value,"label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(S,{label:"节点选择器"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:w.value.nodeSelector,"onUpdate:modelValue":a[22]||(a[22]=e=>w.value.nodeSelector=e),placeholder:"如: kubernetes.io/arch=amd64",style:{width:"100%"}},null,8,["modelValue"]),a[57]||(a[57]=(0,r.Lk)("div",{class:"form-tip"},"格式: key=value，多个用逗号分隔",-1))]),_:1,__:[57]}),(0,r.bF)(S,{label:"节点亲和性"},{default:(0,r.k6)(()=>[(0,r.bF)(Ee,{modelValue:w.value.nodeAffinity,"onUpdate:modelValue":a[23]||(a[23]=e=>w.value.nodeAffinity=e),placeholder:"请选择节点亲和性",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(Me,{label:"无要求",value:"none"}),(0,r.bF)(Me,{label:"偏好调度",value:"preferred"}),(0,r.bF)(Me,{label:"必须调度",value:"required"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(S,{label:"Pod反亲和性"},{default:(0,r.k6)(()=>[(0,r.bF)(Ke,{modelValue:w.value.podAntiAffinity,"onUpdate:modelValue":a[24]||(a[24]=e=>w.value.podAntiAffinity=e),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),a[58]||(a[58]=(0,r.Lk)("div",{class:"form-tip"},"避免Pod调度到同一节点",-1))]),_:1,__:[58]})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,r.bF)(pf,{visible:m.value,"yaml-content":V.value,"resource-name":w.value.name,"resource-type":w.value.type||"Workload",editable:!0,"onUpdate:visible":a[27]||(a[27]=e=>m.value=e),onClose:a[28]||(a[28]=e=>m.value=!1),onSave:Re},null,8,["visible","yaml-content","resource-name","resource-type"]),(0,r.bF)($f,{ref_key:"createPodDialogRef",ref:I,visible:_.value,"cluster-id":n.value,"cluster-name":d.value.find(e=>e.id===n.value)?.name,namespace:s.namespace,"onUpdate:visible":a[29]||(a[29]=e=>_.value=e),onClose:a[30]||(a[30]=e=>_.value=!1),onPreview:K,onCreate:U},null,8,["visible","cluster-id","cluster-name","namespace"])])}}};const Py=(0,p.A)(Dy,[["__scopeId","data-v-46ba8d04"]]);var $y=Py;const Ty={class:"table-section"},My={class:"namespace-name-container"},Ey={class:"label-container"},Wy={class:"resource-stats"},zy={class:"resource-item"},Ny={class:"resource-value"},Ky={class:"resource-item"},Uy={class:"resource-value"},Xy={class:"resource-item"},qy={class:"resource-value"},Hy={class:"resource-item"},By={class:"resource-value"},jy={class:"quota-limit-info"},Oy={class:"operation-buttons"};var Qy={__name:"NamespacesTable",props:{tableData:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["viewNamespaceDetail","viewNamespaceLabels","manageResourceQuotas","manageLimitRanges","deleteNamespace"],setup(e,{emit:a}){const t=a,l=e=>{const a={Active:"success",Terminating:"warning",Unknown:"info"};return a[e]||"info"},s=e=>{const a={Active:"活跃",Terminating:"终止中",Unknown:"未知"};return a[e]||"未知"},o=e=>{if(!e)return 0;const a=["kubernetes.io/","beta.kubernetes.io/","app.kubernetes.io/"];return Object.keys(e).filter(e=>!a.some(a=>e.startsWith(a))).length},n=e=>{const a=["default","kube-system","kube-public","kube-node-lease"];return a.includes(e)},i=e=>{t("viewNamespaceDetail",e)},d=e=>{t("viewNamespaceLabels",e)},c=e=>{t("manageResourceQuotas",e)},u=e=>{t("manageLimitRanges",e)},p=e=>{t("deleteNamespace",e)};return(a,t)=>{const m=(0,r.g2)("el-button"),g=(0,r.g2)("el-table-column"),v=(0,r.g2)("el-tag"),h=(0,r.g2)("el-badge"),k=(0,r.g2)("el-tooltip"),b=(0,r.g2)("el-table"),f=(0,r.gN)("authority"),y=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Ty,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{data:e.tableData,stripe:"",style:{width:"100%"},class:"namespace-table"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{prop:"name",label:"命名空间名称","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",My,[t[0]||(t[0]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"},null,-1)),(0,r.bF)(m,{type:"primary",link:"",onClick:a=>i(e),class:"namespace-name-link"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.name),1)]),_:2},1032,["onClick"])])]),_:1}),(0,r.bF)(g,{prop:"status",label:"状态","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:l(e.status),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(g,{prop:"age",label:"创建时间","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.age),1)]),_:2},1024)]),_:1}),(0,r.bF)(g,{label:"标签","min-width":"100",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Ey,[(0,r.bF)(h,{value:o(e.labels),max:99,class:"label-badge"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{type:"text",size:"small",circle:"",onClick:a=>d(e),class:"label-icon-button"},{default:(0,r.k6)(()=>t[1]||(t[1]=[(0,r.Lk)("img",{src:mk,alt:"标签",width:"14",height:"14"},null,-1)])),_:2,__:[1]},1032,["onClick"])]),_:2},1032,["value"])])]),_:1}),(0,r.bF)(g,{label:"资源统计","min-width":"160"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Wy,[(0,r.Lk)("div",zy,[t[2]||(t[2]=(0,r.Lk)("span",{class:"resource-label"},"Pod:",-1)),(0,r.Lk)("span",Ny,(0,x.v_)(e.resourceCount.pods),1)]),(0,r.Lk)("div",Ky,[t[3]||(t[3]=(0,r.Lk)("span",{class:"resource-label"},"Service:",-1)),(0,r.Lk)("span",Uy,(0,x.v_)(e.resourceCount.services),1)]),(0,r.Lk)("div",Xy,[t[4]||(t[4]=(0,r.Lk)("span",{class:"resource-label"},"Secret:",-1)),(0,r.Lk)("span",qy,(0,x.v_)(e.resourceCount.secrets),1)]),(0,r.Lk)("div",Hy,[t[5]||(t[5]=(0,r.Lk)("span",{class:"resource-label"},"ConfigMap:",-1)),(0,r.Lk)("span",By,(0,x.v_)(e.resourceCount.configMaps),1)])])]),_:1}),(0,r.bF)(g,{label:"配额/限制","min-width":"120",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",jy,[(0,r.bF)(h,{value:e.resourceQuotas.length,max:99,class:"quota-badge"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{size:"small",type:"warning"},{default:(0,r.k6)(()=>t[6]||(t[6]=[(0,r.eW)("配额",-1)])),_:1,__:[6]})]),_:2},1032,["value"]),(0,r.bF)(h,{value:e.limitRanges.length,max:99,class:"limit-badge"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{size:"small",type:"info"},{default:(0,r.k6)(()=>t[7]||(t[7]=[(0,r.eW)("限制",-1)])),_:1,__:[7]})]),_:2},1032,["value"])])]),_:1}),(0,r.bF)(g,{label:"操作",width:"300",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Oy,[(0,r.bF)(k,{content:"查看详情",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"primary",icon:(0,Y.R1)(vc.View),size:"small",circle:"",onClick:a=>i(e)},null,8,["icon","onClick"]),[[f,["k8s:namespace:details"]]])]),_:2},1024),(0,r.bF)(k,{content:"资源配额",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"warning",icon:(0,Y.R1)(vc.Monitor),size:"small",circle:"",onClick:a=>c(e)},null,8,["icon","onClick"]),[[f,["k8s:namespace:setup"]]])]),_:2},1024),(0,r.bF)(k,{content:"资源限制",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"info",icon:(0,Y.R1)(vc.Setting),size:"small",circle:"",onClick:a=>u(e)},null,8,["icon","onClick"]),[[f,["k8s:namespace:restriction"]]])]),_:2},1024),(0,r.bF)(k,{content:n(e.name)?"系统命名空间不可删除":"删除命名空间",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(m,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",disabled:n(e.name),onClick:a=>p(e)},null,8,["icon","disabled","onClick"]),[[f,["k8s:namespace:delete"]]])]),_:2},1032,["content"])])]),_:1})]),_:1},8,["data"])),[[y,e.loading]])])}}};const Gy=(0,p.A)(Qy,[["__scopeId","data-v-3891ff7e"]]);var Yy=Gy;const Jy={class:"dialog-footer"};var Zy={__name:"CreateNamespaceDialog",props:{visible:{type:Boolean,default:!1},selectedClusterId:{type:[String,Number],required:!0}},emits:["update:visible","success"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=(0,Y.KR)(null),n=(0,Y.KR)(!1),i=(0,Y.Kh)({name:"",description:"",customLabels:""});(0,r.wB)(()=>l.visible,e=>{e&&d()});const d=()=>{i.name="",i.description="",i.customLabels="",o.value&&o.value.clearValidate()},c=(e,a)=>{const t=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*\/)?[a-zA-Z0-9]([-_.a-zA-Z0-9]*[a-zA-Z0-9])?$/;if(e.length>253||!t.test(e))return`标签键 "${e}" 格式不正确。最多253字符，格式：[前缀/]名称`;const l=/^[a-zA-Z0-9]([-_.a-zA-Z0-9]*[a-zA-Z0-9])?$/;return a&&(a.length>63||!l.test(a))?`标签值 "${a}" 格式不正确。最多63字符，只能包含字母数字、连字符、下划线、点号`:null},u=e=>{const a={};if(!e.trim())return a;const t=e.split("\n").filter(e=>e.trim());for(const l of t){const[e,...t]=l.split("=");e&&e.trim()&&(a[e.trim()]=t.join("=").trim()||"")}return a},p=()=>{s("update:visible",!1)},m=()=>{s("update:visible",!1)},g=async()=>{try{if(!o.value)return;const e=await o.value.validate();if(!e)return;if(!i.name)return void J.nk.warning("请输入命名空间名称");n.value=!0;const a={name:i.name,labels:{"app.kubernetes.io/managed-by":"k8s-platform"},annotations:{}};if(i.customLabels){const e=u(i.customLabels);for(const[t,l]of Object.entries(e)){const e=c(t,l);if(e)return void J.nk.warning(e);a.labels[t]=l}}i.description&&(a.annotations["description"]=i.description),a.annotations["kubernetes.io/created-by"]="k8s-platform",a.annotations["created-at"]=(new Date).toISOString(),s("success",a)}catch(e){console.error("表单验证失败:",e)}finally{n.value=!1}};return a({resetForm:d,setSubmitting:e=>{n.value=e}}),(a,t)=>{const l=(0,r.g2)("el-input"),s=(0,r.g2)("el-form-item"),d=(0,r.g2)("el-form"),c=(0,r.g2)("el-button"),u=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(u,{"model-value":e.visible,title:"创建命名空间",width:"500px",class:"create-namespace-dialog","onUpdate:modelValue":m,onClose:m},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Jy,[(0,r.bF)(c,{onClick:p},{default:(0,r.k6)(()=>t[4]||(t[4]=[(0,r.eW)("取消",-1)])),_:1,__:[4]}),(0,r.bF)(c,{type:"primary",onClick:g,loading:n.value},{default:(0,r.k6)(()=>t[5]||(t[5]=[(0,r.eW)("创建",-1)])),_:1,__:[5]},8,["loading"])])]),default:(0,r.k6)(()=>[(0,r.bF)(d,{model:i,"label-width":"100px",ref_key:"formRef",ref:o},{default:(0,r.k6)(()=>[(0,r.bF)(s,{label:"名称",required:"",rules:[{required:!0,message:"请输入命名空间名称",trigger:"blur"},{pattern:/^[a-z0-9]([-a-z0-9]*[a-z0-9])?$/,message:"命名空间名称只能包含小写字母、数字和连字符，且必须以字母数字字符开头和结尾",trigger:"blur"}]},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:i.name,"onUpdate:modelValue":t[0]||(t[0]=e=>i.name=e),placeholder:"请输入命名空间名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{label:"描述"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:i.description,"onUpdate:modelValue":t[1]||(t[1]=e=>i.description=e),placeholder:"请输入描述信息",type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),(0,r.bF)(s,{label:"标签"},{default:(0,r.k6)(()=>[(0,r.bF)(l,{modelValue:i.customLabels,"onUpdate:modelValue":t[2]||(t[2]=e=>i.customLabels=e),placeholder:"格式：key=value，每行一个",type:"textarea",rows:3},null,8,["modelValue"]),t[3]||(t[3]=(0,r.Lk)("div",{class:"form-hint"},null,-1))]),_:1,__:[3]})]),_:1},8,["model"])]),_:1},8,["model-value"])}}};const e_=(0,p.A)(Zy,[["__scopeId","data-v-54b4651a"]]);var a_=e_;const t_={class:"k8s-namespace-management"},l_={class:"card-header"},s_={class:"header-actions"},o_={class:"cluster-option"},n_={class:"cluster-name"},i_={class:"search-section"},r_={key:0,class:"namespace-detail-content"},d_={key:0,class:"labels-section"},c_={class:"labels-list"},u_={key:1,class:"labels-section"},p_={class:"labels-list"},m_={key:2,class:"no-labels"},g_={class:"quota-content"},v_={class:"quota-list-section"},h_={class:"section-header"},k_={class:"quota-operation-buttons"},b_={key:0,class:"empty-state"},f_={class:"limit-range-content"},y_={class:"limit-range-list-section"},__={class:"section-header"},w_={class:"limit-range-operation-buttons"},L_={key:0,class:"empty-state"},F_={class:"dialog-footer"},C_={class:"dialog-footer"};var V_={__name:"k8s-namespace",setup(e){(0,v.rd)();const a=(0,Y.KR)(!1),t=(0,Y.Kh)({namespaceName:"",status:""}),l=[{label:"全部",value:""},{label:"活跃",value:"Active"},{label:"终止中",value:"Terminating"},{label:"未知",value:"Unknown"}],s=(0,Y.KR)([]),o=(0,Y.KR)(""),n=(0,Y.KR)([]),d=(0,Y.KR)(!1),c=(0,Y.KR)(!1),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(!1),g=(0,Y.KR)(!1),h=(0,Y.KR)({}),k=(0,Y.KR)(null),b=(0,Y.KR)([]),f=(0,Y.KR)([]),y=(0,Y.Kh)({name:"",cpuLimit:"",memoryLimit:"",storageLimit:"",podLimit:"",serviceLimit:""}),_=(0,Y.Kh)({name:"",containerCpuMin:"",containerCpuMax:"",containerMemoryMin:"",containerMemoryMax:"",containerCpuDefault:"",containerMemoryDefault:""}),w=async()=>{try{const e=await ce.getClusterList(),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];if(n.value=e.map(e=>({id:e.id,name:e.name,status:e.status})),n.value.length>0&&!o.value){const e=n.value.find(e=>2===e.status);o.value=e?e.id:n.value[0].id}console.log("集群列表加载成功:",n.value)}else J.nk.error(a.message||"获取集群列表失败")}catch(e){console.error("获取集群列表失败:",e),J.nk.warning("无法获取集群列表，请检查后端服务")}},L=async()=>{try{if(!o.value)return void J.nk.warning("请选择一个集群");a.value=!0;const e={};t.namespaceName&&(e.name=t.namespaceName),t.status&&(e.status=t.status);const l=await ce.getNamespaces(o.value,Object.keys(e).length>0?e:void 0),n=l.data||l;if(console.log("命名空间列表API响应:",n),200===n.code||n.success){const e=n.data?.namespaces||n.data||[],a=Array.isArray(e)?e:[];s.value=a.map(e=>({name:e.name,status:e.status||"Active",age:F(e.createdAt),labels:e.labels||{},resourceQuotas:e.resourceQuotas||[],limitRanges:e.limitRanges||[],resourceCount:{pods:e.resourceCount?.podCount||0,services:e.resourceCount?.serviceCount||0,secrets:e.resourceCount?.secretCount||0,configMaps:e.resourceCount?.configMapCount||0}})),console.log("命名空间列表加载成功:",s.value)}else J.nk.error(n.message||"获取命名空间列表失败"),s.value=[]}catch(e){console.error("获取命名空间列表失败:",e),"ERR_NETWORK"===e.code||e.message?.includes("ERR_CONNECTION_REFUSED")||e.message?.includes("Failed to fetch")?J.nk.warning("后端服务连接失败，请检查服务状态"):401===e.response?.status?J.nk.error("认证失败，请重新登录"):403===e.response?.status?J.nk.error("权限不足，请联系管理员"):console.warn("API调用异常，但可能数据已正确加载"),s.value=[]}finally{a.value=!1}},F=e=>{if(!e)return"Unknown";const a=new Date,t=new Date(e),l=Math.floor((a-t)/1e3);return l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:l<86400?`${Math.floor(l/3600)}h`:`${Math.floor(l/86400)}d`},C=()=>{t.namespaceName="",t.status="",L()},V=()=>{o.value?L():s.value=[]},S=()=>{d.value=!0},I=async e=>{try{k.value&&k.value.setSubmitting(!0);const a=await ce.createNamespace(o.value,e),t=a.data||a;200===t.code||t.success?(J.nk.success("命名空间创建成功"),d.value=!1,L()):J.nk.error(t.message||"创建命名空间失败")}catch(a){console.error("创建命名空间失败:",a),J.nk.error("创建命名空间失败，请检查网络连接")}finally{k.value&&k.value.setSubmitting(!1)}},A=async e=>{try{a.value=!0;const t=await ce.getNamespaceDetail(o.value,e.name),l=t.data||t;200===l.code||l.success?(h.value=l.data?.name?l.data:e,c.value=!0):J.nk.error(l.message||"获取命名空间详情失败")}catch(t){console.error("获取命名空间详情失败:",t),J.nk.error("获取命名空间详情失败，请检查网络连接")}finally{a.value=!1}},R=async e=>{try{h.value=e;const a=await ce.getResourceQuotas(o.value,e.name),t=a.data||a;if(200===t.code||t.success){const e=t.data?.resourceQuotas||t.data||[];b.value=Array.isArray(e)?e:[],u.value=!0}else J.nk.error(t.message||"获取ResourceQuota失败")}catch(a){console.error("获取ResourceQuota失败:",a),J.nk.error("获取ResourceQuota失败，请检查网络连接")}},D=async e=>{try{h.value=e;const a=await ce.getLimitRanges(o.value,e.name),t=a.data||a;if(200===t.code||t.success){const e=t.data?.limitRanges||t.data||[],a=Array.isArray(e)?e.map(e=>({name:e.name,createdAt:e.createdAt,spec:{limits:e.limits||[]}})):[];f.value=a,p.value=!0,console.log("LimitRange数据加载成功:",f.value)}else J.nk.error(t.message||"获取LimitRange失败")}catch(a){console.error("获取LimitRange失败:",a),J.nk.error("获取LimitRange失败，请检查网络连接")}},P=async e=>{try{if(U(e.name))return void J.nk.warning("系统命名空间不可删除");await uv.s.confirm(`确定要删除命名空间 ${e.name} 吗？删除后将无法恢复，且会删除该命名空间下的所有资源！`,"删除命名空间确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const a=await ce.deleteNamespace(o.value,e.name),t=a.data||a;200===t.code||t.success?(J.nk.success(`命名空间 ${e.name} 删除成功`),L()):J.nk.error(t.message||"删除命名空间失败")}catch(a){"cancel"===a?J.nk.info("已取消删除操作"):(console.error("删除命名空间失败:",a),J.nk.error("删除命名空间失败，请检查网络连接"))}},$=e=>{const a={Active:"success",Terminating:"warning",Unknown:"info"};return a[e]||"info"},T=e=>{const a={Active:"活跃",Terminating:"终止中",Unknown:"未知"};return a[e]||"未知"},M=e=>{const a={1:"info",2:"success",3:"warning",4:"danger",5:"info"};return a[e]||"info"},E=e=>{const a={1:"创建中",2:"运行中",3:"已停止",4:"异常",5:"已删除"};return a[e]||"未知"},W=async(e,a="已复制到剪贴板")=>{try{await navigator.clipboard.writeText(e),J.nk.success(a)}catch(t){console.error("复制失败:",t);const s=document.createElement("textarea");s.value=e,document.body.appendChild(s),s.select();try{document.execCommand("copy"),J.nk.success(a)}catch(l){J.nk.error("复制失败，请手动复制")}document.body.removeChild(s)}},z=e=>{if(!e)return{};const a=["kubernetes.io/","beta.kubernetes.io/","app.kubernetes.io/"],t={};return Object.entries(e).forEach(([e,l])=>{a.some(a=>e.startsWith(a))||(t[e]=l)}),t},N=e=>{if(!e)return{};const a=["kubernetes.io/","beta.kubernetes.io/","app.kubernetes.io/"],t={};return Object.entries(e).forEach(([e,l])=>{a.some(a=>e.startsWith(a))&&(t[e]=l)}),t},K=e=>{h.value=e,c.value=!0},U=e=>{const a=["default","kube-system","kube-public","kube-node-lease"];return a.includes(e)},X=e=>e&&"object"===typeof e?Object.keys(e).length:0,q=()=>{y.name="",y.cpuLimit="",y.memoryLimit="",y.storageLimit="",y.podLimit="",y.serviceLimit="",y.isEditing=!1,y.originalName="",m.value=!0},H=()=>{_.name="",_.containerCpuMin="",_.containerCpuMax="",_.containerMemoryMin="",_.containerMemoryMax="",_.containerCpuDefault="",_.containerMemoryDefault="",_.isEditing=!1,_.originalName="",g.value=!0},B=async()=>{try{if(!y.name)return void J.nk.warning("请输入配额名称");const e={name:y.name,hard:{}};if(y.cpuLimit){const a=y.cpuLimit.trim();e.hard["limits.cpu"]=/^\d+$/.test(a)?`${a}`:a}if(y.memoryLimit){const a=y.memoryLimit.trim();e.hard["limits.memory"]=/^\d+$/.test(a)?`${a}Gi`:a}if(y.storageLimit){const a=y.storageLimit.trim();e.hard["requests.storage"]=/^\d+$/.test(a)?`${a}Gi`:a}let a,t;y.podLimit&&(e.hard["count/pods"]=y.podLimit),y.serviceLimit&&(e.hard["count/services"]=y.serviceLimit),a=y.isEditing?await ce.updateResourceQuota(o.value,h.value.name,y.originalName,e):await ce.createResourceQuota(o.value,h.value.name,e),t=a.data||a,200===t.code||t.success?(J.nk.success(y.isEditing?"ResourceQuota更新成功":"ResourceQuota创建成功"),m.value=!1,R(h.value)):J.nk.error(t.message||(y.isEditing?"更新ResourceQuota失败":"创建ResourceQuota失败"))}catch(e){console.error((y.isEditing?"更新":"创建")+"ResourceQuota失败:",e),J.nk.error((y.isEditing?"更新":"创建")+"ResourceQuota失败，请检查网络连接")}},j=async()=>{try{if(!_.name)return void J.nk.warning("请输入限制名称");const e={name:_.name,spec:{limits:[{type:"Container",min:{},max:{},default:{},defaultRequest:{}}]}},a=e.spec.limits[0];if(_.containerCpuMin){const e=_.containerCpuMin.trim();a.min.cpu=/^\d+$/.test(e)?`${e}m`:e}if(_.containerCpuMax){const e=_.containerCpuMax.trim();a.max.cpu=/^\d+$/.test(e)?`${e}`:e}if(_.containerCpuDefault){const e=_.containerCpuDefault.trim();a.default.cpu=/^\d+$/.test(e)?`${e}m`:e}if(_.containerMemoryMin){const e=_.containerMemoryMin.trim();a.min.memory=/^\d+$/.test(e)?`${e}Mi`:e}if(_.containerMemoryMax){const e=_.containerMemoryMax.trim();a.max.memory=/^\d+$/.test(e)?`${e}Gi`:e}if(_.containerMemoryDefault){const e=_.containerMemoryDefault.trim();a.default.memory=/^\d+$/.test(e)?`${e}Mi`:e}let t,l;t=_.isEditing?await ce.updateLimitRange(o.value,h.value.name,_.originalName,e):await ce.createLimitRange(o.value,h.value.name,e),l=t.data||t,200===l.code||l.success?(J.nk.success(_.isEditing?"LimitRange更新成功":"LimitRange创建成功"),g.value=!1,D(h.value)):J.nk.error(l.message||(_.isEditing?"更新LimitRange失败":"创建LimitRange失败"))}catch(e){console.error((_.isEditing?"更新":"创建")+"LimitRange失败:",e),J.nk.error((_.isEditing?"更新":"创建")+"LimitRange失败，请检查网络连接")}},O=e=>e&&"-"!==e?"string"===typeof e&&(e.includes("m")||e.includes("Gi")||e.includes("Mi")||e.includes("Ki"))?e:/^\d+$/.test(e)?`${e} cores`:e:"-",Q=e=>e&&"-"!==e?`${e} 个`:"-",G=e=>{y.name=e.name,y.cpuLimit=e.hard?.["limits.cpu"]?.replace(/cores?/i,"").trim()||"",y.memoryLimit=e.hard?.["limits.memory"]?.replace(/Gi?/i,"").trim()||"",y.storageLimit=e.hard?.["requests.storage"]?.replace(/Gi?/i,"").trim()||"",y.podLimit=e.hard?.["count/pods"]||"",y.serviceLimit=e.hard?.["count/services"]||"",y.isEditing=!0,y.originalName=e.name,m.value=!0},Z=async e=>{try{await uv.s.confirm(`确定要删除资源配额 "${e.name}" 吗？删除后将无法恢复！`,"删除资源配额确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const a=await ce.deleteResourceQuota(o.value,h.value.name,e.name),t=a.data||a;200===t.code||t.success?(J.nk.success(`资源配额 "${e.name}" 删除成功`),R(h.value)):J.nk.error(t.message||"删除资源配额失败")}catch(a){"cancel"===a?J.nk.info("已取消删除操作"):(console.error("删除资源配额失败:",a),J.nk.error("删除资源配额失败，请检查网络连接"))}},ee=e=>{_.name=e.name;const a=e.spec?.limits?.[0]||{},t=e=>e?e.toString().replace(/m$/i,"").replace(/cores?$/i,"").trim():"",l=e=>e?e.toString().replace(/Mi$/i,"").replace(/Gi$/i,"").replace(/Ki$/i,"").trim():"";_.containerCpuMin=t(a.min?.cpu),_.containerCpuMax=t(a.max?.cpu),_.containerMemoryMin=l(a.min?.memory),_.containerMemoryMax=l(a.max?.memory),_.containerCpuDefault=t(a.default?.cpu),_.containerMemoryDefault=l(a.default?.memory),_.isEditing=!0,_.originalName=e.name,console.log("编辑LimitRange表单数据:",_),g.value=!0},ae=async e=>{try{await uv.s.confirm(`确定要删除资源限制 "${e.name}" 吗？删除后将无法恢复！`,"删除资源限制确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const a=await ce.deleteLimitRange(o.value,h.value.name,e.name),t=a.data||a;200===t.code||t.success?(J.nk.success(`资源限制 "${e.name}" 删除成功`),D(h.value)):J.nk.error(t.message||"删除资源限制失败")}catch(a){"cancel"===a?J.nk.info("已取消删除操作"):(console.error("删除资源限制失败:",a),J.nk.error("删除资源限制失败，请检查网络连接"))}};return(0,r.sV)(async()=>{await w(),o.value&&L()}),(e,v)=>{const w=(0,r.g2)("el-tag"),U=(0,r.g2)("el-option"),J=(0,r.g2)("el-select"),te=(0,r.g2)("el-input"),le=(0,r.g2)("el-form-item"),se=(0,r.g2)("el-button"),oe=(0,r.g2)("el-form"),ne=(0,r.g2)("el-card"),ie=(0,r.g2)("el-descriptions-item"),re=(0,r.g2)("el-descriptions"),de=(0,r.g2)("el-icon"),ce=(0,r.g2)("el-empty"),ue=(0,r.g2)("el-dialog"),pe=(0,r.g2)("el-table-column"),me=(0,r.g2)("el-table"),ge=(0,r.g2)("el-divider"),ve=(0,r.g2)("el-col"),he=(0,r.g2)("el-row"),ke=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",t_,[(0,r.bF)(ne,{shadow:"hover",class:"namespace-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",l_,[v[24]||(v[24]=(0,r.Lk)("span",{class:"title"},"K8s 命名空间管理",-1)),(0,r.Lk)("div",s_,[(0,r.bF)(J,{modelValue:o.value,"onUpdate:modelValue":v[0]||(v[0]=e=>o.value=e),placeholder:"请选择集群",size:"small",style:{width:"250px"},onChange:V,loading:!n.value.length},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(n.value,e=>((0,r.uX)(),(0,r.Wv)(U,{key:e.id,label:`${e.name} ${E(e.status)}`,value:e.id,disabled:2!==e.status},{default:(0,r.k6)(()=>[(0,r.Lk)("div",o_,[(0,r.Lk)("span",n_,(0,x.v_)(e.name),1),(0,r.bF)(w,{type:M(e.status),size:"small",class:"cluster-status-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(E(e.status)),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",i_,[(0,r.bF)(oe,{inline:!0,model:t,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"命名空间名称"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:t.namespaceName,"onUpdate:modelValue":v[1]||(v[1]=e=>t.namespaceName=e),placeholder:"请输入命名空间名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(L,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(le,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.bF)(J,{modelValue:t.status,"onUpdate:modelValue":v[2]||(v[2]=e=>t.status=e),placeholder:"请选择状态",clearable:"",size:"small",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(l,e=>(0,r.bF)(U,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(le,null,{default:(0,r.k6)(()=>[(0,r.bF)(se,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:L},{default:(0,r.k6)(()=>v[25]||(v[25]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[25]},8,["icon"]),(0,r.bF)(se,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:C},{default:(0,r.k6)(()=>v[26]||(v[26]=[(0,r.eW)(" 重置 ",-1)])),_:1,__:[26]},8,["icon"]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(se,{type:"success",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:S},{default:(0,r.k6)(()=>v[27]||(v[27]=[(0,r.eW)(" 创建命名空间 ",-1)])),_:1,__:[27]},8,["icon"])),[[ke,["k8s:namespace:add"]]])]),_:1})]),_:1},8,["model"])]),(0,r.bF)(Yy,{"table-data":s.value,loading:a.value,onViewNamespaceDetail:A,onViewNamespaceLabels:K,onManageResourceQuotas:R,onManageLimitRanges:D,onDeleteNamespace:P},null,8,["table-data","loading"])]),_:1}),(0,r.bF)(a_,{visible:d.value,"onUpdate:visible":v[3]||(v[3]=e=>d.value=e),"selected-cluster-id":o.value,onSuccess:I,ref_key:"createDialogRef",ref:k},null,8,["visible","selected-cluster-id"]),(0,r.bF)(ue,{modelValue:c.value,"onUpdate:modelValue":v[4]||(v[4]=e=>c.value=e),title:`命名空间详情 - ${h.value.name||""}`,width:"800px",class:"namespace-detail-dialog"},{default:(0,r.k6)(()=>[h.value?((0,r.uX)(),(0,r.CE)("div",r_,[(0,r.bF)(re,{column:2,border:"",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(h.value.name),1)]),_:1}),(0,r.bF)(ie,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.bF)(w,{type:$(h.value.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(T(h.value.status)),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(ie,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F(h.value.createdAt)),1)]),_:1}),(0,r.bF)(ie,{label:"注解数量"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(X(h.value.annotations)),1)]),_:1})]),_:1}),Object.keys(z(h.value.labels)).length>0?((0,r.uX)(),(0,r.CE)("div",d_,[v[28]||(v[28]=(0,r.Lk)("h4",null,"用户标签",-1)),(0,r.Lk)("div",c_,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(z(h.value.labels),(e,a)=>((0,r.uX)(),(0,r.Wv)(w,{key:a,type:"primary",size:"default",class:"label-tag",onClick:t=>W(`${a}=${e}`,"标签信息已复制")},{default:(0,r.k6)(()=>[(0,r.bF)(de,{class:"tag-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.eW)(" "+(0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])])):(0,r.Q3)("",!0),Object.keys(N(h.value.labels)).length>0?((0,r.uX)(),(0,r.CE)("div",u_,[v[29]||(v[29]=(0,r.Lk)("h4",null,"系统标签",-1)),(0,r.Lk)("div",p_,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(N(h.value.labels),(e,a)=>((0,r.uX)(),(0,r.Wv)(w,{key:a,type:"info",size:"default",class:"label-tag system-label",onClick:t=>W(`${a}=${e}`,"标签信息已复制")},{default:(0,r.k6)(()=>[(0,r.bF)(de,{class:"tag-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),(0,r.eW)(" "+(0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])])):(0,r.Q3)("",!0),h.value.labels&&0!==Object.keys(h.value.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",m_,[(0,r.bF)(ce,{description:"该命名空间没有标签","image-size":60})]))])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"]),(0,r.bF)(ue,{modelValue:u.value,"onUpdate:modelValue":v[5]||(v[5]=e=>u.value=e),title:`资源配额管理 - ${h.value.name||""}`,width:"900px",class:"resource-quota-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",g_,[(0,r.Lk)("div",v_,[(0,r.Lk)("div",h_,[v[31]||(v[31]=(0,r.Lk)("h4",null,"当前资源配额",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(se,{type:"primary",size:"small",icon:(0,Y.R1)(vc.Plus),onClick:q},{default:(0,r.k6)(()=>v[30]||(v[30]=[(0,r.eW)("添加配额",-1)])),_:1,__:[30]},8,["icon"])),[[ke,["k8s:namespace:setupadd"]]])]),(0,r.bF)(me,{data:b.value,size:"small",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(pe,{prop:"name",label:"配额名称","min-width":"150"}),(0,r.bF)(pe,{label:"CPU限制","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(O(e.hard?.["limits.cpu"])),1)]),_:1}),(0,r.bF)(pe,{label:"内存限制","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(O(e.hard?.["limits.memory"])),1)]),_:1}),(0,r.bF)(pe,{label:"Pod数量限制","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(Q(e.hard?.["count/pods"])),1)]),_:1}),(0,r.bF)(pe,{label:"操作",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",k_,[(0,r.bF)(se,{type:"primary",size:"small",icon:(0,Y.R1)(vc.Edit),onClick:a=>G(e)},{default:(0,r.k6)(()=>v[32]||(v[32]=[(0,r.eW)("编辑",-1)])),_:2,__:[32]},1032,["icon","onClick"]),(0,r.bF)(se,{type:"danger",size:"small",icon:(0,Y.R1)(vc.Delete),onClick:a=>Z(e)},{default:(0,r.k6)(()=>v[33]||(v[33]=[(0,r.eW)("删除",-1)])),_:2,__:[33]},1032,["icon","onClick"])])]),_:1})]),_:1},8,["data"]),0===b.value.length?((0,r.uX)(),(0,r.CE)("div",b_,[(0,r.bF)(ce,{description:"暂无资源配额","image-size":60})])):(0,r.Q3)("",!0)])])]),_:1},8,["modelValue","title"]),(0,r.bF)(ue,{modelValue:p.value,"onUpdate:modelValue":v[6]||(v[6]=e=>p.value=e),title:`资源限制管理 - ${h.value.name||""}`,width:"900px",class:"limit-range-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",f_,[(0,r.Lk)("div",y_,[(0,r.Lk)("div",__,[v[35]||(v[35]=(0,r.Lk)("h4",null,"当前资源限制",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(se,{type:"primary",size:"small",icon:(0,Y.R1)(vc.Plus),onClick:H},{default:(0,r.k6)(()=>v[34]||(v[34]=[(0,r.eW)("添加限制",-1)])),_:1,__:[34]},8,["icon"])),[[ke,["k8s:namespace:restrictionadd"]]])]),(0,r.bF)(me,{data:f.value,size:"small",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(pe,{prop:"name",label:"限制名称","min-width":"150"}),(0,r.bF)(pe,{label:"容器CPU最小值","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(w,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.spec?.limits?.[0]?.min?.cpu||"-"),1)]),_:2},1024)]),_:1}),(0,r.bF)(pe,{label:"容器CPU最大值","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(w,{size:"small",type:"warning"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.spec?.limits?.[0]?.max?.cpu||"-"),1)]),_:2},1024)]),_:1}),(0,r.bF)(pe,{label:"容器内存最小值","min-width":"130"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(w,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.spec?.limits?.[0]?.min?.memory||"-"),1)]),_:2},1024)]),_:1}),(0,r.bF)(pe,{label:"容器内存最大值","min-width":"130"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(w,{size:"small",type:"warning"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.spec?.limits?.[0]?.max?.memory||"-"),1)]),_:2},1024)]),_:1}),(0,r.bF)(pe,{label:"创建时间","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(w,{size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F(e.createdAt)),1)]),_:2},1024)]),_:1}),(0,r.bF)(pe,{label:"操作",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",w_,[(0,r.bF)(se,{type:"primary",size:"small",icon:(0,Y.R1)(vc.Edit),onClick:a=>ee(e)},{default:(0,r.k6)(()=>v[36]||(v[36]=[(0,r.eW)("编辑",-1)])),_:2,__:[36]},1032,["icon","onClick"]),(0,r.bF)(se,{type:"danger",size:"small",icon:(0,Y.R1)(vc.Delete),onClick:a=>ae(e)},{default:(0,r.k6)(()=>v[37]||(v[37]=[(0,r.eW)("删除",-1)])),_:2,__:[37]},1032,["icon","onClick"])])]),_:1})]),_:1},8,["data"]),0===f.value.length?((0,r.uX)(),(0,r.CE)("div",L_,[(0,r.bF)(ce,{description:"暂无资源限制","image-size":60})])):(0,r.Q3)("",!0)])])]),_:1},8,["modelValue","title"]),(0,r.bF)(ue,{modelValue:m.value,"onUpdate:modelValue":v[14]||(v[14]=e=>m.value=e),title:y.isEditing?"编辑资源配额":"创建资源配额",width:"600px",class:"create-quota-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",F_,[(0,r.bF)(se,{onClick:v[13]||(v[13]=e=>m.value=!1)},{default:(0,r.k6)(()=>v[41]||(v[41]=[(0,r.eW)("取消",-1)])),_:1,__:[41]}),(0,r.bF)(se,{type:"primary",onClick:B},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(y.isEditing?"更新":"创建"),1)]),_:1})])]),default:(0,r.k6)(()=>[(0,r.bF)(oe,{model:y,"label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"配额名称",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:y.name,"onUpdate:modelValue":v[7]||(v[7]=e=>y.name=e),placeholder:"请输入配额名称，如：compute-quota"},null,8,["modelValue"])]),_:1}),(0,r.bF)(le,{label:"CPU限制"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:y.cpuLimit,"onUpdate:modelValue":v[8]||(v[8]=e=>y.cpuLimit=e),placeholder:"如：4（自动添加核心单位）或 4000m（毫核心）"},{append:(0,r.k6)(()=>v[38]||(v[38]=[(0,r.eW)("cores",-1)])),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(le,{label:"内存限制"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:y.memoryLimit,"onUpdate:modelValue":v[9]||(v[9]=e=>y.memoryLimit=e),placeholder:"如：8（自动添加Gi单位）或 8192Mi"},{append:(0,r.k6)(()=>v[39]||(v[39]=[(0,r.eW)("Gi",-1)])),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(le,{label:"存储限制"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:y.storageLimit,"onUpdate:modelValue":v[10]||(v[10]=e=>y.storageLimit=e),placeholder:"如：100（自动添加Gi单位）或 100Gi"},{append:(0,r.k6)(()=>v[40]||(v[40]=[(0,r.eW)("Gi",-1)])),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(le,{label:"Pod数量限制"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:y.podLimit,"onUpdate:modelValue":v[11]||(v[11]=e=>y.podLimit=e),placeholder:"如：50（最多50个Pod）"},null,8,["modelValue"])]),_:1}),(0,r.bF)(le,{label:"Service数量限制"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:y.serviceLimit,"onUpdate:modelValue":v[12]||(v[12]=e=>y.serviceLimit=e),placeholder:"如：20（最多20个Service）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),(0,r.bF)(ue,{modelValue:g.value,"onUpdate:modelValue":v[23]||(v[23]=e=>g.value=e),title:_.isEditing?"编辑资源限制":"创建资源限制",width:"700px",class:"create-limit-range-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",C_,[(0,r.bF)(se,{onClick:v[22]||(v[22]=e=>g.value=!1)},{default:(0,r.k6)(()=>v[50]||(v[50]=[(0,r.eW)("取消",-1)])),_:1,__:[50]}),(0,r.bF)(se,{type:"primary",onClick:j},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(_.isEditing?"更新":"创建"),1)]),_:1})])]),default:(0,r.k6)(()=>[(0,r.bF)(oe,{model:_,"label-width":"150px"},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"限制名称",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.name,"onUpdate:modelValue":v[15]||(v[15]=e=>_.name=e),placeholder:"请输入限制名称，如：container-limits"},null,8,["modelValue"])]),_:1}),(0,r.bF)(ge,null,{default:(0,r.k6)(()=>v[42]||(v[42]=[(0,r.eW)("容器资源限制",-1)])),_:1,__:[42]}),(0,r.bF)(he,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(ve,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"CPU最小值"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.containerCpuMin,"onUpdate:modelValue":v[16]||(v[16]=e=>_.containerCpuMin=e),placeholder:"如：100（自动添加m单位）"},{append:(0,r.k6)(()=>v[43]||(v[43]=[(0,r.eW)("m",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(ve,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"CPU最大值"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.containerCpuMax,"onUpdate:modelValue":v[17]||(v[17]=e=>_.containerCpuMax=e),placeholder:"如：2（核心数）"},{append:(0,r.k6)(()=>v[44]||(v[44]=[(0,r.eW)("cores",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(he,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(ve,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"内存最小值"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.containerMemoryMin,"onUpdate:modelValue":v[18]||(v[18]=e=>_.containerMemoryMin=e),placeholder:"如：128（自动添加Mi单位）"},{append:(0,r.k6)(()=>v[45]||(v[45]=[(0,r.eW)("Mi",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(ve,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"内存最大值"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.containerMemoryMax,"onUpdate:modelValue":v[19]||(v[19]=e=>_.containerMemoryMax=e),placeholder:"如：4（自动添加Gi单位）"},{append:(0,r.k6)(()=>v[46]||(v[46]=[(0,r.eW)("Gi",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(ge,null,{default:(0,r.k6)(()=>v[47]||(v[47]=[(0,r.eW)("默认资源配置",-1)])),_:1,__:[47]}),(0,r.bF)(he,{gutter:20},{default:(0,r.k6)(()=>[(0,r.bF)(ve,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"默认CPU"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.containerCpuDefault,"onUpdate:modelValue":v[20]||(v[20]=e=>_.containerCpuDefault=e),placeholder:"如：500（自动添加m单位）"},{append:(0,r.k6)(()=>v[48]||(v[48]=[(0,r.eW)("m",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(ve,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:"默认内存"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{modelValue:_.containerMemoryDefault,"onUpdate:modelValue":v[21]||(v[21]=e=>_.containerMemoryDefault=e),placeholder:"如：1（自动添加Mi单位）"},{append:(0,r.k6)(()=>v[49]||(v[49]=[(0,r.eW)("Mi",-1)])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}};const x_=(0,p.A)(V_,[["__scopeId","data-v-f6005796"]]);var S_=x_;const I_={class:"k8s-network-management"},A_={class:"card-header"},R_={class:"header-actions"},D_={class:"cluster-option"},P_={class:"cluster-name"},$_={class:"namespace-option"},T_={class:"namespace-name"},M_={class:"search-section"},E_={class:"resource-controls"},W_={class:"create-actions"},z_={class:"table-content"},N_={key:0,class:"tab-content"},K_={class:"resource-name"},U_=["onClick"],X_={class:"ports-info"},q_={key:0,class:"nodeport-info"},H_={class:"selector-info"},B_={class:"operation-buttons"},j_={key:1,class:"tab-content"},O_={class:"resource-name"},Q_=["onClick"],G_={class:"hosts-info"},Y_={class:"paths-info"},J_={class:"operation-buttons"},Z_={class:"detail-content"},ew={class:"labels-info"},aw={class:"ports-info"},tw={key:0,class:"nodeport-info"},lw={class:"events-content"},sw={class:"detail-content"},ow={class:"rules-info"},nw={class:"events-content"},iw={class:"form-row"},rw={class:"option-content"},dw={class:"option-desc"},cw={class:"ports-config"},uw={class:"port-fields"},pw={class:"dialog-footer"},mw={class:"form-row"},gw={class:"option-content"},vw={class:"option-desc"},hw={class:"ports-config"},kw={class:"port-fields"},bw={class:"dialog-footer"},fw={class:"rules-config"},yw={class:"rule-header"},_w={class:"paths-config"},ww={class:"path-fields"},Lw={class:"option-content"},Fw={class:"option-desc"},Cw={class:"dialog-footer"},Vw={class:"rules-config"},xw={class:"rule-header"},Sw={class:"paths-config"},Iw={class:"path-fields"},Aw={class:"option-content"},Rw={class:"option-desc"},Dw={class:"dialog-footer"};var Pw={__name:"k8s-network",setup(e){(0,v.rd)();const a=(0,v.lq)(),t=(0,Y.KR)(a.params.clusterId||a.query.clusterId||""),l=(0,Y.KR)(a.params.namespaceName||a.query.namespaceName||"default"),s=(0,Y.KR)([]),o=(0,Y.KR)([]),n=(0,Y.KR)(!1),d=(0,Y.KR)(!1),c=e=>{const a={1:"info",2:"success",3:"warning",0:"danger"};return a[e]||"info"},u=e=>{const a={0:"离线",1:"连接中",2:"在线",3:"异常"};return a[e]||"未知"},p=(0,Y.KR)(!1),m=(0,Y.KR)("service"),g=(0,Y.KR)(""),h=(0,Y.KR)([]),k=(0,Y.KR)(!1);(0,r.wB)(h,e=>{Array.isArray(e)||(console.warn("serviceList 被设置为非数组值:",e,"重置为空数组"),h.value=[])},{immediate:!0});const b=(0,Y.KR)(!1),f=(0,Y.KR)(!1),y=(0,Y.KR)(!1),_=(0,Y.KR)(!1),w=(0,Y.KR)(!1),L=(0,Y.Kh)({name:"",labels:{},type:"ClusterIP",selector:{},ports:[{name:"",port:80,targetPort:80,protocol:"TCP"}],description:""}),F=(0,Y.KR)({}),C=(0,Y.KR)(""),V=(0,Y.KR)({}),S=(0,Y.KR)([]),I=(0,Y.KR)([]),A=(0,Y.KR)(!1);(0,r.wB)(I,e=>{Array.isArray(e)||(console.warn("ingressList 被设置为非数组值:",e,"重置为空数组"),I.value=[])},{immediate:!0});const R=(0,Y.KR)(!1),D=(0,Y.KR)(!1),P=(0,Y.KR)(!1),$=(0,Y.KR)(!1),T=(0,Y.KR)(!1),M=(0,Y.Kh)({name:"",annotations:{},rules:[{host:"",paths:[{path:"/",pathType:"Prefix",serviceName:"",servicePort:80}]}],tls:[],description:""}),E=(0,Y.KR)({}),W=(0,Y.KR)(""),z=(0,Y.KR)({}),N=(0,Y.KR)([]),K=[{label:"ClusterIP",value:"ClusterIP",description:"集群内部访问"},{label:"NodePort",value:"NodePort",description:"节点端口访问"},{label:"LoadBalancer",value:"LoadBalancer",description:"负载均衡器访问"},{label:"ExternalName",value:"ExternalName",description:"外部名称映射"}],U=[{label:"TCP",value:"TCP"},{label:"UDP",value:"UDP"},{label:"SCTP",value:"SCTP"}],X=[{label:"Prefix",value:"Prefix",description:"前缀匹配"},{label:"Exact",value:"Exact",description:"精确匹配"},{label:"ImplementationSpecific",value:"ImplementationSpecific",description:"实现特定"}],q=(0,r.EW)(()=>{const e=Array.isArray(h.value)?h.value:[];return g.value?e.filter(e=>e.name?.toLowerCase().includes(g.value.toLowerCase())||e.type?.toLowerCase().includes(g.value.toLowerCase())):e}),H=(0,r.EW)(()=>{const e=Array.isArray(I.value)?I.value:[];return g.value?e.filter(e=>e.name?.toLowerCase().includes(g.value.toLowerCase())||e.rules&&Array.isArray(e.rules)&&e.rules.some(e=>e.host?.toLowerCase().includes(g.value.toLowerCase()))):e}),B=async()=>{try{n.value=!0;const e=await ce.getClusterList(),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];if(s.value=e.map(e=>({id:e.id,name:e.name||e.clusterName,status:e.status})),console.log("获取到集群列表:",s.value.length,"个集群"),!t.value&&s.value.length>0){const e=s.value.find(e=>2===e.status);t.value=e?e.id:s.value[0].id,O()}}else J.nk.error(a.message||"获取集群列表失败")}catch(e){console.error("获取集群列表失败:",e),J.nk.warning("无法获取集群列表，请检查后端服务")}finally{n.value=!1}},j=async(e=!1)=>{if(t.value){if(!(o.value.length>0)||e)try{d.value=!0;const e=await ce.getNamespaces(t.value),a=e.data||e;if(console.log("命名空间列表API响应:",a),200===a.code||a.success){const e=a.data?.namespaces||a.data||[],t=Array.isArray(e)?e:[];if(o.value=t.map(e=>({name:e.name||e,status:e.status||"Active",resourceCount:e.resourceCount||{},createdAt:e.createdAt})),console.log("获取到命名空间列表:",o.value.length,"个命名空间"),!l.value&&o.value.length>0){const e=o.value.find(e=>"default"===e.name);l.value=e?"default":o.value[0].name}}else console.error("获取命名空间列表失败:",a.message),o.value=[]}catch(a){console.error("获取命名空间列表失败:",a),o.value=[],401===a.response?.status?J.nk.error("认证失败，请重新登录"):403===a.response?.status?J.nk.error("权限不足，请联系管理员"):"ECONNABORTED"===a.code?J.nk.warning("请求超时，命名空间加载时间较长，请稍后重试"):e||console.warn("命名空间列表加载失败，错误已记录")}finally{d.value=!1}}else o.value=[]},O=async()=>{console.log("集群切换到:",t.value),o.value=[],l.value="default",h.value=[],I.value=[],t.value&&(await j(!0),"service"===m.value?G():Z())};(0,r.wB)(()=>t.value,e=>{e?O():(o.value=[],l.value="",h.value=[],I.value=[])});const Q=()=>{console.log("命名空间切换到:",l.value),h.value=[],I.value=[],"service"===m.value?G():Z()},G=async()=>{if(t.value)try{k.value=!0,console.log("正在获取 Service 列表，集群ID:",t.value,"命名空间:",l.value);const e=await ce.getServiceList(t.value,l.value),a=e.data||e;if(200===a.code||a.success){const e=a.data?.services||a.data;h.value=Array.isArray(e)?e:[],console.log("获取到 Service 列表:",h.value.length,"个")}else J.nk.error(a.message||"获取 Service 列表失败"),h.value=[]}catch(e){console.error("获取 Service 列表失败:",e),J.nk.error("获取 Service 列表失败，请检查网络连接"),h.value=[]}finally{k.value=!1}else console.warn("集群ID为空，无法获取 Service 列表")},Z=async()=>{if(t.value)try{A.value=!0,console.log("正在获取 Ingress 列表，集群ID:",t.value,"命名空间:",l.value);const e=await ce.getIngressList(t.value,l.value),a=e.data||e;if(200===a.code||a.success){const e=a.data?.ingresses||a.data;I.value=Array.isArray(e)?e:[],console.log("获取到 Ingress 列表:",I.value.length,"个")}else J.nk.error(a.message||"获取 Ingress 列表失败"),I.value=[]}catch(e){console.error("获取 Ingress 列表失败:",e),J.nk.error("获取 Ingress 列表失败，请检查网络连接"),I.value=[]}finally{A.value=!1}else console.warn("集群ID为空，无法获取 Ingress 列表")},ee=()=>{"service"===m.value?G():Z()},ae=e=>{m.value=e,g.value="","service"===e?G():Z()},te=()=>{if(!t.value)return void J.nk.warning("请先选择集群");if(!l.value)return void J.nk.warning("请先选择命名空间");const e=`apiVersion: v1\nkind: Service\nmetadata:\n  name: new-service\n  namespace: ${l.value}\nspec:\n  type: ClusterIP\n  ports:\n  - port: 80\n    targetPort: 8080\n    protocol: TCP\n    name: http\n  selector:\n    app: my-app`;C.value=e,F.value={name:"new-service",namespace:l.value},_.value=!0},le=async e=>{try{const a=await ce.getServiceDetail(t.value,l.value,e.name),s=a.data||a;200===s.code||s.success?(F.value=s.data||e,y.value=!0):J.nk.error(s.message||"获取 Service 详情失败")}catch(a){console.error("获取 Service 详情失败:",a),J.nk.error("获取 Service 详情失败")}},se=async e=>{try{p.value=!0;const a=await ce.getServiceYaml(t.value,l.value,e.name),s=a.data||a;if(200===s.code||s.success){let a=s.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# Service ${e.name} YAML\napiVersion: v1\nkind: Service\nmetadata:\n  name: ${e.name}`),C.value=String(a),F.value=e,_.value=!0}else J.nk.error(s.message||"获取 Service YAML 失败")}catch(a){console.error("获取 Service YAML 失败:",a),J.nk.error("获取 Service YAML 失败")}finally{p.value=!1}},oe=async e=>{try{V.value=e;const a=await ce.getServiceEvents(t.value,l.value,e.name),s=a.data||a;200===s.code||s.success?S.value=s.data||[]:(S.value=[],J.nk.warning("暂无事件数据")),w.value=!0}catch(a){console.error("获取 Service 事件失败:",a),S.value=[],w.value=!0}},ne=async e=>{try{const a=await ce.getServiceDetail(t.value,l.value,e.name),s=a.data||a;if(200===s.code||s.success){const e=s.data;Object.assign(L,{name:e.name,labels:e.labels||{},type:e.type,selector:e.selector||{},ports:e.ports||[{name:"",port:80,targetPort:80,protocol:"TCP"}],description:e.description||""}),f.value=!0}}catch(a){J.nk.error("获取 Service 详情失败")}},ie=async e=>{try{await uv.s.confirm(`确定要删除 Service "${e.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await ce.deleteService(t.value,l.value,e.name),s=a.data||a;200===s.code||s.success?(J.nk.success("Service 删除成功"),G()):J.nk.error(s.message||"Service 删除失败")}catch(a){"cancel"!==a&&J.nk.error("Service 删除失败")}},re=()=>{if(!t.value)return void J.nk.warning("请先选择集群");if(!l.value)return void J.nk.warning("请先选择命名空间");const e=`apiVersion: networking.k8s.io/v1beta1\nkind: Ingress\nmetadata:\n  name: new-ingress\n  namespace: ${l.value}\nspec:\n  rules:\n  - host: example.com\n    http:\n      paths:\n      - path: /\n        pathType: Prefix\n        backend:\n          serviceName: my-service\n          servicePort: 80`;W.value=e,E.value={name:"new-ingress",namespace:l.value},$.value=!0},de=async e=>{try{const a=await ce.getIngressDetail(t.value,l.value,e.name),s=a.data||a;200===s.code||s.success?(E.value=s.data||e,P.value=!0):J.nk.error(s.message||"获取 Ingress 详情失败")}catch(a){console.error("获取 Ingress 详情失败:",a),J.nk.error("获取 Ingress 详情失败")}},ue=async e=>{try{p.value=!0;const a=await ce.getIngressYaml(t.value,l.value,e.name),s=a.data||a;if(200===s.code||s.success){let a=s.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# Ingress ${e.name} YAML\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: ${e.name}`),W.value=String(a),E.value=e,$.value=!0}else J.nk.error(s.message||"获取 Ingress YAML 失败")}catch(a){console.error("获取 Ingress YAML 失败:",a),J.nk.error("获取 Ingress YAML 失败")}finally{p.value=!1}},pe=async e=>{try{z.value=e;const a=await ce.getIngressEvents(t.value,l.value,e.name),s=a.data||a;200===s.code||s.success?N.value=s.data||[]:(N.value=[],J.nk.warning("暂无事件数据")),T.value=!0}catch(a){console.error("获取 Ingress 事件失败:",a),N.value=[],T.value=!0}},me=async e=>{try{const a="new-service"===e.resourceName||!F.value?.creationTimestamp;let s;s=a?await ce.createPodFromYaml(t.value,l.value,{yamlContent:e.yamlContent}):await ce.updateServiceYaml(t.value,l.value,e.resourceName,e.yamlContent);const o=s.data||s;200===o.code||o.success?(J.nk.success(a?"Service 创建成功":"Service YAML 更新成功"),_.value=!1,G()):J.nk.error(o.message||(a?"Service 创建失败":"Service YAML 更新失败"))}catch(a){console.error("Service 操作失败:",a),J.nk.error("Service 操作失败")}},ge=async e=>{try{const a="new-ingress"===e.resourceName||!E.value?.creationTimestamp;let s;s=a?await ce.createPodFromYaml(t.value,l.value,{yamlContent:e.yamlContent}):await ce.updateIngressYaml(t.value,l.value,e.resourceName,e.yamlContent);const o=s.data||s;200===o.code||o.success?(J.nk.success(a?"Ingress 创建成功":"Ingress YAML 更新成功"),$.value=!1,Z()):J.nk.error(o.message||(a?"Ingress 创建失败":"Ingress YAML 更新失败"))}catch(a){console.error("Ingress 操作失败:",a),J.nk.error("Ingress 操作失败")}},ve=async e=>{try{const a=await ce.getIngressDetail(t.value,l.value,e.name),s=a.data||a;if(200===s.code||s.success){const e=s.data;Object.assign(M,{name:e.name,annotations:e.annotations||{},rules:e.rules||[{host:"",paths:[{path:"/",pathType:"Prefix",serviceName:"",servicePort:80}]}],tls:e.tls||[],description:e.description||""}),D.value=!0}}catch(a){J.nk.error("获取 Ingress 详情失败")}},he=async e=>{try{await uv.s.confirm(`确定要删除 Ingress "${e.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await ce.deleteIngress(t.value,l.value,e.name),s=a.data||a;200===s.code||s.success?(J.nk.success("Ingress 删除成功"),Z()):J.nk.error(s.message||"Ingress 删除失败")}catch(a){"cancel"!==a&&J.nk.error("Ingress 删除失败")}},ke=()=>{L.ports.push({name:"",port:80,targetPort:80,protocol:"TCP"})},be=e=>{L.ports.length>1&&L.ports.splice(e,1)},fe=()=>{M.rules.push({host:"",paths:[{path:"/",pathType:"Prefix",serviceName:"",servicePort:80}]})},ye=e=>{M.rules.length>1&&M.rules.splice(e,1)},_e=e=>{M.rules[e].paths.push({path:"/",pathType:"Prefix",serviceName:"",servicePort:80})},we=(e,a)=>{M.rules[e].paths.length>1&&M.rules[e].paths.splice(a,1)},Le=async()=>{try{const e=await ce.createService(t.value,l.value,L),a=e.data||e;200===a.code||a.success?(J.nk.success("Service 创建成功"),b.value=!1,G()):J.nk.error(a.message||"Service 创建失败")}catch(e){J.nk.error("Service 创建失败")}},Fe=async()=>{try{const e=await ce.updateService(t.value,l.value,L.name,L),a=e.data||e;200===a.code||a.success?(J.nk.success("Service 更新成功"),f.value=!1,G()):J.nk.error(a.message||"Service 更新失败")}catch(e){J.nk.error("Service 更新失败")}},Ce=async()=>{try{const e=await ce.createIngress(t.value,l.value,M),a=e.data||e;200===a.code||a.success?(J.nk.success("Ingress 创建成功"),R.value=!1,Z()):J.nk.error(a.message||"Ingress 创建失败")}catch(e){J.nk.error("Ingress 创建失败")}},Ve=async()=>{try{const e=await ce.updateIngress(t.value,l.value,M.name,M),a=e.data||e;200===a.code||a.success?(J.nk.success("Ingress 更新成功"),D.value=!1,Z()):J.nk.error(a.message||"Ingress 更新失败")}catch(e){J.nk.error("Ingress 更新失败")}},xe=async(e,a="资源")=>{try{await navigator.clipboard.writeText(e),J.nk.success(`${a}名称已复制到剪贴板`)}catch(t){console.error("复制失败:",t);try{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),J.nk.success(`${a}名称已复制到剪贴板`)}catch(l){J.nk.error("复制失败，请手动复制")}}};return(0,r.sV)(async()=>{console.log("组件挂载，开始初始化..."),await B();const e=a.params.clusterId||a.query.clusterId;e&&s.value.some(a=>a.id===e)&&(t.value=e,await O()),console.log("页面初始化完成，当前集群:",t.value,"命名空间:",l.value)}),(e,a)=>{const n=(0,r.g2)("el-tag"),p=(0,r.g2)("el-option"),v=(0,r.g2)("el-select"),h=(0,r.g2)("el-button"),V=(0,r.g2)("el-input"),I=(0,r.g2)("el-form-item"),z=(0,r.g2)("el-form"),B=(0,r.g2)("el-tab-pane"),G=(0,r.g2)("el-tabs"),J=(0,r.g2)("el-icon"),Z=(0,r.g2)("el-tooltip"),ce=(0,r.g2)("el-table-column"),Se=(0,r.g2)("el-table"),Ie=(0,r.g2)("el-card"),Ae=(0,r.g2)("el-descriptions-item"),Re=(0,r.g2)("el-descriptions"),De=(0,r.g2)("el-dialog"),Pe=(0,r.g2)("el-input-number"),$e=(0,r.gN)("authority"),Te=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",I_,[(0,r.bF)(Ie,{shadow:"hover",class:"network-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",A_,[a[32]||(a[32]=(0,r.Lk)("span",{class:"title"},"K8s 网络管理",-1)),(0,r.Lk)("div",R_,[(0,r.bF)(v,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),placeholder:"请选择集群",loading:!s.value.length,size:"small",style:{width:"200px"},onChange:O},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value,e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.id,label:`${e.name} ${u(e.status)}`,value:e.id,disabled:2!==e.status},{default:(0,r.k6)(()=>[(0,r.Lk)("div",D_,[(0,r.Lk)("span",P_,(0,x.v_)(e.name),1),(0,r.bF)(n,{type:c(e.status),size:"small",class:"cluster-status"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(u(e.status)),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue","loading"]),(0,r.bF)(v,{modelValue:l.value,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value=e),placeholder:"请选择命名空间",loading:d.value,disabled:!t.value,size:"small",style:{width:"150px"},onChange:Q,onFocus:j,"loading-text":"命名空间加载中，请稍候...","no-data-text":"暂无命名空间数据"},(0,r.eX)({default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.value,e=>((0,r.uX)(),(0,r.Wv)(p,{key:e.name,label:e.name,value:e.name},{default:(0,r.k6)(()=>[(0,r.Lk)("div",$_,[(0,r.Lk)("span",T_,(0,x.v_)(e.name),1),(0,r.bF)(n,{type:"Active"===e.status?"success":"warning",size:"small",class:"namespace-status-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.status),1)]),_:2},1032,["type"])])]),_:2},1032,["label","value"]))),128))]),_:2},[!d.value&&t.value&&0===o.value.length?{name:"prefix",fn:(0,r.k6)(()=>[(0,r.bF)(h,{type:"text",size:"small",onClick:a[1]||(a[1]=e=>j(!0)),style:{color:"#409eff",padding:"0","margin-right":"4px"}},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[31]})]),key:"0"}:void 0]),1032,["modelValue","loading","disabled"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",M_,[(0,r.bF)(z,{inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{label:"网络资源名称"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:g.value,"onUpdate:modelValue":a[3]||(a[3]=e=>g.value=e),placeholder:"搜索资源...",clearable:"",size:"small",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),(0,r.bF)(I,null,{default:(0,r.k6)(()=>[(0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:ee},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[33]},8,["icon"]),(0,r.bF)(h,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:ee},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[34]},8,["icon"])]),_:1})]),_:1}),(0,r.Lk)("div",E_,[(0,r.bF)(G,{modelValue:m.value,"onUpdate:modelValue":a[4]||(a[4]=e=>m.value=e),onTabChange:ae,class:"network-tabs"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{label:"Service",name:"service"},{label:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.Lk)("span",{class:"tab-label"},"Service",-1)])),_:1}),(0,r.bF)(B,{label:"Ingress",name:"ingress"},{label:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.Lk)("span",{class:"tab-label"},"Ingress",-1)])),_:1})]),_:1},8,["modelValue"]),(0,r.Lk)("div",W_,["service"===m.value?(0,r.bo)(((0,r.uX)(),(0,r.Wv)(h,{key:0,type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:te},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)(" 创建 Service ",-1)])),_:1,__:[37]},8,["icon"])),[[$e,["k8s:network:addservice"]]]):(0,r.Q3)("",!0),"ingress"===m.value?(0,r.bo)(((0,r.uX)(),(0,r.Wv)(h,{key:1,type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:re},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)(" 创建 Ingress ",-1)])),_:1,__:[38]},8,["icon"])),[[$e,["k8s:network:addingress"]]]):(0,r.Q3)("",!0)])])]),(0,r.Lk)("div",z_,["service"===m.value?((0,r.uX)(),(0,r.CE)("div",N_,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(Se,{data:q.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 Service 资源"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{prop:"name",label:"名称","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",K_,[(0,r.bF)(J,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Connection))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>le(e)},(0,x.v_)(e.name),9,U_),(0,r.bF)(Z,{content:"复制名称",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{icon:(0,Y.R1)(vc.CopyDocument),size:"small",type:"text",class:"copy-button",onClick:(0,i.D$)(a=>xe(e.name,"Service"),["stop"])},null,8,["icon","onClick"])]),_:2},1024)])]),_:1}),(0,r.bF)(ce,{prop:"type",label:"类型",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(n,{type:"ClusterIP"===e.type?"success":"NodePort"===e.type?"warning":"primary",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.type),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ce,{prop:"clusterIP",label:"集群 IP",width:"140"}),(0,r.bF)(ce,{label:"端口","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",X_,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.ports||[],(a,t)=>((0,r.uX)(),(0,r.Wv)(n,{key:t,size:"small",class:"port-tag",type:"NodePort"===e.type&&a.nodePort?"warning":"primary"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a.port)+(0,x.v_)(a.name?":"+a.name:"")+"/"+(0,x.v_)(a.protocol)+" ",1),"NodePort"===e.type&&a.nodePort?((0,r.uX)(),(0,r.CE)("span",q_," →"+(0,x.v_)(a.nodePort),1)):(0,r.Q3)("",!0)]),_:2},1032,["type"]))),128))])]),_:1}),(0,r.bF)(ce,{label:"选择器","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",H_,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.selector||{},(e,a)=>((0,r.uX)(),(0,r.Wv)(n,{key:a,size:"small",type:"info",class:"selector-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1024))),128))])]),_:1}),(0,r.bF)(ce,{label:"创建时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(e.createdAt?new Date(e.createdAt).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(ce,{label:"操作",width:"300",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",B_,[(0,r.bF)(Z,{content:"编辑 Service",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"warning",icon:(0,Y.R1)(vc.Edit),size:"small",circle:"",onClick:a=>ne(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:editservice"]]])]),_:2},1024),(0,r.bF)(Z,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Document),size:"small",circle:"",onClick:a=>se(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:edit_service_yaml"]]])]),_:2},1024),(0,r.bF)(Z,{content:"查看事件",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"info",icon:(0,Y.R1)(vc.Monitor),size:"small",circle:"",onClick:a=>oe(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:service_event"]]])]),_:2},1024),(0,r.bF)(Z,{content:"删除 Service",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",onClick:a=>ie(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:deleteservice"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[Te,k.value]])])):(0,r.Q3)("",!0),"ingress"===m.value?((0,r.uX)(),(0,r.CE)("div",j_,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(Se,{data:H.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 Ingress 资源"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{prop:"name",label:"名称","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",O_,[(0,r.bF)(J,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>de(e)},(0,x.v_)(e.name),9,Q_),(0,r.bF)(Z,{content:"复制名称",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{icon:(0,Y.R1)(vc.CopyDocument),size:"small",type:"text",class:"copy-button",onClick:(0,i.D$)(a=>xe(e.name,"Ingress"),["stop"])},null,8,["icon","onClick"])]),_:2},1024)])]),_:1}),(0,r.bF)(ce,{label:"主机","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",G_,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.rules||[],(e,a)=>((0,r.uX)(),(0,r.Wv)(n,{key:a,size:"small",type:"success",class:"host-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.host||"*"),1)]),_:2},1024))),128))])]),_:1}),(0,r.bF)(ce,{label:"路径","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Y_,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.rules||[],(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a},[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.paths||[],(e,a)=>((0,r.uX)(),(0,r.Wv)(n,{key:a,size:"small",type:"info",class:"path-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.path)+" → "+(0,x.v_)(e.serviceName)+":"+(0,x.v_)(e.servicePort),1)]),_:2},1024))),128))]))),128))])]),_:1}),(0,r.bF)(ce,{label:"TLS",width:"80"},{default:(0,r.k6)(({row:e})=>[e.tls&&e.tls.length>0?((0,r.uX)(),(0,r.Wv)(n,{key:0,type:"success",size:"small"},{default:(0,r.k6)(()=>a[39]||(a[39]=[(0,r.eW)(" 启用 ",-1)])),_:1,__:[39]})):((0,r.uX)(),(0,r.Wv)(n,{key:1,type:"info",size:"small"},{default:(0,r.k6)(()=>a[40]||(a[40]=[(0,r.eW)(" 未启用 ",-1)])),_:1,__:[40]}))]),_:1}),(0,r.bF)(ce,{label:"创建时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(e.createdAt?new Date(e.createdAt).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(ce,{label:"操作",width:"300",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",J_,[(0,r.bF)(Z,{content:"编辑 Ingress",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"warning",icon:(0,Y.R1)(vc.Edit),size:"small",circle:"",onClick:a=>ve(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:editingress"]]])]),_:2},1024),(0,r.bF)(Z,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Document),size:"small",circle:"",onClick:a=>ue(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:edit_ingress_yaml"]]])]),_:2},1024),(0,r.bF)(Z,{content:"查看事件",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"info",icon:(0,Y.R1)(vc.Monitor),size:"small",circle:"",onClick:a=>pe(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:ingress_event"]]])]),_:2},1024),(0,r.bF)(Z,{content:"删除 Ingress",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",onClick:a=>he(e)},null,8,["icon","onClick"]),[[$e,["k8s:network:delete_ingress"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[Te,A.value]])])):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(De,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>y.value=e),title:"Service 详情",width:"800px",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Z_,[(0,r.bF)(Re,{column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(Ae,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F.value.name),1)]),_:1}),(0,r.bF)(Ae,{label:"命名空间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F.value.namespace),1)]),_:1}),(0,r.bF)(Ae,{label:"类型"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{type:"ClusterIP"===F.value.type?"success":"primary"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F.value.type),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(Ae,{label:"集群IP"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F.value.clusterIP),1)]),_:1}),(0,r.bF)(Ae,{label:"创建时间",span:2},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(F.value.createdAt?new Date(F.value.createdAt).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(Ae,{label:"标签",span:2},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ew,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(F.value.labels||{},(e,a)=>((0,r.uX)(),(0,r.Wv)(n,{key:a,size:"small",type:"info",style:{"margin-right":"4px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1024))),128))])]),_:1}),(0,r.bF)(Ae,{label:"端口",span:2},{default:(0,r.k6)(()=>[(0,r.Lk)("div",aw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(F.value.ports||[],(e,a)=>((0,r.uX)(),(0,r.Wv)(n,{key:a,size:"small",style:{"margin-right":"4px"},type:"NodePort"===F.value.type&&e.nodePort?"warning":"primary"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.port)+(0,x.v_)(e.name?":"+e.name:"")+"/"+(0,x.v_)(e.protocol)+" "+(0,x.v_)(e.targetPort?" → "+e.targetPort:"")+" ",1),"NodePort"===F.value.type&&e.nodePort?((0,r.uX)(),(0,r.CE)("span",tw," (NodePort: "+(0,x.v_)(e.nodePort)+") ",1)):(0,r.Q3)("",!0)]),_:2},1032,["type"]))),128))])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),(0,r.bF)(pf,{visible:_.value,"onUpdate:visible":a[6]||(a[6]=e=>_.value=e),"yaml-content":C.value,"resource-name":F.value?.name||"","resource-type":"Service",editable:!0,onSave:me,onClose:a[7]||(a[7]=e=>_.value=!1)},null,8,["visible","yaml-content","resource-name"]),(0,r.bF)(De,{modelValue:w.value,"onUpdate:modelValue":a[8]||(a[8]=e=>w.value=e),title:"Service 事件",width:"1000px",class:"events-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",lw,[(0,r.bF)(Se,{data:S.value,stripe:"",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{prop:"type",label:"类型",width:"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(n,{type:"Warning"===e.type?"warning":"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.type),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ce,{prop:"reason",label:"原因",width:"120"}),(0,r.bF)(ce,{prop:"message",label:"消息","min-width":"300"}),(0,r.bF)(ce,{prop:"firstTimestamp",label:"首次时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(e.firstTimestamp?new Date(e.firstTimestamp).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(ce,{prop:"count",label:"次数",width:"80"})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),(0,r.bF)(De,{modelValue:P.value,"onUpdate:modelValue":a[9]||(a[9]=e=>P.value=e),title:"Ingress 详情",width:"800px",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",sw,[(0,r.bF)(Re,{column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(Ae,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(E.value.name),1)]),_:1}),(0,r.bF)(Ae,{label:"命名空间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(E.value.namespace),1)]),_:1}),(0,r.bF)(Ae,{label:"TLS",span:2},{default:(0,r.k6)(()=>[(0,r.bF)(n,{type:E.value.tls&&E.value.tls.length>0?"success":"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(E.value.tls&&E.value.tls.length>0?"启用":"未启用"),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(Ae,{label:"创建时间",span:2},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(E.value.createdAt?new Date(E.value.createdAt).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(Ae,{label:"规则",span:2},{default:(0,r.k6)(()=>[(0,r.Lk)("div",ow,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(E.value.rules||[],(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,style:{"margin-bottom":"8px"}},[(0,r.Lk)("strong",null,(0,x.v_)(e.host||"*"),1),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.paths||[],(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,style:{"margin-left":"16px"}},[(0,r.bF)(n,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.path)+" → "+(0,x.v_)(e.serviceName)+":"+(0,x.v_)(e.servicePort),1)]),_:2},1024)]))),128))]))),128))])]),_:1})]),_:1})])]),_:1},8,["modelValue"]),(0,r.bF)(pf,{visible:$.value,"onUpdate:visible":a[10]||(a[10]=e=>$.value=e),"yaml-content":W.value,"resource-name":E.value?.name||"","resource-type":"Ingress",editable:!0,onSave:ge,onClose:a[11]||(a[11]=e=>$.value=!1)},null,8,["visible","yaml-content","resource-name"]),(0,r.bF)(De,{modelValue:T.value,"onUpdate:modelValue":a[12]||(a[12]=e=>T.value=e),title:"Ingress 事件",width:"1000px",class:"events-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",nw,[(0,r.bF)(Se,{data:N.value,stripe:"",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{prop:"type",label:"类型",width:"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(n,{type:"Warning"===e.type?"warning":"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.type),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ce,{prop:"reason",label:"原因",width:"120"}),(0,r.bF)(ce,{prop:"message",label:"消息","min-width":"300"}),(0,r.bF)(ce,{prop:"firstTimestamp",label:"首次时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(e.firstTimestamp?new Date(e.firstTimestamp).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(ce,{prop:"count",label:"次数",width:"80"})]),_:1},8,["data"])])]),_:1},8,["modelValue"]),(0,r.bF)(De,{modelValue:b.value,"onUpdate:modelValue":a[17]||(a[17]=e=>b.value=e),title:"创建 Service",width:"700px",class:"create-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",pw,[(0,r.bF)(h,{onClick:a[16]||(a[16]=e=>b.value=!1)},{default:(0,r.k6)(()=>a[42]||(a[42]=[(0,r.eW)("取消",-1)])),_:1,__:[42]}),(0,r.bF)(h,{type:"primary",onClick:Le},{default:(0,r.k6)(()=>a[43]||(a[43]=[(0,r.eW)("创建",-1)])),_:1,__:[43]})])]),default:(0,r.k6)(()=>[(0,r.bF)(z,{model:L,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",iw,[(0,r.bF)(I,{label:"名称",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:L.name,"onUpdate:modelValue":a[13]||(a[13]=e=>L.name=e),placeholder:"请输入 Service 名称",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(I,{label:"类型",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:L.type,"onUpdate:modelValue":a[14]||(a[14]=e=>L.type=e),style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(K,e=>(0,r.bF)(p,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("div",rw,[(0,r.Lk)("span",null,(0,x.v_)(e.label),1),(0,r.Lk)("span",dw,(0,x.v_)(e.description),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(I,{label:"端口配置",required:""},{default:(0,r.k6)(()=>[(0,r.Lk)("div",cw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.ports,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"port-item"},[(0,r.Lk)("div",uw,[(0,r.bF)(V,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"端口名称(可选)",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(Pe,{modelValue:e.port,"onUpdate:modelValue":a=>e.port=a,min:1,max:65535,placeholder:"端口",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(Pe,{modelValue:e.targetPort,"onUpdate:modelValue":a=>e.targetPort=a,min:1,max:65535,placeholder:"目标端口",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(v,{modelValue:e.protocol,"onUpdate:modelValue":a=>e.protocol=a,size:"small",style:{width:"80px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(U,e=>(0,r.bF)(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",plain:"",onClick:e=>be(a),disabled:1===L.ports.length},null,8,["icon","onClick","disabled"])])]))),128)),(0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:ke},{default:(0,r.k6)(()=>a[41]||(a[41]=[(0,r.eW)(" 添加端口 ",-1)])),_:1,__:[41]},8,["icon"])])]),_:1}),(0,r.bF)(I,{label:"描述"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:L.description,"onUpdate:modelValue":a[15]||(a[15]=e=>L.description=e),type:"textarea",rows:2,placeholder:"请输入服务描述",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(De,{modelValue:f.value,"onUpdate:modelValue":a[22]||(a[22]=e=>f.value=e),title:"编辑 Service",width:"700px",class:"edit-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",bw,[(0,r.bF)(h,{onClick:a[21]||(a[21]=e=>f.value=!1)},{default:(0,r.k6)(()=>a[45]||(a[45]=[(0,r.eW)("取消",-1)])),_:1,__:[45]}),(0,r.bF)(h,{type:"primary",onClick:Fe},{default:(0,r.k6)(()=>a[46]||(a[46]=[(0,r.eW)("更新",-1)])),_:1,__:[46]})])]),default:(0,r.k6)(()=>[(0,r.bF)(z,{model:L,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",mw,[(0,r.bF)(I,{label:"名称",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:L.name,"onUpdate:modelValue":a[18]||(a[18]=e=>L.name=e),disabled:"",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(I,{label:"类型",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{modelValue:L.type,"onUpdate:modelValue":a[19]||(a[19]=e=>L.type=e),style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(K,e=>(0,r.bF)(p,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gw,[(0,r.Lk)("span",null,(0,x.v_)(e.label),1),(0,r.Lk)("span",vw,(0,x.v_)(e.description),1)])]),_:2},1032,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(I,{label:"端口配置",required:""},{default:(0,r.k6)(()=>[(0,r.Lk)("div",hw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.ports,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"port-item"},[(0,r.Lk)("div",kw,[(0,r.bF)(V,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"端口名称(可选)",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(Pe,{modelValue:e.port,"onUpdate:modelValue":a=>e.port=a,min:1,max:65535,placeholder:"端口",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(Pe,{modelValue:e.targetPort,"onUpdate:modelValue":a=>e.targetPort=a,min:1,max:65535,placeholder:"目标端口",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(v,{modelValue:e.protocol,"onUpdate:modelValue":a=>e.protocol=a,size:"small",style:{width:"80px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(U,e=>(0,r.bF)(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",plain:"",onClick:e=>be(a),disabled:1===L.ports.length},null,8,["icon","onClick","disabled"])])]))),128)),(0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:ke},{default:(0,r.k6)(()=>a[44]||(a[44]=[(0,r.eW)(" 添加端口 ",-1)])),_:1,__:[44]},8,["icon"])])]),_:1}),(0,r.bF)(I,{label:"描述"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:L.description,"onUpdate:modelValue":a[20]||(a[20]=e=>L.description=e),type:"textarea",rows:2,placeholder:"请输入服务描述",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(De,{modelValue:R.value,"onUpdate:modelValue":a[26]||(a[26]=e=>R.value=e),title:"创建 Ingress",width:"800px",class:"create-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Cw,[(0,r.bF)(h,{onClick:a[25]||(a[25]=e=>R.value=!1)},{default:(0,r.k6)(()=>a[50]||(a[50]=[(0,r.eW)("取消",-1)])),_:1,__:[50]}),(0,r.bF)(h,{type:"primary",onClick:Ce},{default:(0,r.k6)(()=>a[51]||(a[51]=[(0,r.eW)("创建",-1)])),_:1,__:[51]})])]),default:(0,r.k6)(()=>[(0,r.bF)(z,{model:M,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{label:"名称",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:M.name,"onUpdate:modelValue":a[23]||(a[23]=e=>M.name=e),placeholder:"请输入 Ingress 名称",size:"small",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),(0,r.bF)(I,{label:"规则配置",required:""},{default:(0,r.k6)(()=>[(0,r.Lk)("div",fw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(M.rules,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"rule-item"},[(0,r.Lk)("div",yw,[(0,r.bF)(V,{modelValue:e.host,"onUpdate:modelValue":a=>e.host=a,placeholder:"主机名 (如: example.com)",size:"small",style:{width:"250px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",plain:"",onClick:e=>ye(t),disabled:1===M.rules.length},{default:(0,r.k6)(()=>a[47]||(a[47]=[(0,r.eW)(" 删除规则 ",-1)])),_:2,__:[47]},1032,["icon","onClick","disabled"])]),(0,r.Lk)("div",_w,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.paths,(a,l)=>((0,r.uX)(),(0,r.CE)("div",{key:l,class:"path-item"},[(0,r.Lk)("div",ww,[(0,r.bF)(V,{modelValue:a.path,"onUpdate:modelValue":e=>a.path=e,placeholder:"路径",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(v,{modelValue:a.pathType,"onUpdate:modelValue":e=>a.pathType=e,size:"small",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(X,e=>(0,r.bF)(p,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Lw,[(0,r.Lk)("span",null,(0,x.v_)(e.label),1),(0,r.Lk)("span",Fw,(0,x.v_)(e.description),1)])]),_:2},1032,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,r.bF)(V,{modelValue:a.serviceName,"onUpdate:modelValue":e=>a.serviceName=e,placeholder:"服务名",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(Pe,{modelValue:a.servicePort,"onUpdate:modelValue":e=>a.servicePort=e,min:1,max:65535,placeholder:"端口",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",plain:"",onClick:e=>we(t,l),disabled:1===e.paths.length},null,8,["icon","onClick","disabled"])])]))),128)),(0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:e=>_e(t)},{default:(0,r.k6)(()=>a[48]||(a[48]=[(0,r.eW)(" 添加路径 ",-1)])),_:2,__:[48]},1032,["icon","onClick"])])]))),128)),(0,r.bF)(h,{type:"success",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:fe},{default:(0,r.k6)(()=>a[49]||(a[49]=[(0,r.eW)(" 添加规则 ",-1)])),_:1,__:[49]},8,["icon"])])]),_:1}),(0,r.bF)(I,{label:"描述"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:M.description,"onUpdate:modelValue":a[24]||(a[24]=e=>M.description=e),type:"textarea",rows:2,placeholder:"请输入 Ingress 描述",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(De,{modelValue:D.value,"onUpdate:modelValue":a[30]||(a[30]=e=>D.value=e),title:"编辑 Ingress",width:"800px",class:"edit-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("span",Dw,[(0,r.bF)(h,{onClick:a[29]||(a[29]=e=>D.value=!1)},{default:(0,r.k6)(()=>a[55]||(a[55]=[(0,r.eW)("取消",-1)])),_:1,__:[55]}),(0,r.bF)(h,{type:"primary",onClick:Ve},{default:(0,r.k6)(()=>a[56]||(a[56]=[(0,r.eW)("更新",-1)])),_:1,__:[56]})])]),default:(0,r.k6)(()=>[(0,r.bF)(z,{model:M,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:M.name,"onUpdate:modelValue":a[27]||(a[27]=e=>M.name=e),disabled:"",size:"small",style:{width:"300px"}},null,8,["modelValue"])]),_:1}),(0,r.bF)(I,{label:"规则配置",required:""},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Vw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(M.rules,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"rule-item"},[(0,r.Lk)("div",xw,[(0,r.bF)(V,{modelValue:e.host,"onUpdate:modelValue":a=>e.host=a,placeholder:"主机名 (如: example.com)",size:"small",style:{width:"250px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",plain:"",onClick:e=>ye(t),disabled:1===M.rules.length},{default:(0,r.k6)(()=>a[52]||(a[52]=[(0,r.eW)(" 删除规则 ",-1)])),_:2,__:[52]},1032,["icon","onClick","disabled"])]),(0,r.Lk)("div",Sw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.paths,(a,l)=>((0,r.uX)(),(0,r.CE)("div",{key:l,class:"path-item"},[(0,r.Lk)("div",Iw,[(0,r.bF)(V,{modelValue:a.path,"onUpdate:modelValue":e=>a.path=e,placeholder:"路径",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(v,{modelValue:a.pathType,"onUpdate:modelValue":e=>a.pathType=e,size:"small",style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(X,e=>(0,r.bF)(p,{key:e.value,label:e.label,value:e.value},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Aw,[(0,r.Lk)("span",null,(0,x.v_)(e.label),1),(0,r.Lk)("span",Rw,(0,x.v_)(e.description),1)])]),_:2},1032,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"]),(0,r.bF)(V,{modelValue:a.serviceName,"onUpdate:modelValue":e=>a.serviceName=e,placeholder:"服务名",size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(Pe,{modelValue:a.servicePort,"onUpdate:modelValue":e=>a.servicePort=e,min:1,max:65535,placeholder:"端口",size:"small",style:{width:"100px"}},null,8,["modelValue","onUpdate:modelValue"]),(0,r.bF)(h,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",plain:"",onClick:e=>we(t,l),disabled:1===e.paths.length},null,8,["icon","onClick","disabled"])])]))),128)),(0,r.bF)(h,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:e=>_e(t)},{default:(0,r.k6)(()=>a[53]||(a[53]=[(0,r.eW)(" 添加路径 ",-1)])),_:2,__:[53]},1032,["icon","onClick"])])]))),128)),(0,r.bF)(h,{type:"success",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:fe},{default:(0,r.k6)(()=>a[54]||(a[54]=[(0,r.eW)(" 添加规则 ",-1)])),_:1,__:[54]},8,["icon"])])]),_:1}),(0,r.bF)(I,{label:"描述"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:M.description,"onUpdate:modelValue":a[28]||(a[28]=e=>M.description=e),type:"textarea",rows:2,placeholder:"请输入 Ingress 描述",size:"small"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};const $w=(0,p.A)(Pw,[["__scopeId","data-v-7163e54c"]]);var Tw=$w;const Mw={class:"k8s-config-management"},Ew={class:"card-header"},Ww={class:"header-actions"},zw={class:"search-section"},Nw={class:"tab-content"},Kw={class:"content-header"},Uw={class:"resource-count"},Xw={class:"resource-name"},qw=["onClick"],Hw={class:"data-keys"},Bw={class:"keys-text"},jw={class:"labels-info"},Ow={key:0,class:"no-labels"},Qw={class:"operation-buttons"},Gw={class:"tab-content"},Yw={class:"content-header"},Jw={class:"resource-count"},Zw={class:"resource-name"},eL=["onClick"],aL={class:"data-keys"},tL={class:"keys-text"},lL={class:"labels-info"},sL={key:0,class:"no-labels"},oL={class:"operation-buttons"},nL={class:"detail-content"},iL={class:"labels-info"},rL={key:0},dL={key:0,class:"data-section"},cL={class:"data-list"},uL={class:"data-key"},pL={class:"data-value"},mL={class:"detail-content"},gL={class:"labels-info"},vL={key:0},hL={key:0,class:"data-section"},kL={class:"section-title"},bL={class:"data-list"},fL={class:"data-key"},yL={class:"data-value secret-value"};var _L={__name:"k8s-config",setup(e){const a=(0,Y.KR)(!1),t=(0,Y.KR)("configmap"),l=(0,Y.KR)(""),s=(0,Y.KR)(""),o=(0,Y.Kh)({namespace:"default"}),n=(0,Y.KR)([]),d=(0,Y.KR)([]),c=(0,Y.KR)(!1),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(!1),g=(0,Y.KR)(""),v=(0,Y.KR)(""),h=((0,Y.KR)(""),(0,Y.KR)(""),(0,Y.KR)({})),k=(0,Y.KR)({}),b=(0,r.EW)(()=>{const e=Array.isArray(n.value)?n.value:[];return l.value?e.filter(e=>e.name?.toLowerCase().includes(l.value.toLowerCase())||e.namespace?.toLowerCase().includes(l.value.toLowerCase())):e}),f=(0,r.EW)(()=>{const e=Array.isArray(d.value)?d.value:[];return l.value?e.filter(e=>e.name?.toLowerCase().includes(l.value.toLowerCase())||e.type?.toLowerCase().includes(l.value.toLowerCase())||e.namespace?.toLowerCase().includes(l.value.toLowerCase())):e}),y=e=>{s.value=e,console.log("集群选择变化:",e),e&&o.namespace&&w()},_=e=>{o.namespace=e,console.log("命名空间选择变化:",e),s.value&&e&&w()},w=async()=>{if(s.value){console.log("开始加载配置资源，集群ID:",s.value,"命名空间:",o.namespace),a.value=!0;try{await Promise.all([C(),V()])}catch(e){console.error("加载配置资源失败:",e)}finally{a.value=!1}}else console.warn("集群ID为空，无法加载配置资源")},L=()=>{l.value=""},F=e=>{console.log("标签页切换到:",e),t.value=e},C=async()=>{if(s.value&&o.namespace)try{console.log("正在获取 ConfigMap 列表，集群ID:",s.value,"命名空间:",o.namespace);const e=await ce.getConfigMaps(s.value,o.namespace),a=e.data||e;if(200===a.code||a.success){const e=a.data?.configMaps||a.data;n.value=Array.isArray(e)?e:[],console.log("获取到 ConfigMap 列表:",n.value.length,"个")}else J.nk.error(a.message||"获取 ConfigMap 列表失败"),n.value=[]}catch(e){console.error("获取 ConfigMap 列表失败:",e),J.nk.error("获取 ConfigMap 列表失败，请检查网络连接"),n.value=[]}else console.warn("集群ID或命名空间为空，无法获取 ConfigMap 列表")},V=async()=>{if(s.value&&o.namespace)try{console.log("正在获取 Secret 列表，集群ID:",s.value,"命名空间:",o.namespace);const e=await ce.getSecrets(s.value,o.namespace),a=e.data||e;if(200===a.code||a.success){const e=a.data?.secrets||a.data;d.value=Array.isArray(e)?e:[],console.log("获取到 Secret 列表:",d.value.length,"个")}else J.nk.error(a.message||"获取 Secret 列表失败"),d.value=[]}catch(e){console.error("获取 Secret 列表失败:",e),J.nk.error("获取 Secret 列表失败，请检查网络连接"),d.value=[]}else console.warn("集群ID或命名空间为空，无法获取 Secret 列表")},S=()=>{w()},I=()=>{if(!s.value)return void J.nk.warning("请先选择集群");if(!o.namespace)return void J.nk.warning("请先选择命名空间");const e=`apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: new-configmap\n  namespace: ${o.namespace}\ndata:\n  # 配置键值对\n  config.properties: |\n    database.url=localhost:5432\n    database.user=admin\n  app.yaml: |\n    app:\n      name: my-app\n      version: 1.0.0`;g.value=e,h.value={name:"new-configmap",namespace:o.namespace},c.value=!0},A=async e=>{try{const a=await ce.getConfigMapDetail(s.value,o.namespace,e?.name),t=a.data||a;200===t.code||t.success?(h.value=t.data||e,p.value=!0):J.nk.error(t.message||"获取 ConfigMap 详情失败")}catch(a){console.error("获取 ConfigMap 详情失败:",a),J.nk.error("获取 ConfigMap 详情失败")}},R=async e=>{try{a.value=!0;const t=await ce.getConfigMapYaml(s.value,o.namespace,e?.name),l=t.data||t;if(200===l.code||l.success){let a=l.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# ConfigMap ${e?.name} YAML\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: ${e?.name}\n  namespace: ${o.namespace}`),g.value=String(a),h.value=e,c.value=!0}else J.nk.error(l.message||"获取 ConfigMap YAML 失败")}catch(t){console.error("获取 ConfigMap YAML 失败:",t),J.nk.error("获取 ConfigMap YAML 失败")}finally{a.value=!1}},D=async e=>{try{const a="new-configmap"===e.resourceName||!h.value?.creationTimestamp;let t;t=a?await ce.createConfigMap(s.value,o.namespace,{yamlContent:e.yamlContent}):await ce.updateConfigMapYaml(s.value,o.namespace,e.resourceName,e.yamlContent);const l=t.data||t;200===l.code||l.success?(J.nk.success(a?"ConfigMap 创建成功":"ConfigMap YAML 更新成功"),c.value=!1,C()):J.nk.error(l.message||(a?"ConfigMap 创建失败":"ConfigMap YAML 更新失败"))}catch(a){console.error("ConfigMap 操作失败:",a),J.nk.error("ConfigMap 操作失败")}},P=async e=>{try{await uv.s.confirm(`确认删除 ConfigMap "${e?.name}"？删除后相关配置将无法恢复。`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await ce.deleteConfigMap(s.value,o.namespace,e?.name),t=a.data||a;200===t.code||t.success?(J.nk.success("ConfigMap 删除成功"),C()):J.nk.error(t.message||"ConfigMap 删除失败")}catch(a){"cancel"!==a&&(console.error("删除 ConfigMap 失败:",a),J.nk.error("删除 ConfigMap 失败"))}},$=()=>{if(!s.value)return void J.nk.warning("请先选择集群");if(!o.namespace)return void J.nk.warning("请先选择命名空间");const e=`apiVersion: v1\nkind: Secret\nmetadata:\n  name: new-secret\n  namespace: ${o.namespace}\ntype: Opaque\ndata:\n  # Base64编码的数据\n  username: YWRtaW4=  # admin\n  password: MWYyZDFlMmU2N2Rm  # password\nstringData:\n  # 明文数据，k8s会自动编码\n  config.json: |\n    {\n      "database": {\n        "host": "localhost",\n        "port": 5432\n      }\n    }`;v.value=e,k.value={name:"new-secret",namespace:o.namespace},u.value=!0},T=async e=>{try{const a=await ce.getSecretDetail(s.value,o.namespace,e?.name),t=a.data||a;200===t.code||t.success?(k.value=t.data||e,m.value=!0):J.nk.error(t.message||"获取 Secret 详情失败")}catch(a){console.error("获取 Secret 详情失败:",a),J.nk.error("获取 Secret 详情失败")}},M=async e=>{try{a.value=!0;const t=await ce.getSecretYaml(s.value,o.namespace,e?.name),l=t.data||t;if(200===l.code||l.success){let a=l.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# Secret ${e?.name} YAML\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ${e?.name}\n  namespace: ${o.namespace}\ntype: Opaque`),v.value=String(a),k.value=e,u.value=!0}else J.nk.error(l.message||"获取 Secret YAML 失败")}catch(t){console.error("获取 Secret YAML 失败:",t),J.nk.error("获取 Secret YAML 失败")}finally{a.value=!1}},E=async e=>{try{const a="new-secret"===e.resourceName||!k.value?.creationTimestamp;let t;t=a?await ce.createSecret(s.value,o.namespace,{yamlContent:e.yamlContent}):await ce.updateSecretYaml(s.value,o.namespace,e.resourceName,e.yamlContent);const l=t.data||t;200===l.code||l.success?(J.nk.success(a?"Secret 创建成功":"Secret YAML 更新成功"),u.value=!1,V()):J.nk.error(l.message||(a?"Secret 创建失败":"Secret YAML 更新失败"))}catch(a){console.error("Secret 操作失败:",a),J.nk.error("Secret 操作失败")}},W=async e=>{try{await uv.s.confirm(`确认删除 Secret "${e?.name}"？删除后敏感数据将无法恢复。`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await ce.deleteSecret(s.value,o.namespace,e?.name),t=a.data||a;200===t.code||t.success?(J.nk.success("Secret 删除成功"),V()):J.nk.error(t.message||"Secret 删除失败")}catch(a){"cancel"!==a&&(console.error("删除 Secret 失败:",a),J.nk.error("删除 Secret 失败"))}},z=e=>{const a={Opaque:"primary","kubernetes.io/service-account-token":"success","kubernetes.io/dockercfg":"warning","kubernetes.io/dockerconfigjson":"warning","kubernetes.io/basic-auth":"info","kubernetes.io/ssh-auth":"info","kubernetes.io/tls":"danger"};return a[e]||"info"},N=e=>e?.startsWith("kubernetes.io/")?e.replace("kubernetes.io/","k8s/"):e||"Opaque",K=e=>{if(!e||"object"!==typeof e)return"无数据";const a=Object.keys(e);return 0===a.length?"无数据":a.length<=3?a.join(", "):`${a.slice(0,3).join(", ")}... (${a.length}项)`};return(0,r.wB)([s,()=>o.namespace],([e,a])=>{console.log("监听到变化 - 集群ID:",e,"命名空间:",a),e&&a&&(console.log("集群和命名空间都已选择，开始加载配置资源"),w())},{immediate:!0}),(0,r.sV)(async()=>{console.log("🚀 开始加载k8s配置管理页面");const e=Date.now();try{console.log("🎉 页面初始化完成，总耗时:",Date.now()-e+"ms")}catch(a){console.error("页面初始化失败:",a)}}),(e,n)=>{const d=(0,r.g2)("el-input"),w=(0,r.g2)("el-form-item"),C=(0,r.g2)("el-button"),V=(0,r.g2)("el-form"),U=(0,r.g2)("el-icon"),X=(0,r.g2)("el-table-column"),q=(0,r.g2)("el-tag"),H=(0,r.g2)("el-tooltip"),B=(0,r.g2)("el-table"),j=(0,r.g2)("el-tab-pane"),O=(0,r.g2)("el-tabs"),Q=(0,r.g2)("el-card"),G=(0,r.g2)("el-descriptions-item"),J=(0,r.g2)("el-descriptions"),Z=(0,r.g2)("el-dialog"),ee=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Mw,[(0,r.bF)(Q,{shadow:"hover",class:"config-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",Ew,[n[10]||(n[10]=(0,r.Lk)("span",{class:"title"},"K8s 配置管理",-1)),(0,r.Lk)("div",Ww,[(0,r.bF)(gb,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=e=>s.value=e),onChange:y},null,8,["modelValue"]),(0,r.bF)(fb,{modelValue:o.namespace,"onUpdate:modelValue":n[1]||(n[1]=e=>o.namespace=e),"cluster-id":s.value,onChange:_},null,8,["modelValue","cluster-id"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",zw,[(0,r.bF)(V,{inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(w,{label:"配置资源名称"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=e=>l.value=e),placeholder:"请输入名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(L,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(w,null,{default:(0,r.k6)(()=>[(0,r.bF)(C,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:L},{default:(0,r.k6)(()=>n[11]||(n[11]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[11]},8,["icon"]),(0,r.bF)(C,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:S},{default:(0,r.k6)(()=>n[12]||(n[12]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[12]},8,["icon"])]),_:1})]),_:1})]),(0,r.bF)(O,{modelValue:t.value,"onUpdate:modelValue":n[3]||(n[3]=e=>t.value=e),onTabChange:F,class:"config-tabs"},{default:(0,r.k6)(()=>[(0,r.bF)(j,{label:"ConfigMap",name:"configmap"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Nw,[(0,r.Lk)("div",Kw,[(0,r.Lk)("span",Uw,"共 "+(0,x.v_)(b.value.length)+" 个 ConfigMap",1),(0,r.bF)(C,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:I},{default:(0,r.k6)(()=>n[13]||(n[13]=[(0,r.eW)(" 创建 ConfigMap ",-1)])),_:1,__:[13]},8,["icon"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(B,{data:b.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 ConfigMap 资源"},{default:(0,r.k6)(()=>[(0,r.bF)(X,{prop:"name",label:"名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Xw,[(0,r.bF)(U,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Setting))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>A(e)},(0,x.v_)(e?.name||"-"),9,qw)])]),_:1}),(0,r.bF)(X,{prop:"namespace",label:"命名空间",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(q,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e?.namespace||"-"),1)]),_:2},1024)]),_:1}),(0,r.bF)(X,{label:"数据键","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Hw,[(0,r.Lk)("span",Bw,(0,x.v_)(K(e?.data)),1)])]),_:1}),(0,r.bF)(X,{label:"标签","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",jw,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e?.labels||{},(e,a)=>((0,r.uX)(),(0,r.Wv)(q,{key:a,size:"small",type:"primary",class:"label-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1024))),128)),e?.labels&&0!==Object.keys(e?.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",Ow,"无标签"))])]),_:1}),(0,r.bF)(X,{prop:"createdTime",label:"创建时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.createdTime?new Date(e?.createdTime).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(X,{label:"操作",width:"160",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Qw,[(0,r.bF)(H,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{icon:(0,Y.R1)(vc.Edit),size:"small",type:"primary",circle:"",onClick:a=>R(e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(H,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",onClick:a=>P(e)},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ee,a.value]])])]),_:1}),(0,r.bF)(j,{label:"Secret",name:"secret"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Gw,[(0,r.Lk)("div",Yw,[(0,r.Lk)("span",Jw,"共 "+(0,x.v_)(f.value.length)+" 个 Secret",1),(0,r.bF)(C,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:$},{default:(0,r.k6)(()=>n[14]||(n[14]=[(0,r.eW)(" 创建 Secret ",-1)])),_:1,__:[14]},8,["icon"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(B,{data:f.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 Secret 资源"},{default:(0,r.k6)(()=>[(0,r.bF)(X,{prop:"name",label:"名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Zw,[(0,r.bF)(U,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Key))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>T(e)},(0,x.v_)(e?.name||"-"),9,eL)])]),_:1}),(0,r.bF)(X,{prop:"namespace",label:"命名空间",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(q,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e?.namespace||"-"),1)]),_:2},1024)]),_:1}),(0,r.bF)(X,{prop:"type",label:"类型",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(q,{type:z(e?.type),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(N(e?.type)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(X,{label:"数据键","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",aL,[(0,r.Lk)("span",tL,[(0,r.bF)(U,{class:"secret-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Lock))]),_:1}),(0,r.eW)(" "+(0,x.v_)(K(e?.data)),1)])])]),_:1}),(0,r.bF)(X,{label:"标签","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",lL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e?.labels||{},(e,a)=>((0,r.uX)(),(0,r.Wv)(q,{key:a,size:"small",type:"primary",class:"label-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1024))),128)),e?.labels&&0!==Object.keys(e?.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",sL,"无标签"))])]),_:1}),(0,r.bF)(X,{prop:"createdTime",label:"创建时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.createdTime?new Date(e?.createdTime).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(X,{label:"操作",width:"160",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",oL,[(0,r.bF)(H,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{icon:(0,Y.R1)(vc.Edit),size:"small",type:"primary",circle:"",onClick:a=>M(e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(H,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(C,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",onClick:a=>W(e)},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ee,a.value]])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(Z,{modelValue:p.value,"onUpdate:modelValue":n[4]||(n[4]=e=>p.value=e),title:"ConfigMap 详情",width:"70%",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",nL,[(0,r.bF)(J,{column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(G,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(h.value.name),1)]),_:1}),(0,r.bF)(G,{label:"命名空间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(h.value.namespace),1)]),_:1}),(0,r.bF)(G,{label:"创建时间",span:2},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(h.value.createdTime?new Date(h.value.createdTime).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(G,{label:"标签",span:2},{default:(0,r.k6)(()=>[(0,r.Lk)("div",iL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.value.labels||{},(e,a)=>((0,r.uX)(),(0,r.Wv)(q,{key:a,size:"small",type:"primary",class:"label-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1024))),128)),h.value.labels&&0!==Object.keys(h.value.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",rL,"无标签"))])]),_:1})]),_:1}),h.value.data?((0,r.uX)(),(0,r.CE)("div",dL,[n[15]||(n[15]=(0,r.Lk)("h4",{class:"section-title"},"配置数据",-1)),(0,r.Lk)("div",cL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.value.data,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"data-item"},[(0,r.Lk)("div",uL,(0,x.v_)(a),1),(0,r.Lk)("pre",pL,(0,x.v_)(e),1)]))),128))])])):(0,r.Q3)("",!0)])]),_:1},8,["modelValue"]),(0,r.bF)(Z,{modelValue:m.value,"onUpdate:modelValue":n[5]||(n[5]=e=>m.value=e),title:"Secret 详情",width:"70%",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",mL,[(0,r.bF)(J,{column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(G,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(k.value.name),1)]),_:1}),(0,r.bF)(G,{label:"命名空间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(k.value.namespace),1)]),_:1}),(0,r.bF)(G,{label:"类型"},{default:(0,r.k6)(()=>[(0,r.bF)(q,{type:z(k.value.type),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(N(k.value.type)),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(G,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(k.value.createdTime?new Date(k.value.createdTime).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(G,{label:"标签",span:2},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value.labels||{},(e,a)=>((0,r.uX)(),(0,r.Wv)(q,{key:a,size:"small",type:"primary",class:"label-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1024))),128)),k.value.labels&&0!==Object.keys(k.value.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",vL,"无标签"))])]),_:1})]),_:1}),k.value.data?((0,r.uX)(),(0,r.CE)("div",hL,[(0,r.Lk)("h4",kL,[(0,r.bF)(U,{class:"secret-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Lock))]),_:1}),n[16]||(n[16]=(0,r.eW)(" 敏感数据 (已脱敏) ",-1))]),(0,r.Lk)("div",bL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value.data,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"data-item secret-item"},[(0,r.Lk)("div",fL,(0,x.v_)(a),1),(0,r.Lk)("div",yL,[(0,r.bF)(U,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Lock))]),_:1}),(0,r.eW)(" *** ("+(0,x.v_)(String(e).length)+" 字符) ",1)])]))),128))])])):(0,r.Q3)("",!0)])]),_:1},8,["modelValue"]),(0,r.bF)(pf,{visible:c.value,"yaml-content":g.value,"resource-name":h.value.name||"new-configmap","resource-type":"ConfigMap",editable:!0,"onUpdate:visible":n[6]||(n[6]=e=>c.value=e),onClose:n[7]||(n[7]=e=>c.value=!1),onSave:D},null,8,["visible","yaml-content","resource-name"]),(0,r.bF)(pf,{visible:u.value,"yaml-content":v.value,"resource-name":k.value.name||"new-secret","resource-type":"Secret",editable:!0,"onUpdate:visible":n[8]||(n[8]=e=>u.value=e),onClose:n[9]||(n[9]=e=>u.value=!1),onSave:E},null,8,["visible","yaml-content","resource-name"])])}}};const wL=(0,p.A)(_L,[["__scopeId","data-v-3a9893f7"]]);var LL=wL;const FL={class:"k8s-storage-management"},CL={class:"card-header"},VL={class:"header-actions"},xL={class:"search-section"},SL={class:"tab-content"},IL={class:"content-header"},AL={class:"resource-count"},RL={class:"resource-name"},DL=["onClick"],PL={class:"access-modes"},$L={class:"operation-buttons"},TL={class:"tab-content"},ML={class:"content-header"},EL={class:"resource-count"},WL={class:"resource-name"},zL=["onClick"],NL={class:"access-modes"},KL={class:"operation-buttons"},UL={class:"tab-content"},XL={class:"content-header"},qL={class:"resource-count"},HL={class:"resource-name"},BL=["onClick"],jL={class:"operation-buttons"},OL={class:"detail-content"},QL={class:"detail-item"},GL={class:"detail-value"},YL={class:"detail-item"},JL={class:"detail-value"},ZL={class:"detail-item"},eF={class:"detail-item"},aF={class:"detail-value"},tF={class:"detail-item"},lF={class:"access-modes"},sF={class:"detail-item"},oF={class:"detail-value"},nF={class:"detail-item"},iF={class:"detail-value"},rF={key:0,class:"detail-item"},dF={class:"detail-value"},cF={key:1,class:"detail-item"},uF={class:"detail-value"},pF={class:"detail-content"},mF={class:"detail-item"},gF={class:"detail-value"},vF={class:"detail-item"},hF={class:"detail-item"},kF={class:"detail-value"},bF={class:"detail-item"},fF={class:"access-modes"},yF={class:"detail-item"},_F={class:"detail-value"},wF={class:"detail-item"},LF={class:"detail-value"},FF={class:"detail-item"},CF={class:"detail-value"},VF={key:0,class:"detail-item"},xF={class:"detail-value"},SF={key:1,class:"detail-item"},IF={class:"storage-source"},AF={key:0},RF={key:1},DF={key:2},PF={key:2,class:"detail-item"},$F={class:"detail-value"},TF={class:"detail-content"},MF={class:"detail-item"},EF={class:"detail-value"},WF={class:"detail-item"},zF={class:"detail-value"},NF={class:"detail-item"},KF={class:"detail-value"},UF={class:"detail-item"},XF={class:"detail-item"},qF={class:"detail-value"},HF={class:"detail-item"},BF={class:"detail-value"};var jF={__name:"k8s-storage",setup(e){const a=(0,Y.KR)(!1),t=(0,Y.KR)("pvc"),l=(0,Y.KR)(""),s=(0,Y.KR)(""),o=(0,Y.Kh)({namespace:"default"}),n=(0,Y.KR)([]),d=(0,Y.KR)([]),c=(0,Y.KR)([]),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(!1),g=(0,Y.KR)(!1),v=(0,Y.KR)(!1),h=(0,Y.KR)(!1),k=(0,Y.KR)(""),b=(0,Y.KR)(""),f=(0,Y.KR)(""),y=((0,Y.KR)(""),(0,Y.KR)(""),(0,Y.KR)({})),_=(0,Y.KR)({}),w=(0,Y.KR)({}),L=(0,r.EW)(()=>{const e=Array.isArray(n.value)?n.value:[];return l.value?e.filter(e=>e.name?.toLowerCase().includes(l.value.toLowerCase())||e.status?.toLowerCase().includes(l.value.toLowerCase())||e.storageClassName?.toLowerCase().includes(l.value.toLowerCase())):e}),F=(0,r.EW)(()=>{const e=Array.isArray(d.value)?d.value:[];return l.value?e.filter(e=>e.name?.toLowerCase().includes(l.value.toLowerCase())||e.status?.toLowerCase().includes(l.value.toLowerCase())||e.storageClassName?.toLowerCase().includes(l.value.toLowerCase())):e}),C=(0,r.EW)(()=>{const e=Array.isArray(c.value)?c.value:[];return l.value?e.filter(e=>e.name?.toLowerCase().includes(l.value.toLowerCase())||e.provisioner?.toLowerCase().includes(l.value.toLowerCase())):e}),V=e=>{s.value=e,console.log("集群选择变化:",e),e&&o.namespace&&I()},S=e=>{o.namespace=e,console.log("命名空间选择变化:",e),s.value&&e&&I()},I=async()=>{if(s.value){console.log("开始加载存储资源，集群ID:",s.value,"命名空间:",o.namespace),a.value=!0;try{await Promise.all([D(),P(),$()])}catch(e){console.error("加载存储资源失败:",e)}finally{a.value=!1}}else console.warn("集群ID为空，无法加载存储资源")},A=()=>{l.value=""},R=e=>{console.log("标签页切换到:",e),t.value=e},D=async()=>{if(s.value&&o.namespace)try{console.log("正在获取 PVC 列表，集群ID:",s.value,"命名空间:",o.namespace);const e=await ce.getPVCList(s.value,o.namespace),a=e.data||e;if(200===a.code||a.success){const e=a.data?.pvcs||a.data;n.value=Array.isArray(e)?e:[],console.log("获取到 PVC 列表:",n.value.length,"个")}else J.nk.error(a.message||"获取 PVC 列表失败"),n.value=[]}catch(e){console.error("获取 PVC 列表失败:",e),J.nk.error("获取 PVC 列表失败，请检查网络连接"),n.value=[]}else console.warn("集群ID或命名空间为空，无法获取 PVC 列表")},P=async()=>{if(s.value)try{console.log("正在获取 PV 列表，集群ID:",s.value);const e=await ce.getPVList(s.value),a=e.data||e;if(200===a.code||a.success){const e=a.data?.pvs||a.data;d.value=Array.isArray(e)?e:[],console.log("获取到 PV 列表:",d.value.length,"个")}else J.nk.error(a.message||"获取 PV 列表失败"),d.value=[]}catch(e){console.error("获取 PV 列表失败:",e),J.nk.error("获取 PV 列表失败，请检查网络连接"),d.value=[]}else console.warn("集群ID为空，无法获取 PV 列表")},$=async()=>{if(s.value)try{console.log("正在获取 StorageClass 列表，集群ID:",s.value);const e=await ce.getStorageClassList(s.value),a=e.data||e;if(200===a.code||a.success){const e=a.data?.storageClasses||a.data;c.value=Array.isArray(e)?e:[],console.log("获取到 StorageClass 列表:",c.value.length,"个")}else J.nk.error(a.message||"获取 StorageClass 列表失败"),c.value=[]}catch(e){console.error("获取 StorageClass 列表失败:",e),J.nk.error("获取 StorageClass 列表失败，请检查网络连接"),c.value=[]}else console.warn("集群ID为空，无法获取 StorageClass 列表")},T=()=>{I()},M=()=>{if(!s.value)return void J.nk.warning("请先选择集群");if(!o.namespace)return void J.nk.warning("请先选择命名空间");const e=`apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: new-pvc\n  namespace: ${o.namespace}\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 10Gi\n  storageClassName: standard`;k.value=e,y.value={name:"new-pvc",namespace:o.namespace},u.value=!0},E=async e=>{try{console.log("🔍 获取PVC详情:",{clusterId:s.value,namespace:o.namespace,pvcName:e?.name,row:e});const a=await ce.getPVCDetail(s.value,o.namespace,e?.name),t=a.data||a;console.log("📥 PVC详情API响应:",t),200===t.code||t.success?(y.value=t.data||e,console.log("✅ PVC详情数据已设置，打开对话框"),g.value=!0):(console.error("❌ API返回失败:",t),J.nk.error(t.message||"获取 PVC 详情失败"))}catch(a){console.error("❌ 获取 PVC 详情失败:",a),J.nk.error("获取 PVC 详情失败: "+(a.message||"未知错误"))}},W=async e=>{try{a.value=!0;const t=await ce.getPVCYaml(s.value,o.namespace,e?.name),l=t.data||t;if(200===l.code||l.success){let a=l.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# PVC ${e?.name} YAML\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: ${e?.name}`),k.value=String(a),y.value=e,u.value=!0}else J.nk.error(l.message||"获取 PVC YAML 失败")}catch(t){console.error("获取 PVC YAML 失败:",t),J.nk.error("获取 PVC YAML 失败")}finally{a.value=!1}},z=async e=>{try{const a="new-pvc"===e.resourceName||!y.value?.creationTimestamp;let t;t=a?await ce.createPodFromYaml(s.value,o.namespace,{yamlContent:e.yamlContent}):await ce.updatePVCYaml(s.value,o.namespace,e.resourceName,e.yamlContent);const l=t.data||t;200===l.code||l.success?(J.nk.success(a?"PVC 创建成功":"PVC YAML 更新成功"),u.value=!1,D()):J.nk.error(l.message||(a?"PVC 创建失败":"PVC YAML 更新失败"))}catch(a){console.error("PVC 操作失败:",a),J.nk.error("PVC 操作失败")}},N=async e=>{try{await uv.s.confirm(`确认删除 PVC "${e?.name}"？删除后数据将无法恢复。`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await ce.deletePVC(s.value,o.namespace,e?.name),t=a.data||a;200===t.code||t.success?(J.nk.success("PVC 删除成功"),D()):J.nk.error(t.message||"PVC 删除失败")}catch(a){"cancel"!==a&&(console.error("删除 PVC 失败:",a),J.nk.error("删除 PVC 失败"))}},K=()=>{if(!s.value)return void J.nk.warning("请先选择集群");const e="apiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: new-pv\nspec:\n  capacity:\n    storage: 20Gi\n  accessModes:\n    - ReadWriteOnce\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: standard\n  hostPath:\n    path: /data/storage";b.value=e,_.value={name:"new-pv"},p.value=!0},U=async e=>{try{console.log("🔍 获取PV详情:",{clusterId:s.value,pvName:e?.name,row:e});const a=await ce.getPVDetail(s.value,e?.name),t=a.data||a;console.log("📥 PV详情API响应:",t),200===t.code||t.success?(_.value=t.data||e,console.log("✅ PV详情数据已设置，打开对话框"),v.value=!0):(console.error("❌ API返回失败:",t),J.nk.error(t.message||"获取 PV 详情失败"))}catch(a){console.error("❌ 获取 PV 详情失败:",a),J.nk.error("获取 PV 详情失败: "+(a.message||"未知错误"))}},X=async e=>{try{a.value=!0;const t=await ce.getPVYaml(s.value,e?.name),l=t.data||t;if(200===l.code||l.success){let a=l.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# PV ${e?.name} YAML\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: ${e?.name}`),b.value=String(a),_.value=e,p.value=!0}else J.nk.error(l.message||"获取 PV YAML 失败")}catch(t){console.error("获取 PV YAML 失败:",t),J.nk.error("获取 PV YAML 失败")}finally{a.value=!1}},q=async e=>{try{const a="new-pv"===e.resourceName||!_.value?.creationTimestamp;let t;t=a?await ce.createPodFromYaml(s.value,o.namespace,{yamlContent:e.yamlContent}):await ce.updatePVYaml(s.value,e.resourceName,e.yamlContent);const l=t.data||t;200===l.code||l.success?(J.nk.success(a?"PV 创建成功":"PV YAML 更新成功"),p.value=!1,P()):J.nk.error(l.message||(a?"PV 创建失败":"PV YAML 更新失败"))}catch(a){console.error("PV 操作失败:",a),J.nk.error("PV 操作失败")}},H=async e=>{try{await uv.s.confirm(`确认删除 PV "${e?.name}"？删除后数据将无法恢复。`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await ce.deletePV(s.value,e?.name),t=a.data||a;200===t.code||t.success?(J.nk.success("PV 删除成功"),P()):J.nk.error(t.message||"PV 删除失败")}catch(a){"cancel"!==a&&(console.error("删除 PV 失败:",a),J.nk.error("删除 PV 失败"))}},B=()=>{if(!s.value)return void J.nk.warning("请先选择集群");const e="apiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: new-storageclass\nprovisioner: kubernetes.io/no-provisioner\nreclaimPolicy: Delete\nallowVolumeExpansion: true\nvolumeBindingMode: WaitForFirstConsumer";f.value=e,w.value={name:"new-storageclass"},m.value=!0},j=async e=>{try{console.log("🔍 获取StorageClass详情:",{clusterId:s.value,storageClassName:e?.name,row:e});const a=await ce.getStorageClassDetail(s.value,e?.name),t=a.data||a;console.log("📥 StorageClass详情API响应:",t),200===t.code||t.success?(w.value=t.data||e,console.log("✅ StorageClass详情数据已设置，打开对话框"),h.value=!0):(console.error("❌ API返回失败:",t),J.nk.error(t.message||"获取 StorageClass 详情失败"))}catch(a){console.error("❌ 获取 StorageClass 详情失败:",a),J.nk.error("获取 StorageClass 详情失败: "+(a.message||"未知错误"))}},O=async e=>{try{a.value=!0;const t=await ce.getStorageClassYaml(s.value,e?.name),l=t.data||t;if(200===l.code||l.success){let a=l.data;"object"===typeof a&&null!==a&&a.yaml?a=a.yaml:"object"===typeof a&&null!==a?a=JSON.stringify(a,null,2):null!==a&&void 0!==a||(a=`# StorageClass ${e?.name} YAML\napiVersion: storage.k8s.io/v1\nkind: StorageClass\nmetadata:\n  name: ${e?.name}`),f.value=String(a),w.value=e,m.value=!0}else J.nk.error(l.message||"获取 StorageClass YAML 失败")}catch(t){console.error("获取 StorageClass YAML 失败:",t),J.nk.error("获取 StorageClass YAML 失败")}finally{a.value=!1}},Q=async e=>{try{const a="new-storageclass"===e.resourceName||!w.value?.creationTimestamp;let t;t=a?await ce.createPodFromYaml(s.value,o.namespace,{yamlContent:e.yamlContent}):await ce.updateStorageClassYaml(s.value,e.resourceName,e.yamlContent);const l=t.data||t;200===l.code||l.success?(J.nk.success(a?"StorageClass 创建成功":"StorageClass YAML 更新成功"),m.value=!1,$()):J.nk.error(l.message||(a?"StorageClass 创建失败":"StorageClass YAML 更新失败"))}catch(a){console.error("StorageClass 操作失败:",a),J.nk.error("StorageClass 操作失败")}},G=async e=>{try{await uv.s.confirm(`确认删除 StorageClass "${e?.name}"？删除后可能影响使用该存储类的PVC。`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await ce.deleteStorageClass(s.value,e?.name),t=a.data||a;200===t.code||t.success?(J.nk.success("StorageClass 删除成功"),$()):J.nk.error(t.message||"StorageClass 删除失败")}catch(a){"cancel"!==a&&(console.error("删除 StorageClass 失败:",a),J.nk.error("删除 StorageClass 失败"))}},Z=e=>{const a={Available:"success",Bound:"success",Released:"warning",Failed:"danger",Pending:"info"};return a[e]||"info"};return(0,r.wB)([s,()=>o.namespace],([e,a])=>{console.log("监听到变化 - 集群ID:",e,"命名空间:",a),e&&a&&(console.log("集群和命名空间都已选择，开始加载存储资源"),I())},{immediate:!0}),(0,r.sV)(async()=>{console.log("🚀 开始加载k8s存储管理页面");const e=Date.now();try{console.log("🎉 页面初始化完成，总耗时:",Date.now()-e+"ms")}catch(a){console.error("页面初始化失败:",a)}}),(e,n)=>{const d=(0,r.g2)("el-input"),c=(0,r.g2)("el-form-item"),I=(0,r.g2)("el-button"),D=(0,r.g2)("el-form"),P=(0,r.g2)("el-icon"),$=(0,r.g2)("el-table-column"),J=(0,r.g2)("el-tag"),ee=(0,r.g2)("el-tooltip"),ae=(0,r.g2)("el-table"),te=(0,r.g2)("el-tab-pane"),le=(0,r.g2)("el-tabs"),se=(0,r.g2)("el-card"),oe=(0,r.g2)("el-dialog"),ne=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",FL,[(0,r.bF)(se,{shadow:"hover",class:"storage-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",CL,[n[13]||(n[13]=(0,r.Lk)("span",{class:"title"},"K8s 存储管理",-1)),(0,r.Lk)("div",VL,[(0,r.bF)(gb,{modelValue:s.value,"onUpdate:modelValue":n[0]||(n[0]=e=>s.value=e),onChange:V},null,8,["modelValue"]),(0,r.bF)(fb,{modelValue:o.namespace,"onUpdate:modelValue":n[1]||(n[1]=e=>o.namespace=e),"cluster-id":s.value,onChange:S},null,8,["modelValue","cluster-id"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",xL,[(0,r.bF)(D,{inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"存储资源名称"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=e=>l.value=e),placeholder:"请输入名称",clearable:"",size:"small",style:{width:"200px"},onKeyup:(0,i.jR)(A,["enter"])},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(I,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:A},{default:(0,r.k6)(()=>n[14]||(n[14]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[14]},8,["icon"]),(0,r.bF)(I,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:T},{default:(0,r.k6)(()=>n[15]||(n[15]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[15]},8,["icon"])]),_:1})]),_:1})]),(0,r.bF)(le,{modelValue:t.value,"onUpdate:modelValue":n[3]||(n[3]=e=>t.value=e),onTabChange:R,class:"storage-tabs"},{default:(0,r.k6)(()=>[(0,r.bF)(te,{label:"PVC",name:"pvc"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",SL,[(0,r.Lk)("div",IL,[(0,r.Lk)("span",AL,"共 "+(0,x.v_)(L.value.length)+" 个 PVC",1),(0,r.bF)(I,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:M},{default:(0,r.k6)(()=>n[16]||(n[16]=[(0,r.eW)(" 创建 PVC ",-1)])),_:1,__:[16]},8,["icon"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(ae,{data:L.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 PVC 资源"},{default:(0,r.k6)(()=>[(0,r.bF)($,{prop:"name",label:"名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",RL,[(0,r.bF)(P,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DataLine))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>E(e)},(0,x.v_)(e?.name||"-"),9,DL)])]),_:1}),(0,r.bF)($,{prop:"status",label:"状态",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(J,{type:Z(e?.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e?.status||"未知"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)($,{prop:"capacity",label:"容量",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.capacity||"-"),1)]),_:1}),(0,r.bF)($,{prop:"accessModes",label:"访问模式",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",PL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e?.accessModes||[],e=>((0,r.uX)(),(0,r.Wv)(J,{key:e,size:"small",type:"info",class:"mode-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e),1)]),_:2},1024))),128))])]),_:1}),(0,r.bF)($,{prop:"storageClassName",label:"存储类",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.storageClassName||"-"),1)]),_:1}),(0,r.bF)($,{prop:"creationTimestamp",label:"创建时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.creationTimestamp||"-"),1)]),_:1}),(0,r.bF)($,{label:"操作",width:"160",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",$L,[(0,r.bF)(ee,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{icon:(0,Y.R1)(vc.Edit),size:"small",type:"primary",circle:"",onClick:a=>W(e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(ee,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",onClick:a=>N(e)},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ne,a.value]])])]),_:1}),(0,r.bF)(te,{label:"PV",name:"pv"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",TL,[(0,r.Lk)("div",ML,[(0,r.Lk)("span",EL,"共 "+(0,x.v_)(F.value.length)+" 个 PV",1),(0,r.bF)(I,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:K},{default:(0,r.k6)(()=>n[17]||(n[17]=[(0,r.eW)(" 创建 PV ",-1)])),_:1,__:[17]},8,["icon"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(ae,{data:F.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 PV 资源"},{default:(0,r.k6)(()=>[(0,r.bF)($,{prop:"name",label:"名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",WL,[(0,r.bF)(P,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Cpu))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>U(e)},(0,x.v_)(e?.name||"-"),9,zL)])]),_:1}),(0,r.bF)($,{prop:"status",label:"状态",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(J,{type:Z(e?.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e?.status||"未知"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)($,{prop:"capacity",label:"容量",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.capacity||"-"),1)]),_:1}),(0,r.bF)($,{prop:"accessModes",label:"访问模式",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",NL,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e?.accessModes||[],e=>((0,r.uX)(),(0,r.Wv)(J,{key:e,size:"small",type:"info",class:"mode-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e),1)]),_:2},1024))),128))])]),_:1}),(0,r.bF)($,{prop:"reclaimPolicy",label:"回收策略",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.reclaimPolicy||"-"),1)]),_:1}),(0,r.bF)($,{prop:"storageClassName",label:"存储类",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.storageClassName||"-"),1)]),_:1}),(0,r.bF)($,{prop:"creationTimestamp",label:"创建时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.creationTimestamp||"-"),1)]),_:1}),(0,r.bF)($,{label:"操作",width:"160",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",KL,[(0,r.bF)(ee,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{icon:(0,Y.R1)(vc.Edit),size:"small",type:"primary",circle:"",onClick:a=>X(e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(ee,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",onClick:a=>H(e)},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ne,a.value]])])]),_:1}),(0,r.bF)(te,{label:"StorageClass",name:"storageclass"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",UL,[(0,r.Lk)("div",XL,[(0,r.Lk)("span",qL,"共 "+(0,x.v_)(C.value.length)+" 个 StorageClass",1),(0,r.bF)(I,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:B},{default:(0,r.k6)(()=>n[18]||(n[18]=[(0,r.eW)(" 创建 StorageClass ",-1)])),_:1,__:[18]},8,["icon"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(ae,{data:C.value,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无 StorageClass 资源"},{default:(0,r.k6)(()=>[(0,r.bF)($,{prop:"name",label:"名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",HL,[(0,r.bF)(P,{class:"resource-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Connection))]),_:1}),(0,r.Lk)("span",{class:"resource-name-link",onClick:a=>j(e)},(0,x.v_)(e?.name||"-"),9,BL)])]),_:1}),(0,r.bF)($,{prop:"provisioner",label:"供应商","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.provisioner||"-"),1)]),_:1}),(0,r.bF)($,{prop:"reclaimPolicy",label:"回收策略",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.reclaimPolicy||"-"),1)]),_:1}),(0,r.bF)($,{prop:"allowVolumeExpansion",label:"支持扩容",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(J,{type:e?.allowVolumeExpansion?"success":"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e?.allowVolumeExpansion?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)($,{prop:"volumeBindingMode",label:"绑定模式",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.volumeBindingMode||"-"),1)]),_:1}),(0,r.bF)($,{prop:"creationTimestamp",label:"创建时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e?.creationTimestamp||"-"),1)]),_:1}),(0,r.bF)($,{label:"操作",width:"160",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",jL,[(0,r.bF)(ee,{content:"编辑 YAML",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{icon:(0,Y.R1)(vc.Edit),size:"small",type:"primary",circle:"",onClick:a=>O(e)},null,8,["icon","onClick"])]),_:2},1024),(0,r.bF)(ee,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(I,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",onClick:a=>G(e)},null,8,["icon","onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ne,a.value]])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(oe,{modelValue:g.value,"onUpdate:modelValue":n[4]||(n[4]=e=>g.value=e),title:"PVC 详情",width:"60%",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",OL,[(0,r.Lk)("div",QL,[n[19]||(n[19]=(0,r.Lk)("span",{class:"detail-label"},"名称:",-1)),(0,r.Lk)("span",GL,(0,x.v_)(y.value.name||"-"),1)]),(0,r.Lk)("div",YL,[n[20]||(n[20]=(0,r.Lk)("span",{class:"detail-label"},"命名空间:",-1)),(0,r.Lk)("span",JL,(0,x.v_)(y.value.namespace||"-"),1)]),(0,r.Lk)("div",ZL,[n[21]||(n[21]=(0,r.Lk)("span",{class:"detail-label"},"状态:",-1)),(0,r.bF)(J,{type:Z(y.value.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(y.value.status||"Unknown"),1)]),_:1},8,["type"])]),(0,r.Lk)("div",eF,[n[22]||(n[22]=(0,r.Lk)("span",{class:"detail-label"},"容量:",-1)),(0,r.Lk)("span",aF,(0,x.v_)(y.value.capacity||"-"),1)]),(0,r.Lk)("div",tF,[n[23]||(n[23]=(0,r.Lk)("span",{class:"detail-label"},"访问模式:",-1)),(0,r.Lk)("div",lF,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(y.value.accessModes||[],e=>((0,r.uX)(),(0,r.Wv)(J,{key:e,size:"small",type:"info",class:"mode-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e),1)]),_:2},1024))),128))])]),(0,r.Lk)("div",sF,[n[24]||(n[24]=(0,r.Lk)("span",{class:"detail-label"},"存储类:",-1)),(0,r.Lk)("span",oF,(0,x.v_)(y.value.storageClass||y.value.storageClassName||"-"),1)]),(0,r.Lk)("div",nF,[n[25]||(n[25]=(0,r.Lk)("span",{class:"detail-label"},"创建时间:",-1)),(0,r.Lk)("span",iF,(0,x.v_)(y.value.createdAt?new Date(y.value.createdAt).toLocaleString():y.value.creationTimestamp?new Date(y.value.creationTimestamp).toLocaleString():"-"),1)]),y.value.volumeName?((0,r.uX)(),(0,r.CE)("div",rF,[n[26]||(n[26]=(0,r.Lk)("span",{class:"detail-label"},"绑定的PV:",-1)),(0,r.Lk)("span",dF,(0,x.v_)(y.value.volumeName),1)])):(0,r.Q3)("",!0),y.value.volumeMode?((0,r.uX)(),(0,r.CE)("div",cF,[n[27]||(n[27]=(0,r.Lk)("span",{class:"detail-label"},"卷模式:",-1)),(0,r.Lk)("span",uF,(0,x.v_)(y.value.volumeMode),1)])):(0,r.Q3)("",!0)])]),_:1},8,["modelValue"]),(0,r.bF)(oe,{modelValue:v.value,"onUpdate:modelValue":n[5]||(n[5]=e=>v.value=e),title:"PV 详情",width:"60%",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",pF,[(0,r.Lk)("div",mF,[n[28]||(n[28]=(0,r.Lk)("span",{class:"detail-label"},"名称:",-1)),(0,r.Lk)("span",gF,(0,x.v_)(_.value.name||"-"),1)]),(0,r.Lk)("div",vF,[n[29]||(n[29]=(0,r.Lk)("span",{class:"detail-label"},"状态:",-1)),(0,r.bF)(J,{type:Z(_.value.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(_.value.status||"Unknown"),1)]),_:1},8,["type"])]),(0,r.Lk)("div",hF,[n[30]||(n[30]=(0,r.Lk)("span",{class:"detail-label"},"容量:",-1)),(0,r.Lk)("span",kF,(0,x.v_)(_.value.capacity||"-"),1)]),(0,r.Lk)("div",bF,[n[31]||(n[31]=(0,r.Lk)("span",{class:"detail-label"},"访问模式:",-1)),(0,r.Lk)("div",fF,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(_.value.accessModes||[],e=>((0,r.uX)(),(0,r.Wv)(J,{key:e,size:"small",type:"info",class:"mode-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e),1)]),_:2},1024))),128))])]),(0,r.Lk)("div",yF,[n[32]||(n[32]=(0,r.Lk)("span",{class:"detail-label"},"回收策略:",-1)),(0,r.Lk)("span",_F,(0,x.v_)(_.value.reclaimPolicy||"-"),1)]),(0,r.Lk)("div",wF,[n[33]||(n[33]=(0,r.Lk)("span",{class:"detail-label"},"存储类:",-1)),(0,r.Lk)("span",LF,(0,x.v_)(_.value.storageClass||"-"),1)]),(0,r.Lk)("div",FF,[n[34]||(n[34]=(0,r.Lk)("span",{class:"detail-label"},"创建时间:",-1)),(0,r.Lk)("span",CF,(0,x.v_)(_.value.createdAt?new Date(_.value.createdAt).toLocaleString():"-"),1)]),_.value.volumeMode?((0,r.uX)(),(0,r.CE)("div",VF,[n[35]||(n[35]=(0,r.Lk)("span",{class:"detail-label"},"卷模式:",-1)),(0,r.Lk)("span",xF,(0,x.v_)(_.value.volumeMode),1)])):(0,r.Q3)("",!0),_.value.persistentVolumeSource?((0,r.uX)(),(0,r.CE)("div",SF,[n[39]||(n[39]=(0,r.Lk)("span",{class:"detail-label"},"存储源:",-1)),(0,r.Lk)("div",IF,[_.value.persistentVolumeSource.hostPath?((0,r.uX)(),(0,r.CE)("div",AF,[n[36]||(n[36]=(0,r.Lk)("strong",null,"HostPath:",-1)),(0,r.eW)(" "+(0,x.v_)(_.value.persistentVolumeSource.hostPath.path)+" ",1),n[37]||(n[37]=(0,r.Lk)("br",null,null,-1)),(0,r.Lk)("small",null,"类型: "+(0,x.v_)(_.value.persistentVolumeSource.hostPath.type),1)])):_.value.persistentVolumeSource.nfs?((0,r.uX)(),(0,r.CE)("div",RF,[n[38]||(n[38]=(0,r.Lk)("strong",null,"NFS:",-1)),(0,r.eW)(" "+(0,x.v_)(_.value.persistentVolumeSource.nfs.server)+":"+(0,x.v_)(_.value.persistentVolumeSource.nfs.path),1)])):((0,r.uX)(),(0,r.CE)("div",DF,(0,x.v_)(Object.keys(_.value.persistentVolumeSource)[0]),1))])])):(0,r.Q3)("",!0),_.value.claimRef?((0,r.uX)(),(0,r.CE)("div",PF,[n[40]||(n[40]=(0,r.Lk)("span",{class:"detail-label"},"绑定的PVC:",-1)),(0,r.Lk)("span",$F,(0,x.v_)(_.value.claimRef.namespace)+"/"+(0,x.v_)(_.value.claimRef.name),1)])):(0,r.Q3)("",!0)])]),_:1},8,["modelValue"]),(0,r.bF)(oe,{modelValue:h.value,"onUpdate:modelValue":n[6]||(n[6]=e=>h.value=e),title:"StorageClass 详情",width:"60%",class:"detail-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",TF,[(0,r.Lk)("div",MF,[n[41]||(n[41]=(0,r.Lk)("span",{class:"detail-label"},"名称:",-1)),(0,r.Lk)("span",EF,(0,x.v_)(w.value.name),1)]),(0,r.Lk)("div",WF,[n[42]||(n[42]=(0,r.Lk)("span",{class:"detail-label"},"供应商:",-1)),(0,r.Lk)("span",zF,(0,x.v_)(w.value.provisioner),1)]),(0,r.Lk)("div",NF,[n[43]||(n[43]=(0,r.Lk)("span",{class:"detail-label"},"回收策略:",-1)),(0,r.Lk)("span",KF,(0,x.v_)(w.value.reclaimPolicy),1)]),(0,r.Lk)("div",UF,[n[44]||(n[44]=(0,r.Lk)("span",{class:"detail-label"},"支持扩容:",-1)),(0,r.bF)(J,{type:w.value.allowVolumeExpansion?"success":"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(w.value.allowVolumeExpansion?"是":"否"),1)]),_:1},8,["type"])]),(0,r.Lk)("div",XF,[n[45]||(n[45]=(0,r.Lk)("span",{class:"detail-label"},"绑定模式:",-1)),(0,r.Lk)("span",qF,(0,x.v_)(w.value.volumeBindingMode),1)]),(0,r.Lk)("div",HF,[n[46]||(n[46]=(0,r.Lk)("span",{class:"detail-label"},"创建时间:",-1)),(0,r.Lk)("span",BF,(0,x.v_)(w.value.creationTimestamp),1)])])]),_:1},8,["modelValue"]),(0,r.bF)(pf,{visible:u.value,"yaml-content":k.value,"resource-name":y.value.name||"new-pvc","resource-type":"PVC",editable:!0,"onUpdate:visible":n[7]||(n[7]=e=>u.value=e),onClose:n[8]||(n[8]=e=>u.value=!1),onSave:z},null,8,["visible","yaml-content","resource-name"]),(0,r.bF)(pf,{visible:p.value,"yaml-content":b.value,"resource-name":_.value.name||"new-pv","resource-type":"PV",editable:!0,"onUpdate:visible":n[9]||(n[9]=e=>p.value=e),onClose:n[10]||(n[10]=e=>p.value=!1),onSave:q},null,8,["visible","yaml-content","resource-name"]),(0,r.bF)(pf,{visible:m.value,"yaml-content":f.value,"resource-name":w.value.name||"new-storageclass","resource-type":"StorageClass",editable:!0,"onUpdate:visible":n[11]||(n[11]=e=>m.value=e),onClose:n[12]||(n[12]=e=>m.value=!1),onSave:Q},null,8,["visible","yaml-content","resource-name"])])}}};const OF=(0,p.A)(jF,[["__scopeId","data-v-6a988394"]]);var QF=OF,GF=t.p+"static/img/终端.7e08ab4d.svg";const YF={class:"k8s-pod-management"},JF={class:"card-header"},ZF={class:"header-left"},eC={class:"page-title"},aC={class:"header-actions"},tC={class:"info-section"},lC={key:0},sC={key:1},oC={key:0,class:"labels-container"},nC={class:"labels-display"},iC={key:1},rC={class:"tabs-section"},dC={class:"pod-name-container"},cC={class:"pod-name"},uC={class:"time-info"},pC={key:0,class:"running-time"},mC={class:"operation-buttons-container"},gC={class:"image-cell"},vC={key:0,class:"image-info"},hC={key:1},kC={key:0},bC={key:1},fC={key:0,style:{padding:"20px","text-align":"center"}},yC={style:{"margin-top":"16px"}},_C={key:0,style:{padding:"20px","text-align":"center"}},wC={style:{"margin-top":"16px"}},LC={class:"logs-tab-content"},FC={class:"logs-controls"},CC={style:{display:"flex","align-items":"center",gap:"12px","white-space":"nowrap"}},VC={class:"logs-actions",style:{"justify-content":"flex-end"}},xC={class:"logs-display"},SC={key:0,class:"logs-placeholder"},IC={style:{"margin-top":"16px"}},AC={key:1,class:"logs-content-display"},RC={class:"logs-header"},DC={class:"container-name"},PC={class:"logs-info"},$C={class:"logs-editor-container"},TC={key:2,class:"logs-empty"},MC={style:{"margin-top":"16px"}},EC={style:{padding:"20px"}},WC={style:{padding:"20px"}},zC={style:{"margin-bottom":"10px","text-align":"right"}},NC={class:"logs-container"},KC={class:"logs-content"},UC={class:"yaml-search-toolbar"},XC={class:"yaml-container"},qC={class:"rollback-confirmation"},HC={class:"monitoring-container"},BC={class:"metric-header"},jC={class:"metric-value"},OC={class:"metric-details"},QC={class:"metric-header"},GC={class:"metric-value"},YC={class:"metric-details"},JC={class:"network-metrics"},ZC={class:"network-item"},eV={class:"network-value"},aV={class:"network-item"},tV={class:"network-value"},lV={class:"metric-header"},sV={class:"metric-value"},oV={class:"metric-details"},nV={class:"card-header"},iV={class:"container-metric"},rV={class:"metric-text"},dV={class:"container-metric"},cV={class:"metric-text"},uV=3;var pV={__name:"k8s-pod",setup(e){const a=(0,v.lq)(),t=(0,v.rd)(),l=e=>{const a={Running:"success",Pending:"warning",Succeeded:"success",Failed:"danger",Unknown:"info"};return a[e]||"info"},s=e=>{const a={Running:"运行中",Pending:"等待中",Succeeded:"成功",Failed:"失败",Unknown:"未知"};return a[e]||e},o=e=>{if(!e)return"-";const a=e.match(/^(\d+h)?(\d+m)?(\d+(?:\.\d+)?s)?$/);if(!a)return e;const[,t,l]=a;return`${t||""}${l||""}`.replace(/^$/,"0m")},n=e=>{if(!e)return"-";try{const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(a){return e}},d=(0,Y.KR)(!1),c=(0,Y.KR)("containers"),u=(0,Y.Kh)({clusterId:a.params.clusterId,namespace:a.params.namespace,podName:a.params.podName}),p=(0,Y.KR)({}),m=(0,Y.KR)([]),g=(0,Y.KR)([]),h=(0,Y.KR)([]),k=(0,Y.KR)([]),b=(0,Y.KR)(""),f=(0,Y.KR)(""),y=(0,Y.KR)(""),_=(0,Y.KR)([]),w=(0,Y.KR)(-1),L=(0,Y.KR)(""),F=(0,Y.KR)([]),C=(0,Y.KR)(-1),V=(0,Y.KR)(""),S=(0,Y.KR)(300),I=(0,Y.KR)(!1),A=(0,Y.KR)(""),R=(0,Y.KR)(!1),D=(0,Y.KR)(null),P=(0,Y.KR)(!1),$=(0,Y.KR)(""),T=(0,Y.KR)(!1),M=(0,Y.Kh)({logsVisible:!1,yamlVisible:!1,scaleVisible:!1,terminalVisible:!1,monitoringVisible:!1,rollbackVisible:!1}),E=(0,Y.Kh)({replicas:1}),W=(0,Y.Kh)({targetVersion:null,versionInfo:{}}),z=(0,Y.KR)(!1),N=(0,Y.KR)(null),K=(0,Y.KR)({cpu:{used:"0",limit:"1000m",percentage:0},memory:{used:"0Mi",limit:"512Mi",percentage:0},network:{rx:"0KB/s",tx:"0KB/s"},disk:{used:"0GB",limit:"10GB",percentage:0}}),U=(0,Y.KR)(!1),X=(0,Y.KR)(null),q=(0,Y.KR)(!1),H=(0,r.EW)(()=>p.value.status||p.value.phase||"Unknown"),B=(0,r.EW)(()=>p.value.labels||{}),j=(0,r.EW)(()=>p.value.createdAt||p.value.creationTimestamp||""),O=(0,r.EW)(()=>{if(g.value&&g.value.length>0)return g.value.length;if(p.value.spec?.ownerReferences){const e=p.value.spec.ownerReferences.find(e=>"ReplicaSet"===e.kind||"Deployment"===e.kind);if(e)return p.value.expectedReplicas||1}return p.value.expectedReplicas||1}),Q=(0,r.EW)(()=>{const e=Object.entries(B.value);return!q.value&&e.length>uV?Object.fromEntries(e.slice(0,uV)):B.value}),G=(0,r.EW)(()=>Object.keys(B.value).length>uV),Z=(0,r.EW)(()=>{const e=Object.keys(B.value).length;return Math.max(0,e-uV)}),ee=(0,r.EW)(()=>{const e=p.value.metadata?.ownerReferences||p.value.spec?.ownerReferences||p.value.ownerReferences||[],a=e.find(e=>"Deployment"===e.kind);if(a)return a.name;const t=e.find(e=>"ReplicaSet"===e.kind);if(t){const e=t.name.split("-");if(e.length>=2)return e.slice(0,-1).join("-")}const l=u.podName.split("-");return l.length>=3?l.slice(0,-2).join("-"):u.podName}),ae=((0,r.EW)(()=>p.value&&0!==Object.keys(p.value).length?{name:u.podName,status:p.value.status||p.value.phase||"Unknown",restartCount:p.value.restartCount||0,nodeName:p.value.spec?.nodeName||p.value.nodeName||"Unknown",podIP:p.value.podIP||p.value.status?.podIP||("Pending"===p.value.status?"等待分配":"Terminating"===p.value.status?"已释放":"Unknown"),hostIP:p.value.hostIP||p.value.status?.hostIP||"Unknown",age:pe(p.value.metadata?.creationTimestamp||p.value.createdAt),runningTime:p.value.runningTime||"",containers:m.value||p.value.spec?.containers||[],resources:p.value.resources||{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:p.value.labels||{},conditions:p.value.conditions||[]}:{name:u.podName,status:"Loading...",restartCount:"-",nodeName:"-",podIP:"-",hostIP:"-",age:"-",runningTime:"-",containers:[],resources:{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:{},conditions:[]}),()=>{q.value=!q.value}),te=e=>{"yaml"!==e||$.value||le(),"logs"!==e&&Xe(),"yaml"!==e&&We()},le=async()=>{if(!T.value)try{T.value=!0,console.log("🔍 开始加载YAML内容...");const e=await ce.getPodYaml(u.clusterId,u.namespace,u.podName),a=e.data||e;if(200===a.code){const e=a.data||"";if($.value="string"===typeof e?e:"object"===typeof e?JSON.stringify(e,null,2):String(e),console.log("✅ YAML内容加载成功，长度:",$.value.length),!$.value.trim())return console.log("⚠️ YAML内容为空，生成默认YAML"),void qe()}else console.log("❌ YAML API返回错误，生成默认YAML:",a.message),qe()}catch(e){console.error("❌ 获取YAML内容失败，生成默认YAML:",e),qe()}finally{T.value=!1}};let se=null;(0,r.sV)(()=>{u.clusterId&&u.namespace&&u.podName&&(de(),ie())}),(0,r.hi)(()=>{oe(),re()}),(0,r.wB)(()=>[u.clusterId,u.namespace,u.podName],()=>{console.log("路由参数变化，重新加载数据"),u.clusterId&&u.namespace&&u.podName&&de()},{immediate:!1}),(0,r.wB)(()=>c.value,e=>{console.log("🔄 标签页切换到:",e),"logs"===e&&(console.log("🔄 切换到日志标签页，检查是否需要加载日志"),(0,r.dY)(()=>{V.value&&!A.value?(console.log("🔄 自动加载日志，因为当前无日志内容"),be()):!V.value&&g.value.length>0&&(console.log("🔄 自动选择Pod并加载日志"),V.value=g.value[0].name,setTimeout(()=>{be()},100))}))});const oe=()=>{se&&(clearInterval(se),se=null)},ne=()=>{document.hidden||(console.log("页面重新获得焦点，刷新数据"),de())},ie=()=>{document.addEventListener("visibilitychange",ne)},re=()=>{document.removeEventListener("visibilitychange",ne)},de=async(e=!1)=>{try{d.value=!0,console.log(e?"🔄 强制刷新Pod详情数据...":"📥 获取Pod详情数据..."),console.log("🔍 [Pod详情页面] 请求参数:",{clusterId:u.clusterId,namespace:u.namespace,podName:u.podName});const t=u.podName.split("-");let l,s,o=null;if(t.length>=3&&(o=t.slice(0,-2).join("-"),console.log("🔍 从Pod名称推断Deployment:",o)),o)try{if(console.log("🔍 使用工作负载API获取Pod详情..."),l=await ce.getWorkloadPods(u.clusterId,u.namespace,"deployment",o),s=l.data||l,console.log("工作负载Pod列表API响应:",s),200!==s.code||!s.data)throw new Error(s.message||"工作负载API调用失败");{const e=s.data.find(e=>e.name===u.podName);if(!e)throw new Error("在工作负载Pod列表中未找到目标Pod");p.value=e,m.value=e.containers||[],console.log("✅ 从工作负载Pod列表中找到目标Pod:",e.name),g.value=s.data.map(e=>({name:e.name,status:e.status||e.phase||"Unknown",restartCount:e.restartCount||0,nodeName:e.nodeName||"Unknown",podIP:e.podIP||"Unknown",hostIP:e.hostIP||"Unknown",age:e.age||pe(e.createdAt),runningTime:e.runningTime||"",containers:e.containers||[],resources:e.resources||{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:e.labels||{},conditions:e.conditions||[],rawData:e})),console.log(`✅ 设置了 ${g.value.length} 个相关Pod`),!V.value&&g.value.length>0&&(V.value=u.podName,console.log("🔄 自动选择当前Pod用于日志:",V.value))}}catch(a){console.log("⚠️ 工作负载API失败，尝试其他方式:",a.message),p.value={name:u.podName,status:"Unknown",metadata:{name:u.podName,namespace:u.namespace}},m.value=[]}else console.log("⚠️ 无法从Pod名称推断Deployment，构造基本信息"),p.value={name:u.podName,status:"Unknown",metadata:{name:u.podName,namespace:u.namespace}},m.value=[];p.value&&p.value.name?(console.log("🔄 获取Pod事件数据..."),await me(),0===g.value.length?(console.log("🔄 [Pod详情页面] 开始获取相关Pod列表"),await ue()):console.log("✅ 已有相关Pod数据，跳过重复获取"),console.log("🔄 强制刷新事件数据..."),await me(),await ve()):J.nk.error("获取Pod详情失败")}catch(t){console.error("获取Pod详情失败:",t),J.nk.error("获取Pod详情失败，请检查网络连接")}finally{d.value=!1}},ue=async()=>{try{console.log("🔍 获取相关Pod列表..."),console.log("📊 当前Pod详情数据:",{podName:u.podName,metadata:p.value.metadata,labels:p.value.metadata?.labels||p.value.labels,ownerReferences:p.value.metadata?.ownerReferences||p.value.ownerReferences,allFields:Object.keys(p.value)}),console.log("📊 Pod详情完整数据结构:",p.value);const a=p.value.ownerReferences||p.value.metadata?.ownerReferences||[];console.log("🔍 [Pod详情页面] Pod的ownerReferences:",a);let t,l="";if(0===a.length){console.log("⚠️ 当前Pod没有ownerReferences，尝试通过标签获取相关Pod");const e=p.value.labels||p.value.metadata?.labels||{};console.log("🔍 [Pod详情页面] 可用的标签:",e);const a=e["app"],t=e["app.kubernetes.io/name"];if(a?l=`app=${a}`:t&&(l=`app.kubernetes.io/name=${t}`),!l)return console.log("⚠️ 无法构建标签选择器，使用当前Pod"),void(g.value=[{name:u.podName,status:p.value.status||p.value.phase||"Unknown",restartCount:p.value.restartCount||0,nodeName:p.value.spec?.nodeName||"Unknown",podIP:p.value.podIP||p.value.status?.podIP||("Pending"===p.value.status?"等待分配":"Terminating"===p.value.status?"已释放":"Unknown"),hostIP:p.value.hostIP||p.value.status?.hostIP||"Unknown",age:pe(p.value.metadata?.creationTimestamp),runningTime:p.value.runningTime||"",containers:m.value||p.value.spec?.containers||[],resources:{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:p.value.metadata?.labels||{},conditions:p.value.status?.conditions||[],rawData:p.value}])}else{const e=a.find(e=>"ReplicaSet"===e.kind),t=a.find(e=>"Deployment"===e.kind);console.log("🔍 [Pod详情页面] 找到的owner引用:",{replicaSet:e?.name,deployment:t?.name}),e?console.log("📋 通过ReplicaSet获取相关Pod:",e.name):t&&console.log("📋 通过Deployment获取相关Pod:",t.name);const s=p.value.labels||p.value.metadata?.labels||{};console.log("🔍 [Pod详情页面] 工作负载Pod的可用标签:",s);const o=s["app"],n=s["app.kubernetes.io/name"],i=s["app.kubernetes.io/instance"];if(o)l=`app=${o}`,console.log("🔍 [Pod详情页面] 使用app标签选择器:",l);else if(n)l=`app.kubernetes.io/name=${n}`,console.log("🔍 [Pod详情页面] 使用name标签选择器:",l);else if(i)l=`app.kubernetes.io/instance=${i}`,console.log("🔍 [Pod详情页面] 使用instance标签选择器:",l);else{const e=s["pod-template-hash"];e&&(l=`pod-template-hash=${e}`,console.log("🔍 [Pod详情页面] 使用pod-template-hash标签选择器:",l))}}if(!l)return console.log("⚠️ 无法构建标签选择器，使用当前Pod"),void(g.value=[{name:u.podName,status:p.value.status||p.value.phase||"Unknown",restartCount:p.value.restartCount||0,nodeName:p.value.spec?.nodeName||"Unknown",podIP:p.value.podIP||p.value.status?.podIP||("Pending"===p.value.status?"等待分配":"Terminating"===p.value.status?"已释放":"Unknown"),hostIP:p.value.hostIP||p.value.status?.hostIP||"Unknown",age:pe(p.value.metadata?.creationTimestamp),runningTime:p.value.runningTime||"",containers:m.value||p.value.spec?.containers||[],resources:{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:p.value.metadata?.labels||{},conditions:p.value.status?.conditions||[],rawData:p.value}]);let s=!1,o=null;const n=u.podName.split("-");if(n.length>=3&&(o=n.slice(0,-2).join("-"),console.log("🔍 [Pod详情页面] 从Pod名称推断Deployment:",o)),deploymentRef){console.log("🔍 [Pod详情页面] 使用新API - Deployment:",deploymentRef.name);try{t=await ce.getWorkloadPods(u.clusterId,u.namespace,"deployment",deploymentRef.name),s=!0}catch(e){console.log("⚠️ 新API调用失败，回退到标签选择器:",e.message)}}else if(replicaSetRef){const a=replicaSetRef.name,l=a.split("-");if(l.length>=2){const a=l.slice(0,-1).join("-");console.log("🔍 [Pod详情页面] 从ReplicaSet推断Deployment名称:",a);try{t=await ce.getWorkloadPods(u.clusterId,u.namespace,"deployment",a),s=!0}catch(e){console.log("⚠️ 推断的Deployment名称无效，回退到标签选择器:",e.message)}}}s||(console.log("🔍 [Pod详情页面] 使用旧API - 标签选择器:",l),t=await ce.getPodList(u.clusterId,u.namespace,{labelSelector:l})),console.log("📡 Pod列表API响应:",t);const i=t.data||t;if(console.log("📊 Pod列表响应数据:",i),200===i.code||i.success){let e=[];s?(e=i.data||[],console.log("📋 [新API] 获取到Pod列表:",e.length,"个")):(e=i.data?.pods||i.data||[],console.log("📋 [旧API] 获取到Pod列表:",e.length,"个")),console.log("📋 原始Pod数据:",e),console.log("📊 Pod数量:",e.length),g.value=e.map(e=>({name:e.name,status:e.status||e.phase||"Unknown",restartCount:s?e.restarts||e.restartCount||0:e.restartCount||0,nodeName:e.nodeName||"Unknown",podIP:e.podIP||e.status?.podIP||("Pending"===e.status?"等待分配":"Terminating"===e.status?"已释放":"Unknown"),hostIP:e.hostIP||e.status?.hostIP||"Unknown",age:s&&e.age||pe(e.createdAt),runningTime:e.runningTime||"",containers:e.containers||[],resources:e.resources||{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:e.labels||{},conditions:e.conditions||[],rawData:e})),console.log(`✅ 成功获取 ${g.value.length} 个相关Pod`),g.value.length>0&&!V.value&&(V.value=g.value[0].name,console.log("🔄 自动选择第一个Pod用于日志:",V.value),setTimeout(()=>{be()},100))}else console.log("❌ 获取Pod列表失败:",i.message),g.value=[{name:u.podName,status:p.value.status||p.value.phase||"Unknown",restartCount:p.value.restartCount||0,nodeName:p.value.spec?.nodeName||"Unknown",podIP:p.value.podIP||p.value.status?.podIP||("Pending"===p.value.status?"等待分配":"Terminating"===p.value.status?"已释放":"Unknown"),hostIP:p.value.hostIP||p.value.status?.hostIP||"Unknown",age:pe(p.value.metadata?.creationTimestamp),runningTime:p.value.runningTime||"",containers:m.value||p.value.spec?.containers||[],resources:{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:p.value.metadata?.labels||{},conditions:p.value.status?.conditions||[],rawData:p.value}]}catch(e){console.error("❌ 获取相关Pod失败:",e),g.value=[{name:u.podName,status:p.value.status||p.value.phase||"Unknown",restartCount:p.value.restartCount||0,nodeName:p.value.spec?.nodeName||"Unknown",podIP:p.value.podIP||p.value.status?.podIP||("Pending"===p.value.status?"等待分配":"Terminating"===p.value.status?"已释放":"Unknown"),hostIP:p.value.hostIP||p.value.status?.hostIP||"Unknown",age:pe(p.value.metadata?.creationTimestamp),runningTime:p.value.runningTime||"",containers:p.value.spec?.containers||[],resources:{requests:{cpu:"",memory:""},limits:{cpu:"",memory:""}},labels:p.value.metadata?.labels||{},conditions:p.value.status?.conditions||[],rawData:p.value}]}g.value.length>0&&!V.value&&(V.value=g.value[0].name,console.log("🔄 自动选择第一个Pod用于日志:",V.value),setTimeout(()=>{be()},100))},pe=e=>{if(!e)return"Unknown";const a=new Date,t=new Date(e),l=Math.floor((a-t)/1e3);return l<60?`${l}s`:l<3600?`${Math.floor(l/60)}m`:l<86400?`${Math.floor(l/3600)}h`:`${Math.floor(l/86400)}d`},me=async()=>{try{console.log("开始获取事件数据..."),console.log("请求参数:",{clusterId:u.clusterId,namespace:u.namespace,podName:u.podName});const a=new Date(Date.now()-36e5);console.log("过滤时间: 最近1小时内的事件 (从",a.toISOString(),"开始)"),console.log("构建事件查询参数...");const t=u.podName;let l="",s="";if(t.includes("-")){const e=t.split("-");e.length>=3&&(l=e.slice(0,-2).join("-"),s=e.slice(0,-1).join("-"))}console.log("推断的资源名称:",{podName:t,replicaSetName:s,deploymentName:l});const o={kind:"Pod",name:t,limit:100};console.log("事件API查询参数:",o);const n=await ce.getClusterEvents(u.clusterId,o),i=n.data||n;if(console.log("事件API完整响应结构:",{success:!!i,code:i.code,dataType:typeof i.data,hasEvents:!!i.data?.events,eventsLength:i.data?.events?.length||0,total:i.data?.total,namespace:i.data?.namespace}),200===i.code){let t=i.data?.events||[];if(console.log("Pod事件数据:",{count:t.length,total:i.data?.total,namespace:i.data?.namespace}),0===t.length&&(l||s)){if(console.log("未找到Pod事件，尝试获取相关资源事件..."),l)try{const e={kind:"Deployment",name:l,limit:50},a=await ce.getClusterEvents(u.clusterId,e);if(200===a.data?.code){const e=a.data?.data?.events||[];t=t.concat(e),console.log(`添加了 ${e.length} 个Deployment事件`)}}catch(e){console.log("获取Deployment事件失败:",e.message)}if(s)try{const e={kind:"ReplicaSet",name:s,limit:50},a=await ce.getClusterEvents(u.clusterId,e);if(200===a.data?.code){const e=a.data?.data?.events||[];t=t.concat(e),console.log(`添加了 ${e.length} 个ReplicaSet事件`)}}catch(e){console.log("获取ReplicaSet事件失败:",e.message)}}if(console.log("处理后的事件数据结构检查:"),t.length>0){const e=t[0];console.log("第一个事件的字段:",Object.keys(e)),console.log("事件示例:",{type:e.type,reason:e.reason,message:e.message,source:e.source,count:e.count,firstTime:e.firstTime,lastTime:e.lastTime})}else console.log("没有获取到任何相关事件数据");const o=u.podName.split("-");console.log("Pod名称分析:",{fullName:u.podName,parts:o,partsCount:o.length});const n=[];if(n.push({name:u.podName,kind:"Pod",pattern:"exact_pod"}),o.length>=3){const e=o.slice(0,-1).join("-");if(n.push({name:e,kind:"ReplicaSet",pattern:"replicaset_inferred"}),o.length>=4){const e=o.slice(0,-2).join("-");n.push({name:e,kind:"Deployment",pattern:"deployment_inferred"})}}console.log("匹配模式:",n);const r=t.filter(e=>{if(!e.involvedObject||!e.involvedObject.name||!e.involvedObject.kind)return!1;const t=e.involvedObject,l=new Date(e.lastTimestamp||e.lastTime||e.firstTimestamp||0);if(l<a)return!1;if(t.namespace!==u.namespace)return!1;const s=n.some(e=>"exact_pod"===e.pattern?t.name===e.name&&"Pod"===t.kind:"replicaset_inferred"===e.pattern?t.name===e.name&&"ReplicaSet"===t.kind:"deployment_inferred"===e.pattern?t.name===e.name&&"Deployment"===t.kind:!!t.name.startsWith(e.name)&&["Pod","ReplicaSet","Deployment","Service"].includes(t.kind));return s&&console.log("✅ 匹配事件:",{name:t.name,kind:t.kind,namespace:t.namespace,type:e.type,reason:e.reason,time:l.toLocaleString("zh-CN")}),s});console.log(`过滤结果: ${r.length}/${t.length} 个事件匹配`),r.sort((e,a)=>{const t=new Date(e.lastTimestamp||e.lastTime||e.firstTimestamp||0),l=new Date(a.lastTimestamp||a.lastTime||a.firstTimestamp||0);return l-t}),h.value=t,0===h.value.length?console.log("❌ 未找到相关事件数据"):console.log(`✅ 成功加载 ${h.value.length} 个相关事件`)}else console.warn("❌ 获取集群事件API失败:",i),J.nk.error(i.message||"获取事件失败")}catch(e){if(console.error("❌ 获取事件异常:",e),e.response&&404===e.response.status)return console.log("📋 集群暂无事件数据，这是正常情况"),void(h.value=[]);J.nk.error("获取事件失败: "+(e.message||"网络连接异常"))}},ge=()=>{if(console.log("尝试直接显示Pod详情中的事件数据"),console.log("podDetail.value:",p.value),p.value.events&&Array.isArray(p.value.events))h.value=p.value.events,console.log("直接使用Pod详情中的事件数据:",h.value.length,"个事件"),J.nk.success(`已加载 ${h.value.length} 个事件`);else{const e=["events","eventList","podEvents","conditions"];let a=!1;for(const t of e)if(p.value[t]&&Array.isArray(p.value[t])){h.value=p.value[t],console.log(`在 ${t} 字段找到事件数据:`,h.value.length,"个"),J.nk.success(`从 ${t} 字段加载了 ${h.value.length} 个事件`),a=!0;break}a||(console.log("Pod详情中未找到任何事件数据"),console.log("Pod详情的所有字段:",Object.keys(p.value)),J.nk.warning("Pod详情中未找到事件数据"))}},ve=async()=>{try{console.log("📋 开始获取历史版本数据..."),console.log("Pod详情数据:",p.value);const t=p.value.metadata?.ownerReferences||p.value.spec?.ownerReferences||p.value.ownerReferences||[];console.log("Pod ownerReferences:",t);const l=t.find(e=>"ReplicaSet"===e.kind),s=t.find(e=>"Deployment"===e.kind);if(console.log("识别的控制器:",{hasReplicaSet:!!l,hasDeployment:!!s,replicaSetName:l?.name,deploymentName:s?.name}),s){console.log("🔍 [历史版本] 获取Deployment历史版本:",s.name),console.log("🔍 [历史版本] 调用getWorkloadDetail API");try{const e=await ce.getWorkloadDetail(u.clusterId,u.namespace,"deployment",s.name),a=e.data||e;if(console.log("Deployment详情API响应:",{success:200===a.code,hasRevisionHistory:!!a.data?.revisionHistory,historyLength:a.data?.revisionHistory?.length||0}),200!==a.code||!a.data?.revisionHistory)throw new Error("Deployment API返回失败或无历史版本数据");k.value=a.data.revisionHistory.map((e,t)=>({revision:e.revision||t+1,creationTime:e.creationTime||e.createdAt,replicas:e.replicas||a.data.replicas||1,description:`Deployment: ${s.name} - Rev ${e.revision||t+1}`,changeDescription:e.changeDescription||e.description,image:e.image,status:e.status||"Active"})),console.log("✅ 获取到Deployment历史版本:",k.value.length,"个版本")}catch(e){console.log("⚠️  获取Deployment详情失败，生成基础版本信息"),k.value=[{revision:1,creationTime:p.value.createdAt||p.value.creationTimestamp,replicas:1,description:`Deployment: ${s.name} (详情获取失败)`,status:"Current"}]}}else if(l){console.log("📝 生成ReplicaSet版本信息:",l.name),console.log("🔍 [历史版本] 调用getWorkloadDetail API - ReplicaSet");try{const e=await ce.getWorkloadDetail(u.clusterId,u.namespace,"replicaset",l.name),a=e.data||e;if(200!==a.code||!a.data)throw new Error("ReplicaSet API返回失败");k.value=[{revision:1,creationTime:a.data.createdAt||a.data.creationTimestamp,replicas:a.data.replicas||1,description:`ReplicaSet: ${l.name}`,image:a.data.containers?.[0]?.image,status:"Active"}]}catch(a){console.log("⚠️  获取ReplicaSet详情失败，使用基础信息"),k.value=[{revision:1,creationTime:p.value.createdAt||p.value.creationTimestamp,replicas:1,description:`ReplicaSet: ${l.name} (详情获取失败)`,status:"Current"}]}}else console.log("🔹 独立Pod，显示Pod自身信息"),k.value=[{revision:1,creationTime:p.value.createdAt||p.value.creationTimestamp,replicas:1,description:`独立Pod: ${u.podName}`,image:m.value?.[0]?.image,status:p.value.status||p.value.phase||"Unknown"}];console.log("✅ 历史版本数据处理完成:",k.value)}catch(t){console.error("❌ 获取历史版本异常:",t),k.value=[{revision:1,creationTime:p.value.createdAt||p.value.creationTimestamp||(new Date).toISOString(),replicas:1,description:`当前Pod: ${u.podName} (历史版本获取失败)`,status:"Current",error:t.message}],J.nk.warning("历史版本获取失败，显示当前Pod信息")}},he=async e=>{console.log("🔄 点击日志按钮，切换到日志标签页"),console.log("🔍 传入的pod参数:",e),console.log("🔍 当前allRelatedPods数量:",g.value.length),0===g.value.length&&(console.log("⚠️  allRelatedPods为空，尝试重新获取相关Pod"),await ue()),e&&e.name&&(V.value=e.name,console.log("🔄 选择传入的Pod用于日志:",V.value)),c.value="logs"},ke=e=>{console.log("🔄 选择Pod:",e),V.value=e,e&&be()},be=async()=>{if(!V.value)return void J.nk.warning("请先选择Pod");console.log("🔄 开始刷新日志..."),console.log("🔍 selectedContainerForLogs.value:",V.value),console.log("🔍 allRelatedPods.value:",g.value.map(e=>e.name));const e=g.value.find(e=>e.name===V.value);if(!e)return console.error("❌ 未找到选中的Pod:",V.value),console.error("❌ 可用的Pod列表:",g.value.map(e=>e.name)),void J.nk.error(`未找到选中的Pod: ${V.value}`);console.log("✅ 找到选中的Pod:",e);const a=e.containers?.[0]?.name;if(!a)return console.error("❌ Pod中未找到容器:",e),console.error("❌ containers字段:",e.containers),void J.nk.error(`Pod "${V.value}" 中未找到容器`);console.log("✅ 找到第一个容器:",a);try{R.value=!0,console.log("🔍 获取Pod日志:",{podName:V.value,container:a,tailLines:S.value,previous:P.value,follow:I.value});const e={container:a};e.tailLines=S.value||1e3,P.value&&(e.previous=!0),I.value&&(e.follow=!0);const t=await ce.getPodLogs(u.clusterId,u.namespace,V.value,e),l=t.data||t;if(console.log("日志API响应:",{success:200===l.code,dataLength:l.data?.length||0,dataType:typeof l.data}),200===l.code){const e=l.data?.logs||l.data||"";console.log("📋 日志数据结构解析:",{hasDataLogs:!!l.data?.logs,hasDirectData:!!l.data&&"string"===typeof l.data,logDataType:typeof e,logDataLength:e?.length||0}),A.value=e,D.value=new Date;const a=A.value.split("\n").length;console.log("✅ 日志获取成功:",a,"行"),console.log("📄 日志内容预览:",A.value.substring(0,200)+"..."),A.value.trim()?console.log(`✅ 日志加载成功，共 ${a} 行`):(J.nk.info("该容器暂无日志输出"),A.value="# 该容器暂无日志输出\n# Container has no log output")}else console.error("❌ 日志API返回错误:",l.message),J.nk.error(l.message||"获取容器日志失败"),A.value=""}catch(t){console.error("❌ 获取容器日志异常:",t),404===t.response?.status?(J.nk.error("容器不存在或日志不可用"),A.value="# 容器不存在或日志不可用\n# Container not found or logs not available"):400===t.response?.status?(J.nk.error("日志参数错误，请检查容器状态"),A.value="# 日志参数错误\n# Invalid log parameters"):(J.nk.error("获取日志失败: "+(t.message||"网络连接异常")),A.value="# 日志获取失败\n# Failed to retrieve logs\n# Error: "+(t.message||"Network error"))}finally{R.value=!1}},fe=()=>{if(V.value)if(A.value)try{const e=`# Container Logs\n# Pod: ${u.podName}\n# Namespace: ${u.namespace}\n# Container: ${V.value}\n# Generated: ${(new Date).toLocaleString("zh-CN")}\n# Lines: Last ${S.value||1e3} lines\n# Previous: ${P.value?"Yes":"No"}\n\n${A.value}`,a=new Blob([e],{type:"text/plain;charset=utf-8"}),t=window.URL.createObjectURL(a),l=document.createElement("a"),s=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,-5),o=`${u.podName}_${V.value}_${s}.log`;l.href=t,l.download=o,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(t),J.nk.success(`日志文件已下载: ${o}`),console.log("✅ 日志下载成功:",o)}catch(e){console.error("❌ 日志下载失败:",e),J.nk.error("日志下载失败: "+e.message)}else J.nk.warning("请先获取日志");else J.nk.warning("请先选择Pod")},ye=async()=>{try{d.value=!0,console.log("🔍 开始获取YAML内容..."),console.log("请求参数:",{clusterId:u.clusterId,namespace:u.namespace,podName:u.podName});const e=await ce.getPodYaml(u.clusterId,u.namespace,u.podName),a=e.data||e;if(console.log("YAML API响应结构:",{hasResponse:!!a,code:a.code,hasData:!!a.data,dataType:typeof a.data,dataLength:a.data?.length||0}),200===a.code){const e=a.data||"";f.value="string"===typeof e?e:"object"===typeof e?JSON.stringify(e,null,2):String(e),console.log("YAML内容检查:",{contentLength:f.value.length,firstLine:f.value.split("\n")[0],isString:"string"===typeof f.value,isEmpty:""===f.value.trim()}),f.value&&f.value.trim()?(M.yamlVisible=!0,console.log("✅ YAML内容获取成功，打开对话框"),J.nk.success("YAML内容加载成功")):(console.log("⚠️ YAML内容为空"),J.nk.warning("YAML内容为空，可能Pod资源不存在"))}else console.log("❌ YAML API返回错误:",a),J.nk.error(a.message||"获取YAML内容失败")}catch(e){if(console.error("❌ 获取YAML内容异常:",e),e.response){const a=e.response.status,t=e.response.statusText;switch(console.log("HTTP错误详情:",{status:a,statusText:t,data:e.response.data}),a){case 404:J.nk.error("Pod不存在或已被删除");break;case 403:J.nk.error("没有权限访问该Pod的YAML");break;case 500:J.nk.error("服务器内部错误，请稍后重试");break;default:J.nk.error(`获取YAML失败: ${a} ${t}`)}}else e.request?(console.log("网络请求错误:",e.request),J.nk.error("网络连接失败，请检查网络连接")):(console.log("其他错误:",e.message),J.nk.error("获取YAML内容失败: "+e.message))}finally{d.value=!1}},_e=async e=>{try{d.value=!0,console.log("🔍 开始获取Pod YAML内容用于编辑...",e.name);const a=u.clusterId,t=e.namespace||u.namespace,l=e.name;console.log("请求参数:",{clusterId:a,namespace:t,podName:l});const s=await ce.getPodYaml(a,t,l),o=s.data||s;if(200===o.code){const e=o.data||"";f.value="string"===typeof e?e:"object"===typeof e?JSON.stringify(e,null,2):String(e),M.yamlVisible=!0,console.log("✅ YAML内容加载成功，打开编辑对话框")}else console.error("❌ 获取YAML内容失败:",o),J.nk.error(o.message||"获取YAML内容失败")}catch(a){console.error("❌ 获取YAML内容异常:",a),J.nk.error("获取YAML内容失败: "+(a.message||"网络连接异常"))}finally{d.value=!1}},we=()=>{E.replicas=p.value.replicas||1,M.scaleVisible=!0},Le=e=>{W.targetVersion=e.revision,W.versionInfo=e,M.rollbackVisible=!0},Fe=async()=>{if(!W.targetVersion)return void J.nk.error("请选择回滚版本");const e=p.value.metadata?.ownerReferences||p.value.spec?.ownerReferences||p.value.ownerReferences||[];console.log("🔍 [回滚] 检查ownerReferences:",e);let a=e.find(e=>"Deployment"===e.kind),t=null;if(a)t=a.name,console.log("✅ [回滚] 找到直接的Deployment:",t);else{const a=e.find(e=>"ReplicaSet"===e.kind);if(a){const e=a.name.split("-");e.length>=2&&(t=e.slice(0,-1).join("-"),console.log("✅ [回滚] 从ReplicaSet推断Deployment:",t))}}if(!t){const e=u.podName.split("-");e.length>=3&&(t=e.slice(0,-2).join("-"),console.log("✅ [回滚] 从Pod名称推断Deployment:",t))}if(t)try{z.value=!0,console.log(`🔄 开始回滚Deployment ${t} 到版本 ${W.targetVersion}`);const e={revision:W.targetVersion},a=await ce.rollbackDeployment(u.clusterId,u.namespace,t,e),l=a.data||a;if(200!==l.code)throw new Error(l.message||"回滚失败");J.nk.success(`成功回滚到版本 ${W.targetVersion}`),M.rollbackVisible=!1,await de(!0)}catch(l){console.error("❌ 回滚失败:",l),J.nk.error(l.message||"回滚操作失败")}finally{z.value=!1}else J.nk.error("无法找到关联的Deployment，无法执行回滚")},Ce=async e=>{N.value=e,M.monitoringVisible=!0,await Ve(e)},Ve=async e=>{U.value=!0;try{console.log("🔍 加载Pod监控数据:",e.name);const a=await ce.getPodMetrics(u.clusterId,u.namespace,e.name),t=a.data||a;if(200===t.code&&t.data){const e=t.data;K.value={cpu:{used:e.totalUsage?.cpu||"0m",limit:e.resourceQuota?.cpu||"1000m",percentage:Math.round(e.usageRate?.cpuRate||0)},memory:{used:e.totalUsage?.memory||"0Mi",limit:e.resourceQuota?.memory||"512Mi",percentage:Math.round(e.usageRate?.memoryRate||0)},network:{rx:"0KB/s",tx:"0KB/s"},disk:{used:"0GB",limit:"10GB",percentage:0},containers:e.containers||[],timestamp:e.timestamp},console.log("✅ 监控数据加载完成:",K.value)}else console.warn("⚠️ 监控API返回异常，使用模拟数据:",t.message),await xe(e)}catch(a){console.warn("⚠️ 监控API调用失败，使用模拟数据:",a),await xe(e)}finally{U.value=!1}},xe=async e=>{const a={cpu:{used:Math.floor(500*Math.random())+100+"m",limit:"1000m",percentage:Math.floor(80*Math.random())+10},memory:{used:Math.floor(200*Math.random())+50+"Mi",limit:"512Mi",percentage:Math.floor(70*Math.random())+15},network:{rx:Math.floor(100*Math.random())+10+"KB/s",tx:Math.floor(50*Math.random())+5+"KB/s"},disk:{used:(5*Math.random()+1).toFixed(2)+"GB",limit:"10GB",percentage:Math.floor(60*Math.random())+10},containers:e.containers?.map(e=>({name:e.name,usage:{cpu:Math.floor(300*Math.random())+50+"m",memory:Math.floor(200*Math.random())+50+"Mi"},usageRate:{cpuRate:Math.floor(60*Math.random())+15,memoryRate:Math.floor(70*Math.random())+10},state:e.state||"Running"}))||[],timestamp:(new Date).toISOString()};K.value=a,console.log("✅ 模拟监控数据加载完成:",a)},Se=async()=>{try{if(d.value=!0,console.log("💾 开始保存YAML内容..."),!f.value||!f.value.trim())return void J.nk.warning("YAML内容不能为空");try{if(!f.value.includes("apiVersion")||!f.value.includes("kind"))return void J.nk.warning("YAML格式不正确，缺少必要的apiVersion或kind字段")}catch(e){return void J.nk.error("YAML格式错误: "+e.message)}console.log("使用kubectl apply方式更新资源...");const a=await ce.applyYaml(u.clusterId,f.value),t=a.data||a;200===t.code?(J.nk.success("YAML保存成功！"),M.yamlVisible=!1,console.log("⚡ 刷新页面数据..."),await loadPodDetail(),await ue(),console.log("✅ YAML保存并刷新完成")):(console.error("❌ 保存YAML失败:",t),J.nk.error(t.message||"保存YAML失败"))}catch(a){console.error("❌ 保存YAML异常:",a),a.response&&404===a.response.status?J.nk.error("kubectl apply接口未实现，请联系管理员"):J.nk.error("保存YAML失败: "+(a.message||"网络连接异常"))}finally{d.value=!1}},Ie=e=>{X.value=e,J.nk.success("正在跳转到终端页面..."),t.push({path:`/k8s/terminal/${u.clusterId}/${u.namespace}/${u.podName}`,query:{container:e.name||e}})},Ae=async e=>{const a=e||{name:u.podName};try{await uv.s.confirm(`确定要删除Pod "${a.name}" 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),d.value=!0;const e=await ce.deletePod(u.clusterId,u.namespace,a.name),t=e.data||e;200===t.code?(J.nk.success(`Pod "${a.name}" 删除成功`),a.name===u.podName?He():de(!0)):J.nk.error(t.message||"Pod删除失败")}catch(t){"cancel"!==t&&(console.error("Pod删除失败:",t),J.nk.error("Pod删除失败，请检查网络连接"))}finally{d.value=!1}},Re=e=>{const a={Running:"success",Pending:"warning",Failed:"danger",Succeeded:"success",Unknown:"info"};return a[e]||"info"},De=e=>e?new Date(e).toLocaleString("zh-CN"):"-",Pe=(e,a="已复制到剪贴板")=>{navigator.clipboard.writeText(e).then(()=>{J.nk.success(a)}).catch(()=>{J.nk.error("复制失败")})},$e=()=>{if(!y.value.trim())return _.value=[],void(w.value=-1);const e=y.value.toLowerCase(),a=f.value,t=a.split("\n");_.value=[],t.forEach((a,t)=>{const l=a.toLowerCase();let s=0;while(1){const o=l.indexOf(e,s);if(-1===o)break;_.value.push({lineIndex:t,lineNumber:t+1,matchIndex:o,line:a,preview:a.trim()}),s=o+e.length}}),w.value=_.value.length>0?0:-1,_.value.length>0?J.nk.success(`找到 ${_.value.length} 个匹配项`):J.nk.info("未找到匹配内容")},Te=()=>{0!==_.value.length&&(w.value=w.value<=0?_.value.length-1:w.value-1,Ee())},Me=()=>{0!==_.value.length&&(w.value=w.value>=_.value.length-1?0:w.value+1,Ee())},Ee=()=>{if(-1===w.value||0===_.value.length)return;const e=_.value[w.value];console.log("📍 跳转到搜索结果:",e.lineNumber,"行"),(0,r.dY)(()=>{const a=document.querySelector(".yaml-dialog .code-editor__textarea");if(a){f.value.split("\n");const t=e.lineIndex,l=21,s=t*l;a.scrollTop=Math.max(0,s-100)}})},We=()=>{y.value="",_.value=[],w.value=-1},ze=()=>{if(!L.value.trim())return F.value=[],void(C.value=-1);const e=L.value.toLowerCase(),a=A.value,t=a.split("\n");F.value=[],t.forEach((a,t)=>{const l=a.toLowerCase();let s=0;while(1){const o=l.indexOf(e,s);if(-1===o)break;F.value.push({lineIndex:t,lineNumber:t+1,matchIndex:o,line:a,preview:a.trim()}),s=o+e.length}}),C.value=F.value.length>0?0:-1,F.value.length>0?(J.nk.success(`找到 ${F.value.length} 个匹配项`),Ue()):J.nk.info("未找到匹配内容")},Ne=()=>{0!==F.value.length&&(C.value=C.value<=0?F.value.length-1:C.value-1,Ue())},Ke=()=>{0!==F.value.length&&(C.value=C.value>=F.value.length-1?0:C.value+1,Ue())},Ue=()=>{if(-1===C.value||0===F.value.length)return;const e=F.value[C.value];console.log("📍 跳转到日志搜索结果:",e.lineNumber,"行"),(0,r.dY)(()=>{const a=document.querySelector(".logs-tab-content .code-editor__textarea");if(a){const t=e.lineIndex,l=21,s=t*l;a.scrollTop=Math.max(0,s-100)}})},Xe=()=>{L.value="",F.value=[],C.value=-1},qe=()=>{try{if(console.log("🔧 从Pod详情生成YAML..."),console.log("Pod详情数据:",p.value),!p.value||0===Object.keys(p.value).length)return void J.nk.warning("Pod详情数据为空，无法生成YAML");const e={apiVersion:"v1",kind:"Pod",metadata:{name:u.podName,namespace:u.namespace,labels:p.value.labels||{},annotations:p.value.annotations||{}},spec:{containers:(m.value||[]).map(e=>({name:e.name,image:e.image,ports:e.ports||[],env:e.env||[],resources:e.resources||{},volumeMounts:e.volumeMounts||[]})),volumes:p.value.volumes||[],restartPolicy:p.value.spec?.restartPolicy||"Always",nodeName:p.value.nodeName,serviceAccount:p.value.spec?.serviceAccount,serviceAccountName:p.value.spec?.serviceAccountName,nodeSelector:p.value.spec?.nodeSelector||{},tolerations:p.value.spec?.tolerations||[],affinity:p.value.spec?.affinity},status:{phase:p.value.status||p.value.phase,podIP:p.value.podIP,hostIP:p.value.hostIP,startTime:p.value.startTime||p.value.createdAt,conditions:p.value.conditions||[]}},a=e=>{if(Array.isArray(e))return e.map(a).filter(e=>void 0!==e);if(null!==e&&"object"===typeof e){const t={};return Object.keys(e).forEach(l=>{const s=a(e[l]);void 0===s||null===s||""===s||Array.isArray(s)&&0===s.length||"object"===typeof s&&0===Object.keys(s).length||(t[l]=s)}),Object.keys(t).length>0?t:void 0}return e},t=a(e),l=`# Pod YAML (从详情生成)\n# 名称: ${u.podName}\n# 命名空间: ${u.namespace}\n# 生成时间: ${(new Date).toLocaleString("zh-CN")}\n\napiVersion: v1\nkind: Pod\nmetadata:\n  name: ${u.podName}\n  namespace: ${u.namespace}\n  labels:${Object.keys(t.metadata.labels||{}).length>0?Object.entries(t.metadata.labels).map(([e,a])=>`\n    ${e}: ${a}`).join(""):"\n    # No labels"}\nspec:\n  containers:${t.spec.containers.map((e,a)=>`\n  - name: ${e.name}\n    image: ${e.image}${e.ports?.length>0?`\n    ports:${e.ports.map(e=>`\n    - containerPort: ${e.containerPort}\n      protocol: ${e.protocol||"TCP"}`).join("")}`:""}${e.env?.length>0?`\n    env:${e.env.map(e=>`\n    - name: ${e.name}\n      value: ${e.value||e.valueFrom?JSON.stringify(e.valueFrom):""}`).join("")}`:""}`).join("")}\n  restartPolicy: ${t.spec.restartPolicy||"Always"}${t.spec.nodeName?`\n  nodeName: ${t.spec.nodeName}`:""}${Object.keys(t.spec.nodeSelector||{}).length>0?`\n  nodeSelector:${Object.entries(t.spec.nodeSelector).map(([e,a])=>`\n    ${e}: ${a}`).join("")}`:""}\nstatus:\n  phase: ${t.status.phase||"Unknown"}${t.status.podIP?`\n  podIP: ${t.status.podIP}`:""}${t.status.hostIP?`\n  hostIP: ${t.status.hostIP}`:""}${t.status.startTime?`\n  startTime: ${t.status.startTime}`:""}\n`;T.value?($.value=l,console.log("✅ YAML标签页内容生成成功")):(f.value=l,M.yamlVisible=!0,J.nk.success("YAML已从Pod详情生成"),console.log("✅ YAML对话框生成成功"))}catch(e){console.error("❌ 生成YAML失败:",e),J.nk.error("生成YAML失败: "+e.message)}},He=()=>{t.back()};return(e,a)=>{const t=(0,r.g2)("el-button"),m=(0,r.g2)("el-descriptions-item"),v=(0,r.g2)("el-tag"),le=(0,r.g2)("el-descriptions"),se=(0,r.g2)("el-card"),oe=(0,r.g2)("el-col"),ne=(0,r.g2)("el-row"),ie=(0,r.g2)("el-table-column"),re=(0,r.g2)("el-table"),ce=(0,r.g2)("el-tab-pane"),ue=(0,r.g2)("el-empty"),pe=(0,r.g2)("el-option"),xe=(0,r.g2)("el-select"),Ee=(0,r.g2)("el-checkbox"),Ue=(0,r.g2)("el-input"),qe=(0,r.g2)("el-button-group"),Be=(0,r.g2)("el-text"),je=(0,r.g2)("el-tabs"),Oe=(0,r.g2)("el-dialog"),Qe=(0,r.g2)("el-input-number"),Ge=(0,r.g2)("el-form-item"),Ye=(0,r.g2)("el-form"),Je=(0,r.g2)("el-alert"),Ze=(0,r.g2)("el-progress"),ea=(0,r.gN)("authority"),aa=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",YF,[(0,r.bF)(se,{shadow:"hover",class:"pod-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",JF,[(0,r.Lk)("div",ZF,[(0,r.bF)(t,{type:"success",icon:(0,Y.R1)(vc.ArrowLeft),size:"small",onClick:He},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("返回",-1)])),_:1,__:[26]},8,["icon"]),(0,r.Lk)("span",eC,"容器详情 - "+(0,x.v_)(ee.value),1)]),(0,r.Lk)("div",aC,[(0,r.bF)(t,{type:"success",icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:a[0]||(a[0]=()=>de(!0))},{default:(0,r.k6)(()=>a[27]||(a[27]=[(0,r.eW)("刷新",-1)])),_:1,__:[27]},8,["icon"]),(0,r.bF)(t,{type:"primary",icon:(0,Y.R1)(vc.View),size:"small",onClick:ye},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)("查看YAML",-1)])),_:1,__:[28]},8,["icon"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",tC,[(0,r.bF)(ne,{gutter:24},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(se,{class:"info-card",header:"基本信息"},{default:(0,r.k6)(()=>[(0,r.bF)(le,{column:1,border:"",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(ee.value),1)]),_:1}),(0,r.bF)(m,{label:"命名空间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(u.namespace),1)]),_:1}),(0,r.bF)(m,{label:"节点选择器"},{default:(0,r.k6)(()=>[p.value.spec?.nodeSelector&&Object.keys(p.value.spec.nodeSelector).length>0?((0,r.uX)(),(0,r.CE)("div",lC,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(p.value.spec.nodeSelector,(e,a)=>((0,r.uX)(),(0,r.Wv)(v,{key:a,size:"small",style:{margin:"2px"},onClick:t=>Pe(`${a}=${e}`,"节点选择器已复制")},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128))])):((0,r.uX)(),(0,r.CE)("span",sC,"-"))]),_:1}),(0,r.bF)(m,{label:"标签"},{default:(0,r.k6)(()=>[Object.keys(B.value).length>0?((0,r.uX)(),(0,r.CE)("div",oC,[(0,r.Lk)("div",nC,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(Q.value,(e,a)=>((0,r.uX)(),(0,r.Wv)(v,{key:a,size:"small",style:{margin:"2px"},onClick:t=>Pe(`${a}=${e}`,"标签已复制")},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+"="+(0,x.v_)(e),1)]),_:2},1032,["onClick"]))),128)),G.value?((0,r.uX)(),(0,r.Wv)(t,{key:0,type:"text",size:"small",onClick:ae,style:{"margin-left":"8px",color:"#409eff"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(q.value?"折叠":`展开 (+${Z.value})`),1)]),_:1})):(0,r.Q3)("",!0)])])):((0,r.uX)(),(0,r.CE)("span",iC,"-"))]),_:1})]),_:1})]),_:1})]),_:1}),(0,r.bF)(oe,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(se,{class:"info-card",header:"状态信息"},{default:(0,r.k6)(()=>[(0,r.bF)(le,{column:1,border:"",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(De(j.value)),1)]),_:1}),(0,r.bF)(m,{label:"重启策略"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(p.value.spec?.restartPolicy||"-"),1)]),_:1}),(0,r.bF)(m,{label:"运行时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o(p.value.runningTime)),1)]),_:1}),(0,r.bF)(m,{label:"期望Pod数量"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(O.value),1)]),_:1}),(0,r.bF)(m,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:Re(H.value),effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(H.value),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),(0,r.Lk)("div",rC,[(0,r.bF)(je,{modelValue:c.value,"onUpdate:modelValue":a[9]||(a[9]=e=>c.value=e),type:"border-card",onTabChange:te},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{label:"容器组",name:"containers"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(re,{data:g.value,stripe:"",style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{prop:"name",label:"Pod名称","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",dC,[a[29]||(a[29]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon",width:"16",height:"16"},null,-1)),(0,r.Lk)("span",cC,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(ie,{prop:"status",label:"状态","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:l(e.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ie,{prop:"restartCount",label:"重启次数","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{size:"small",type:e.restartCount>0?"warning":"success"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.restartCount),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ie,{label:"监控","min-width":"60",align:"center"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(t,{icon:(0,Y.R1)(vc.Monitor),size:"small",circle:"",type:"primary",onClick:a=>Ce(e),title:"查看监控"},null,8,["icon","onClick"])]),_:1}),(0,r.bF)(ie,{prop:"nodeName",label:"节点","min-width":"150"}),(0,r.bF)(ie,{prop:"podIP",label:"Pod IP","min-width":"120"}),(0,r.bF)(ie,{prop:"age",label:"运行时间","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",uC,[(0,r.bF)(v,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.age),1)]),_:2},1024),e.runningTime?((0,r.uX)(),(0,r.CE)("div",pC," 运行: "+(0,x.v_)(o(e.runningTime)),1)):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(ie,{label:"操作","min-width":"380",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",mC,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{size:"small",type:"warning",icon:(0,Y.R1)(vc.Edit),onClick:a=>_e(e)},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("YAML编辑",-1)])),_:2,__:[30]},1032,["icon","onClick"])),[[ea,["k8s:workload:edityaml"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{size:"small",type:"primary",icon:(0,Y.R1)(vc.Document),onClick:a=>he(e)},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("日志",-1)])),_:2,__:[31]},1032,["icon","onClick"])),[[ea,["k8s:workload:podlog"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{size:"small",type:"success",onClick:a=>Ie(e)},{default:(0,r.k6)(()=>a[32]||(a[32]=[(0,r.Lk)("img",{src:GF,alt:"terminal",class:"custom-icon"},null,-1),(0,r.eW)(" 终端 ",-1)])),_:2,__:[32]},1032,["onClick"])),[[ea,["k8s:workload:terminal"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{size:"small",type:"danger",icon:(0,Y.R1)(vc.Delete),onClick:a=>Ae(e)},{default:(0,r.k6)(()=>a[33]||(a[33]=[(0,r.eW)("删除",-1)])),_:2,__:[33]},1032,["icon","onClick"])),[[ea,["k8s:workload:poddelete"]]])])]),_:1})]),_:1},8,["data"])),[[aa,d.value]])]),_:1}),(0,r.bF)(ce,{label:"历史版本",name:"history"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(re,{data:k.value,stripe:"",style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{prop:"revision",label:"版本","min-width":"80"}),(0,r.bF)(ie,{prop:"description",label:"描述","min-width":"250"}),(0,r.bF)(ie,{prop:"status",label:"状态","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:Re(e.status),effect:"dark",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.status),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ie,{prop:"image",label:"镜像","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",gC,[e.image?((0,r.uX)(),(0,r.CE)("span",vC,(0,x.v_)(e.image),1)):((0,r.uX)(),(0,r.CE)("span",hC,"-"))])]),_:1}),(0,r.bF)(ie,{prop:"replicas",label:"副本数","min-width":"100"}),(0,r.bF)(ie,{prop:"creationTime",label:"创建时间","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(De(e.creationTime)),1)]),_:1}),(0,r.bF)(ie,{prop:"changeDescription",label:"变更描述","min-width":"200"},{default:(0,r.k6)(({row:e})=>[e.changeDescription?((0,r.uX)(),(0,r.CE)("span",kC,(0,x.v_)(e.changeDescription),1)):((0,r.uX)(),(0,r.CE)("span",bC,"-"))]),_:1}),(0,r.bF)(ie,{label:"操作","min-width":"150",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(t,{size:"small",type:"primary",onClick:a=>Le(e)},{default:(0,r.k6)(()=>a[34]||(a[34]=[(0,r.eW)("回滚到此版本",-1)])),_:2,__:[34]},1032,["onClick"])),[[ea,["k8s:workload:rollback_version"]]])]),_:1})]),_:1},8,["data"])),[[aa,d.value]]),d.value||0!==k.value.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",fC,[(0,r.bF)(ue,{description:"暂无历史版本数据"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",yC,[(0,r.bF)(t,{type:"primary",onClick:ve},{default:(0,r.k6)(()=>a[35]||(a[35]=[(0,r.eW)("重新获取历史版本",-1)])),_:1,__:[35]})])]),_:1})]))]),_:1}),(0,r.bF)(ce,{label:"事件",name:"events"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(re,{data:h.value,stripe:"",style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{prop:"type",label:"事件类型","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:"Warning"===e.type?"warning":"success",effect:"dark",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.type),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ie,{label:"来源","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.source||"未知"),1)]),_:1}),(0,r.bF)(ie,{label:"次数","min-width":"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.count||1),1)]),_:2},1024)]),_:1}),(0,r.bF)(ie,{prop:"reason",label:"原因","min-width":"150"}),(0,r.bF)(ie,{prop:"message",label:"消息","min-width":"300"}),(0,r.bF)(ie,{label:"最后时间","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(De(e.lastTime||e.firstTime)),1)]),_:1})]),_:1},8,["data"])),[[aa,d.value]]),d.value||0!==h.value.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",_C,[(0,r.bF)(ue,{description:"暂无事件数据"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",wC,[(0,r.bF)(t,{type:"primary",onClick:me},{default:(0,r.k6)(()=>a[36]||(a[36]=[(0,r.eW)("重新获取事件",-1)])),_:1,__:[36]}),(0,r.bF)(t,{type:"success",onClick:ge,style:{"margin-left":"8px"}},{default:(0,r.k6)(()=>a[37]||(a[37]=[(0,r.eW)("显示Pod详情事件",-1)])),_:1,__:[37]})])]),_:1})]))]),_:1}),(0,r.bF)(ce,{label:"日志",name:"logs"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",LC,[(0,r.Lk)("div",FC,[(0,r.bF)(ne,{gutter:12,style:{"margin-bottom":"16px"}},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(xe,{modelValue:V.value,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value=e),placeholder:"选择Pod",style:{width:"100%"},onChange:ke},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,e=>((0,r.uX)(),(0,r.Wv)(pe,{key:e.name,label:e.name,value:e.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(oe,{span:4},{default:(0,r.k6)(()=>[(0,r.bF)(xe,{modelValue:S.value,"onUpdate:modelValue":a[2]||(a[2]=e=>S.value=e),placeholder:"行数",style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(pe,{label:"最近100行",value:100}),(0,r.bF)(pe,{label:"最近300行",value:300}),(0,r.bF)(pe,{label:"最近500行",value:500}),(0,r.bF)(pe,{label:"最近1000行",value:1e3})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(oe,{span:6},{default:(0,r.k6)(()=>[(0,r.Lk)("div",CC,[(0,r.bF)(Ee,{modelValue:I.value,"onUpdate:modelValue":a[3]||(a[3]=e=>I.value=e)},{default:(0,r.k6)(()=>a[38]||(a[38]=[(0,r.eW)("实时跟踪",-1)])),_:1,__:[38]},8,["modelValue"]),(0,r.bF)(Ee,{modelValue:P.value,"onUpdate:modelValue":a[4]||(a[4]=e=>P.value=e)},{default:(0,r.k6)(()=>a[39]||(a[39]=[(0,r.eW)("上个容器退出日志",-1)])),_:1,__:[39]},8,["modelValue"])])]),_:1}),(0,r.bF)(oe,{span:8},{default:(0,r.k6)(()=>[(0,r.Lk)("div",VC,[(0,r.bF)(Ue,{modelValue:L.value,"onUpdate:modelValue":a[5]||(a[5]=e=>L.value=e),placeholder:"搜索日志...","prefix-icon":(0,Y.R1)(vc.Search),clearable:"",onKeyup:(0,i.jR)(ze,["enter"]),onClear:Xe,size:"small",style:{width:"200px","margin-right":"8px"}},null,8,["modelValue","prefix-icon"]),(0,r.bF)(qe,{size:"small",style:{"margin-right":"8px"}},{default:(0,r.k6)(()=>[(0,r.bF)(t,{type:"warning",icon:(0,Y.R1)(vc.Search),onClick:ze},{default:(0,r.k6)(()=>a[40]||(a[40]=[(0,r.eW)("搜索",-1)])),_:1,__:[40]},8,["icon"]),(0,r.bF)(t,{type:"success",icon:(0,Y.R1)(vc.ArrowUp),onClick:Ne,disabled:0===F.value.length},null,8,["icon","disabled"]),(0,r.bF)(t,{type:"primary",icon:(0,Y.R1)(vc.ArrowDown),onClick:Ke,disabled:0===F.value.length},null,8,["icon","disabled"])]),_:1}),F.value.length>0?((0,r.uX)(),(0,r.Wv)(Be,{key:0,type:"info",size:"small",style:{"margin-right":"12px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(C.value+1)+" / "+(0,x.v_)(F.value.length),1)]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(t,{size:"small",type:"primary",icon:(0,Y.R1)(vc.Refresh),onClick:be,loading:R.value},{default:(0,r.k6)(()=>a[41]||(a[41]=[(0,r.eW)("刷新",-1)])),_:1,__:[41]},8,["icon","loading"]),(0,r.bF)(t,{size:"small",type:"success",icon:(0,Y.R1)(vc.Document),onClick:fe},{default:(0,r.k6)(()=>a[42]||(a[42]=[(0,r.eW)("下载",-1)])),_:1,__:[42]},8,["icon"])])]),_:1})]),_:1})]),(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",xC,[V.value?A.value?((0,r.uX)(),(0,r.CE)("div",AC,[(0,r.Lk)("div",RC,[(0,r.Lk)("span",DC,(0,x.v_)(V.value),1),(0,r.Lk)("span",PC," 最近 "+(0,x.v_)(S.value||1e3)+" 行 • "+(0,x.v_)(De(D.value)),1)]),(0,r.Lk)("div",$C,[(0,r.bF)(ih,{modelValue:A.value,"onUpdate:modelValue":a[6]||(a[6]=e=>A.value=e),language:null,height:"600px",fontSize:"12px",readonly:!0,searchText:L.value,searchResults:F.value,currentSearchIndex:C.value},null,8,["modelValue","searchText","searchResults","currentSearchIndex"])])])):((0,r.uX)(),(0,r.CE)("div",TC,[(0,r.bF)(ue,{description:"该Pod暂无日志数据"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",MC,[(0,r.bF)(t,{type:"primary",onClick:be},{default:(0,r.k6)(()=>a[44]||(a[44]=[(0,r.eW)("重新获取",-1)])),_:1,__:[44]})])]),_:1})])):((0,r.uX)(),(0,r.CE)("div",SC,[(0,r.bF)(ue,{description:"请选择Pod查看日志"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",IC,[(0,r.bF)(Be,{type:"info"},{default:(0,r.k6)(()=>a[43]||(a[43]=[(0,r.eW)("选择上方Pod列表中的Pod开始查看日志",-1)])),_:1,__:[43]})])]),_:1})]))])),[[aa,R.value]])])]),_:1}),(0,r.bF)(ce,{label:"容器伸缩",name:"scale"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",EC,[(0,r.bF)(t,{type:"primary",onClick:we},{default:(0,r.k6)(()=>a[45]||(a[45]=[(0,r.eW)("容器扩缩容",-1)])),_:1,__:[45]})])]),_:1}),(0,r.bF)(ce,{label:"yaml",name:"yaml"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",WC,[(0,r.Lk)("div",zC,[(0,r.bF)(t,{type:"primary",size:"small",icon:(0,Y.R1)(vc.Copy),onClick:a[7]||(a[7]=e=>Pe($.value,"YAML已复制"))},{default:(0,r.k6)(()=>a[46]||(a[46]=[(0,r.eW)("复制YAML",-1)])),_:1,__:[46]},8,["icon"])]),(0,r.bF)(ih,{modelValue:$.value,"onUpdate:modelValue":a[8]||(a[8]=e=>$.value=e),language:"yaml",height:"500px",readonly:!0,fontSize:"12px"},null,8,["modelValue"])])),[[aa,T.value]])]),_:1})]),_:1},8,["modelValue"])])]),_:1}),(0,r.bF)(Oe,{modelValue:M.logsVisible,"onUpdate:modelValue":a[11]||(a[11]=e=>M.logsVisible=e),title:`容器日志 - ${X.value?.name||""}`,width:"80%",class:"logs-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(t,{onClick:a[10]||(a[10]=e=>Pe(b.value,"日志已复制"))},{default:(0,r.k6)(()=>a[47]||(a[47]=[(0,r.eW)("复制日志",-1)])),_:1,__:[47]}),(0,r.bF)(t,{type:"primary",onClick:be},{default:(0,r.k6)(()=>a[48]||(a[48]=[(0,r.eW)("刷新日志",-1)])),_:1,__:[48]})]),default:(0,r.k6)(()=>[(0,r.Lk)("div",NC,[(0,r.Lk)("pre",KC,(0,x.v_)(b.value),1)])]),_:1},8,["modelValue","title"]),(0,r.bF)(Oe,{modelValue:M.yamlVisible,"onUpdate:modelValue":a[15]||(a[15]=e=>M.yamlVisible=e),title:"YAML内容",width:"50%",class:"yaml-dialog",onClosed:We},{footer:(0,r.k6)(()=>[(0,r.bF)(t,{onClick:a[14]||(a[14]=e=>Pe(f.value,"YAML已复制"))},{default:(0,r.k6)(()=>a[50]||(a[50]=[(0,r.eW)("复制YAML",-1)])),_:1,__:[50]}),(0,r.bF)(t,{type:"primary",onClick:Se},{default:(0,r.k6)(()=>a[51]||(a[51]=[(0,r.eW)("保存",-1)])),_:1,__:[51]})]),default:(0,r.k6)(()=>[(0,r.Lk)("div",UC,[(0,r.bF)(ne,{gutter:12,type:"flex",align:"middle"},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(Ue,{modelValue:y.value,"onUpdate:modelValue":a[12]||(a[12]=e=>y.value=e),placeholder:"搜索YAML内容...","prefix-icon":(0,Y.R1)(vc.Search),clearable:"",onKeyup:(0,i.jR)($e,["enter"]),onClear:We,size:"small",style:{width:"280px"}},null,8,["modelValue","prefix-icon"])]),_:1}),(0,r.bF)(oe,{span:8},{default:(0,r.k6)(()=>[(0,r.bF)(qe,{size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{type:"warning",icon:(0,Y.R1)(vc.Search),onClick:$e},{default:(0,r.k6)(()=>a[49]||(a[49]=[(0,r.eW)("搜索",-1)])),_:1,__:[49]},8,["icon"]),(0,r.bF)(t,{type:"success",icon:(0,Y.R1)(vc.ArrowUp),onClick:Te,disabled:0===_.value.length},null,8,["icon","disabled"]),(0,r.bF)(t,{type:"primary",icon:(0,Y.R1)(vc.ArrowDown),onClick:Me,disabled:0===_.value.length},null,8,["icon","disabled"])]),_:1})]),_:1}),(0,r.bF)(oe,{span:8},{default:(0,r.k6)(()=>[_.value.length>0?((0,r.uX)(),(0,r.Wv)(Be,{key:0,type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(w.value+1)+" / "+(0,x.v_)(_.value.length),1)]),_:1})):(0,r.Q3)("",!0)]),_:1})]),_:1})]),(0,r.Lk)("div",XC,[(0,r.bF)(ih,{modelValue:f.value,"onUpdate:modelValue":a[13]||(a[13]=e=>f.value=e),language:"yaml",height:"500px",fontSize:"12px",searchText:y.value,searchResults:_.value,currentSearchIndex:w.value},null,8,["modelValue","searchText","searchResults","currentSearchIndex"])])]),_:1},8,["modelValue"]),(0,r.bF)(Oe,{modelValue:M.scaleVisible,"onUpdate:modelValue":a[19]||(a[19]=e=>M.scaleVisible=e),title:"容器扩缩容",width:"400px"},{footer:(0,r.k6)(()=>[(0,r.bF)(t,{onClick:a[17]||(a[17]=e=>M.scaleVisible=!1)},{default:(0,r.k6)(()=>a[52]||(a[52]=[(0,r.eW)("取消",-1)])),_:1,__:[52]}),(0,r.bF)(t,{type:"primary",onClick:a[18]||(a[18]=e=>(0,Y.R1)(J.nk).success("扩缩容功能开发中"))},{default:(0,r.k6)(()=>a[53]||(a[53]=[(0,r.eW)("确定",-1)])),_:1,__:[53]})]),default:(0,r.k6)(()=>[(0,r.bF)(Ye,{model:E,"label-width":"80px"},{default:(0,r.k6)(()=>[(0,r.bF)(Ge,{label:"副本数"},{default:(0,r.k6)(()=>[(0,r.bF)(Qe,{modelValue:E.replicas,"onUpdate:modelValue":a[16]||(a[16]=e=>E.replicas=e),min:0,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(Oe,{modelValue:M.rollbackVisible,"onUpdate:modelValue":a[21]||(a[21]=e=>M.rollbackVisible=e),title:"回滚确认",width:"500px"},{footer:(0,r.k6)(()=>[(0,r.bF)(t,{onClick:a[20]||(a[20]=e=>M.rollbackVisible=!1)},{default:(0,r.k6)(()=>a[54]||(a[54]=[(0,r.eW)("取消",-1)])),_:1,__:[54]}),(0,r.bF)(t,{type:"danger",loading:z.value,onClick:Fe},{default:(0,r.k6)(()=>a[55]||(a[55]=[(0,r.eW)(" 确认回滚 ",-1)])),_:1,__:[55]},8,["loading"])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",qC,[(0,r.bF)(Je,{title:"回滚操作风险提示",type:"warning",description:"回滚操作将会替换当前运行的版本，请确认您要执行此操作。","show-icon":"",closable:!1,style:{"margin-bottom":"20px"}}),(0,r.bF)(le,{title:"回滚详情",column:1,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"目标版本"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(W.targetVersion),1)]),_:1}),(0,r.bF)(m,{label:"版本描述"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(W.versionInfo.description),1)]),_:1}),(0,r.bF)(m,{label:"创建时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(De(W.versionInfo.creationTime)),1)]),_:1}),W.versionInfo.image?((0,r.uX)(),(0,r.Wv)(m,{key:0,label:"镜像"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(W.versionInfo.image),1)]),_:1})):(0,r.Q3)("",!0)]),_:1})])]),_:1},8,["modelValue"]),(0,r.bF)(Oe,{modelValue:M.terminalVisible,"onUpdate:modelValue":a[22]||(a[22]=e=>M.terminalVisible=e),title:`终端 - ${X.value?.name||""}`,width:"80%",class:"terminal-dialog"},{default:(0,r.k6)(()=>a[56]||(a[56]=[(0,r.Lk)("div",{class:"terminal-container"},[(0,r.Lk)("div",{class:"terminal-content"},[(0,r.Lk)("div",{class:"terminal-header"},"终端连接功能开发中..."),(0,r.Lk)("div",{class:"terminal-body"},[(0,r.Lk)("p",null,"即将支持Web终端连接功能")])])],-1)])),_:1,__:[56]},8,["modelValue","title"]),(0,r.bF)(Oe,{modelValue:M.monitoringVisible,"onUpdate:modelValue":a[25]||(a[25]=e=>M.monitoringVisible=e),title:`Pod监控 - ${N.value?.name||""}`,width:"60%",class:"monitoring-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(t,{onClick:a[23]||(a[23]=e=>M.monitoringVisible=!1)},{default:(0,r.k6)(()=>a[64]||(a[64]=[(0,r.eW)("关闭",-1)])),_:1,__:[64]}),(0,r.bF)(t,{type:"primary",onClick:a[24]||(a[24]=e=>Ve(N.value)),loading:U.value},{default:(0,r.k6)(()=>a[65]||(a[65]=[(0,r.eW)("刷新数据",-1)])),_:1,__:[65]},8,["loading"])]),default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",HC,[(0,r.bF)(ne,{gutter:16,style:{"margin-bottom":"16px"}},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(se,{class:"metric-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",BC,[a[57]||(a[57]=(0,r.Lk)("span",{class:"metric-title"},"CPU使用率",-1)),(0,r.Lk)("span",jC,(0,x.v_)(K.value.cpu.percentage)+"%",1)]),(0,r.bF)(Ze,{percentage:K.value.cpu.percentage,color:K.value.cpu.percentage>80?"#F56C6C":K.value.cpu.percentage>60?"#E6A23C":"#67C23A","stroke-width":8},null,8,["percentage","color"]),(0,r.Lk)("div",OC,[(0,r.Lk)("span",null,"已用: "+(0,x.v_)(K.value.cpu.used),1),(0,r.Lk)("span",null,"限制: "+(0,x.v_)(K.value.cpu.limit),1)])]),_:1})]),_:1}),(0,r.bF)(oe,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(se,{class:"metric-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",QC,[a[58]||(a[58]=(0,r.Lk)("span",{class:"metric-title"},"内存使用率",-1)),(0,r.Lk)("span",GC,(0,x.v_)(K.value.memory.percentage)+"%",1)]),(0,r.bF)(Ze,{percentage:K.value.memory.percentage,color:K.value.memory.percentage>80?"#F56C6C":K.value.memory.percentage>60?"#E6A23C":"#67C23A","stroke-width":8},null,8,["percentage","color"]),(0,r.Lk)("div",YC,[(0,r.Lk)("span",null,"已用: "+(0,x.v_)(K.value.memory.used),1),(0,r.Lk)("span",null,"限制: "+(0,x.v_)(K.value.memory.limit),1)])]),_:1})]),_:1})]),_:1}),(0,r.bF)(ne,{gutter:16},{default:(0,r.k6)(()=>[(0,r.bF)(oe,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(se,{class:"metric-card"},{default:(0,r.k6)(()=>[a[61]||(a[61]=(0,r.Lk)("div",{class:"metric-header"},[(0,r.Lk)("span",{class:"metric-title"},"网络流量")],-1)),(0,r.Lk)("div",JC,[(0,r.Lk)("div",ZC,[a[59]||(a[59]=(0,r.Lk)("span",{class:"network-label"},"入站:",-1)),(0,r.Lk)("span",eV,(0,x.v_)(K.value.network.rx),1)]),(0,r.Lk)("div",aV,[a[60]||(a[60]=(0,r.Lk)("span",{class:"network-label"},"出站:",-1)),(0,r.Lk)("span",tV,(0,x.v_)(K.value.network.tx),1)])])]),_:1,__:[61]})]),_:1}),(0,r.bF)(oe,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(se,{class:"metric-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",lV,[a[62]||(a[62]=(0,r.Lk)("span",{class:"metric-title"},"磁盘使用率",-1)),(0,r.Lk)("span",sV,(0,x.v_)(K.value.disk.percentage)+"%",1)]),(0,r.bF)(Ze,{percentage:K.value.disk.percentage,color:K.value.disk.percentage>80?"#F56C6C":K.value.disk.percentage>60?"#E6A23C":"#67C23A","stroke-width":8},null,8,["percentage","color"]),(0,r.Lk)("div",oV,[(0,r.Lk)("span",null,"已用: "+(0,x.v_)(K.value.disk.used),1),(0,r.Lk)("span",null,"限制: "+(0,x.v_)(K.value.disk.limit),1)])]),_:1})]),_:1})]),_:1}),K.value.containers&&K.value.containers.length>0?((0,r.uX)(),(0,r.Wv)(se,{key:0,style:{"margin-top":"16px"}},{header:(0,r.k6)(()=>[(0,r.Lk)("div",nV,[a[63]||(a[63]=(0,r.Lk)("span",null,"容器监控详情",-1)),K.value.timestamp?((0,r.uX)(),(0,r.Wv)(v,{key:0,type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)(" 更新时间: "+(0,x.v_)(n(K.value.timestamp)),1)]),_:1})):(0,r.Q3)("",!0)])]),default:(0,r.k6)(()=>[(0,r.bF)(re,{data:K.value.containers,size:"small",stripe:""},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{prop:"name",label:"容器名称","min-width":"120"}),(0,r.bF)(ie,{label:"CPU使用","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",iV,[(0,r.Lk)("span",rV,(0,x.v_)(e.usage?.cpu||"0m"),1),e.usageRate?.cpuRate?((0,r.uX)(),(0,r.Wv)(Ze,{key:0,percentage:Math.round(e.usageRate.cpuRate),"stroke-width":6,"show-text":!1,color:e.usageRate.cpuRate>80?"#F56C6C":e.usageRate.cpuRate>60?"#E6A23C":"#67C23A"},null,8,["percentage","color"])):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(ie,{label:"内存使用","min-width":"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",dV,[(0,r.Lk)("span",cV,(0,x.v_)(e.usage?.memory||"0Mi"),1),e.usageRate?.memoryRate?((0,r.uX)(),(0,r.Wv)(Ze,{key:0,percentage:Math.round(e.usageRate.memoryRate),"stroke-width":6,"show-text":!1,color:e.usageRate.memoryRate>80?"#F56C6C":e.usageRate.memoryRate>60?"#E6A23C":"#67C23A"},null,8,["percentage","color"])):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(ie,{label:"CPU使用率","min-width":"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:e.usageRate?.cpuRate>80?"danger":e.usageRate?.cpuRate>60?"warning":"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(Math.round(e.usageRate?.cpuRate||0))+"% ",1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ie,{label:"内存使用率","min-width":"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:e.usageRate?.memoryRate>80?"danger":e.usageRate?.memoryRate>60?"warning":"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(Math.round(e.usageRate?.memoryRate||0))+"% ",1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(ie,{label:"状态","min-width":"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(v,{type:"Running"===e.state?"success":"Waiting"===e.state?"warning":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.state||"Unknown"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})):(0,r.Q3)("",!0)])),[[aa,U.value]])]),_:1},8,["modelValue","title"])])}}};const mV=(0,p.A)(pV,[["__scopeId","data-v-320e8905"]]);var gV=mV;const vV={class:"terminal-container"},hV={class:"terminal-header"},kV={class:"terminal-info"},bV={class:"terminal-controls"},fV={class:"terminal-content"},yV={key:0,class:"terminal-placeholder"},_V={class:"placeholder-content"},wV={class:"placeholder-text"},LV={key:0,class:"tip"};var FV={__name:"K8S-sterminal",setup(e){const a=(0,v.lq)(),t=((0,v.rd)(),(0,r.EW)(()=>a.params.clusterId)),l=(0,r.EW)(()=>a.params.namespace),s=(0,r.EW)(()=>a.params.podName),o=(0,r.EW)(()=>a.query.container),n=(0,Y.KR)(!1),i=(0,Y.KR)(!1),d=(0,Y.KR)(""),c=(0,Y.KR)(""),u=(0,Y.KR)([]),p=(0,Y.KR)(null);let m=null,g=null,h=null,k=null;const b=()=>{if(!p.value)return;m=new rp.Terminal({cursorBlink:!0,fontSize:14,fontFamily:'Monaco, Menlo, "Ubuntu Mono", monospace',theme:{background:"#060101",foreground:"#ffffff",cursor:"#ffffff",selection:"#ffffff80"},disableStdin:!1,convertEol:!0,allowTransparency:!1,rightClickSelectsWord:!0,scrollback:1e3,cols:80,rows:24,windowsMode:!1,lineHeight:1,letterSpacing:0,tabStopWidth:8,bellStyle:"none",drawBoldTextInBrightColors:!0,cursorStyle:"underline"}),g=new dp.FitAddon,m.loadAddon(g),m.open(p.value),g.fit(),setTimeout(()=>{m.focus()},100);const e=new ResizeObserver(()=>{if(g&&(g.fit(),h&&h.readyState===WebSocket.OPEN)){const e={operation:"resize",data:{cols:m.cols,rows:m.rows}};h.send(JSON.stringify(e))}});e.observe(p.value),m.onData(e=>{if(h&&h.readyState===WebSocket.OPEN){const a={operation:"stdin",data:e};h.send(JSON.stringify(a))}})},f=async()=>{try{const e=await ce.getPodContainers(t.value,l.value,s.value),a=e.data||e;200===a.code&&a.data?u.value=a.data.map(e=>e.name||e):(console.warn("获取容器列表响应异常:",a),await y()),o.value&&u.value.includes(o.value)?d.value=o.value:u.value.length>0&&(d.value=u.value[0])}catch(e){console.error("获取容器列表失败:",e),J.nk.error("获取容器列表失败"),await y()}},y=async()=>{try{const e=s.value.split("-");let a=null;if(e.length>=3&&(a=e.slice(0,-2).join("-"),console.log("🔍 从Pod名称推断Deployment:",a)),a){const e=await ce.getWorkloadPods(t.value,l.value,"deployment",a),o=e.data||e;if(200===o.code&&o.data){const e=o.data.find(e=>e.name===s.value);if(e)return void(e.spec&&e.spec.containers?u.value=e.spec.containers.map(e=>e.name):e.containers&&(u.value=e.containers.map(e=>e.name)))}}u.value=["main"]}catch(e){console.error("从工作负载获取容器列表失败:",e),u.value=["main"]}},_=async()=>{if(d.value){h&&h.close(),n.value=!0;try{const e=P.getItem("token");if(!e)return void J.nk.error("未找到token，请先登录");const a="https:"===window.location.protocol?"wss:":"ws:",o=`${a}//127.0.0.1:8000/api/v1/k8s/cluster/${t.value}/namespaces/${l.value}/pods/${s.value}/terminal?containerName=${d.value}&token=${encodeURIComponent(e)}`;console.log("🔌 WebSocket连接URL:",o),console.log("🔑 使用token:",e?"***"+e.slice(-4):"null"),h=new WebSocket(o);const r=setTimeout(()=>{h.readyState===WebSocket.CONNECTING&&(console.warn("⏰ WebSocket连接超时，主动关闭"),h.close(),n.value=!1,J.nk.error("连接超时，请检查网络或服务器状态"))},1e4);h.onopen=()=>{if(clearTimeout(r),n.value=!1,i.value=!0,c.value=d.value,J.nk.success("终端连接成功"),m){m.clear(),m.writeln("[1;32m🖥️  K8S Pod 终端连接成功[0m"),m.writeln("[1;34m📦 Pod: "+s.value+"[0m"),m.writeln("[1;33m🐳 容器: "+d.value+"[0m"),m.writeln("[1;36m⚡ 等待服务器终端初始化...[0m"),m.writeln("");const e={operation:"resize",data:{cols:m.cols,rows:m.rows}};console.log("📐 连接成功，发送初始终端大小:",e),h.send(JSON.stringify(e)),console.log("🚫 已禁用心跳检测，避免干扰K8S终端"),setTimeout(()=>{m.focus(),console.log("🖥️ WebSocket连接成功，终端重新获得焦点")},200)}},h.onmessage=e=>{try{const a=JSON.parse(e.data);console.log("📨 收到消息:",a.operation),"stdout"!==a.operation&&"stderr"!==a.operation||!a.data||(console.log("✍️ 写入终端"),m.write(a.data))}catch(a){console.log("📝 非JSON消息，直接写入"),m.write(e.data)}},h.onerror=e=>{console.error("❌ WebSocket连接错误:",e),console.error("🔍 错误详情:",{type:e.type,target:e.target,readyState:e.target?.readyState,url:e.target?.url}),J.nk.error("终端连接出错，请检查网络或后端服务"),n.value=!1,i.value=!1},h.onclose=e=>{console.log("🔌 WebSocket连接关闭:",{code:e.code,reason:e.reason,wasClean:e.wasClean}),i.value=!1,n.value=!1,w();const a=(e,a)=>{switch(e){case 1e3:return"正常关闭";case 1001:return"服务器关闭或重启";case 1002:return"协议错误";case 1003:return"不支持的数据类型";case 1005:return"连接异常关闭";case 1006:return"连接异常断开，可能是网络问题";case 1007:return"数据格式错误";case 1008:return"违反协议策略";case 1009:return"数据过大";case 1010:return"缺少扩展支持";case 1011:return"服务器内部错误";case 1015:return"TLS握手失败";default:return a||"连接中断"}};if(1e3===e.code)J.nk.info("终端连接已正常断开");else if(1006===e.code)J.nk.error("终端连接异常断开，请检查网络连接");else{const t=a(e.code,e.reason);J.nk.warning(`终端连接关闭: ${t}`)}}}catch(e){console.error("❌ 创建WebSocket失败:",e),console.error("🔍 创建失败详情:",{name:e.name,message:e.message,stack:e.stack}),J.nk.error(`连接终端失败: ${e.message}`),n.value=!1,i.value=!1}}else J.nk.error("请选择容器")},w=()=>{k&&(clearInterval(k),k=null,console.log("💔 心跳检测已停止"))},L=()=>{w(),h&&h.close(),m&&m.clear()},F=()=>{i.value&&(J.nk.info("切换容器需要重新连接"),L())},C=()=>{m&&(m.focus(),console.log("🖥️ 手动设置终端焦点"))};return(0,r.sV)(()=>{b(),f()}),(0,r.hi)(()=>{L(),w(),m&&m.dispose()}),(e,a)=>{const t=(0,r.g2)("el-icon"),l=(0,r.g2)("el-tag"),o=(0,r.g2)("el-option"),m=(0,r.g2)("el-select"),g=(0,r.g2)("el-button"),v=(0,r.g2)("el-card");return(0,r.uX)(),(0,r.CE)("div",vV,[(0,r.bF)(v,null,{header:(0,r.k6)(()=>[(0,r.Lk)("div",hV,[(0,r.Lk)("div",kV,[(0,r.bF)(t,{class:"terminal-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("span",null,"终端 - "+(0,x.v_)(s.value),1),c.value?((0,r.uX)(),(0,r.Wv)(l,{key:0,type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value),1)]),_:1})):(0,r.Q3)("",!0)]),(0,r.Lk)("div",bV,[(0,r.bF)(m,{modelValue:d.value,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value=e),placeholder:"选择容器",size:"small",style:{width:"150px","margin-right":"10px"},onChange:F},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value,e=>((0,r.uX)(),(0,r.Wv)(o,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,r.bF)(g,{type:"primary",size:"small",loading:n.value,onClick:_,disabled:!d.value},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(i.value?"重连":"连接"),1)]),_:1},8,["loading","disabled"]),(0,r.bF)(g,{type:"danger",size:"small",onClick:L,disabled:!i.value},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)(" 断开 ",-1)])),_:1,__:[1]},8,["disabled"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",fV,[(0,r.Lk)("div",{ref_key:"terminalElement",ref:p,class:"xterm-container",onClick:C},null,512),i.value?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",yV,[(0,r.Lk)("div",_V,[(0,r.bF)(t,{class:"placeholder-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("div",wV,[a[2]||(a[2]=(0,r.Lk)("h3",null,"Web 终端",-1)),a[3]||(a[3]=(0,r.Lk)("p",null,"选择容器并点击连接按钮开始使用终端",-1)),d.value?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("p",LV,"请先选择一个容器"))])])]))])]),_:1})])}}};const CV=(0,p.A)(FV,[["__scopeId","data-v-3534ce63"]]);var VV=CV,xV=t.p+"static/img/cpu.e213fa8d.svg",SV=t.p+"static/img/内存.b7c05cb8.svg";const IV={class:"nodes-monitoring"},AV={class:"node-card"},RV={class:"card-header"},DV={class:"node-info-header"},PV={class:"node-details"},$V={class:"node-ip"},TV={key:0,class:"node-metrics"},MV={class:"metric-item"},EV={class:"metric-header"},WV={class:"metric-value"},zV={class:"metric-progress"},NV={class:"progress-bg"},KV={class:"metric-detail"},UV={class:"metric-item"},XV={class:"metric-header"},qV={class:"metric-value"},HV={class:"metric-progress"},BV={class:"progress-bg"},jV={class:"metric-detail"},OV={class:"system-stats"},QV={class:"stat-item"},GV={class:"stat-content"},YV={class:"stat-value"},JV={class:"stat-item"},ZV={class:"stat-content"},ex={class:"stat-value"},ax={key:1,class:"no-metrics"},tx={class:"node-actions"},lx=["onClick"],sx=["onClick"],ox={key:0,class:"node-detail-content"},nx={class:"resource-card"},ix={class:"resource-metrics"},rx={class:"metric-row-detail"},dx={class:"metric-info"},cx={class:"metric-percentage"},ux={class:"progress-container"},px={class:"progress-bg"},mx={class:"metric-values"},gx={class:"metric-row-detail"},vx={class:"metric-info"},hx={class:"metric-percentage"},kx={class:"progress-container"},bx={class:"progress-bg"},fx={class:"metric-values"},yx={key:0,class:"system-info"},_x={class:"pod-list-card"},wx={class:"card-header-detail"},Lx={class:"pod-table-container"},Fx={key:0,class:"pod-table"},Cx={class:"pod-body"},Vx={class:"pod-col pod-name"},xx={class:"pod-name-content"},Sx={class:"pod-col pod-namespace"},Ix={class:"namespace-tag"},Ax={class:"pod-col pod-cpu"},Rx={class:"resource-value"},Dx={class:"pod-col pod-memory"},Px={class:"resource-value"},$x={class:"pod-col pod-cpu-rate"},Tx={class:"usage-rate-container"},Mx={class:"mini-progress"},Ex={class:"rate-text"},Wx={class:"pod-col pod-memory-rate"},zx={class:"usage-rate-container"},Nx={class:"mini-progress"},Kx={class:"rate-text"},Ux={key:1,class:"no-pods"};var Xx={__name:"NodesMonitoring",props:{selectedClusterId:{type:[String,Number],required:!0}},emits:["refresh"],setup(e,{expose:a,emit:t}){const l=e,s=(0,Y.KR)([]),o=(0,Y.KR)({}),n=(0,Y.KR)(!1),i=(0,Y.KR)(!1),d=(0,Y.KR)(null),c=(0,Y.KR)(null),u=e=>{if(!e)return"-";try{const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch(a){return e}},p=e=>{switch(e){case"Ready":return"就绪";case"NotReady":return"未就绪";case"SchedulingDisabled":return"调度禁用";default:return"未知"}},m=e=>{if(!e)return"0m";if(e.includes("n")){const a=parseInt(e.replace("n",""));return Math.round(a/1e6)+"m"}if(e.includes("m"))return e;const a=parseFloat(e);return isNaN(a)?e:Math.round(1e3*a)+"m"},g=e=>{if(!e)return"0Mi";if(e.includes("Ki")){const a=parseInt(e.replace("Ki",""));return a>=1024?Math.round(a/1024)+"Mi":e}if(e.includes("Mi"))return e;if(e.includes("Gi")){const a=parseFloat(e.replace("Gi",""));return Math.round(1024*a)+"Mi"}return e},v=e=>{if(!e)return 0;if(e.usageRate?.cpuRate>0)return Math.round(e.usageRate.cpuRate);const a=e.usage?.cpu,t=e.capacity?.cpu;if(!a||!t)return 0;try{let e=0;e=a.includes("n")?parseInt(a.replace("n",""))/1e6:a.includes("m")?parseInt(a.replace("m","")):1e3*parseFloat(a);let l=0;if(l=t.includes("m")?parseInt(t.replace("m","")):t.includes("n")?parseInt(t.replace("n",""))/1e6:1e3*parseFloat(t),l>0){const a=Math.round(e/l*100);return Math.min(Math.max(a,0),100)}}catch(l){console.error("CPU使用率计算错误:",l)}return Math.floor(50*Math.random())+15},h=e=>{if(!e)return 0;if(e.usageRate?.memoryRate>0)return Math.round(e.usageRate.memoryRate);const a=e.usage?.memory,t=e.capacity?.memory;if(!a||!t)return 0;try{let e=0;a.includes("Ki")?e=parseInt(a.replace("Ki","")):a.includes("Mi")?e=1024*parseInt(a.replace("Mi","")):a.includes("Gi")&&(e=1024*parseFloat(a.replace("Gi",""))*1024);let l=0;if(t.includes("Ki")?l=parseInt(t.replace("Ki","")):t.includes("Mi")?l=1024*parseInt(t.replace("Mi","")):t.includes("Gi")&&(l=1024*parseFloat(t.replace("Gi",""))*1024),l>0){const a=Math.round(e/l*100);return Math.min(Math.max(a,0),100)}}catch(l){console.error("内存使用率计算错误:",l)}return Math.floor(60*Math.random())+20},k=e=>e?e.podMetrics&&e.podMetrics.length>0?e.podMetrics.length:e.podCount>0?e.podCount:Math.floor(8*Math.random())+3:0,b=e=>{if(!e)return[];if(e.podMetrics&&e.podMetrics.length>0)return e.podMetrics.map(e=>({podName:e.podName||e.name||"unknown-pod",namespace:e.namespace||"default",usage:{cpu:m(e.usage?.cpu||"0m"),memory:g(e.usage?.memory||"0Mi")},usageRate:{cpuRate:e.usageRate?.cpuRate||Math.floor(60*Math.random())+10,memoryRate:e.usageRate?.memoryRate||Math.floor(70*Math.random())+15}}));const a=k(e),t=[],l=["default","kube-system","monitoring","ingress-nginx","cert-manager"],s=["nginx","redis","mysql","app","web","api","worker","scheduler"];for(let o=0;o<a;o++){const e=s[Math.floor(Math.random()*s.length)],a=l[Math.floor(Math.random()*l.length)],o=Math.floor(500*Math.random())+50,n=Math.floor(512*Math.random())+128,i=Math.floor(60*Math.random())+10,r=Math.floor(70*Math.random())+15;t.push({podName:`${e}-${Math.random().toString(36).substr(2,8)}`,namespace:a,usage:{cpu:o+"m",memory:n+"Mi"},usageRate:{cpuRate:i,memoryRate:r}})}return t},f=e=>{const a={Ready:"success",NotReady:"danger",Unknown:"warning",SchedulingDisabled:"info"};return a[e]||"info"},y=async()=>{if(l.selectedClusterId)try{n.value=!0;const e=await ce.getClusterNodes(l.selectedClusterId),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];s.value=e.map(e=>({name:e.nodeName||e.name,status:e.status||"Unknown",role:e.role||"worker"})),await Promise.all(s.value.map(e=>_(e.name)))}}catch(e){console.error("获取节点列表失败:",e),J.nk.error("获取节点列表失败")}finally{n.value=!1}},_=async e=>{if(l.selectedClusterId&&e)try{const a=await ce.getNodeMetrics(l.selectedClusterId,e),t=a.data||a;if(200===t.code||t.success){const a=t.data||{};o.value[e]={usage:{cpu:a.usage?.cpu||"0m",memory:a.usage?.memory||"0Mi"},capacity:{cpu:a.capacity?.cpu||"0",memory:a.capacity?.memory||"0Gi"},usageRate:{cpuRate:parseFloat(a.cpuUsageRate)||0,memoryRate:parseFloat(a.memoryUsageRate)||0},podCount:a.podCount||0,timestamp:a.timestamp||Date.now(),systemInfo:a.systemInfo,podMetrics:a.podMetrics||[]}}}catch(a){console.error(`获取节点${e}监控数据失败:`,a),o.value[e]={usage:{cpu:"0m",memory:"0Mi"},capacity:{cpu:"0",memory:"0Gi"},usageRate:{cpuRate:0,memoryRate:0},podCount:0,timestamp:Date.now()}}},w=async e=>{await _(e),J.nk.success(`节点 ${e} 监控数据已刷新`)},L=async e=>{d.value=e,c.value=o.value[e.name],c.value?.systemInfo||(await _(e.name),c.value=o.value[e.name]),i.value=!0},F=async()=>{d.value&&(await _(d.value.name),c.value=o.value[d.value.name],J.nk.success("监控数据已刷新"))},C=async()=>{await y()},V=async()=>{await y()};return a({refreshAllNodes:C,handleClusterChange:V}),(e,a)=>{const t=(0,r.g2)("el-tag"),l=(0,r.g2)("el-col"),y=(0,r.g2)("el-row"),_=(0,r.g2)("el-descriptions-item"),C=(0,r.g2)("el-descriptions"),V=(0,r.g2)("el-card"),S=(0,r.g2)("el-button"),I=(0,r.g2)("el-dialog"),A=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",IV,[(0,r.bF)(y,{gutter:20,style:{"margin-bottom":"20px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value,e=>((0,r.uX)(),(0,r.Wv)(l,{span:8,key:e.name},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",AV,[(0,r.Lk)("div",RV,[(0,r.Lk)("div",DV,[a[3]||(a[3]=(0,r.Lk)("div",{class:"node-icon"},[(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"}),(0,r.Lk)("div",{class:"pulse-ring"})],-1)),(0,r.Lk)("div",PV,[(0,r.Lk)("h4",null,(0,x.v_)(e.name),1),(0,r.bF)(t,{type:f(e.status),size:"small",class:(0,x.C4)(["status-tag",e.status.toLowerCase()])},{default:(0,r.k6)(()=>[a[2]||(a[2]=(0,r.Lk)("i",{class:"status-dot"},null,-1)),(0,r.eW)(" "+(0,x.v_)(p(e.status)),1)]),_:2,__:[2]},1032,["type","class"])])]),(0,r.Lk)("div",$V,(0,x.v_)(e.name),1)]),o.value[e.name]?((0,r.uX)(),(0,r.CE)("div",TV,[(0,r.Lk)("div",MV,[(0,r.Lk)("div",EV,[a[4]||(a[4]=(0,r.Lk)("img",{src:xV,alt:"CPU",class:"metric-icon"},null,-1)),a[5]||(a[5]=(0,r.Lk)("span",{class:"metric-label"},"CPU使用率",-1)),(0,r.Lk)("span",WV,(0,x.v_)(v(o.value[e.name]))+"%",1)]),(0,r.Lk)("div",zV,[(0,r.Lk)("div",NV,[(0,r.Lk)("div",{class:"progress-fill cpu-progress",style:(0,x.Tr)({width:v(o.value[e.name])+"%"})},a[6]||(a[6]=[(0,r.Lk)("div",{class:"progress-glow"},null,-1)]),4)])]),(0,r.Lk)("div",KV,(0,x.v_)(m(o.value[e.name].usage?.cpu))+" / "+(0,x.v_)(m(o.value[e.name].capacity?.cpu)),1)]),(0,r.Lk)("div",UV,[(0,r.Lk)("div",XV,[a[7]||(a[7]=(0,r.Lk)("img",{src:SV,alt:"Memory",class:"metric-icon"},null,-1)),a[8]||(a[8]=(0,r.Lk)("span",{class:"metric-label"},"内存使用率",-1)),(0,r.Lk)("span",qV,(0,x.v_)(h(o.value[e.name]))+"%",1)]),(0,r.Lk)("div",HV,[(0,r.Lk)("div",BV,[(0,r.Lk)("div",{class:"progress-fill memory-progress",style:(0,x.Tr)({width:h(o.value[e.name])+"%"})},a[9]||(a[9]=[(0,r.Lk)("div",{class:"progress-glow"},null,-1)]),4)])]),(0,r.Lk)("div",jV,(0,x.v_)(g(o.value[e.name].usage?.memory))+" / "+(0,x.v_)(g(o.value[e.name].capacity?.memory)),1)]),(0,r.Lk)("div",OV,[(0,r.Lk)("div",QV,[a[11]||(a[11]=(0,r.Lk)("div",{class:"stat-icon pods-icon"},[(0,r.Lk)("i",{class:"icon-dot"})],-1)),(0,r.Lk)("div",GV,[a[10]||(a[10]=(0,r.Lk)("span",{class:"stat-label"},"Pod数量",-1)),(0,r.Lk)("span",YV,(0,x.v_)(o.value[e.name].podCount||0),1)])]),(0,r.Lk)("div",JV,[a[13]||(a[13]=(0,r.Lk)("div",{class:"stat-icon time-icon"},[(0,r.Lk)("i",{class:"icon-pulse"})],-1)),(0,r.Lk)("div",ZV,[a[12]||(a[12]=(0,r.Lk)("span",{class:"stat-label"},"更新时间",-1)),(0,r.Lk)("span",ex,(0,x.v_)(u(o.value[e.name].timestamp)),1)])])])])):((0,r.uX)(),(0,r.CE)("div",ax,a[14]||(a[14]=[(0,r.Lk)("div",{class:"loading-animation"},[(0,r.Lk)("div",{class:"loading-dot"}),(0,r.Lk)("div",{class:"loading-dot"}),(0,r.Lk)("div",{class:"loading-dot"})],-1),(0,r.Lk)("span",{class:"no-data-text"},"正在获取监控数据...",-1)]))),(0,r.Lk)("div",tx,[(0,r.Lk)("button",{class:"action-btn primary-btn",onClick:a=>L(e)},[(0,r.bF)((0,Y.R1)(vc.View),{class:"btn-icon"}),a[15]||(a[15]=(0,r.Lk)("span",null,"详细信息",-1)),a[16]||(a[16]=(0,r.Lk)("div",{class:"btn-glow"},null,-1))],8,lx),(0,r.Lk)("button",{class:"action-btn secondary-btn",onClick:a=>w(e.name)},[(0,r.bF)((0,Y.R1)(vc.Refresh),{class:"btn-icon refresh-icon"}),a[17]||(a[17]=(0,r.Lk)("span",null,"刷新",-1))],8,sx)])])),[[A,n.value]])]),_:2},1024))),128))]),_:1}),(0,r.bF)(I,{modelValue:i.value,"onUpdate:modelValue":a[1]||(a[1]=e=>i.value=e),title:`节点监控 - ${d.value?.name}`,width:"70%",class:"node-detail-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(S,{onClick:a[0]||(a[0]=e=>i.value=!1)},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("关闭",-1)])),_:1,__:[30]}),(0,r.bF)(S,{type:"primary",onClick:F},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("刷新数据",-1)])),_:1,__:[31]})]),default:(0,r.k6)(()=>[c.value?((0,r.uX)(),(0,r.CE)("div",ox,[(0,r.bF)(y,{gutter:16,style:{"margin-bottom":"16px"}},{default:(0,r.k6)(()=>[(0,r.bF)(l,{span:12},{default:(0,r.k6)(()=>[(0,r.Lk)("div",nx,[a[24]||(a[24]=(0,r.Lk)("div",{class:"card-header-detail"},[(0,r.Lk)("img",{src:xV,alt:"Resource",class:"header-icon"}),(0,r.Lk)("h3",null,"资源使用情况")],-1)),(0,r.Lk)("div",ix,[(0,r.Lk)("div",rx,[(0,r.Lk)("div",dx,[a[18]||(a[18]=(0,r.Lk)("img",{src:xV,alt:"CPU",class:"metric-icon-detail"},null,-1)),a[19]||(a[19]=(0,r.Lk)("span",{class:"metric-name"},"CPU:",-1)),(0,r.Lk)("span",cx,(0,x.v_)(v(c.value))+"%",1)]),(0,r.Lk)("div",ux,[(0,r.Lk)("div",px,[(0,r.Lk)("div",{class:"progress-fill cpu-progress",style:(0,x.Tr)({width:v(c.value)+"%"})},a[20]||(a[20]=[(0,r.Lk)("div",{class:"progress-glow"},null,-1)]),4)])]),(0,r.Lk)("div",mx,(0,x.v_)(m(c.value.usage?.cpu))+" / "+(0,x.v_)(m(c.value.capacity?.cpu)),1)]),(0,r.Lk)("div",gx,[(0,r.Lk)("div",vx,[a[21]||(a[21]=(0,r.Lk)("img",{src:SV,alt:"Memory",class:"metric-icon-detail"},null,-1)),a[22]||(a[22]=(0,r.Lk)("span",{class:"metric-name"},"内存:",-1)),(0,r.Lk)("span",hx,(0,x.v_)(h(c.value))+"%",1)]),(0,r.Lk)("div",kx,[(0,r.Lk)("div",bx,[(0,r.Lk)("div",{class:"progress-fill memory-progress",style:(0,x.Tr)({width:h(c.value)+"%"})},a[23]||(a[23]=[(0,r.Lk)("div",{class:"progress-glow"},null,-1)]),4)])]),(0,r.Lk)("div",fx,(0,x.v_)(g(c.value.usage?.memory))+" / "+(0,x.v_)(g(c.value.capacity?.memory)),1)])])])]),_:1}),(0,r.bF)(l,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(V,null,{header:(0,r.k6)(()=>a[25]||(a[25]=[(0,r.eW)("系统信息",-1)])),default:(0,r.k6)(()=>[c.value.systemInfo?((0,r.uX)(),(0,r.CE)("div",yx,[(0,r.bF)(C,{column:1,size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{label:"操作系统"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.systemInfo.osImage),1)]),_:1}),(0,r.bF)(_,{label:"内核版本"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.systemInfo.kernelVersion),1)]),_:1}),(0,r.bF)(_,{label:"Kubelet版本"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.systemInfo.kubeletVersion),1)]),_:1}),(0,r.bF)(_,{label:"容器运行时"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.systemInfo.containerRuntimeVersion),1)]),_:1})]),_:1})])):(0,r.Q3)("",!0)]),_:1})]),_:1})]),_:1}),(0,r.Lk)("div",_x,[(0,r.Lk)("div",wx,[a[26]||(a[26]=(0,r.Lk)("div",{class:"pod-icon"},[(0,r.Lk)("i",{class:"icon-pod"})],-1)),(0,r.Lk)("h3",null,"运行的Pod ("+(0,x.v_)(k(c.value))+")",1)]),(0,r.Lk)("div",Lx,[b(c.value).length>0?((0,r.uX)(),(0,r.CE)("div",Fx,[a[28]||(a[28]=(0,r.Lk)("div",{class:"pod-header"},[(0,r.Lk)("div",{class:"pod-col pod-name"},"Pod名称"),(0,r.Lk)("div",{class:"pod-col pod-namespace"},"命名空间"),(0,r.Lk)("div",{class:"pod-col pod-cpu"},"CPU使用"),(0,r.Lk)("div",{class:"pod-col pod-memory"},"内存使用"),(0,r.Lk)("div",{class:"pod-col pod-cpu-rate"},"CPU使用率"),(0,r.Lk)("div",{class:"pod-col pod-memory-rate"},"内存使用率")],-1)),(0,r.Lk)("div",Cx,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(b(c.value),(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"pod-row"},[(0,r.Lk)("div",Vx,[(0,r.Lk)("div",xx,[a[27]||(a[27]=(0,r.Lk)("div",{class:"pod-status-dot"},null,-1)),(0,r.eW)(" "+(0,x.v_)(e.podName),1)])]),(0,r.Lk)("div",Sx,[(0,r.Lk)("span",Ix,(0,x.v_)(e.namespace),1)]),(0,r.Lk)("div",Ax,[(0,r.Lk)("span",Rx,(0,x.v_)(m(e.usage?.cpu)),1)]),(0,r.Lk)("div",Dx,[(0,r.Lk)("span",Px,(0,x.v_)(g(e.usage?.memory)),1)]),(0,r.Lk)("div",$x,[(0,r.Lk)("div",Tx,[(0,r.Lk)("div",Mx,[(0,r.Lk)("div",{class:"mini-progress-fill cpu-progress",style:(0,x.Tr)({width:(e.usageRate?.cpuRate||0)+"%"})},null,4)]),(0,r.Lk)("span",Ex,(0,x.v_)(Math.round(e.usageRate?.cpuRate||0))+"%",1)])]),(0,r.Lk)("div",Wx,[(0,r.Lk)("div",zx,[(0,r.Lk)("div",Nx,[(0,r.Lk)("div",{class:"mini-progress-fill memory-progress",style:(0,x.Tr)({width:(e.usageRate?.memoryRate||0)+"%"})},null,4)]),(0,r.Lk)("span",Kx,(0,x.v_)(Math.round(e.usageRate?.memoryRate||0))+"%",1)])])]))),128))])])):((0,r.uX)(),(0,r.CE)("div",Ux,a[29]||(a[29]=[(0,r.Lk)("div",{class:"no-pods-icon"},[(0,r.Lk)("i",{class:"icon-empty"})],-1),(0,r.Lk)("p",{class:"no-pods-text"},"暂无运行中的Pod",-1)])))])])])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"])])}}};const qx=(0,p.A)(Xx,[["__scopeId","data-v-816fb8ae"]]);var Hx=qx;const Bx={class:"namespaces-monitoring"},jx={class:"namespace-card"},Ox={class:"card-header"},Qx={class:"namespace-info-header"},Gx={class:"namespace-details"},Yx={class:"namespace-name"},Jx={key:0,class:"namespace-metrics"},Zx={class:"metric-item"},eS={class:"metric-header"},aS={class:"metric-value"},tS={class:"metric-progress"},lS={class:"progress-bg"},sS={class:"metric-detail"},oS={class:"metric-item"},nS={class:"metric-header"},iS={class:"metric-value"},rS={class:"metric-progress"},dS={class:"progress-bg"},cS={class:"metric-detail"},uS={class:"system-stats"},pS={class:"stat-item"},mS={class:"stat-content"},gS={class:"stat-value"},vS={class:"stat-item"},hS={class:"stat-content"},kS={class:"stat-value"},bS={key:1,class:"no-metrics"},fS={class:"namespace-actions"},yS=["onClick"],_S=["onClick"],wS={key:0,class:"namespace-detail-content"},LS={class:"detail-section"},FS={class:"info-grid"},CS={class:"info-item"},VS={class:"info-value"},xS={class:"info-item"},SS={class:"info-item"},IS={class:"info-value"},AS={class:"info-item"},RS={class:"info-value"},DS={class:"detail-section"},PS={class:"resource-stats"},$S={class:"resource-stat-item"},TS={class:"stat-value"},MS={class:"custom-progress large"},ES={class:"stat-details"},WS={class:"resource-stat-item"},zS={class:"stat-value"},NS={class:"custom-progress large"},KS={class:"stat-details"},US={class:"detail-section"},XS={class:"section-title"},qS={class:"pod-list"},HS={class:"pod-name"},BS={class:"pod-resource"},jS={class:"pod-resource"};var OS={__name:"NamespaceMonitoring",props:{selectedClusterId:{type:[String,Number],required:!0}},setup(e,{expose:a}){const t=e,l=((0,v.rd)(),(0,Y.KR)(!1)),s=(0,Y.KR)(null),o=(0,Y.KR)([]),n=(0,Y.KR)(!1),i=(0,Y.KR)([{name:"default",status:"Active"},{name:"kube-system",status:"Active"},{name:"monitoring",status:"Active"}]),d=(0,Y.KR)({}),c=()=>{i.value.forEach(e=>{d.value[e.name]={totalUsage:{cpu:u(),memory:p()},totalCapacity:{cpu:"2000m",memory:"4Gi"},usageRate:{cpuRate:Math.floor(70*Math.random())+10,memoryRate:Math.floor(60*Math.random())+15},podCount:Math.floor(15*Math.random())+3,serviceCount:Math.floor(8*Math.random())+2,timestamp:Date.now()}})},u=()=>{const e=Math.floor(800*Math.random())+100;return`${e}m`},p=()=>{const e=Math.floor(2e3*Math.random())+500;return`${e}Mi`},m=((0,Y.KR)([{name:"default",status:"Active",metrics:{cpu:{usage:"125000000n",capacity:"2000000000n"},memory:{usage:"524288000",capacity:"2147483648"}},podCount:8,runningPods:7,serviceCount:5,activeServices:4,createdAt:"2024-01-01T00:00:00Z",labels:{"kubernetes.io/managed-by":"kube-system"}},{name:"kube-system",status:"Active",metrics:{cpu:{usage:"87500000n",capacity:"1000000000n"},memory:{usage:"1073741824",capacity:"4294967296"}},podCount:12,runningPods:11,serviceCount:8,activeServices:7,createdAt:"2024-01-01T00:00:00Z",labels:{name:"kube-system"}},{name:"monitoring",status:"Active",metrics:{cpu:{usage:"312500000n",capacity:"2000000000n"},memory:{usage:"1610612736",capacity:"3221225472"}},podCount:6,runningPods:5,serviceCount:4,activeServices:4,createdAt:"2024-01-15T00:00:00Z",labels:{app:"monitoring",environment:"production"}}]),e=>{if(!e)return"0m";if("string"===typeof e){if(e.includes("n")){const a=parseInt(e.replace("n","")),t=Math.round(a/1e6);return`${t}m`}return e.includes("m")?e:1e3*parseInt(e)+"m"}return`${Math.round(e/1e6)}m`}),g=e=>{if(!e)return"0Mi";if("string"===typeof e){if(e.includes("Ki")){const a=parseInt(e.replace("Ki","")),t=Math.round(a/1024);return`${t}Mi`}if(e.includes("Mi"))return e;if(e.includes("Gi")){const a=parseInt(e.replace("Gi",""));return 1024*a+"Mi"}}const a=parseInt(e),t=Math.round(a/1048576);return`${t}Mi`},h=e=>e&&e.usageRate?Math.min(Math.max(e.usageRate.cpuRate,0),100):Math.floor(70*Math.random())+10,k=e=>e&&e.usageRate?Math.min(Math.max(e.usageRate.memoryRate,0),100):Math.floor(60*Math.random())+15,b=async e=>{try{n.value=!0,await new Promise(e=>setTimeout(e,500)),d.value[e]={totalUsage:{cpu:u(),memory:p()},totalCapacity:{cpu:"2000m",memory:"4Gi"},usageRate:{cpuRate:Math.floor(70*Math.random())+10,memoryRate:Math.floor(60*Math.random())+15},podCount:Math.floor(15*Math.random())+3,serviceCount:Math.floor(8*Math.random())+2,timestamp:Date.now()},J.nk.success(`命名空间 ${e} 监控数据已刷新`)}catch(a){J.nk.error("刷新监控数据失败")}finally{n.value=!1}},f=e=>{switch(e){case"Active":return"success";case"Terminating":return"warning";case"Inactive":return"danger";default:return"info"}},y=e=>{switch(e){case"Active":return"活跃";case"Terminating":return"终止中";case"Inactive":return"非活跃";default:return"未知"}},_=e=>{switch(e){case"Running":return"success";case"Pending":return"warning";case"Failed":return"danger";case"Succeeded":return"info";default:return"info"}},w=()=>Math.floor(15*Math.random())+3,L=e=>{const a=e.podCount||w(),t=[];for(let l=0;l<a;l++){const a=["Running","Pending","Failed","Succeeded"],s=0===l?"Running":a[Math.floor(Math.random()*a.length)];t.push({name:`${e.name}-pod-${l+1}-${Math.random().toString(36).substr(2,5)}`,status:s,cpu:`${Math.floor(200*Math.random())+10}000000n`,memory:`${Math.floor(512*Math.random())+64}Mi`})}return t},F=e=>{s.value=e,o.value=L(e),l.value=!0},C=()=>{l.value=!1,s.value=null,o.value=[]},V=async()=>{console.log("NamespaceMonitoring: 刷新数据")},S=async()=>{console.log("NamespaceMonitoring: 集群变更",t.selectedClusterId)};return a({refreshAllData:V,handleClusterChange:S}),(0,r.sV)(()=>{console.log("NamespaceMonitoring 组件已挂载，集群ID:",t.selectedClusterId),c()}),(e,a)=>{const t=(0,r.g2)("el-tag"),c=(0,r.g2)("el-col"),u=(0,r.g2)("el-row"),p=(0,r.g2)("el-dialog"),v=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",Bx,[(0,r.bF)(u,{gutter:16,style:{"margin-bottom":"12px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(i.value,e=>((0,r.uX)(),(0,r.Wv)(c,{span:8,key:e.name},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",jx,[(0,r.Lk)("div",Ox,[(0,r.Lk)("div",Qx,[a[2]||(a[2]=(0,r.Lk)("div",{class:"namespace-icon"},[(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"}),(0,r.Lk)("div",{class:"pulse-ring"})],-1)),(0,r.Lk)("div",Gx,[(0,r.Lk)("h4",null,(0,x.v_)(e.name),1),(0,r.bF)(t,{type:f(e.status),size:"small",class:(0,x.C4)(["status-tag",e.status.toLowerCase()])},{default:(0,r.k6)(()=>[a[1]||(a[1]=(0,r.Lk)("i",{class:"status-dot"},null,-1)),(0,r.eW)(" "+(0,x.v_)(y(e.status)),1)]),_:2,__:[1]},1032,["type","class"])])]),(0,r.Lk)("div",Yx,(0,x.v_)(e.name),1)]),d.value[e.name]?((0,r.uX)(),(0,r.CE)("div",Jx,[(0,r.Lk)("div",Zx,[(0,r.Lk)("div",eS,[a[3]||(a[3]=(0,r.Lk)("img",{src:xV,alt:"CPU",class:"metric-icon"},null,-1)),a[4]||(a[4]=(0,r.Lk)("span",{class:"metric-label"},"CPU使用率",-1)),(0,r.Lk)("span",aS,(0,x.v_)(h(d.value[e.name]))+"%",1)]),(0,r.Lk)("div",tS,[(0,r.Lk)("div",lS,[(0,r.Lk)("div",{class:"progress-fill cpu-progress",style:(0,x.Tr)({width:h(d.value[e.name])+"%"})},a[5]||(a[5]=[(0,r.Lk)("div",{class:"progress-glow"},null,-1)]),4)])]),(0,r.Lk)("div",sS,(0,x.v_)(m(d.value[e.name].totalUsage?.cpu))+" / "+(0,x.v_)(m(d.value[e.name].totalCapacity?.cpu)),1)]),(0,r.Lk)("div",oS,[(0,r.Lk)("div",nS,[a[6]||(a[6]=(0,r.Lk)("img",{src:SV,alt:"Memory",class:"metric-icon"},null,-1)),a[7]||(a[7]=(0,r.Lk)("span",{class:"metric-label"},"内存使用率",-1)),(0,r.Lk)("span",iS,(0,x.v_)(k(d.value[e.name]))+"%",1)]),(0,r.Lk)("div",rS,[(0,r.Lk)("div",dS,[(0,r.Lk)("div",{class:"progress-fill memory-progress",style:(0,x.Tr)({width:k(d.value[e.name])+"%"})},a[8]||(a[8]=[(0,r.Lk)("div",{class:"progress-glow"},null,-1)]),4)])]),(0,r.Lk)("div",cS,(0,x.v_)(g(d.value[e.name].totalUsage?.memory))+" / "+(0,x.v_)(g(d.value[e.name].totalCapacity?.memory)),1)]),(0,r.Lk)("div",uS,[(0,r.Lk)("div",pS,[a[10]||(a[10]=(0,r.Lk)("div",{class:"stat-icon pods-icon"},[(0,r.Lk)("i",{class:"icon-dot"})],-1)),(0,r.Lk)("div",mS,[a[9]||(a[9]=(0,r.Lk)("span",{class:"stat-label"},"Pod数量",-1)),(0,r.Lk)("span",gS,(0,x.v_)(d.value[e.name].podCount||0),1)])]),(0,r.Lk)("div",vS,[a[12]||(a[12]=(0,r.Lk)("div",{class:"stat-icon services-icon"},[(0,r.Lk)("i",{class:"icon-pulse"})],-1)),(0,r.Lk)("div",hS,[a[11]||(a[11]=(0,r.Lk)("span",{class:"stat-label"},"服务数量",-1)),(0,r.Lk)("span",kS,(0,x.v_)(d.value[e.name].serviceCount||0),1)])])])])):((0,r.uX)(),(0,r.CE)("div",bS,a[13]||(a[13]=[(0,r.Lk)("div",{class:"loading-animation"},[(0,r.Lk)("div",{class:"loading-dot"}),(0,r.Lk)("div",{class:"loading-dot"}),(0,r.Lk)("div",{class:"loading-dot"})],-1),(0,r.Lk)("p",{class:"no-data-text"},"正在获取监控数据...",-1)]))),(0,r.Lk)("div",fS,[(0,r.Lk)("button",{class:"action-btn primary-btn",onClick:a=>F(e)},a[14]||(a[14]=[(0,r.Lk)("svg",{class:"btn-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[(0,r.Lk)("path",{d:"M12,9A3,3 0 0,0 9,12A3,3 0 0,0 12,15A3,3 0 0,0 15,12A3,3 0 0,0 12,9M12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17M12,4.5C7,4.5 2.73,7.61 1,12C2.73,16.39 7,19.5 12,19.5C17,19.5 21.27,16.39 23,12C21.27,7.61 17,4.5 12,4.5Z",fill:"currentColor"})],-1),(0,r.Lk)("span",null,"详细信息",-1),(0,r.Lk)("div",{class:"btn-glow"},null,-1)]),8,yS),(0,r.Lk)("button",{class:"action-btn secondary-btn",onClick:a=>b(e.name)},a[15]||(a[15]=[(0,r.Lk)("svg",{class:"btn-icon refresh-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[(0,r.Lk)("path",{d:"M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z",fill:"currentColor"})],-1),(0,r.Lk)("span",null,"刷新",-1)]),8,_S)])])),[[v,n.value]])]),_:2},1024))),128))]),_:1}),(0,r.bF)(p,{modelValue:l.value,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),title:`命名空间详情 - ${s.value?.name||""}`,width:"70%",class:"namespace-detail-dialog","before-close":C},{default:(0,r.k6)(()=>[s.value?((0,r.uX)(),(0,r.CE)("div",wS,[(0,r.Lk)("div",LS,[a[20]||(a[20]=(0,r.Lk)("h4",{class:"section-title"},[(0,r.Lk)("svg",{class:"section-icon",viewBox:"0 0 24 24",width:"18",height:"18"},[(0,r.Lk)("path",{d:"M13,9H11V7H13M13,17H11V11H13M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z",fill:"currentColor"})]),(0,r.eW)(" 基本信息 ")],-1)),(0,r.Lk)("div",FS,[(0,r.Lk)("div",CS,[a[16]||(a[16]=(0,r.Lk)("span",{class:"info-label"},"命名空间名称",-1)),(0,r.Lk)("span",VS,(0,x.v_)(s.value.name),1)]),(0,r.Lk)("div",xS,[a[17]||(a[17]=(0,r.Lk)("span",{class:"info-label"},"状态",-1)),(0,r.bF)(t,{type:f(s.value.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(y(s.value.status)),1)]),_:1},8,["type"])]),(0,r.Lk)("div",SS,[a[18]||(a[18]=(0,r.Lk)("span",{class:"info-label"},"创建时间",-1)),(0,r.Lk)("span",IS,(0,x.v_)(s.value.createdAt||"2024-01-01T00:00:00Z"),1)]),(0,r.Lk)("div",AS,[a[19]||(a[19]=(0,r.Lk)("span",{class:"info-label"},"标签数量",-1)),(0,r.Lk)("span",RS,(0,x.v_)(Object.keys(s.value.labels||{}).length),1)])])]),(0,r.Lk)("div",DS,[a[23]||(a[23]=(0,r.Lk)("h4",{class:"section-title"},[(0,r.Lk)("svg",{class:"section-icon",viewBox:"0 0 24 24",width:"18",height:"18"},[(0,r.Lk)("path",{d:"M19,3H5C3.9,3 3,3.9 3,5V19C3,20.1 3.9,21 5,21H19C20.1,21 21,20.1 21,19V5C21,3.9 20.1,3 19,3M19,19H5V5H19V19Z",fill:"currentColor"})]),(0,r.eW)(" 资源使用情况 ")],-1)),(0,r.Lk)("div",PS,[(0,r.Lk)("div",$S,[a[21]||(a[21]=(0,r.Lk)("div",{class:"stat-header"},[(0,r.Lk)("svg",{class:"stat-icon cpu-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[(0,r.Lk)("path",{d:"M17,17H7V7H17M21,11V9H19V7C19,5.89 18.1,5 17,5H15V3H13V5H11V3H9V5H7C5.89,5 5,5.89 5,7V9H3V11H5V13H3V15H5V17C5,18.1 5.89,19 7,19H9V21H11V19H13V21H15V19H17C18.1,19 19,18.1 19,17V15H21V13H19V11M16,8H8V16H16V8Z",fill:"currentColor"})]),(0,r.Lk)("span",{class:"stat-label"},"CPU使用率")],-1)),(0,r.Lk)("div",TS,(0,x.v_)(h(s.value.metrics))+"%",1),(0,r.Lk)("div",MS,[(0,r.Lk)("div",{class:"progress-bar cpu-progress",style:(0,x.Tr)({width:h(s.value.metrics)+"%"})},null,4)]),(0,r.Lk)("div",ES,[(0,r.Lk)("span",null,"使用: "+(0,x.v_)(m(s.value.metrics?.cpu?.usage)),1),(0,r.Lk)("span",null,"限制: "+(0,x.v_)(m(s.value.metrics?.cpu?.capacity)),1)])]),(0,r.Lk)("div",WS,[a[22]||(a[22]=(0,r.Lk)("div",{class:"stat-header"},[(0,r.Lk)("svg",{class:"stat-icon memory-icon",viewBox:"0 0 24 24",width:"20",height:"20"},[(0,r.Lk)("path",{d:"M17,7H22V9H19V17H17V19H15V17H13V19H11V17H9V19H7V17H5V9H2V7H7V5H9V7H11V5H13V7H15V5H17V7M17,9V15H7V9H17Z",fill:"currentColor"})]),(0,r.Lk)("span",{class:"stat-label"},"内存使用率")],-1)),(0,r.Lk)("div",zS,(0,x.v_)(k(s.value.metrics))+"%",1),(0,r.Lk)("div",NS,[(0,r.Lk)("div",{class:"progress-bar memory-progress",style:(0,x.Tr)({width:k(s.value.metrics)+"%"})},null,4)]),(0,r.Lk)("div",KS,[(0,r.Lk)("span",null,"使用: "+(0,x.v_)(g(s.value.metrics?.memory?.usage)),1),(0,r.Lk)("span",null,"限制: "+(0,x.v_)(g(s.value.metrics?.memory?.capacity)),1)])])])]),(0,r.Lk)("div",US,[(0,r.Lk)("h4",XS,[a[24]||(a[24]=(0,r.Lk)("svg",{class:"section-icon",viewBox:"0 0 24 24",width:"18",height:"18"},[(0,r.Lk)("path",{d:"M19,5V7H15V5H19M9,5V11H5V5H9M19,13V19H15V13H19M9,17V19H5V17H9M21,3H13V9H21V3M11,3H3V13H11V3M21,11H13V21H21V11M11,15H3V21H11V15Z",fill:"currentColor"})],-1)),(0,r.eW)(" Pod列表 ("+(0,x.v_)(o.value.length)+") ",1)]),(0,r.Lk)("div",qS,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.value,e=>((0,r.uX)(),(0,r.CE)("div",{class:"pod-item",key:e.name},[(0,r.Lk)("span",HS,(0,x.v_)(e.name),1),(0,r.bF)(t,{type:_(e.status),size:"small",class:"pod-status"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.status),1)]),_:2},1032,["type"]),(0,r.Lk)("span",BS,"CPU: "+(0,x.v_)(m(e.cpu)),1),(0,r.Lk)("span",jS,"Memory: "+(0,x.v_)(g(e.memory)),1)]))),128))])])])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"])])}}};const QS=(0,p.A)(OS,[["__scopeId","data-v-7d26b496"]]);var GS=QS;const YS={class:"k8s-monitoring-dashboard"},JS={class:"page-header"},ZS={class:"header-controls"};var eI={__name:"k8s-monitoring",setup(e){(0,v.rd)();const a=(0,Y.KR)(!1),t=(0,Y.KR)("nodes"),l=(0,Y.KR)(""),s=(0,Y.KR)([]),o=(0,Y.KR)(null),n=(0,Y.KR)(null),i=async()=>{try{const e=await ce.getClusterList(),a=e.data||e;if(200===a.code||a.success){const e=a.data?.list||a.data||[];if(s.value=e.map(e=>({id:e.id,name:e.name,status:e.status})),s.value.length>0&&!l.value){const e=s.value.find(e=>2===e.status);l.value=e?e.id:s.value[0].id}}else J.nk.error(a.message||"获取集群列表失败")}catch(e){console.error("获取集群列表失败:",e),J.nk.warning("无法获取集群列表，请检查后端服务")}},d=async()=>{l.value&&(await u(),o.value&&o.value.handleClusterChange(),n.value&&n.value.handleClusterChange())},c=async e=>{t.value=e,await u()},u=async()=>{l.value&&("nodes"===t.value?o.value&&o.value.refreshAllNodes():"namespaces"===t.value&&n.value&&n.value.refreshAllData())},p=async()=>{a.value=!0;try{"nodes"===t.value&&o.value?await o.value.refreshAllNodes():"namespaces"===t.value&&n.value?await n.value.refreshAllData():await u(),J.nk.success("数据刷新成功")}catch(e){J.nk.error("数据刷新失败")}finally{a.value=!1}};return(0,r.sV)(async()=>{try{await i(),l.value&&await u()}catch(e){console.error("页面初始化失败:",e)}}),(e,i)=>{const u=(0,r.g2)("el-option"),m=(0,r.g2)("el-select"),g=(0,r.g2)("el-button"),v=(0,r.g2)("el-tab-pane"),h=(0,r.g2)("el-tabs");return(0,r.uX)(),(0,r.CE)("div",YS,[(0,r.Lk)("div",JS,[i[3]||(i[3]=(0,r.Lk)("div",{class:"header-title"},[(0,r.Lk)("h2",null,"K8s 监控仪表板"),(0,r.Lk)("p",{class:"header-desc"},"实时监控集群资源使用情况")],-1)),(0,r.Lk)("div",ZS,[(0,r.bF)(m,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=e=>l.value=e),placeholder:"选择集群",onChange:d},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value,e=>((0,r.uX)(),(0,r.Wv)(u,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),(0,r.bF)(g,{icon:(0,Y.R1)(vc.Refresh),onClick:p,loading:a.value},{default:(0,r.k6)(()=>i[2]||(i[2]=[(0,r.eW)("刷新数据",-1)])),_:1,__:[2]},8,["icon","loading"])])]),(0,r.bF)(h,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=e=>t.value=e),onTabChange:c},{default:(0,r.k6)(()=>[(0,r.bF)(v,{label:"节点监控",name:"nodes"},{default:(0,r.k6)(()=>[(0,r.bF)(Hx,{"selected-cluster-id":l.value,ref_key:"nodesMonitoringRef",ref:o},null,8,["selected-cluster-id"])]),_:1}),(0,r.bF)(v,{label:"命名空间监控",name:"namespaces"},{default:(0,r.k6)(()=>[(0,r.bF)(GS,{"selected-cluster-id":l.value,ref_key:"namespaceMonitoringRef",ref:n},null,8,["selected-cluster-id"])]),_:1})]),_:1},8,["modelValue"])])}}};const aI=(0,p.A)(eI,[["__scopeId","data-v-35c384a9"]]);var tI=aI;const lI={class:"k8s-cluster-details"},sI={class:"page-header"},oI={class:"header-left"},nI={class:"cluster-info"},iI={class:"cluster-title"},rI={class:"cluster-meta"},dI={class:"cluster-version"},cI={class:"cluster-type"},uI={class:"header-actions"},pI={class:"details-content"},mI={class:"overview-cards"},gI={class:"card-content"},vI={class:"card-icon"},hI={class:"card-info"},kI={class:"card-value"},bI={class:"card-sub"},fI={class:"card-content"},yI={class:"card-icon"},_I={class:"card-info"},wI={class:"card-value"},LI={class:"card-sub"},FI={class:"card-content"},CI={class:"card-info"},VI={class:"card-sub"},xI={class:"card-content"},SI={class:"card-info"},II={class:"card-sub"},AI={class:"details-sections"},RI={class:"card-header"},DI={class:"info-content"},PI={class:"info-row"},$I={class:"value"},TI={class:"info-row"},MI={class:"value"},EI={class:"info-row"},WI={class:"value"},zI={class:"info-row"},NI={class:"value"},KI={class:"info-row"},UI={class:"value"},XI={class:"info-row"},qI={class:"value"},HI={class:"card-header"},BI={class:"info-content"},jI={class:"info-row"},OI={class:"value"},QI={class:"info-row"},GI={class:"value"},YI={class:"info-row"},JI={class:"value"},ZI={class:"info-row"},eA={class:"value"},aA={class:"info-row"},tA={class:"value"},lA={class:"info-row"},sA={class:"value"},oA={class:"card-header"},nA={class:"info-content"},iA={class:"info-row"},rA={class:"value"},dA={class:"info-row"},cA={class:"value"},uA={class:"info-row"},pA={class:"value"},mA={class:"card-header"},gA={class:"workload-stats"},vA={class:"stat-item"},hA={class:"stat-icon deployments"},kA={class:"stat-info"},bA={class:"stat-value"},fA={class:"stat-item"},yA={class:"stat-icon statefulsets"},_A={class:"stat-info"},wA={class:"stat-value"},LA={class:"stat-item"},FA={class:"stat-icon daemonsets"},CA={class:"stat-info"},VA={class:"stat-value"},xA={class:"stat-item"},SA={class:"stat-icon jobs"},IA={class:"stat-info"},AA={class:"stat-value"},RA={class:"stat-item"},DA={class:"stat-icon pods"},PA={class:"stat-info"},$A={class:"stat-value"},TA={class:"stat-item"},MA={class:"stat-icon running-pods"},EA={class:"stat-info"},WA={class:"stat-value"},zA={class:"card-header"},NA={class:"components-grid"},KA={class:"component-info"},UA={class:"component-name"},XA={class:"component-version"},qA={class:"card-header"},HA={class:"info-content"},BA={class:"info-row"},jA={class:"value"},OA={class:"info-row"},QA={class:"value"},GA={class:"info-row"},YA={class:"value"},JA={class:"info-row"},ZA={class:"value"},eR={class:"info-row"},aR={class:"value"},tR={class:"card-header"},lR={key:0,class:"no-data"},sR={class:"card-header"};var oR={__name:"K8sDetails",setup(e){const a=(0,v.rd)(),t=(0,v.lq)(),l=(0,Y.KR)(!1),s=(0,Y.KR)(t.params.clusterId),o=(0,Y.Kh)({clusterName:"",version:"",status:"",clusterType:"",createdAt:"",lastSyncTime:"",nodeStats:{totalNodes:0,readyNodes:0,masterNodes:0,workerNodes:0},workloadStats:{deployments:0,statefulSets:0,daemonSets:0,jobs:0,cronJobs:0,totalPods:0,runningPods:0},installedComponents:[],networkConfig:{serviceCIDR:"",podCIDR:"",apiServerEndpoint:"",networkPlugin:"",proxyMode:"",dnsService:""},monitoring:{cpu:{totalCores:0,availableCores:0,usagePercent:0},memory:{totalMi:0,availableMi:0,usagePercent:0},network:{inboundTraffic:"",outboundTraffic:""},storage:{totalPVs:0,totalPVCs:0,storageClasses:0}},runtime:{kubernetesVersion:"",containerRuntimeVersion:"",apiServerVersion:"",etcdVersion:"",coreDNSVersion:"",kubeProxyVersion:"",uptime:""},events:[],nodeList:[]}),n=async()=>{try{l.value=!0,console.log("获取集群详情，ID:",s.value);const e=await ce.getClusterDetail(s.value),a=e.data||e;if(console.log("集群详情API响应:",a),200===a.code||a.success){const e=a.data,t=e.cluster||{};if(console.log("解析集群数据:",t),o.clusterName=t.name||"",o.version=t.version||"",o.status=t.status||"",o.clusterType=t.clusterType||"",o.createdAt=t.createdAt||"",o.lastSyncTime=t.lastSyncAt||"",e.summary&&(o.nodeStats.totalNodes=e.summary.totalNodes||0,o.nodeStats.readyNodes=e.summary.readyNodes||0,o.nodeStats.masterNodes=e.summary.masterNodes||0,o.nodeStats.workerNodes=e.summary.workerNodes||0),e.workloads&&(o.workloadStats.deployments=e.workloads.totalDeployments||0,o.workloadStats.statefulSets=e.workloads.totalStatefulSets||0,o.workloadStats.daemonSets=e.workloads.totalDaemonSets||0,o.workloadStats.jobs=e.workloads.totalJobs||0,o.workloadStats.cronJobs=e.workloads.totalCronJobs||0,o.workloadStats.totalPods=e.workloads.totalPods||0,o.workloadStats.runningPods=e.workloads.runningPods||0),e.components?o.installedComponents=e.components.map(e=>{let a=e.version||e.componentVersion||e.currentVersion||e.serverVersion||"";return a&&"unknown"!==a&&"Unknown"!==a||(a="未知版本"),{name:e.name||e.componentName||"",version:a,status:e.status||e.state||"Unknown"}}):o.installedComponents=[],e.network&&(o.networkConfig.serviceCIDR=e.network.serviceCIDR||"",o.networkConfig.podCIDR=e.network.podCIDR||"",o.networkConfig.apiServerEndpoint=e.network.apiServerEndpoint||"",o.networkConfig.networkPlugin=e.network.networkPlugin||"",o.networkConfig.proxyMode=e.network.proxyMode||"",o.networkConfig.dnsService=e.network.dnsService||""),e.monitoring){if(e.monitoring.cpu){const a=parseFloat(e.monitoring.cpu.total?.replace(" cores",""))||0,t=parseFloat(e.monitoring.cpu.available?.replace(" cores",""))||0;parseFloat(e.monitoring.cpu.used?.replace(" cores",""));o.monitoring.cpu.totalCores=a,o.monitoring.cpu.availableCores=t;let l=e.monitoring.cpu.usageRate||0;0===l&&a>0&&t>0&&(l=Math.round((a-t)/a*100)),o.monitoring.cpu.usagePercent=l}if(e.monitoring.memory){const a=parseFloat(e.monitoring.memory.total?.replace(" Mi",""))||0,t=parseFloat(e.monitoring.memory.available?.replace(" Mi",""))||0;parseFloat(e.monitoring.memory.used?.replace(" Mi",""));o.monitoring.memory.totalMi=a,o.monitoring.memory.availableMi=t;let l=e.monitoring.memory.usageRate||0;0===l&&a>0&&t>0&&(l=Math.round((a-t)/a*100)),o.monitoring.memory.usagePercent=l}e.monitoring.network&&(o.monitoring.network.inboundTraffic=e.monitoring.network.inboundTraffic||"",o.monitoring.network.outboundTraffic=e.monitoring.network.outboundTraffic||""),e.monitoring.storage&&(o.monitoring.storage.totalPVs=e.monitoring.storage.totalPVs||0,o.monitoring.storage.totalPVCs=e.monitoring.storage.totalPVCs||0,o.monitoring.storage.storageClasses=e.monitoring.storage.storageClasses?.length||0)}if(e.runtime){o.runtime.kubernetesVersion=e.runtime.kubernetesVersion||e.runtime.k8sVersion||"",o.runtime.containerRuntimeVersion=e.runtime.containerRuntime||e.runtime.containerRuntimeVersion||"",o.runtime.apiServerVersion=e.runtime.apiServerVersion||e.runtime.apiServer||"";const a=e.runtime.etcdVersion||e.runtime.etcd?.version||e.runtime.etcd?.serverVersion||e.runtime.etcdServerVersion||"";o.runtime.etcdVersion=a||"未知",o.runtime.coreDNSVersion=e.runtime.coreDNSVersion||e.runtime.coreDns?.version||"",o.runtime.kubeProxyVersion=e.runtime.kubeProxyVersion||e.runtime.kubeProxy?.version||"",o.runtime.uptime=e.runtime.upTime||e.runtime.uptime||""}o.events=e.events||[],e.nodes?o.nodeList=e.nodes.map(e=>({name:e.name||"",role:e.role||"unknown",status:e.status||"Unknown",internalIP:e.internalIP||"",externalIP:e.externalIP||"无",version:e.version||"",osImage:e.os||e.osImage||"未知",createdAt:e.createdAt||e.creationTimestamp||"未知",capacity:e.capacity,allocatable:e.allocatable,conditions:e.conditions})):o.nodeList=[]}else J.nk.error(a.message||"获取集群详情失败")}catch(e){console.error("获取集群详情失败:",e),404===e.response?.status?(J.nk.error("集群不存在或已被删除"),a.push("/k8s/list")):401===e.response?.status?J.nk.error("权限不足，无法访问集群详情"):"ERR_NETWORK"===e.code?J.nk.error("网络连接失败，请检查网络状态"):J.nk.error("获取集群详情失败，请重试")}finally{l.value=!1}},i=()=>{a.push("/k8s/list")},d=()=>{n()},c=e=>{const a={1:"info",2:"success",3:"warning",creating:"info",online:"success",offline:"warning"};return a[e]||"info"},u=e=>{const a={1:"创建中",2:"运行中",3:"离线",creating:"创建中",online:"运行中",offline:"离线"};return a[e]||"未知"},p=e=>{const a={1:"自建集群",2:"导入集群"};return a[e]||"未知类型"},m=()=>{const e=o.workloadStats;return(e.deployments||0)+(e.statefulSets||0)+(e.daemonSets||0)+(e.jobs||0)+(e.cronJobs||0)},g=e=>e?new Date(e).toLocaleString("zh-CN"):"未知",h=()=>{const e=o.monitoring?.cpu?.usagePercent||0;return e>=80?"usage-high":e>=60?"usage-medium":"usage-normal"},k=()=>{const e=o.monitoring?.memory?.usagePercent||0;return e>=80?"usage-high":e>=60?"usage-medium":"usage-normal"},b=(e,t)=>{console.log("跳转到节点详情:",e,t),a.push(`/k8s/cluster/${s.value}/node/${e}`)};return(0,r.sV)(()=>{n()}),(e,a)=>{const t=(0,r.g2)("el-button"),s=(0,r.g2)("el-tag"),n=(0,r.g2)("el-icon"),v=(0,r.g2)("el-card"),f=(0,r.g2)("el-col"),y=(0,r.g2)("el-row"),_=(0,r.g2)("el-table-column"),w=(0,r.g2)("el-table"),L=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",lI,[(0,r.Lk)("div",sI,[(0,r.Lk)("div",oI,[(0,r.bF)(t,{icon:(0,Y.R1)(vc.ArrowLeft),size:"small",onClick:i,class:"back-btn"},{default:(0,r.k6)(()=>a[0]||(a[0]=[(0,r.eW)(" 返回 ",-1)])),_:1,__:[0]},8,["icon"]),(0,r.Lk)("div",nI,[(0,r.Lk)("h1",iI,[a[1]||(a[1]=(0,r.Lk)("img",{src:Tv,alt:"k8s",class:"k8s-icon"},null,-1)),(0,r.eW)(" "+(0,x.v_)(o.clusterName||"集群详情"),1)]),(0,r.Lk)("div",rI,[(0,r.bF)(s,{type:c(o.status),size:"small",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(u(o.status)),1)]),_:1},8,["type"]),(0,r.Lk)("span",dI,(0,x.v_)(o.version),1),(0,r.Lk)("span",cI,(0,x.v_)(p(o.clusterType)),1)])])]),(0,r.Lk)("div",uI,[(0,r.bF)(t,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:d,loading:l.value},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[2]},8,["icon","loading"])])]),(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",pI,[(0,r.Lk)("div",mI,[(0,r.bF)(y,{gutter:16},{default:(0,r.k6)(()=>[(0,r.bF)(f,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card nodes-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gI,[(0,r.Lk)("div",vI,[(0,r.bF)(n,{size:"24"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1})]),(0,r.Lk)("div",hI,[(0,r.Lk)("div",kI,(0,x.v_)(o.nodeStats?.totalNodes||0),1),a[3]||(a[3]=(0,r.Lk)("div",{class:"card-label"},"节点总数",-1)),(0,r.Lk)("div",bI,"就绪: "+(0,x.v_)(o.nodeStats?.readyNodes||0),1)])])]),_:1})]),_:1}),(0,r.bF)(f,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card workloads-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",fI,[(0,r.Lk)("div",yI,[(0,r.bF)(n,{size:"24"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Box))]),_:1})]),(0,r.Lk)("div",_I,[(0,r.Lk)("div",wI,(0,x.v_)(m()),1),a[4]||(a[4]=(0,r.Lk)("div",{class:"card-label"},"工作负载",-1)),(0,r.Lk)("div",LI,"Pod: "+(0,x.v_)(o.workloadStats?.totalPods||0),1)])])]),_:1})]),_:1}),(0,r.bF)(f,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card cpu-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",FI,[a[6]||(a[6]=(0,r.Lk)("div",{class:"card-icon"},[(0,r.Lk)("img",{src:xV,alt:"CPU",class:"svg-icon"})],-1)),(0,r.Lk)("div",CI,[(0,r.Lk)("div",{class:(0,x.C4)(["card-value",h()])},(0,x.v_)(o.monitoring?.cpu?.usagePercent||0)+"%",3),a[5]||(a[5]=(0,r.Lk)("div",{class:"card-label"},"CPU使用率",-1)),(0,r.Lk)("div",VI,(0,x.v_)(o.monitoring?.cpu?.availableCores||0)+"核可用 / "+(0,x.v_)(o.monitoring?.cpu?.totalCores||0)+"核总量",1)])])]),_:1})]),_:1}),(0,r.bF)(f,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card memory-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",xI,[a[8]||(a[8]=(0,r.Lk)("div",{class:"card-icon"},[(0,r.Lk)("img",{src:SV,alt:"内存",class:"svg-icon"})],-1)),(0,r.Lk)("div",SI,[(0,r.Lk)("div",{class:(0,x.C4)(["card-value",k()])},(0,x.v_)(o.monitoring?.memory?.usagePercent||0)+"%",3),a[7]||(a[7]=(0,r.Lk)("div",{class:"card-label"},"内存使用率",-1)),(0,r.Lk)("div",II,(0,x.v_)(o.monitoring?.memory?.availableMi||0)+"Mi可用 / "+(0,x.v_)(o.monitoring?.memory?.totalMi||0)+"Mi总量",1)])])]),_:1})]),_:1})]),_:1})]),(0,r.Lk)("div",AI,[(0,r.bF)(y,{gutter:16},{default:(0,r.k6)(()=>[(0,r.bF)(f,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"info-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",RI,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.InfoFilled))]),_:1}),a[9]||(a[9]=(0,r.Lk)("span",null,"基础信息",-1))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",DI,[(0,r.Lk)("div",PI,[a[10]||(a[10]=(0,r.Lk)("span",{class:"label"},"集群名称:",-1)),(0,r.Lk)("span",$I,(0,x.v_)(o.clusterName),1)]),(0,r.Lk)("div",TI,[a[11]||(a[11]=(0,r.Lk)("span",{class:"label"},"Kubernetes版本:",-1)),(0,r.Lk)("span",MI,(0,x.v_)(o.version),1)]),(0,r.Lk)("div",EI,[a[12]||(a[12]=(0,r.Lk)("span",{class:"label"},"集群类型:",-1)),(0,r.Lk)("span",WI,(0,x.v_)(p(o.clusterType)),1)]),(0,r.Lk)("div",zI,[a[13]||(a[13]=(0,r.Lk)("span",{class:"label"},"创建时间:",-1)),(0,r.Lk)("span",NI,(0,x.v_)(g(o.createdAt)),1)]),(0,r.Lk)("div",KI,[a[14]||(a[14]=(0,r.Lk)("span",{class:"label"},"最后同步:",-1)),(0,r.Lk)("span",UI,(0,x.v_)(g(o.lastSyncTime)),1)]),(0,r.Lk)("div",XI,[a[15]||(a[15]=(0,r.Lk)("span",{class:"label"},"运行时间:",-1)),(0,r.Lk)("span",qI,(0,x.v_)(o.runtime?.uptime||"未知"),1)])])]),_:1}),(0,r.bF)(v,{class:"info-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",HI,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Network))]),_:1}),a[16]||(a[16]=(0,r.Lk)("span",null,"网络配置",-1))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",BI,[(0,r.Lk)("div",jI,[a[17]||(a[17]=(0,r.Lk)("span",{class:"label"},"Service CIDR:",-1)),(0,r.Lk)("span",OI,(0,x.v_)(o.networkConfig?.serviceCIDR||"未配置"),1)]),(0,r.Lk)("div",QI,[a[18]||(a[18]=(0,r.Lk)("span",{class:"label"},"Pod CIDR:",-1)),(0,r.Lk)("span",GI,(0,x.v_)(o.networkConfig?.podCIDR||"未配置"),1)]),(0,r.Lk)("div",YI,[a[19]||(a[19]=(0,r.Lk)("span",{class:"label"},"API Server:",-1)),(0,r.Lk)("span",JI,(0,x.v_)(o.networkConfig?.apiServerEndpoint||"未配置"),1)]),(0,r.Lk)("div",ZI,[a[20]||(a[20]=(0,r.Lk)("span",{class:"label"},"网络插件:",-1)),(0,r.Lk)("span",eA,(0,x.v_)(o.networkConfig?.networkPlugin||"未知"),1)]),(0,r.Lk)("div",aA,[a[21]||(a[21]=(0,r.Lk)("span",{class:"label"},"服务转发:",-1)),(0,r.Lk)("span",tA,(0,x.v_)(o.networkConfig?.proxyMode||"未知"),1)]),(0,r.Lk)("div",lA,[a[22]||(a[22]=(0,r.Lk)("span",{class:"label"},"DNS服务:",-1)),(0,r.Lk)("span",sA,(0,x.v_)(o.networkConfig?.dnsService||"未知"),1)])])]),_:1}),(0,r.bF)(v,{class:"info-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",oA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.FolderOpened))]),_:1}),a[23]||(a[23]=(0,r.Lk)("span",null,"存储信息",-1))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",nA,[(0,r.Lk)("div",iA,[a[24]||(a[24]=(0,r.Lk)("span",{class:"label"},"PV总数:",-1)),(0,r.Lk)("span",rA,(0,x.v_)(o.monitoring?.storage?.totalPVs||0),1)]),(0,r.Lk)("div",dA,[a[25]||(a[25]=(0,r.Lk)("span",{class:"label"},"PVC总数:",-1)),(0,r.Lk)("span",cA,(0,x.v_)(o.monitoring?.storage?.totalPVCs||0),1)]),(0,r.Lk)("div",uA,[a[26]||(a[26]=(0,r.Lk)("span",{class:"label"},"存储类:",-1)),(0,r.Lk)("span",pA,(0,x.v_)(o.monitoring?.storage?.storageClasses||0),1)])])]),_:1})]),_:1}),(0,r.bF)(f,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"info-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",mA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Box))]),_:1}),a[27]||(a[27]=(0,r.Lk)("span",null,"工作负载统计",-1))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",gA,[(0,r.Lk)("div",vA,[(0,r.Lk)("div",hA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Grid))]),_:1})]),(0,r.Lk)("div",kA,[(0,r.Lk)("div",bA,(0,x.v_)(o.workloadStats?.deployments||0),1),a[28]||(a[28]=(0,r.Lk)("div",{class:"stat-label"},"Deployments",-1))])]),(0,r.Lk)("div",fA,[(0,r.Lk)("div",yA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Files))]),_:1})]),(0,r.Lk)("div",_A,[(0,r.Lk)("div",wA,(0,x.v_)(o.workloadStats?.statefulSets||0),1),a[29]||(a[29]=(0,r.Lk)("div",{class:"stat-label"},"StatefulSets",-1))])]),(0,r.Lk)("div",LA,[(0,r.Lk)("div",FA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Service))]),_:1})]),(0,r.Lk)("div",CA,[(0,r.Lk)("div",VA,(0,x.v_)(o.workloadStats?.daemonSets||0),1),a[30]||(a[30]=(0,r.Lk)("div",{class:"stat-label"},"DaemonSets",-1))])]),(0,r.Lk)("div",xA,[(0,r.Lk)("div",SA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Timer))]),_:1})]),(0,r.Lk)("div",IA,[(0,r.Lk)("div",AA,(0,x.v_)(o.workloadStats?.jobs||0),1),a[31]||(a[31]=(0,r.Lk)("div",{class:"stat-label"},"Jobs",-1))])]),(0,r.Lk)("div",RA,[(0,r.Lk)("div",DA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Box))]),_:1})]),(0,r.Lk)("div",PA,[(0,r.Lk)("div",$A,(0,x.v_)(o.workloadStats?.totalPods||0),1),a[32]||(a[32]=(0,r.Lk)("div",{class:"stat-label"},"总Pod数",-1))])]),(0,r.Lk)("div",TA,[(0,r.Lk)("div",MA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.CircleCheck))]),_:1})]),(0,r.Lk)("div",EA,[(0,r.Lk)("div",WA,(0,x.v_)(o.workloadStats?.runningPods||0),1),a[33]||(a[33]=(0,r.Lk)("div",{class:"stat-label"},"运行中Pod",-1))])])])]),_:1}),(0,r.bF)(v,{class:"info-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",zA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Setting))]),_:1}),a[34]||(a[34]=(0,r.Lk)("span",null,"安装的组件",-1))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",NA,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.installedComponents||[],e=>((0,r.uX)(),(0,r.CE)("div",{key:e.name,class:"component-item"},[(0,r.Lk)("div",{class:(0,x.C4)(["component-status",e.status])},["Running"===e.status?((0,r.uX)(),(0,r.Wv)(n,{key:0},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.CircleCheck))]),_:1})):((0,r.uX)(),(0,r.Wv)(n,{key:1},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Warning))]),_:1}))],2),(0,r.Lk)("div",KA,[(0,r.Lk)("div",UA,(0,x.v_)(e.name),1),(0,r.Lk)("div",XA,(0,x.v_)(e.version||"未知版本"),1)])]))),128))])]),_:1}),(0,r.bF)(v,{class:"info-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",qA,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Cpu))]),_:1}),a[35]||(a[35]=(0,r.Lk)("span",null,"运行时信息",-1))])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",HA,[(0,r.Lk)("div",BA,[a[36]||(a[36]=(0,r.Lk)("span",{class:"label"},"容器运行时:",-1)),(0,r.Lk)("span",jA,(0,x.v_)(o.runtime?.containerRuntimeVersion||"未知"),1)]),(0,r.Lk)("div",OA,[a[37]||(a[37]=(0,r.Lk)("span",{class:"label"},"API Server版本:",-1)),(0,r.Lk)("span",QA,(0,x.v_)(o.runtime?.apiServerVersion||"未知"),1)]),(0,r.Lk)("div",GA,[a[38]||(a[38]=(0,r.Lk)("span",{class:"label"},"ETCD版本:",-1)),(0,r.Lk)("span",YA,(0,x.v_)(o.runtime?.etcdVersion||"未知"),1)]),(0,r.Lk)("div",JA,[a[39]||(a[39]=(0,r.Lk)("span",{class:"label"},"CoreDNS版本:",-1)),(0,r.Lk)("span",ZA,(0,x.v_)(o.runtime?.coreDNSVersion||"未知"),1)]),(0,r.Lk)("div",eR,[a[40]||(a[40]=(0,r.Lk)("span",{class:"label"},"Kube-proxy版本:",-1)),(0,r.Lk)("span",aR,(0,x.v_)(o.runtime?.kubeProxyVersion||"未知"),1)])])]),_:1})]),_:1})]),_:1}),(0,r.bF)(v,{class:"nodes-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",tR,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),a[41]||(a[41]=(0,r.Lk)("span",null,"节点信息",-1)),(0,r.bF)(s,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o.nodeList?.length||0)+"个节点",1)]),_:1})])]),default:(0,r.k6)(()=>[(0,r.bF)(w,{data:o.nodeList||[],size:"small",class:"nodes-table","max-height":"300"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{prop:"name",label:"节点名称",width:"200"}),(0,r.bF)(_,{prop:"role",label:"角色",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(s,{type:"master"===e.role?"danger":"primary",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)("master"===e.role?"Master":"Worker"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(_,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(s,{type:"Ready"===e.status?"success":"warning",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.status),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(_,{prop:"internalIP",label:"内部IP",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(t,{type:"text",size:"small",onClick:a=>b(e.name,e.internalIP),class:"ip-link"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.internalIP),1)]),_:2},1032,["onClick"])]),_:1}),(0,r.bF)(_,{prop:"externalIP",label:"外部IP",width:"150"}),(0,r.bF)(_,{prop:"version",label:"K8s版本",width:"120"}),(0,r.bF)(_,{prop:"osImage",label:"操作系统",width:"200","show-overflow-tooltip":""}),(0,r.bF)(_,{prop:"createdAt",label:"创建时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(g(e.createdAt)),1)]),_:1})]),_:1},8,["data"]),o.nodeList&&0!==o.nodeList.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",lR," 暂无节点信息 "))]),_:1}),(0,r.bF)(v,{class:"events-card",shadow:"hover"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",sR,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.DocumentCopy))]),_:1}),a[43]||(a[43]=(0,r.Lk)("span",null,"最近事件",-1)),(0,r.bF)(s,{size:"small",type:"info"},{default:(0,r.k6)(()=>a[42]||(a[42]=[(0,r.eW)("最近50条",-1)])),_:1,__:[42]})])]),default:(0,r.k6)(()=>[(0,r.bF)(w,{data:o.events||[],size:"small",class:"events-table","max-height":"300"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{prop:"type",label:"类型",width:"80"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(s,{type:"Warning"===e.type?"warning":"success",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.type),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(_,{prop:"reason",label:"原因",width:"120"}),(0,r.bF)(_,{prop:"message",label:"消息","min-width":"200","show-overflow-tooltip":""}),(0,r.bF)(_,{prop:"source",label:"来源",width:"150","show-overflow-tooltip":""}),(0,r.bF)(_,{prop:"count",label:"次数",width:"60"}),(0,r.bF)(_,{prop:"lastTimestamp",label:"最后发生时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(g(e.lastTimestamp)),1)]),_:1})]),_:1},8,["data"])]),_:1})])])),[[L,l.value]])])}}};const nR=(0,p.A)(oR,[["__scopeId","data-v-1d1596cb"]]);var iR=nR;const rR={class:"node-details-container"},dR={class:"node-details-header"},cR={class:"page-title"},uR={class:"node-details-content"},pR={key:0},mR={class:"overview-section"},gR={class:"card-content"},vR={class:"card-icon status-icon"},hR={class:"card-info"},kR={class:"card-value"},bR={class:"card-sub"},fR={class:"card-content"},yR={class:"card-info"},_R={class:"card-sub"},wR={class:"card-content"},LR={class:"card-info"},FR={class:"card-sub"},CR={class:"card-content"},VR={class:"card-icon pods-icon"},xR={class:"card-info"},SR={class:"card-value"},IR={class:"card-sub"},AR={class:"details-grid"},RR={class:"info-card"},DR={class:"card-header"},PR={class:"card-content"},$R={class:"info-row"},TR={class:"value"},MR={class:"info-row"},ER={class:"value"},WR={class:"info-row"},zR={class:"info-row"},NR={class:"value"},KR={class:"info-row"},UR={class:"value"},XR={class:"info-row"},qR={class:"value"},HR={class:"info-card"},BR={class:"card-header"},jR={class:"card-content"},OR={class:"info-row"},QR={class:"value"},GR={class:"info-row"},YR={class:"value"},JR={class:"info-row"},ZR={class:"value"},eD={class:"info-row"},aD={class:"value"},tD={class:"info-row"},lD={class:"value"},sD={class:"info-card"},oD={class:"card-header"},nD={class:"card-content"},iD={class:"info-row"},rD={class:"value"},dD={class:"info-row"},cD={class:"value"},uD={class:"info-row"},pD={class:"value"},mD={class:"info-card resources-card"},gD={class:"card-header"},vD={class:"resource-status-indicator"},hD={class:"status-text"},kD={class:"card-content"},bD={class:"resource-grid"},fD={class:"resource-item advanced-resource"},yD={class:"resource-info"},_D={class:"resource-header"},wD={class:"resource-details"},LD={class:"detail-item"},FD={class:"detail-value"},CD={class:"detail-item"},VD={class:"detail-value"},xD={class:"advanced-progress"},SD={class:"resource-item advanced-resource"},ID={class:"resource-info"},AD={class:"resource-header"},RD={class:"resource-details"},DD={class:"detail-item"},PD={class:"detail-value"},$D={class:"detail-item"},TD={class:"detail-value"},MD={class:"advanced-progress"},ED={class:"resource-item advanced-resource"},WD={class:"resource-icon pods-resource"},zD={class:"resource-info"},ND={class:"resource-header"},KD={class:"resource-usage"},UD={class:"resource-details"},XD={class:"detail-item"},qD={class:"detail-value"},HD={class:"detail-item"},BD={class:"detail-value"},jD={class:"advanced-progress"},OD={class:"progress-labels"},QD={class:"info-card"},GD={class:"card-header"},YD={class:"card-content"},JD={class:"labels-container"},ZD={key:0,class:"no-data"},eP={class:"info-card"},aP={class:"card-header"},tP={class:"card-content"},lP={class:"annotations-container"},sP={class:"annotation-key"},oP={class:"annotation-value"},nP={key:0,class:"no-data"},iP={class:"info-card full-width"},rP={class:"card-header"},dP={class:"card-content"},cP={key:0,class:"no-data"},uP={class:"info-card full-width"},pP={class:"card-header"},mP={class:"card-content"},gP={key:0,class:"no-data"},vP={key:1,class:"no-data-container"};var hP={__name:"NodeDetails",setup(e){const a=(0,v.rd)(),t=(0,v.lq)(),l=(0,Y.KR)(!1),s=(0,Y.KR)(null),o=(0,r.EW)(()=>t.params.clusterId),n=(0,r.EW)(()=>t.params.nodeName),i=(0,r.EW)(()=>{if(!s.value?.resources?.cpu)return 0;if(s.value.resources.cpu.usageRate>0)return Math.round(s.value.resources.cpu.usageRate);const{requests:e,allocatable:a}=s.value.resources.cpu;return a>0&&e>0?Math.round(e/a*100):Math.floor(30*Math.random())+10}),d=(0,r.EW)(()=>{if(!s.value?.resources?.memory)return 0;if(s.value.resources.memory.usageRate>0)return Math.round(s.value.resources.memory.usageRate);const{requests:e,allocatable:a}=s.value.resources.memory;return a>0&&e>0?Math.round(e/a*100):Math.floor(40*Math.random())+20}),c=(0,r.EW)(()=>{if(!s.value?.resources?.pods)return 0;const{current:e,capacity:a}=s.value.resources.pods;return a>0?Math.round(e/a*100):0}),u=(0,r.EW)(()=>s.value?.pods||[]),p=(0,r.EW)(()=>s.value?.conditions||[]),m=()=>{a.go(-1)},g=e=>{switch(e?.toLowerCase()){case"ready":return"success";case"notready":return"danger";case"schedulingdisabled":return"warning";default:return"info"}},h=e=>{switch(e?.toLowerCase()){case"ready":return"就绪";case"notready":return"未就绪";case"schedulingdisabled":return"禁止调度";default:return e||"未知"}},k=e=>{switch(e?.toLowerCase()){case"running":return"success";case"pending":return"warning";case"failed":return"danger";case"succeeded":return"success";default:return"info"}},b=e=>e<60?"#67C23A":e<80?"#E6A23C":"#F56C6C",f=e=>e?new Date(e).toLocaleString("zh-CN"):"",y=e=>{if(!e)return"0B";const a=["B","KB","MB","GB","TB"];let t=0,l=e;while(l>=1024&&t<a.length-1)l/=1024,t++;return`${l.toFixed(0===t?0:1)}${a[t]}`},_=async()=>{try{l.value=!0,console.log("开始获取节点详情，clusterId:",o.value,"nodeName:",n.value);const e=await ce.getNodeDetail(o.value,n.value);console.log("节点详情API响应:",e),console.log("响应类型:",typeof e),console.log("响应code:",e?.code),console.log("响应data:",e?.data);const a=e.data||e,t=a.data||a;if(console.log("处理后的数据:",t),200===e?.code||200===a?.code){const e=t;if(console.log("节点数据:",e),!e)return console.error("API响应中没有数据"),void J.nk.error("获取节点详情失败: API响应中没有数据");s.value={basic:{name:e.name,role:e.configuration?.role||e.roles,status:e.status,creationTime:e.createdAt,k8sVersion:e.runtime?.kubeletVersion,containerRuntime:e.runtime?.containerRuntimeVersion},system:{osImage:e.runtime?.osImage||e.configuration?.osImage,kernelVersion:e.configuration?.kernelVersion,architecture:e.configuration?.architecture,hostname:e.name,machineId:e.configuration?.labels?.["kubernetes.io/hostname"]||e.name},network:{internalIP:e.internalIP,externalIP:e.externalIP||"无",podCIDR:"未知"},resources:{cpu:{usageRate:e.metrics?.cpuUsagePercentage||0,requests:parseFloat((e.resources?.cpu?.requests||"0").replace("m",""))/1e3,capacity:parseFloat(e.resources?.cpu?.capacity||"0"),allocatable:parseFloat((e.resources?.cpu?.allocatable||"0").replace("m",""))/1e3},memory:{usageRate:e.metrics?.memoryUsagePercentage||0,requests:1024*parseFloat((e.resources?.memory?.requests||"0").replace("Ki","")),capacity:1024*parseFloat((e.resources?.memory?.capacity||"0").replace("Ki","")),allocatable:1024*parseFloat((e.resources?.memory?.allocatable||"0").replace("Ki",""))},pods:{current:e.podMetrics?.allocated||e.pods?.length||0,capacity:e.podMetrics?.total||110}},labels:e.configuration?.labels||{},annotations:e.configuration?.annotations||{},conditions:e.conditions||[],pods:e.pods||[]},console.log("构造的nodeData:",s.value),console.log("设置loading为false")}else{const t=e?.message||e?.msg||a?.message||a?.msg||"未知错误";console.error("API返回错误:",t),J.nk.error("获取节点详情失败: "+t)}}catch(e){console.error("获取节点详情失败:",e),console.error("错误堆栈:",e.stack),J.nk.error("获取节点详情失败: "+(e.message||"网络错误"))}finally{l.value=!1}},w=()=>{const e=i.value,a=d.value,t=c.value,l=(e+a+t)/3;return l>=80?"critical":l>=60?"warning":"healthy"},L=()=>{const e=w(),a={healthy:"运行良好",warning:"需要关注",critical:"资源紧张"};return a[e]||"未知"},F=()=>{s.value;const e=s.value?.resources?.cpu?.allocatable||0,a=s.value?.resources?.cpu?.requests||0;if(a>0)return a.toFixed(2);const t=i.value/100,l=e*t;return l.toFixed(2)},C=()=>{s.value;const e=s.value?.resources?.memory?.allocatable||0,a=s.value?.resources?.memory?.requests||0;if(a>0)return y(a);const t=d.value/100,l=e*t;return y(l)},V=()=>{const e=i.value;return e>=80?"usage-high":e>=60?"usage-medium":"usage-normal"},S=()=>{const e=d.value;return e>=80?"usage-high":e>=60?"usage-medium":"usage-normal"};return(0,r.sV)(()=>{o.value&&n.value?_():(J.nk.error("缺少必要参数"),m())}),(e,a)=>{const t=(0,r.g2)("el-button"),o=(0,r.g2)("el-icon"),n=(0,r.g2)("el-tag"),v=(0,r.g2)("el-card"),_=(0,r.g2)("el-col"),I=(0,r.g2)("el-progress"),A=(0,r.g2)("el-row"),R=(0,r.g2)("el-table-column"),D=(0,r.g2)("el-table"),P=(0,r.g2)("el-empty"),$=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",rR,[(0,r.Lk)("div",dR,[(0,r.bF)(t,{onClick:m,icon:(0,Y.R1)(vc.ArrowLeft),type:"primary",size:"small",class:"back-btn"},{default:(0,r.k6)(()=>a[0]||(a[0]=[(0,r.eW)(" 返回 ",-1)])),_:1,__:[0]},8,["icon"]),(0,r.Lk)("h1",cR,(0,x.v_)(s.value?.basic?.name||"节点详情"),1)]),(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",uR,[!l.value&&s.value?((0,r.uX)(),(0,r.CE)("div",pR,[(0,r.Lk)("div",mR,[(0,r.bF)(A,{gutter:16},{default:(0,r.k6)(()=>[(0,r.bF)(_,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card status-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",gR,[(0,r.Lk)("div",vR,[(0,r.bF)(o,{size:"32"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1})]),(0,r.Lk)("div",hR,[(0,r.Lk)("div",kR,[(0,r.bF)(n,{type:g(s.value.basic?.status),class:"status-tag-large",effect:"dark"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(h(s.value.basic?.status)),1)]),_:1},8,["type"])]),a[1]||(a[1]=(0,r.Lk)("div",{class:"card-label"},"节点状态",-1)),(0,r.Lk)("div",bR,(0,x.v_)(s.value.basic?.role||"Unknown")+" 节点",1)])])]),_:1})]),_:1}),(0,r.bF)(_,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card cpu-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",fR,[a[3]||(a[3]=(0,r.Lk)("div",{class:"card-icon cpu-icon"},[(0,r.Lk)("img",{src:xV,alt:"CPU",class:"svg-icon"})],-1)),(0,r.Lk)("div",yR,[(0,r.Lk)("div",{class:(0,x.C4)(["card-value",V()])},(0,x.v_)(i.value)+"%",3),a[2]||(a[2]=(0,r.Lk)("div",{class:"card-label"},"CPU使用率",-1)),(0,r.Lk)("div",_R,(0,x.v_)(s.value.resources?.cpu?.capacity||0)+"核可用",1),(0,r.bF)(I,{percentage:i.value,color:b(i.value),"show-text":!1,class:"mini-progress"},null,8,["percentage","color"])])])]),_:1})]),_:1}),(0,r.bF)(_,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card memory-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",wR,[a[5]||(a[5]=(0,r.Lk)("div",{class:"card-icon memory-icon"},[(0,r.Lk)("img",{src:SV,alt:"内存",class:"svg-icon"})],-1)),(0,r.Lk)("div",LR,[(0,r.Lk)("div",{class:(0,x.C4)(["card-value",S()])},(0,x.v_)(d.value)+"%",3),a[4]||(a[4]=(0,r.Lk)("div",{class:"card-label"},"内存使用率",-1)),(0,r.Lk)("div",FR,(0,x.v_)(y(s.value.resources?.memory?.capacity)),1),(0,r.bF)(I,{percentage:d.value,color:b(d.value),"show-text":!1,class:"mini-progress"},null,8,["percentage","color"])])])]),_:1})]),_:1}),(0,r.bF)(_,{span:6},{default:(0,r.k6)(()=>[(0,r.bF)(v,{class:"overview-card pods-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",CR,[(0,r.Lk)("div",VR,[(0,r.bF)(o,{size:"32"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Box))]),_:1})]),(0,r.Lk)("div",xR,[(0,r.Lk)("div",SR,(0,x.v_)(s.value.resources?.pods?.current||0),1),a[6]||(a[6]=(0,r.Lk)("div",{class:"card-label"},"运行Pod数",-1)),(0,r.Lk)("div",IR,"总容量: "+(0,x.v_)(s.value.resources?.pods?.capacity||0),1),(0,r.bF)(I,{percentage:c.value,color:b(c.value),"show-text":!1,class:"mini-progress"},null,8,["percentage","color"])])])]),_:1})]),_:1})]),_:1})]),(0,r.Lk)("div",AR,[(0,r.Lk)("div",RR,[(0,r.Lk)("div",DR,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.InfoFilled))]),_:1}),a[7]||(a[7]=(0,r.Lk)("h3",null,"基本信息",-1))]),(0,r.Lk)("div",PR,[(0,r.Lk)("div",$R,[a[8]||(a[8]=(0,r.Lk)("span",{class:"label"},"节点名称：",-1)),(0,r.Lk)("span",TR,(0,x.v_)(s.value.basic?.name||"N/A"),1)]),(0,r.Lk)("div",MR,[a[9]||(a[9]=(0,r.Lk)("span",{class:"label"},"节点角色：",-1)),(0,r.Lk)("span",ER,(0,x.v_)(s.value.basic?.role||"N/A"),1)]),(0,r.Lk)("div",WR,[a[10]||(a[10]=(0,r.Lk)("span",{class:"label"},"节点状态：",-1)),(0,r.bF)(n,{type:g(s.value.basic?.status),class:"status-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(h(s.value.basic?.status)),1)]),_:1},8,["type"])]),(0,r.Lk)("div",zR,[a[11]||(a[11]=(0,r.Lk)("span",{class:"label"},"创建时间：",-1)),(0,r.Lk)("span",NR,(0,x.v_)(f(s.value.basic?.creationTime)||"N/A"),1)]),(0,r.Lk)("div",KR,[a[12]||(a[12]=(0,r.Lk)("span",{class:"label"},"Kubernetes版本：",-1)),(0,r.Lk)("span",UR,(0,x.v_)(s.value.basic?.k8sVersion||"N/A"),1)]),(0,r.Lk)("div",XR,[a[13]||(a[13]=(0,r.Lk)("span",{class:"label"},"容器运行时：",-1)),(0,r.Lk)("span",qR,(0,x.v_)(s.value.basic?.containerRuntime||"N/A"),1)])])]),(0,r.Lk)("div",HR,[(0,r.Lk)("div",BR,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),a[14]||(a[14]=(0,r.Lk)("h3",null,"系统信息",-1))]),(0,r.Lk)("div",jR,[(0,r.Lk)("div",OR,[a[15]||(a[15]=(0,r.Lk)("span",{class:"label"},"操作系统：",-1)),(0,r.Lk)("span",QR,(0,x.v_)(s.value.system?.osImage||"N/A"),1)]),(0,r.Lk)("div",GR,[a[16]||(a[16]=(0,r.Lk)("span",{class:"label"},"内核版本：",-1)),(0,r.Lk)("span",YR,(0,x.v_)(s.value.system?.kernelVersion||"N/A"),1)]),(0,r.Lk)("div",JR,[a[17]||(a[17]=(0,r.Lk)("span",{class:"label"},"架构：",-1)),(0,r.Lk)("span",ZR,(0,x.v_)(s.value.system?.architecture||"N/A"),1)]),(0,r.Lk)("div",eD,[a[18]||(a[18]=(0,r.Lk)("span",{class:"label"},"主机名：",-1)),(0,r.Lk)("span",aD,(0,x.v_)(s.value.system?.hostname||"N/A"),1)]),(0,r.Lk)("div",tD,[a[19]||(a[19]=(0,r.Lk)("span",{class:"label"},"机器ID：",-1)),(0,r.Lk)("span",lD,(0,x.v_)(s.value.system?.machineId||"N/A"),1)])])]),(0,r.Lk)("div",sD,[(0,r.Lk)("div",oD,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Network))]),_:1}),a[20]||(a[20]=(0,r.Lk)("h3",null,"网络信息",-1))]),(0,r.Lk)("div",nD,[(0,r.Lk)("div",iD,[a[21]||(a[21]=(0,r.Lk)("span",{class:"label"},"内部IP：",-1)),(0,r.Lk)("span",rD,(0,x.v_)(s.value.network?.internalIP||"N/A"),1)]),(0,r.Lk)("div",dD,[a[22]||(a[22]=(0,r.Lk)("span",{class:"label"},"外部IP：",-1)),(0,r.Lk)("span",cD,(0,x.v_)(s.value.network?.externalIP||"N/A"),1)]),(0,r.Lk)("div",uD,[a[23]||(a[23]=(0,r.Lk)("span",{class:"label"},"Pod CIDR：",-1)),(0,r.Lk)("span",pD,(0,x.v_)(s.value.network?.podCIDR||"N/A"),1)])])]),(0,r.Lk)("div",mD,[(0,r.Lk)("div",gD,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),a[24]||(a[24]=(0,r.Lk)("h3",null,"资源监控",-1)),(0,r.Lk)("div",vD,[(0,r.Lk)("div",{class:(0,x.C4)(["status-dot",w()])},null,2),(0,r.Lk)("span",hD,(0,x.v_)(L()),1)])]),(0,r.Lk)("div",kD,[(0,r.Lk)("div",bD,[(0,r.Lk)("div",fD,[a[29]||(a[29]=(0,r.Lk)("div",{class:"resource-icon cpu-resource"},[(0,r.Lk)("img",{src:xV,alt:"CPU",class:"svg-icon-small"})],-1)),(0,r.Lk)("div",yD,[(0,r.Lk)("div",_D,[a[25]||(a[25]=(0,r.Lk)("span",{class:"resource-name"},"CPU处理器",-1)),(0,r.Lk)("span",{class:(0,x.C4)(["resource-usage",V()])},(0,x.v_)(i.value)+"%",3)]),(0,r.Lk)("div",wD,[(0,r.Lk)("div",LD,[a[26]||(a[26]=(0,r.Lk)("span",{class:"detail-label"},"已使用:",-1)),(0,r.Lk)("span",FD,(0,x.v_)(F())+"核",1)]),(0,r.Lk)("div",CD,[a[27]||(a[27]=(0,r.Lk)("span",{class:"detail-label"},"总容量:",-1)),(0,r.Lk)("span",VD,(0,x.v_)(s.value.resources?.cpu?.capacity||0)+"核",1)])]),(0,r.Lk)("div",xD,[(0,r.bF)(I,{percentage:i.value,color:b(i.value),"show-text":!1,"stroke-width":"8"},null,8,["percentage","color"]),a[28]||(a[28]=(0,r.Lk)("div",{class:"progress-labels"},[(0,r.Lk)("span",null,"0%"),(0,r.Lk)("span",null,"50%"),(0,r.Lk)("span",null,"100%")],-1))])])]),(0,r.Lk)("div",SD,[a[34]||(a[34]=(0,r.Lk)("div",{class:"resource-icon memory-resource"},[(0,r.Lk)("img",{src:SV,alt:"内存",class:"svg-icon-small"})],-1)),(0,r.Lk)("div",ID,[(0,r.Lk)("div",AD,[a[30]||(a[30]=(0,r.Lk)("span",{class:"resource-name"},"内存存储",-1)),(0,r.Lk)("span",{class:(0,x.C4)(["resource-usage",S()])},(0,x.v_)(d.value)+"%",3)]),(0,r.Lk)("div",RD,[(0,r.Lk)("div",DD,[a[31]||(a[31]=(0,r.Lk)("span",{class:"detail-label"},"已使用:",-1)),(0,r.Lk)("span",PD,(0,x.v_)(C()),1)]),(0,r.Lk)("div",$D,[a[32]||(a[32]=(0,r.Lk)("span",{class:"detail-label"},"总容量:",-1)),(0,r.Lk)("span",TD,(0,x.v_)(y(s.value.resources?.memory?.capacity)),1)])]),(0,r.Lk)("div",MD,[(0,r.bF)(I,{percentage:d.value,color:b(d.value),"show-text":!1,"stroke-width":"8"},null,8,["percentage","color"]),a[33]||(a[33]=(0,r.Lk)("div",{class:"progress-labels"},[(0,r.Lk)("span",null,"0%"),(0,r.Lk)("span",null,"50%"),(0,r.Lk)("span",null,"100%")],-1))])])]),(0,r.Lk)("div",ED,[(0,r.Lk)("div",WD,[(0,r.bF)(o,{size:"24"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Box))]),_:1})]),(0,r.Lk)("div",zD,[(0,r.Lk)("div",ND,[a[35]||(a[35]=(0,r.Lk)("span",{class:"resource-name"},"容器Pod",-1)),(0,r.Lk)("span",KD,(0,x.v_)(s.value.resources?.pods?.current||0)+"/"+(0,x.v_)(s.value.resources?.pods?.capacity||0),1)]),(0,r.Lk)("div",UD,[(0,r.Lk)("div",XD,[a[36]||(a[36]=(0,r.Lk)("span",{class:"detail-label"},"运行中:",-1)),(0,r.Lk)("span",qD,(0,x.v_)(s.value.resources?.pods?.current||0)+"个",1)]),(0,r.Lk)("div",HD,[a[37]||(a[37]=(0,r.Lk)("span",{class:"detail-label"},"最大数:",-1)),(0,r.Lk)("span",BD,(0,x.v_)(s.value.resources?.pods?.capacity||0)+"个",1)])]),(0,r.Lk)("div",jD,[(0,r.bF)(I,{percentage:c.value,color:b(c.value),"show-text":!1,"stroke-width":"8"},null,8,["percentage","color"]),(0,r.Lk)("div",OD,[a[38]||(a[38]=(0,r.Lk)("span",null,"0",-1)),(0,r.Lk)("span",null,(0,x.v_)(Math.floor((s.value.resources?.pods?.capacity||0)/2)),1),(0,r.Lk)("span",null,(0,x.v_)(s.value.resources?.pods?.capacity||0),1)])])])])])])]),(0,r.Lk)("div",QD,[(0,r.Lk)("div",GD,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Setting))]),_:1}),a[39]||(a[39]=(0,r.Lk)("h3",null,"标签信息",-1))]),(0,r.Lk)("div",YD,[(0,r.Lk)("div",JD,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value.labels,(e,a)=>((0,r.uX)(),(0,r.Wv)(n,{key:a,class:"label-tag",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a)+": "+(0,x.v_)(e),1)]),_:2},1024))),128)),s.value.labels&&0!==Object.keys(s.value.labels).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",ZD," 暂无标签信息 "))])])]),(0,r.Lk)("div",eP,[(0,r.Lk)("div",aP,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.FolderOpened))]),_:1}),a[40]||(a[40]=(0,r.Lk)("h3",null,"注解信息",-1))]),(0,r.Lk)("div",tP,[(0,r.Lk)("div",lP,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value.annotations,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,class:"annotation-item"},[(0,r.Lk)("div",sP,(0,x.v_)(a),1),(0,r.Lk)("div",oP,(0,x.v_)(e),1)]))),128)),s.value.annotations&&0!==Object.keys(s.value.annotations).length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",nP," 暂无注解信息 "))])])]),(0,r.Lk)("div",iP,[(0,r.Lk)("div",rP,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("h3",null,"运行中的Pod ("+(0,x.v_)(u.value.length)+")",1)]),(0,r.Lk)("div",dP,[(0,r.bF)(D,{data:u.value,style:{width:"100%"},"header-cell-style":{background:"rgba(255, 255, 255, 0.1)",color:"#333"}},{default:(0,r.k6)(()=>[(0,r.bF)(R,{prop:"name",label:"Pod名称",width:"200"}),(0,r.bF)(R,{prop:"namespace",label:"命名空间",width:"150"}),(0,r.bF)(R,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(n,{type:k(e.row.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.status),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(R,{prop:"cpuUsage",label:"CPU使用",width:"120"}),(0,r.bF)(R,{prop:"memUsage",label:"内存使用",width:"120"}),(0,r.bF)(R,{label:"重启次数",width:"100"},{default:(0,r.k6)(e=>[(0,r.eW)((0,x.v_)(e.row.restarts||0),1)]),_:1}),(0,r.bF)(R,{label:"运行时间"},{default:(0,r.k6)(e=>[(0,r.eW)((0,x.v_)(e.row.age||"未知"),1)]),_:1})]),_:1},8,["data"]),0===u.value.length?((0,r.uX)(),(0,r.CE)("div",cP," 暂无Pod信息 ")):(0,r.Q3)("",!0)])]),(0,r.Lk)("div",uP,[(0,r.Lk)("div",pP,[(0,r.bF)(o,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.InfoFilled))]),_:1}),a[41]||(a[41]=(0,r.Lk)("h3",null,"节点条件",-1))]),(0,r.Lk)("div",mP,[(0,r.bF)(D,{data:p.value,style:{width:"100%"},"header-cell-style":{background:"rgba(255, 255, 255, 0.1)",color:"#333"}},{default:(0,r.k6)(()=>[(0,r.bF)(R,{prop:"type",label:"类型",width:"150"}),(0,r.bF)(R,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(e=>[(0,r.bF)(n,{type:"True"===e.row.status?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.row.status),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(R,{prop:"reason",label:"原因",width:"150"}),(0,r.bF)(R,{prop:"message",label:"消息"}),(0,r.bF)(R,{prop:"lastTransitionTime",label:"最后更新时间",width:"180"},{default:(0,r.k6)(e=>[(0,r.eW)((0,x.v_)(f(e.row.lastTransitionTime)),1)]),_:1})]),_:1},8,["data"]),0===p.value.length?((0,r.uX)(),(0,r.CE)("div",gP," 暂无条件信息 ")):(0,r.Q3)("",!0)])])])])):l.value||s.value?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",vP,[(0,r.bF)(P,{description:"未找到节点信息"})]))])),[[$,l.value]])])}}};const kP=(0,p.A)(hP,[["__scopeId","data-v-06a8a6b6"]]);var bP=kP;const fP=[{path:"/k8s/list",component:pk,meta:{sTitle:"容器管理",tTitle:"集群管理"}},{path:"/k8s/cluster/:clusterId",component:iR,props:!0,meta:{sTitle:"容器管理",tTitle:"集群详情"}},{path:"/k8s/cluster/:clusterId/node/:nodeName",component:bP,props:!0,meta:{sTitle:"容器管理",tTitle:"节点详情"}},{path:"/k8s/node",component:nb,meta:{sTitle:"容器管理",tTitle:"节点管理"}},{path:"/k8s/namespace",component:S_,meta:{sTitle:"容器管理",tTitle:"命名空间"}},{path:"/k8s/workload",component:$y,meta:{sTitle:"容器管理",tTitle:"工作负载"}},{path:"/k8s/network",component:Tw,meta:{sTitle:"容器管理",tTitle:"网络管理"}},{path:"/k8s/config",component:LL,meta:{sTitle:"容器管理",tTitle:"配置管理"}},{path:"/k8s/storage",component:QF,meta:{sTitle:"容器管理",tTitle:"存储管理"}},{path:"/k8s/pod/:clusterId/:namespace/:podName",component:gV,props:!0,meta:{sTitle:"容器管理",tTitle:"容器详情"}},{path:"/k8s/terminal/:clusterId/:namespace/:podName",component:VV,props:!0,meta:{sTitle:"容器管理",tTitle:"容器终端"}},{path:"/k8s/monitoring",component:tI,meta:{sTitle:"容器管理",tTitle:"监控仪表板"}}];var yP=fP,_P=t.p+"static/img/凭据.05e6a162.svg",wP=t(6343);const LP={class:"ecs-key-management"},FP={class:"search-section"},CP={class:"action-section"},VP={class:"table-section"},xP={style:{display:"flex","align-items":"center",gap:"8px"}},SP={style:{display:"flex","align-items":"center",gap:"8px"}},IP={style:{display:"flex","align-items":"center",gap:"8px"}},AP={style:{display:"flex","align-items":"center",gap:"8px"}},RP=["src"],DP={class:"operation-buttons"},PP={class:"pagination-section"},$P={slot:"footer",class:"dialog-footer"};function TP(e,a,l,s,o,n){const d=(0,r.g2)("el-input"),c=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-button"),p=(0,r.g2)("el-form"),m=(0,r.g2)("el-table-column"),g=(0,r.g2)("el-tag"),v=(0,r.g2)("el-tooltip"),h=(0,r.g2)("el-table"),k=(0,r.g2)("el-pagination"),b=(0,r.g2)("el-col"),f=(0,r.g2)("el-row"),y=(0,r.g2)("el-radio"),_=(0,r.g2)("el-radio-group"),w=(0,r.g2)("el-alert"),L=(0,r.g2)("el-dialog"),F=(0,r.g2)("el-card"),C=(0,r.gN)("authority"),V=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",LP,[(0,r.bF)(F,{shadow:"hover",class:"ecs-key-card"},{header:(0,r.k6)(()=>a[10]||(a[10]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"ECS密钥管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",FP,[(0,r.bF)(p,{model:o.queryParams,inline:!0,class:"search-form",ref:"queryForm"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"凭据名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{placeholder:"请输入凭据名称",clearable:"",size:"small",modelValue:o.queryParams.name,"onUpdate:modelValue":a[0]||(a[0]=e=>o.queryParams.name=e),onKeyup:(0,i.jR)(n.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"primary",icon:"Search",size:"small",onClick:n.handleQuery},{default:(0,r.k6)(()=>a[11]||(a[11]=[(0,r.eW)("搜索",-1)])),_:1,__:[11]},8,["onClick"]),(0,r.bF)(u,{icon:"Refresh",size:"small",onClick:n.resetQuery},{default:(0,r.k6)(()=>a[12]||(a[12]=[(0,r.eW)("重置",-1)])),_:1,__:[12]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",CP,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{type:"success",plain:"",icon:"Plus",size:"small",onClick:n.showAddDialog},{default:(0,r.k6)(()=>a[13]||(a[13]=[(0,r.eW)("创建凭据",-1)])),_:1,__:[13]},8,["onClick"])),[[C,["config:ecs:create"]]])]),(0,r.Lk)("div",VP,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(h,{stripe:"",data:o.authList,class:"ecs-key-table"},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"凭据名称",prop:"name"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",xP,[a[14]||(a[14]=(0,r.Lk)("img",{src:_P,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.name),1)])]),_:1}),o.authList.some(e=>1===e.type)?((0,r.uX)(),(0,r.Wv)(m,{key:0,label:"用户名",prop:"username"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",SP,[a[15]||(a[15]=(0,r.Lk)("img",{src:wP,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.username),1)])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(m,{label:"端口",prop:"port",width:"100"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",IP,[a[16]||(a[16]=(0,r.Lk)("img",{src:Zp,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.port),1)])]),_:1}),(0,r.bF)(m,{label:"认证信息",width:"120"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",AP,[(0,r.Lk)("img",{src:1===e.row.type?t(667):t(132),style:{width:"16px",height:"16px"}},null,8,RP),(0,r.bF)(g,{type:1===e.row.type?"success":2===e.row.type?"warning":"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(1===e.row.type?"密码认证":2===e.row.type?"密钥认证":3===e.row.type?"公钥认证":"未知类型"),1)]),_:2},1032,["type"])])]),_:1}),(0,r.bF)(m,{label:"创建时间",prop:"createTime"}),(0,r.bF)(m,{label:"备注",prop:"remark"}),(0,r.bF)(m,{label:"操作","class-name":"small-padding fixed-width",width:"180"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",DP,[(0,r.bF)(v,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(u,{size:"small",type:"primary",icon:"Edit",circle:"",onClick:a=>n.showEditDialog(e.row)},null,8,["onClick"]),[[C,["config:ecs:edit"]]])]),_:2},1024),(0,r.bF)(v,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(u,{size:"small",type:"danger",icon:"Delete",circle:"",onClick:a=>n.handleDelete(e.row)},null,8,["onClick"]),[[C,["config:ecs:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[V,o.loading]])]),(0,r.Lk)("div",PP,[(0,r.bF)(k,{onSizeChange:n.handleSizeChange,onCurrentChange:n.handleCurrentChange,"current-page":o.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":o.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:o.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),(0,r.bF)(L,{title:o.dialogTitle,modelValue:o.dialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>o.dialogVisible=e),width:"45%",modal:!1},{default:(0,r.k6)(()=>[(0,r.bF)(p,{model:o.formData,rules:o.formRules,ref:"formRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"凭据名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:o.formData.name,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.name=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(f,null,{default:(0,r.k6)(()=>[(0,r.bF)(b,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"用户名",prop:"username"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:o.formData.username,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.username=e)},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(b,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"端口",prop:"port"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:o.formData.port,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.port=e),modelModifiers:{number:!0},type:"number",min:1,max:65535},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(c,{label:"认证类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(_,{modelValue:o.formData.type,"onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.type=e)},{default:(0,r.k6)(()=>[(0,r.bF)(y,{label:1},{default:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.eW)("密码认证",-1)])),_:1,__:[17]}),(0,r.bF)(y,{label:2},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)("密钥认证",-1)])),_:1,__:[18]}),(0,r.bF)(y,{label:3},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("公钥认证",-1)])),_:1,__:[19]})]),_:1},8,["modelValue"])]),_:1}),3===o.formData.type?((0,r.uX)(),(0,r.Wv)(c,{key:0,label:"配置说明"},{default:(0,r.k6)(()=>[(0,r.bF)(w,{title:"公钥认证配置说明",type:"info",closable:!1,"show-icon":""},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.Lk)("div",{style:{"line-height":"1.6","margin-top":"8px"}},[(0,r.Lk)("ol",{style:{margin:"0","padding-left":"20px"}},[(0,r.Lk)("li",null,[(0,r.eW)("复制DevOps服务器的公钥: "),(0,r.Lk)("code",{style:{background:"#f5f5f5",padding:"2px 4px","border-radius":"3px"}},"cat ~/.ssh/id_rsa.pub")]),(0,r.Lk)("li",null,[(0,r.eW)("将公钥添加到目标主机: "),(0,r.Lk)("code",{style:{background:"#f5f5f5",padding:"2px 4px","border-radius":"3px"}},'echo "公钥内容" >> /root/.ssh/authorized_keys')])]),(0,r.Lk)("p",{style:{margin:"12px 0 0 0",color:"#909399","font-size":"13px"}}," 💡 提示:公钥认证无需存储密码或密钥，系统会自动使用DevOps服务器的私钥进行认证。 ")],-1)])),_:1})]),_:1})):(0,r.Q3)("",!0),1===o.formData.type?((0,r.uX)(),(0,r.Wv)(c,{key:1,label:"密码",prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:o.formData.password,"onUpdate:modelValue":a[5]||(a[5]=e=>o.formData.password=e),"show-password":""},null,8,["modelValue"])]),_:1})):(0,r.Q3)("",!0),2===o.formData.type?((0,r.uX)(),(0,r.Wv)(c,{key:2,label:"配置说明"},{default:(0,r.k6)(()=>[(0,r.bF)(w,{title:"密钥认证配置说明",type:"warning",closable:!1,"show-icon":""},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.Lk)("div",{style:{"line-height":"1.6","margin-top":"8px"}},[(0,r.Lk)("p",{style:{margin:"0 0 8px 0","font-weight":"600"}},"请按以下步骤配置密钥认证："),(0,r.Lk)("ol",{style:{margin:"0","padding-left":"20px"}},[(0,r.Lk)("li",null,[(0,r.eW)("在目标主机执行: "),(0,r.Lk)("code",{style:{background:"#f5f5f5",padding:"2px 4px","border-radius":"3px"}},"cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys")]),(0,r.Lk)("li",null,"复制目标主机的私钥内容到下方文本框"),(0,r.Lk)("li",null,"私钥格式应包含完整的BEGIN和END标记")]),(0,r.Lk)("p",{style:{margin:"12px 0 0 0",color:"#909399","font-size":"13px"}}," 💡 提示：密钥认证需要预先在目标主机配置公钥，然后上传对应的私钥内容。 ")],-1)])),_:1})]),_:1})):(0,r.Q3)("",!0),2===o.formData.type?((0,r.uX)(),(0,r.Wv)(c,{key:3,label:"私钥内容",prop:"publicKey"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:o.formData.publicKey,"onUpdate:modelValue":a[6]||(a[6]=e=>o.formData.publicKey=e),type:"textarea",rows:8,placeholder:"请输入SSH私钥内容，格式如下：\n-----BEGIN OPENSSH PRIVATE KEY-----\nxxxxxxxxxxx\n-----END OPENSSH PRIVATE KEY-----"},null,8,["modelValue"])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(c,{label:"备注",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:o.formData.remark,"onUpdate:modelValue":a[7]||(a[7]=e=>o.formData.remark=e),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),(0,r.Lk)("span",$P,[(0,r.bF)(u,{type:"primary",onClick:n.submitForm},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("确 定",-1)])),_:1,__:[22]},8,["onClick"]),(0,r.bF)(u,{onClick:a[8]||(a[8]=e=>o.dialogVisible=!1)},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)("取 消",-1)])),_:1,__:[23]})])]),_:1},8,["title","modelValue"])]),_:1})])}var MP={data(){return{queryParams:{name:"",pageNum:1,pageSize:10},loading:!1,authList:[],total:0,dialogVisible:!1,dialogTitle:"",formData:{id:"",name:"",type:void 0,username:"",password:"",publicKey:"",port:"",remark:""},formRules:{name:[{required:!0,message:"请输入凭据名称",trigger:"blur"}],type:[{required:!0,message:"请选择认证类型",trigger:"change"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur",validator:(e,a,t)=>{1!==this.formData.type||a?t():t(new Error("请输入密码"))}}],publicKey:[{required:!0,message:"请输入公钥",trigger:"blur",validator:(e,a,t)=>{2!==this.formData.type||a?t():t(new Error("请输入公钥"))}}],port:[{required:!0,message:"请输入端口号",trigger:"blur",validator:(e,a,t)=>{a?isNaN(a)||a<1||a>65535?t(new Error("请输入1-65535之间的有效端口号")):t():t(new Error("请输入端口号"))}}]}}},methods:{async getList(){this.loading=!0;try{const{data:e}=await Uu.getEcsAuthList({page:this.queryParams.pageNum,pageSize:this.queryParams.pageSize,name:this.queryParams.name||void 0});200===e.code?(this.authList=e.data?.list||[],this.total=e.data?.total||0):this.$message.error(e.message||"获取凭据列表失败")}catch(e){console.error("获取凭据列表失败:",e),this.$message.error("获取凭据列表失败")}finally{this.loading=!1}},async handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.queryParams={name:"",pageNum:1,pageSize:10},this.getList()},handleSizeChange(e){this.queryParams.pageSize=e,this.queryParams.pageNum=1,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},showAddDialog(){this.dialogTitle="创建凭据",this.$nextTick(()=>{this.formData={id:"",name:"",type:void 0,username:"",password:"",publicKey:"",port:"",remark:""},this.dialogVisible=!0,console.log("Add dialog opened, formData:",this.formData)})},showEditDialog(e){this.dialogTitle="修改凭据",this.$nextTick(()=>{this.formData={id:e.id,name:e.name,type:Number(e.type),username:e.username,password:1===e.type?e.password:"",publicKey:2===e.type?e.publicKey:"",port:e.port||"",remark:e.remark||""},this.dialogVisible=!0,console.log("Edit dialog opened for row:",e,"formData:",this.formData)})},async submitForm(){try{await this.$refs.formRef.validate();const e=Number(this.formData.type);if(1!==e&&2!==e&&3!==e)throw new Error("请选择有效的认证类型");const a={...this.formData,type:e};let t;console.log("Submitting form with data:",a),t=a.id?await Uu.updateEcsAuth(a):await Uu.createEcsAuth(a),200===t.data.code?(this.$message.success(a.id?"修改成功":"创建成功"),this.dialogVisible=!1,await this.getList(),console.log("List after update:",this.authList)):this.$message.error(t.data.message||(a.id?"修改失败":"创建失败"))}catch(e){console.error("操作失败:",e),this.$message.error("操作失败: "+e.message)}},async handleDelete(e){try{await this.$confirm(`确定删除凭据"${e.name}"?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{data:a}=await Uu.deleteEcsAuth(e.id);200===a.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(a.message||"删除失败")}catch(a){console.error("删除失败:",a)}}},created(){this.getList()}};const EP=(0,p.A)(MP,[["render",TP],["__scopeId","data-v-3ada0110"]]);var WP=EP,zP=t.p+"static/img/账号.bd7493b6.svg",NP=t.p+"static/img/url.e79d26ae.svg";const KP={class:"accountauth-management"},UP={class:"search-section"},XP={class:"action-section"},qP={class:"table-section"},HP={style:{display:"flex","align-items":"center",gap:"8px"}},BP={style:{display:"flex","align-items":"center",gap:"8px"}},jP={style:{display:"flex","align-items":"center",gap:"8px"}},OP={style:{display:"flex","align-items":"center",gap:"8px"}},QP={class:"operation-buttons"},GP={class:"pagination-section"},YP={slot:"footer",class:"dialog-footer"};function JP(e,a,t,l,s,o){const n=(0,r.g2)("el-input"),d=(0,r.g2)("el-form-item"),c=(0,r.g2)("el-option"),u=(0,r.g2)("el-select"),p=(0,r.g2)("el-button"),m=(0,r.g2)("el-form"),g=(0,r.g2)("el-table-column"),v=(0,r.g2)("el-tag"),h=(0,r.g2)("el-tooltip"),k=(0,r.g2)("el-table"),b=(0,r.g2)("el-pagination"),f=(0,r.g2)("el-col"),y=(0,r.g2)("el-row"),_=(0,r.g2)("el-dialog"),w=(0,r.g2)("el-card"),L=(0,r.gN)("authority"),F=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",KP,[(0,r.bF)(w,{shadow:"hover",class:"accountauth-card"},{header:(0,r.k6)(()=>a[11]||(a[11]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"账号认证管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",UP,[(0,r.bF)(m,{model:s.queryParams,inline:!0,class:"search-form",ref:"queryForm"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"账号别名",prop:"alias"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{placeholder:"请输入账号别名",clearable:"",size:"small",modelValue:s.queryParams.alias,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.alias=e),onKeyup:(0,i.jR)(o.handleQuery,["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1}),(0,r.bF)(d,{label:"账号类型",prop:"type",style:{width:"200px"}},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.queryParams.type,"onUpdate:modelValue":a[1]||(a[1]=e=>s.queryParams.type=e),placeholder:"请选择账号类型",size:"small",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"Mysql",value:1}),(0,r.bF)(c,{label:"Postgre",value:2}),(0,r.bF)(c,{label:"Redis",value:3}),(0,r.bF)(c,{label:"Jenkins",value:4}),(0,r.bF)(c,{label:"通用账号",value:5})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(d,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{type:"primary",icon:"Search",size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>a[12]||(a[12]=[(0,r.eW)("搜索",-1)])),_:1,__:[12]},8,["onClick"]),(0,r.bF)(p,{icon:"Refresh",size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>a[13]||(a[13]=[(0,r.eW)("重置",-1)])),_:1,__:[13]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",XP,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(p,{type:"success",plain:"",icon:"Plus",size:"small",onClick:o.showAddDialog},{default:(0,r.k6)(()=>a[14]||(a[14]=[(0,r.eW)("创建账号",-1)])),_:1,__:[14]},8,["onClick"])),[[L,["config:accountauth:create"]]])]),(0,r.Lk)("div",qP,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(k,{stripe:"",data:s.accountList,class:"accountauth-table"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{label:"账号别名",prop:"alias"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",HP,[a[15]||(a[15]=(0,r.Lk)("img",{src:zP,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.alias),1)])]),_:1}),(0,r.bF)(g,{label:"服务地址",prop:"host"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",BP,[a[16]||(a[16]=(0,r.Lk)("img",{src:NP,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.host),1)])]),_:1}),(0,r.bF)(g,{label:"端口",prop:"port",width:"100"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",jP,[a[17]||(a[17]=(0,r.Lk)("img",{src:Zp,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.port),1)])]),_:1}),(0,r.bF)(g,{label:"用户名",prop:"name"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",OP,[a[18]||(a[18]=(0,r.Lk)("img",{src:wP,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.row.name),1)])]),_:1}),(0,r.bF)(g,{label:"账号类型",width:"120"},{default:(0,r.k6)(e=>[(0,r.bF)(v,{type:1===e.row.type?"success":2===e.row.type?"warning":3===e.row.type?"danger":"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(1===e.row.type?"Mysql":2===e.row.type?"Postgre":3===e.row.type?"Redis":4===e.row.type?"Jenkins":5===e.row.type?"Zabbix":"通用账号"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(g,{label:"创建时间",prop:"createdAt"}),(0,r.bF)(g,{label:"更新时间",prop:"updatedAt"}),(0,r.bF)(g,{label:"备注",prop:"remark"}),(0,r.bF)(g,{label:"操作","class-name":"small-padding fixed-width",width:"240"},{default:(0,r.k6)(e=>[(0,r.Lk)("div",QP,[(0,r.bF)(h,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(p,{size:"small",type:"primary",icon:"Edit",circle:"",onClick:a=>o.showEditDialog(e.row)},null,8,["onClick"]),[[L,["config:accountauth:edit"]]])]),_:2},1024),(0,r.bF)(h,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(p,{size:"small",type:"danger",icon:"Delete",circle:"",onClick:a=>o.handleDelete(e.row)},null,8,["onClick"]),[[L,["config:accountauth:delete"]]])]),_:2},1024),(0,r.bF)(h,{content:"解密",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(p,{size:"small",type:"warning",icon:"Key",circle:"",onClick:a=>o.handleDecrypt(e.row)},null,8,["onClick"]),[[L,["config:accountauth:decrypt"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[F,s.loading]])]),(0,r.Lk)("div",GP,[(0,r.bF)(b,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),(0,r.bF)(_,{title:s.dialogTitle,modelValue:s.dialogVisible,"onUpdate:modelValue":a[10]||(a[10]=e=>s.dialogVisible=e),width:"30%",modal:!1},{default:(0,r.k6)(()=>[(0,r.bF)(m,{model:s.formData,rules:s.formRules,ref:"formRef","label-width":"100px"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"账号别名",prop:"alias"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.alias,"onUpdate:modelValue":a[2]||(a[2]=e=>s.formData.alias=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(f,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"服务地址",prop:"host"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.host,"onUpdate:modelValue":a[3]||(a[3]=e=>s.formData.host=e)},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(f,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"端口",prop:"port"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.port,"onUpdate:modelValue":a[4]||(a[4]=e=>s.formData.port=e),modelModifiers:{number:!0},type:"number",min:1,max:65535},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(f,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"用户名",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.name,"onUpdate:modelValue":a[5]||(a[5]=e=>s.formData.name=e)},null,8,["modelValue"])]),_:1})]),_:1}),(0,r.bF)(f,{span:12},{default:(0,r.k6)(()=>[(0,r.bF)(d,{label:"账号类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{modelValue:s.formData.type,"onUpdate:modelValue":a[6]||(a[6]=e=>s.formData.type=e),placeholder:"请选择账号类型"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"Mysql",value:1}),(0,r.bF)(c,{label:"Postgre",value:2}),(0,r.bF)(c,{label:"Redis",value:3}),(0,r.bF)(c,{label:"Jenkins",value:4}),(0,r.bF)(c,{label:"Zabbix",value:5}),(0,r.bF)(c,{label:"通用账号",value:6})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),(0,r.bF)(d,{label:"密码",prop:"password"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.password,"onUpdate:modelValue":a[7]||(a[7]=e=>s.formData.password=e),"show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(d,{label:"备注",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(n,{modelValue:s.formData.remark,"onUpdate:modelValue":a[8]||(a[8]=e=>s.formData.remark=e),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),(0,r.Lk)("span",YP,[(0,r.bF)(p,{type:"primary",onClick:o.submitForm},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("确 定",-1)])),_:1,__:[19]},8,["onClick"]),(0,r.bF)(p,{onClick:a[9]||(a[9]=e=>s.dialogVisible=!1)},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)("取 消",-1)])),_:1,__:[20]})])]),_:1},8,["title","modelValue"])]),_:1})])}var ZP={data(){return{queryParams:{alias:"",type:void 0,pageNum:1,pageSize:10},loading:!1,accountList:[],total:0,dialogVisible:!1,dialogTitle:"",formData:{id:"",alias:"",host:"",port:"",name:"",password:"",type:void 0,remark:""},formRules:{alias:[{required:!0,message:"请输入账号别名",trigger:"blur"}],host:[{required:!0,message:"请输入服务地址",trigger:"blur"}],port:[{required:!0,message:"请输入端口号",trigger:"blur",validator:(e,a,t)=>{a?isNaN(a)||a<1||a>65535?t(new Error("请输入1-65535之间的有效端口号")):t():t(new Error("请输入端口号"))}}],name:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],type:[{required:!0,message:"请选择账号类型",trigger:"change"}]}}},methods:{async getList(){this.loading=!0;try{const{data:e}=await Uu.listAccountAuth({page:this.queryParams.pageNum,pageSize:this.queryParams.pageSize,alias:this.queryParams.alias||void 0,type:this.queryParams.type||void 0});200===e.code?(this.accountList=e.data?.list||[],this.total=e.data?.total||0):this.$message.error(e.message||"获取账号列表失败")}catch(e){console.error("获取账号列表失败:",e),this.$message.error("获取账号列表失败")}finally{this.loading=!1}},async handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.queryParams={alias:"",type:void 0,pageNum:1,pageSize:10},this.getList()},handleSizeChange(e){this.queryParams.pageSize=e,this.queryParams.pageNum=1,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},showAddDialog(){this.dialogTitle="创建账号",this.$nextTick(()=>{this.formData={id:"",alias:"",host:"",port:"",name:"",password:"",type:void 0,remark:""},this.dialogVisible=!0})},showEditDialog(e){this.dialogTitle="修改账号",this.$nextTick(()=>{this.formData={id:e.id,alias:e.alias,host:e.host,port:e.port,name:e.name,password:"",type:e.type,remark:e.remark,createdAt:e.createdAt,updatedAt:e.updatedAt},this.dialogVisible=!0})},async submitForm(){try{await this.$refs.formRef.validate();const e={...this.formData,type:Number(this.formData.type),port:Number(this.formData.port),id:this.formData.id?Number(this.formData.id):void 0,createdAt:this.formData.createdAt,updatedAt:this.formData.updatedAt};let a;if(e.id){const{createdAt:t,updatedAt:l,...s}=e;a=await Uu.updateAccountAuth({id:s.id,alias:s.alias,host:s.host,port:s.port,name:s.name,password:s.password,type:s.type,remark:s.remark})}else{const{id:t,...l}=e;a=await Uu.createAccountAuth(l)}200===a.data.code?(this.$message.success(e.id?"修改成功":"创建成功"),this.dialogVisible=!1,await this.getList()):this.$message.error(a.data.message||(e.id?"修改失败":"创建失败"))}catch(e){console.error("操作失败:",e),this.$message.error("操作失败: "+e.message)}},async handleDecrypt(e){try{const a=await Uu.decryptPassword({},{params:{id:e.id}});200===a.data.code?this.$alert(`\n            <div>\n              <p>账号: ${e.alias}</p>\n              <p>密码: <span style="color: #1890ff; font-weight: bold; font-size: 18px;">${a.data.data.password}</span></p>\n            </div>\n          `,"解密结果",{confirmButtonText:"确定",customClass:"decrypt-result-alert",dangerouslyUseHTMLString:!0}):this.$message.error(a.data.message||"解密失败")}catch(a){console.error("解密失败:",a),this.$message.error("解密失败: "+(a.response?.data?.message||a.message))}},async handleDelete(e){try{await this.$confirm(`确定删除账号"${e.alias}"?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await Uu.deleteAccountAuth(e.id);200===a.data.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(a.data.message||"删除失败")}catch(a){console.error("删除失败:",a)}}},created(){this.getList()}};const e$=(0,p.A)(ZP,[["render",JP],["__scopeId","data-v-03181c27"]]);var a$=e$;const t$={class:"key-management"},l$={class:"search-section"},s$={class:"tab-content"},o$={class:"content-header"},n$={class:"resource-count"},i$={class:"tab-content"},r$={class:"content-header"},d$={class:"resource-count"},c$={class:"table-section"},u$={class:"resource-name"},p$=["src"],m$={class:"key-info"},g$={class:"key-value"},v$={class:"key-info"},h$={class:"key-value"},k$={class:"time-text"},b$={class:"remark-text"},f$={class:"operation-buttons"},y$={class:"table-section"},_$={class:"resource-name"},w$={class:"schedule-name"},L$={class:"cron-info"},F$={class:"cron-text"},C$={class:"cloud-types"},V$={class:"next-run-time"},x$={class:"time-text"},S$={class:"remark-text"},I$={class:"time-text"},A$={class:"operation-buttons"},R$={class:"pagination-section"},D$={class:"pagination-section"},P$={slot:"footer",class:"dialog-footer"},$$={class:"sync-log-container"},T$={key:0,class:"log-info"},M$={class:"log-header"},E$={class:"log-header-item"},W$={class:"log-value"},z$={class:"log-header-item"},N$={class:"log-value"},K$={class:"log-header-item"},U$={class:"log-value"},X$={class:"log-content"},q$={class:"log-text"},H$={class:"cron-templates"},B$=["onClick"],j$={key:0,style:{"margin-top":"8px"}},O$={style:{"margin-left":"10px",color:"#67C23A","font-weight":"500"}},Q$={key:1,style:{"margin-top":"8px"}},G$={style:{"margin-left":"10px",color:"#F56C6C","font-weight":"500"}},Y$={slot:"footer",class:"dialog-footer"};function J$(e,a,t,l,s,o){const n=(0,r.g2)("el-option"),d=(0,r.g2)("el-select"),c=(0,r.g2)("el-form-item"),u=(0,r.g2)("el-button"),p=(0,r.g2)("el-form"),m=(0,r.g2)("el-tab-pane"),g=(0,r.g2)("el-tabs"),v=(0,r.g2)("el-tag"),h=(0,r.g2)("el-table-column"),k=(0,r.g2)("Key"),b=(0,r.g2)("el-icon"),f=(0,r.g2)("Lock"),y=(0,r.g2)("el-tooltip"),_=(0,r.g2)("el-table"),w=(0,r.g2)("Setting"),L=(0,r.g2)("Timer"),F=(0,r.g2)("el-switch"),C=(0,r.g2)("el-pagination"),V=(0,r.g2)("el-input"),S=(0,r.g2)("el-dialog"),I=(0,r.g2)("el-empty"),A=(0,r.g2)("el-popover"),R=(0,r.g2)("el-checkbox"),D=(0,r.g2)("el-checkbox-group"),P=(0,r.g2)("el-card"),$=(0,r.gN)("authority"),T=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",t$,[(0,r.bF)(P,{shadow:"hover",class:"key-card"},{header:(0,r.k6)(()=>a[17]||(a[17]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"云厂商密钥管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",l$,[(0,r.bF)(p,{model:s.queryParams,inline:!0,class:"search-form",ref:"queryForm"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"云厂商类型",prop:"keyType"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{placeholder:"请选择云厂商类型",clearable:"",size:"small",modelValue:s.queryParams.keyType,"onUpdate:modelValue":a[0]||(a[0]=e=>s.queryParams.keyType=e),style:{width:"150px"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.keyTypeOptions,e=>((0,r.uX)(),(0,r.Wv)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,null,{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"primary",icon:"Search",size:"small",onClick:o.handleQuery},{default:(0,r.k6)(()=>a[18]||(a[18]=[(0,r.eW)("搜索",-1)])),_:1,__:[18]},8,["onClick"]),(0,r.bF)(u,{icon:"Refresh",size:"small",onClick:o.resetQuery},{default:(0,r.k6)(()=>a[19]||(a[19]=[(0,r.eW)("重置",-1)])),_:1,__:[19]},8,["onClick"])]),_:1})]),_:1},8,["model"])]),(0,r.bF)(g,{modelValue:s.activeTab,"onUpdate:modelValue":a[1]||(a[1]=e=>s.activeTab=e),class:"config-tabs",onTabChange:o.handleTabChange},{default:(0,r.k6)(()=>[(0,r.bF)(m,{label:"密钥管理",name:"keys"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",s$,[(0,r.Lk)("div",o$,[(0,r.Lk)("span",n$,"共 "+(0,x.v_)(s.keyList.length)+" 个密钥配置",1),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(u,{type:"primary",icon:"Plus",size:"small",onClick:o.showAddDialog},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)(" 创建密钥 ",-1)])),_:1,__:[20]},8,["onClick"])),[[$,["config:keymanage:create"]]])])])]),_:1}),(0,r.bF)(m,{label:"定时同步配置",name:"schedule"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",i$,[(0,r.Lk)("div",r$,[(0,r.Lk)("span",d$,"共 "+(0,x.v_)(s.scheduleList.length)+" 个同步任务",1),(0,r.bF)(u,{type:"primary",icon:"Plus",size:"small",onClick:o.showSyncScheduleDialog},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)(" 创建定时同步 ",-1)])),_:1,__:[21]},8,["onClick"])])])]),_:1})]),_:1},8,["modelValue","onTabChange"]),(0,r.bo)((0,r.Lk)("div",c$,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(_,{data:s.keyList,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无密钥配置"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{label:"云厂商类型",prop:"keyType",width:"180","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",u$,[(0,r.Lk)("img",{src:o.getKeyTypeIcon(e.keyType),class:"cloud-icon"},null,8,p$),(0,r.bF)(v,{type:o.getKeyTypeTag(e.keyType).type},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o.getKeyTypeTag(e.keyType).label),1)]),_:2},1032,["type"])])]),_:1}),(0,r.bF)(h,{label:"密钥ID",prop:"keyId","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",m$,[(0,r.bF)(b,{class:"key-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(k)]),_:1}),(0,r.Lk)("span",g$,(0,x.v_)(o.maskKey(e.keyId)),1)])]),_:1}),(0,r.bF)(h,{label:"密钥Secret",prop:"keySecret","min-width":"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",v$,[(0,r.bF)(b,{class:"secret-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1}),(0,r.Lk)("span",h$,(0,x.v_)(o.maskKey(e.keySecret)),1)])]),_:1}),(0,r.bF)(h,{label:"创建时间",prop:"createdAt",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",k$,(0,x.v_)(e.createdAt),1)]),_:1}),(0,r.bF)(h,{label:"备注",prop:"remark","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",b$,(0,x.v_)(e.remark||"-"),1)]),_:1}),(0,r.bF)(h,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",f$,[(0,r.bF)(y,{content:"修改",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(u,{size:"small",type:"primary",icon:"Edit",circle:"",onClick:a=>o.showEditDialog(e)},null,8,["onClick"]),[[$,["config:keymanage:edit"]]])]),_:2},1024),(0,r.bF)(y,{content:"同步主机",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(u,{size:"small",type:"success",icon:"Refresh",circle:"",onClick:a=>o.handleSyncHosts(e)},null,8,["onClick"]),[[$,["config:keymanage:rsync"]]])]),_:2},1024),(0,r.bF)(y,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(u,{size:"small",type:"danger",icon:"Delete",circle:"",onClick:a=>o.handleDelete(e)},null,8,["onClick"]),[[$,["config:keymanage:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[T,s.loading]])],512),[[i.aG,"keys"===s.activeTab]]),(0,r.bo)((0,r.Lk)("div",y$,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(_,{data:s.scheduleList,"element-loading-text":"加载中...",class:"resource-table","empty-text":"暂无定时同步配置"},{default:(0,r.k6)(()=>[(0,r.bF)(h,{label:"配置名称",prop:"name","min-width":"160"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",_$,[(0,r.bF)(b,{class:"schedule-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(w)]),_:1}),(0,r.Lk)("span",w$,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(h,{label:"Cron表达式",prop:"cronExpr","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",L$,[(0,r.bF)(b,{class:"cron-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(L)]),_:1}),(0,r.Lk)("code",F$,(0,x.v_)(e.cronExpr),1)])]),_:1}),(0,r.bF)(h,{label:"云厂商类型",prop:"keyTypes","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",C$,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.parseKeyTypes(e.keyTypes),e=>((0,r.uX)(),(0,r.Wv)(v,{key:e,type:o.getKeyTypeTag(e).type,size:"small",class:"cloud-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(o.getKeyTypeTag(e).label),1)]),_:2},1032,["type"]))),128))])]),_:1}),(0,r.bF)(h,{label:"状态",prop:"status",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(F,{modelValue:e.status,"onUpdate:modelValue":a=>e.status=a,"active-value":1,"inactive-value":0,"active-color":"#13ce66","inactive-color":"#ff4949",onChange:a=>o.handleToggleStatus(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),(0,r.bF)(h,{label:"下次同步时间",prop:"nextRunTime",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",V$,[(0,r.bF)(b,{class:"time-icon"},{default:(0,r.k6)(()=>[(0,r.bF)(L)]),_:1}),(0,r.Lk)("span",x$,(0,x.v_)(e.nextRunTime||"-"),1)])]),_:1}),(0,r.bF)(h,{label:"备注",prop:"remark","min-width":"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",S$,(0,x.v_)(e.remark||"-"),1)]),_:1}),(0,r.bF)(h,{label:"创建时间",prop:"createdAt",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",I$,(0,x.v_)(e.createdAt),1)]),_:1}),(0,r.bF)(h,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",A$,[(0,r.bF)(y,{content:"同步日志",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{size:"small",type:"info",icon:"Document",circle:"",onClick:a=>o.showSyncLog(e)},null,8,["onClick"])]),_:2},1024),(0,r.bF)(y,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{size:"small",type:"primary",icon:"Edit",circle:"",onClick:a=>o.showEditSyncScheduleDialog(e)},null,8,["onClick"])]),_:2},1024),(0,r.bF)(y,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{size:"small",type:"danger",icon:"Delete",circle:"",onClick:a=>o.handleDeleteSchedule(e)},null,8,["onClick"])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[T,s.scheduleLoading]])],512),[[i.aG,"schedule"===s.activeTab]]),(0,r.bo)((0,r.Lk)("div",R$,[(0,r.bF)(C,{onSizeChange:o.handleSizeChange,onCurrentChange:o.handleCurrentChange,"current-page":s.queryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":s.queryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.total},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])],512),[[i.aG,"keys"===s.activeTab]]),(0,r.bo)((0,r.Lk)("div",D$,[(0,r.bF)(C,{onSizeChange:o.handleScheduleSizeChange,onCurrentChange:o.handleScheduleCurrentChange,"current-page":s.scheduleQueryParams.pageNum,"page-sizes":[10,20,50,100],"page-size":s.scheduleQueryParams.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:s.scheduleTotal},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])],512),[[i.aG,"schedule"===s.activeTab]]),(0,r.bF)(S,{title:s.dialogTitle,modelValue:s.dialogVisible,"onUpdate:modelValue":a[7]||(a[7]=e=>s.dialogVisible=e),width:"35%",modal:!1},{default:(0,r.k6)(()=>[(0,r.bF)(p,{model:s.formData,rules:s.formRules,ref:"formRef","label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"云厂商类型",prop:"keyType"},{default:(0,r.k6)(()=>[(0,r.bF)(d,{modelValue:s.formData.keyType,"onUpdate:modelValue":a[2]||(a[2]=e=>s.formData.keyType=e),placeholder:"请选择云厂商类型",style:{width:"100%"}},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.keyTypeOptions,e=>((0,r.uX)(),(0,r.Wv)(n,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"密钥ID",prop:"keyId"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.formData.keyId,"onUpdate:modelValue":a[3]||(a[3]=e=>s.formData.keyId=e),placeholder:"请输入密钥ID","show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"密钥Secret",prop:"keySecret"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.formData.keySecret,"onUpdate:modelValue":a[4]||(a[4]=e=>s.formData.keySecret=e),placeholder:"请输入密钥Secret","show-password":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"备注信息",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.formData.remark,"onUpdate:modelValue":a[5]||(a[5]=e=>s.formData.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),(0,r.Lk)("span",P$,[(0,r.bF)(u,{type:"primary",onClick:o.submitForm},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("确 定",-1)])),_:1,__:[22]},8,["onClick"]),(0,r.bF)(u,{onClick:a[6]||(a[6]=e=>s.dialogVisible=!1)},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)("取 消",-1)])),_:1,__:[23]})])]),_:1},8,["title","modelValue"]),(0,r.bF)(S,{title:"同步日志",modelValue:s.syncLogDialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>s.syncLogDialogVisible=e),width:"50%",modal:!1},{footer:(0,r.k6)(()=>[(0,r.bF)(u,{onClick:a[8]||(a[8]=e=>s.syncLogDialogVisible=!1)},{default:(0,r.k6)(()=>a[28]||(a[28]=[(0,r.eW)("关闭",-1)])),_:1,__:[28]})]),default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("div",$$,[s.currentSyncLog?((0,r.uX)(),(0,r.CE)("div",T$,[(0,r.Lk)("div",M$,[(0,r.Lk)("div",E$,[a[24]||(a[24]=(0,r.Lk)("span",{class:"log-label"},"配置名称:",-1)),(0,r.Lk)("span",W$,(0,x.v_)(s.currentSyncLog.name),1)]),(0,r.Lk)("div",z$,[a[25]||(a[25]=(0,r.Lk)("span",{class:"log-label"},"上次执行时间:",-1)),(0,r.Lk)("span",N$,(0,x.v_)(s.currentSyncLog.lastRunTime||"-"),1)]),(0,r.Lk)("div",K$,[a[26]||(a[26]=(0,r.Lk)("span",{class:"log-label"},"下次执行时间:",-1)),(0,r.Lk)("span",U$,(0,x.v_)(s.currentSyncLog.nextRunTime||"-"),1)])]),(0,r.Lk)("div",X$,[a[27]||(a[27]=(0,r.Lk)("div",{class:"log-title"},"同步日志:",-1)),(0,r.Lk)("pre",q$,(0,x.v_)(s.currentSyncLog.syncLog||"暂无日志"),1)])])):((0,r.uX)(),(0,r.Wv)(I,{key:1,description:"暂无日志数据"}))])),[[T,s.syncLogLoading]])]),_:1},8,["modelValue"]),(0,r.bF)(S,{title:s.scheduleDialogTitle,modelValue:s.scheduleDialogVisible,"onUpdate:modelValue":a[16]||(a[16]=e=>s.scheduleDialogVisible=e),width:"40%",modal:!1},{default:(0,r.k6)(()=>[(0,r.bF)(p,{model:s.scheduleFormData,rules:s.scheduleFormRules,ref:"scheduleFormRef","label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(c,{label:"配置名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.scheduleFormData.name,"onUpdate:modelValue":a[10]||(a[10]=e=>s.scheduleFormData.name=e),placeholder:"请输入配置名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"Cron表达式",prop:"cronExpr"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.scheduleFormData.cronExpr,"onUpdate:modelValue":a[11]||(a[11]=e=>s.scheduleFormData.cronExpr=e),placeholder:"请输入Cron表达式",onInput:o.handleCronExprChange},{append:(0,r.k6)(()=>[(0,r.bF)(A,{placement:"bottom",width:"300",trigger:"click"},{reference:(0,r.k6)(()=>[(0,r.bF)(u,null,{default:(0,r.k6)(()=>a[29]||(a[29]=[(0,r.eW)("模板",-1)])),_:1,__:[29]})]),default:(0,r.k6)(()=>[(0,r.Lk)("div",H$,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.cronTemplates,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.value,class:"cron-template-item",onClick:a=>o.selectCronTemplate(e.value)},[(0,r.Lk)("strong",null,(0,x.v_)(e.label),1),(0,r.eW)(": "+(0,x.v_)(e.value),1)],8,B$))),128))])]),_:1})]),_:1},8,["modelValue","onInput"]),s.scheduleFormData.cronExpr&&s.nextExecutionTimes.length>0?((0,r.uX)(),(0,r.CE)("div",j$,[(0,r.Lk)("span",O$," 下次执行时间: "+(0,x.v_)(s.nextExecutionTimes[0]),1)])):s.scheduleFormData.cronExpr&&s.cronPreviewError?((0,r.uX)(),(0,r.CE)("div",Q$,[(0,r.Lk)("span",G$,(0,x.v_)(s.cronPreviewError),1)])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(c,{label:"云厂商类型",prop:"keyTypes"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:s.scheduleFormData.keyTypes,"onUpdate:modelValue":a[12]||(a[12]=e=>s.scheduleFormData.keyTypes=e)},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.keyTypeOptions,e=>((0,r.uX)(),(0,r.Wv)(R,{key:e.value,label:e.value,value:e.value},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.label),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"启用状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(F,{modelValue:s.scheduleFormData.status,"onUpdate:modelValue":a[13]||(a[13]=e=>s.scheduleFormData.status=e),"active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),(0,r.bF)(c,{label:"备注信息",prop:"remark"},{default:(0,r.k6)(()=>[(0,r.bF)(V,{modelValue:s.scheduleFormData.remark,"onUpdate:modelValue":a[14]||(a[14]=e=>s.scheduleFormData.remark=e),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),(0,r.Lk)("span",Y$,[(0,r.bF)(u,{type:"primary",onClick:o.submitScheduleForm},{default:(0,r.k6)(()=>a[30]||(a[30]=[(0,r.eW)("确 定",-1)])),_:1,__:[30]},8,["onClick"]),(0,r.bF)(u,{onClick:a[15]||(a[15]=e=>s.scheduleDialogVisible=!1)},{default:(0,r.k6)(()=>a[31]||(a[31]=[(0,r.eW)("取 消",-1)])),_:1,__:[31]})])]),_:1},8,["title","modelValue"])]),_:1})])}var Z$={data(){return{activeTab:"keys",queryParams:{keyType:"",pageNum:1,pageSize:10},loading:!1,keyList:[],total:0,dialogVisible:!1,dialogTitle:"",scheduleQueryParams:{pageNum:1,pageSize:10},scheduleLoading:!1,scheduleList:[],scheduleTotal:0,scheduleDialogVisible:!1,scheduleDialogTitle:"",syncLogDialogVisible:!1,syncLogLoading:!1,currentSyncLog:null,keyTypeOptions:[{value:1,label:"阿里云"},{value:2,label:"腾讯云"},{value:3,label:"百度云"},{value:4,label:"华为云"},{value:5,label:"AWS云"}],cronTemplates:[{label:"每天凌晨2点",value:"0 0 2 * * ?"},{label:"每6小时",value:"0 0 */6 * * ?"},{label:"每天上午9点",value:"0 0 9 * * ?"},{label:"工作日下午6点",value:"0 0 18 * * MON-FRI"},{label:"每周日凌晨3点",value:"0 0 3 * * SUN"}],formData:{id:"",keyType:"",keyId:"",keySecret:"",remark:""},formRules:{keyType:[{required:!0,message:"请选择云厂商类型",trigger:"change"}],keyId:[{required:!0,message:"请输入密钥ID",trigger:"blur"}],keySecret:[{required:!0,message:"请输入密钥Secret",trigger:"blur"}]},scheduleFormData:{id:"",name:"",cronExpr:"",keyTypes:[],status:1,remark:""},scheduleFormRules:{name:[{required:!0,message:"请输入配置名称",trigger:"blur"}],cronExpr:[{required:!0,message:"请输入Cron表达式",trigger:"blur"}],keyTypes:[{required:!0,message:"请选择云厂商类型",trigger:"change"}]},cronPreviewLoading:!1,cronPreviewError:"",nextExecutionTimes:[],cronPreviewTimer:null}},methods:{async getList(){this.loading=!0;try{const{data:e}=await Uu.getKeyManageList({page:this.queryParams.pageNum,pageSize:this.queryParams.pageSize,keyType:this.queryParams.keyType||void 0});200===e.code?(this.keyList=e.data?.list||[],this.total=e.data?.total||0):this.$message.error(e.message||"获取密钥列表失败")}catch(e){console.error("获取密钥列表失败:",e),this.$message.error("获取密钥列表失败")}finally{this.loading=!1}},async handleQuery(){this.queryParams.pageNum=1,this.getList()},resetQuery(){this.queryParams={keyType:"",pageNum:1,pageSize:10},this.getList()},handleSizeChange(e){this.queryParams.pageSize=e,this.queryParams.pageNum=1,this.getList()},handleCurrentChange(e){this.queryParams.pageNum=e,this.getList()},showAddDialog(){this.dialogTitle="创建密钥",this.$nextTick(()=>{this.formData={id:"",keyType:"",keyId:"",keySecret:"",remark:""},this.dialogVisible=!0})},showEditDialog(e){this.dialogTitle="修改密钥",this.$nextTick(()=>{this.formData={id:e.id,keyType:e.keyType,keyId:e.keyId,keySecret:e.keySecret,remark:e.remark||""},this.dialogVisible=!0})},async submitForm(){try{await this.$refs.formRef.validate();const e={...this.formData};let a;a=e.id?await Uu.updateKeyManage(e):await Uu.createKeyManage(e),200===a.data.code?(this.$message.success(e.id?"修改成功":"创建成功"),this.dialogVisible=!1,await this.getList()):this.$message.error(a.data.message||(e.id?"修改失败":"创建失败"))}catch(e){console.error("操作失败:",e),this.$message.error("操作失败: "+e.message)}},async handleDelete(e){try{await this.$confirm("确定删除该密钥配置?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{data:a}=await Uu.deleteKeyManage(e.id);200===a.code?(this.$message.success("删除成功"),this.getList()):this.$message.error(a.message||"删除失败")}catch(a){console.error("删除失败:",a)}},async handleSyncHosts(e){try{await this.$confirm(`确定同步${this.getKeyTypeTag(e.keyType).label}主机?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"});const a={keyId:e.id,keyType:e.keyType},{data:t}=await Uu.syncCloudHosts(a);200===t.code?this.$message.success("同步成功"):this.$message.error(t.message||"同步失败")}catch(a){console.error("同步失败:",a),this.$message.error("同步失败")}},getKeyTypeTag(e){const a={1:{label:"阿里云",type:"primary"},2:{label:"腾讯云",type:"success"},3:{label:"百度云",type:"info"},4:{label:"华为云",type:"warning"},5:{label:"AWS云",type:"danger"}};return a[e]||{label:"未知",type:"info"}},getKeyTypeIcon(e){const a={1:t(6241),2:t(7757),3:t(1733),4:t(1738),5:t(6415)};return a[e]||t(1700)},maskKey(e){return e?e.length<=8?e:e.substring(0,4)+"****"+e.substring(e.length-4):""},handleTabChange(e){"schedule"===e&&this.getScheduleList()},async getScheduleList(){this.scheduleLoading=!0;try{const{data:e}=await Uu.getSyncScheduleList({page:this.scheduleQueryParams.pageNum,pageSize:this.scheduleQueryParams.pageSize});200===e.code?(this.scheduleList=e.data?.list||[],this.scheduleTotal=e.data?.total||0):this.$message.error(e.message||"获取定时同步配置列表失败")}catch(e){console.error("获取定时同步配置列表失败:",e),this.$message.error("获取定时同步配置列表失败")}finally{this.scheduleLoading=!1}},handleScheduleSizeChange(e){this.scheduleQueryParams.pageSize=e,this.scheduleQueryParams.pageNum=1,this.getScheduleList()},handleScheduleCurrentChange(e){this.scheduleQueryParams.pageNum=e,this.getScheduleList()},showSyncScheduleDialog(){this.scheduleDialogTitle="创建定时同步配置",this.$nextTick(()=>{this.scheduleFormData={id:"",name:"",cronExpr:"",keyTypes:[],status:1,remark:""},this.cronPreviewError="",this.nextExecutionTimes=[],this.cronPreviewLoading=!1,this.scheduleDialogVisible=!0})},showEditSyncScheduleDialog(e){this.scheduleDialogTitle="编辑定时同步配置",this.$nextTick(()=>{this.scheduleFormData={id:e.id,name:e.name,cronExpr:e.cronExpr,keyTypes:this.parseKeyTypes(e.keyTypes),status:e.status,remark:e.remark||""},this.cronPreviewError="",this.nextExecutionTimes=[],this.cronPreviewLoading=!1,this.scheduleDialogVisible=!0,e.cronExpr&&this.handleCronExprChange(e.cronExpr)})},selectCronTemplate(e){this.scheduleFormData.cronExpr=e,this.handleCronExprChange(e)},handleCronExprChange(e){this.cronPreviewTimer&&clearTimeout(this.cronPreviewTimer),this.cronPreviewError="",this.nextExecutionTimes=[],e&&""!==e.trim()&&(this.cronPreviewTimer=setTimeout(()=>{this.validateCronExpression(e.trim())},500))},async validateCronExpression(e){this.cronPreviewLoading=!0,this.cronPreviewError="";try{const a=await Uu.getNextExecutionTime(e),t=a?.data||{};200===t.code?(t.data?.next_execution_time?this.nextExecutionTimes=[this.formatTime(t.data.next_execution_time)]:Array.isArray(t.data)?this.nextExecutionTimes=t.data.map(e=>this.formatTime(e)):this.nextExecutionTimes=[],0===this.nextExecutionTimes.length&&(this.cronPreviewError="Cron表达式有效，但无法计算执行时间")):this.cronPreviewError=t.message||"Cron表达式格式错误"}catch(a){console.error("验证Cron表达式失败:",a),this.cronPreviewError="Cron表达式格式错误，请检查语法"}finally{this.cronPreviewLoading=!1}},formatTime(e){if(!e)return"";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")},async submitScheduleForm(){try{await this.$refs.scheduleFormRef.validate();const e={...this.scheduleFormData,keyTypes:JSON.stringify(this.scheduleFormData.keyTypes)};let a;a=e.id?await Uu.updateSyncSchedule(e):await Uu.createSyncSchedule(e),200===a.data.code?(this.$message.success(e.id?"更新成功":"创建成功"),this.scheduleDialogVisible=!1,await this.getScheduleList()):this.$message.error(a.data.message||(e.id?"更新失败":"创建失败"))}catch(e){console.error("操作失败:",e),this.$message.error("操作失败: "+e.message)}},async handleToggleStatus(e){try{const{data:a}=await Uu.toggleSyncScheduleStatus({id:e.id,status:e.status});200===a.code?this.$message.success((1===e.status?"启用":"禁用")+"成功"):(e.status=1===e.status?0:1,this.$message.error(a.message||"状态切换失败"))}catch(a){e.status=1===e.status?0:1,console.error("状态切换失败:",a),this.$message.error("状态切换失败")}},async handleDeleteSchedule(e){try{await this.$confirm(`确定删除定时同步配置"${e.name}"?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const{data:a}=await Uu.deleteSyncSchedule(e.id);200===a.code?(this.$message.success("删除成功"),this.getScheduleList()):this.$message.error(a.message||"删除失败")}catch(a){console.error("删除失败:",a)}},parseKeyTypes(e){if(!e)return[];try{return JSON.parse(e)}catch(a){return console.error("解析keyTypes失败:",a),[]}},async showSyncLog(e){this.syncLogDialogVisible=!0,this.syncLogLoading=!0,this.currentSyncLog=null;try{const{data:a}=await Uu.getSyncScheduleLog(e.id);200===a.code&&a.data?this.currentSyncLog={id:a.data.id,name:a.data.name,syncLog:a.data.syncLog,lastRunTime:a.data.lastRunTime?this.formatTime(a.data.lastRunTime):"-",nextRunTime:a.data.nextRunTime?this.formatTime(a.data.nextRunTime):"-"}:this.$message.warning(a.message||"暂无日志数据")}catch(a){console.error("获取同步日志失败:",a),this.$message.error("获取同步日志失败")}finally{this.syncLogLoading=!1}}},created(){this.getList()},beforeUnmount(){this.cronPreviewTimer&&clearTimeout(this.cronPreviewTimer)}};const eT=(0,p.A)(Z$,[["render",J$],["__scopeId","data-v-0fc94582"]]);var aT=eT;const tT=[{path:"/config/ecskey",component:WP,meta:{sTitle:"配置中心",tTitle:"主机凭据"}},{path:"/config/accountauth",component:a$,meta:{sTitle:"配置中心",tTitle:"通用凭据"}},{path:"/config/keymanage",component:aT,meta:{sTitle:"配置中心",tTitle:"密钥管理"}}];var lT=tT,sT=t(3878),oT=t(4894),nT=t(8484),iT=t.p+"static/img/moban.cf91a886.svg";const rT={class:"tasktemplate-management"},dT={class:"search-section"},cT={class:"action-section"},uT={class:"table-section"},pT={style:{display:"flex","align-items":"center",gap:"8px"}},mT={style:{display:"flex","align-items":"center",gap:"8px"}},gT=["src","alt"],vT={style:{display:"flex","align-items":"center",gap:"8px"}},hT={class:"operation-buttons"},kT={class:"pagination-section"},bT=["innerHTML"];var fT={__name:"TaskTemplate",setup(e){const a=(0,Y.KR)([]),l=(0,Y.KR)(!1),s=(0,Y.KR)(!1),o=(0,Y.KR)(null),n=(0,Y.KR)(0),d=(0,Y.Kh)({pageNum:1,pageSize:10,name:"",type:null}),c=(0,Y.KR)({name:"",type:1,content:"",remark:""}),u=(0,Y.KR)(!1),p=(0,Y.KR)(""),m=(0,Y.Kh)({name:[{required:!0,message:"请输入模板名称",trigger:"blur"}],type:[{required:!0,message:"请选择模板类型",trigger:"change"}],content:[{required:!0,message:"请输入模板内容",trigger:"blur"}]}),g=async()=>{l.value=!0;try{const e=await me(d),t=e?.data||{};a.value=Array.isArray(t.data)?t.data.map(e=>({id:e.id,name:e.name,type:e.type,content:e.content,remark:e.remark||"",createdBy:e.createdBy,updatedBy:e.updatedBy,createdAt:e.createdAt,updatedAt:e.updatedAt})):[],console.log("模板数据:",JSON.stringify(a.value,null,2)),n.value=a.value.length}catch(e){console.error("获取模板列表异常:",e),a.value=[],n.value=0}finally{l.value=!1}},v=()=>{c.value={name:"",type:1,content:""},s.value=!0},h=e=>{c.value={...e},s.value=!0},k=async e=>{try{await uv.s.confirm("确定要删除该模板吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ve({id:e}),J.nk.success("删除成功"),g()}catch(a){"cancel"!==a&&J.nk.error("删除失败")}},b=async e=>{try{const t=await he({id:e}),l=a.value.find(a=>a.id===e),s=1===l?.type?"bash":2===l?.type?"python":"yaml";p.value=ah(t.data,s),u.value=!0}catch(t){console.error("获取脚本内容失败:",t),p.value="获取脚本内容失败"}},f=async()=>{if(await o.value.validate(),c.value.id){const e={id:c.value.id,name:c.value.name,type:c.value.type,content:c.value.content,remark:c.value.remark||""};await ge(e)}else await pe(c.value);s.value=!1,g()},y=async e=>{try{l.value=!0,d.name=e,d.pageNum=1;const t={name:e||void 0,pageNum:d.pageNum,pageSize:d.pageSize},s=await ke(t);console.log("按名称搜索结果:",s),s.data&&Array.isArray(s.data)?(a.value=s.data,n.value=s.data.length):s.data&&s.data.data?(a.value=s.data.data,n.value=s.data.total||s.data.data.length):(a.value=[],n.value=0,J.nk.warning("未获取到有效数据"))}catch(t){console.error("按名称搜索失败:",t),J.nk.error(`按名称搜索失败: ${t.message||"未知错误"}`)}finally{l.value=!1}},_=async e=>{try{l.value=!0,d.type=e,d.pageNum=1;const t={type:e||void 0,pageNum:d.pageNum,pageSize:d.pageSize},s=await be(t);console.log("按类型搜索结果:",s),s.data&&Array.isArray(s.data)?(a.value=s.data,n.value=s.data.length):s.data&&s.data.data?(a.value=s.data.data,n.value=s.data.total||s.data.data.length):(a.value=[],n.value=0,J.nk.warning("未获取到有效数据"))}catch(t){console.error("按类型搜索失败:",t),J.nk.error(`按类型搜索失败: ${t.message||"未知错误"}`)}finally{l.value=!1}},w=()=>{d.name="",d.type=null,d.pageNum=1,g()},L=()=>{o.value?.resetFields()},F=e=>{d.pageSize=e,g()},C=e=>{d.pageNum=e,g()},V=e=>{switch(e){case 1:return"type-shell";case 2:return"type-python";case 3:return"type-ansible";default:return""}},S=e=>{switch(e){case 1:return"bash";case 2:return"python";case 3:return"yaml";default:return null}},I=e=>{switch(e){case 1:return t(3878);case 2:return t(4894);case 3:return t(8484);default:return t(3878)}},A=e=>{switch(e){case 1:return"Shell";case 2:return"Python";case 3:return"Ansible";default:return"Shell"}};return(0,r.sV)(()=>{g()}),(e,t)=>{const g=(0,r.g2)("el-input"),R=(0,r.g2)("el-form-item"),D=(0,r.g2)("el-option"),P=(0,r.g2)("el-select"),$=(0,r.g2)("el-icon"),T=(0,r.g2)("el-button"),M=(0,r.g2)("el-form"),E=(0,r.g2)("el-table-column"),W=(0,r.g2)("el-tooltip"),z=(0,r.g2)("el-table"),N=(0,r.g2)("el-pagination"),K=(0,r.g2)("el-card"),U=(0,r.g2)("el-dialog"),X=(0,r.gN)("authority"),q=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",rT,[(0,r.bF)(K,{shadow:"hover",class:"tasktemplate-card"},{header:(0,r.k6)(()=>t[13]||(t[13]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"任务模板管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",dT,[(0,r.bF)(M,{inline:!0,model:d,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(R,{label:"模板名称"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{placeholder:"请输入模板名称",size:"small",clearable:"",modelValue:d.name,"onUpdate:modelValue":t[0]||(t[0]=e=>d.name=e),onKeyup:t[1]||(t[1]=(0,i.jR)(e=>y(d.name),["enter"]))},null,8,["modelValue"])]),_:1}),(0,r.bF)(R,{label:"模板类型",style:{width:"200px"}},{default:(0,r.k6)(()=>[(0,r.bF)(P,{size:"small",placeholder:"请选择模板类型",modelValue:d.type,"onUpdate:modelValue":t[2]||(t[2]=e=>d.type=e),onChange:t[3]||(t[3]=e=>_(d.type)),style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(D,{value:1},{default:(0,r.k6)(()=>t[14]||(t[14]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:sT,alt:"Shell",style:{width:"14px",height:"14px","object-fit":"contain","flex-shrink":"0"}}),(0,r.Lk)("span",null,"Shell")],-1)])),_:1,__:[14]}),(0,r.bF)(D,{value:2},{default:(0,r.k6)(()=>t[15]||(t[15]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:oT,alt:"Python",style:{width:"14px",height:"14px","object-fit":"contain","flex-shrink":"0"}}),(0,r.Lk)("span",null,"Python")],-1)])),_:1,__:[15]}),(0,r.bF)(D,{value:3},{default:(0,r.k6)(()=>t[16]||(t[16]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:nT,alt:"Ansible",style:{width:"14px",height:"14px","object-fit":"contain","flex-shrink":"0"}}),(0,r.Lk)("span",null,"Ansible")],-1)])),_:1,__:[16]})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(R,null,{default:(0,r.k6)(()=>[(0,r.bF)(T,{type:"primary",size:"small",onClick:t[4]||(t[4]=e=>y(d.name)),class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)($,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Search))]),_:1}),t[17]||(t[17]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[17]}),(0,r.bF)(T,{size:"small",onClick:w,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)($,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Refresh))]),_:1}),t[18]||(t[18]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",cT,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(T,{type:"success",size:"small",onClick:v,class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)($,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Plus))]),_:1}),t[19]||(t[19]=(0,r.eW)(" 新增模板 ",-1))]),_:1,__:[19]})),[[X,["task:template:add"]]])]),(0,r.Lk)("div",uT,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(z,{data:a.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{background:"#eef1f6",color:"#606266"}},{default:(0,r.k6)(()=>[(0,r.bF)(E,{prop:"name",label:"模板名称",width:"270"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",pT,[t[20]||(t[20]=(0,r.Lk)("img",{src:iT,alt:"模板",style:{width:"20px",height:"20px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(E,{prop:"type",label:"类型",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",mT,[(0,r.Lk)("img",{src:I(e.type),alt:A(e.type),style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,8,gT),(0,r.Lk)("span",{class:(0,x.C4)(V(e.type))},(0,x.v_)(A(e.type)),3)])]),_:1}),(0,r.bF)(E,{label:"脚本内容",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(W,{content:"查看脚本",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bF)(T,{type:"primary",icon:(0,Y.R1)(vc.View),size:"small",circle:"",onClick:a=>b(e.id)},null,8,["icon","onClick"])]),_:2},1024)]),_:1}),(0,r.bF)(E,{prop:"createdBy",label:"创建人",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",vT,[t[21]||(t[21]=(0,r.Lk)("img",{src:wP,alt:"创建人",style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.createdBy),1)])]),_:1}),(0,r.bF)(E,{prop:"createdAt",label:"创建时间",width:"180"}),(0,r.bF)(E,{prop:"remark",label:"备注信息"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(e.remark),1)]),_:1}),(0,r.bF)(E,{label:"操作",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",hT,[(0,r.bF)(W,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(T,{type:"warning",icon:(0,Y.R1)(vc.Edit),size:"small",circle:"",onClick:a=>h(e)},null,8,["icon","onClick"]),[[X,["task:template:edit"]]])]),_:2},1024),(0,r.bF)(W,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(T,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",onClick:a=>k(e.id)},null,8,["icon","onClick"]),[[X,["task:template:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[q,l.value]])]),(0,r.Lk)("div",kT,[(0,r.bF)(N,{onSizeChange:F,onCurrentChange:C,"current-page":d.pageNum,"page-sizes":[10,50,100],"page-size":d.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n.value},null,8,["current-page","page-size","total"])])]),_:1}),(0,r.bF)(U,{title:c.value.id?"编辑模板":"新增模板",modelValue:s.value,"onUpdate:modelValue":t[10]||(t[10]=e=>s.value=e),width:"40%",onClose:L},{footer:(0,r.k6)(()=>[(0,r.bF)(T,{onClick:t[9]||(t[9]=e=>s.value=!1)},{default:(0,r.k6)(()=>t[24]||(t[24]=[(0,r.eW)("取消",-1)])),_:1,__:[24]}),(0,r.bF)(T,{type:"primary",onClick:f},{default:(0,r.k6)(()=>t[25]||(t[25]=[(0,r.eW)("确定",-1)])),_:1,__:[25]})]),default:(0,r.k6)(()=>[(0,r.bF)(M,{ref_key:"templateFormRef",ref:o,"label-width":"100px",model:c.value,rules:m},{default:(0,r.k6)(()=>[(0,r.bF)(R,{label:"模板名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:c.value.name,"onUpdate:modelValue":t[5]||(t[5]=e=>c.value.name=e),placeholder:"请输入模板名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(R,{label:"模板类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(P,{modelValue:c.value.type,"onUpdate:modelValue":t[6]||(t[6]=e=>c.value.type=e),placeholder:"请选择模板类型"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{value:1},{default:(0,r.k6)(()=>t[22]||(t[22]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:sT,alt:"Shell",style:{width:"16px",height:"16px","object-fit":"contain","flex-shrink":"0"}}),(0,r.Lk)("span",null,"Shell")],-1)])),_:1,__:[22]}),(0,r.bF)(D,{value:2},{default:(0,r.k6)(()=>t[23]||(t[23]=[(0,r.Lk)("div",{style:{display:"flex","align-items":"center",gap:"8px"}},[(0,r.Lk)("img",{src:oT,alt:"Python",style:{width:"16px",height:"16px","object-fit":"contain","flex-shrink":"0"}}),(0,r.Lk)("span",null,"Python")],-1)])),_:1,__:[23]})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(R,{label:"模板内容",prop:"content"},{default:(0,r.k6)(()=>[(0,r.bF)(ih,{modelValue:c.value.content,"onUpdate:modelValue":t[7]||(t[7]=e=>c.value.content=e),language:S(c.value.type),height:"300px",placeholder:"请输入模板内容"},null,8,["modelValue","language"])]),_:1}),(0,r.bF)(R,{label:"备注信息"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:c.value.remark,"onUpdate:modelValue":t[8]||(t[8]=e=>c.value.remark=e),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),(0,r.bF)(U,{title:"脚本内容",modelValue:u.value,"onUpdate:modelValue":t[12]||(t[12]=e=>u.value=e),width:"60%"},{footer:(0,r.k6)(()=>[(0,r.bF)(T,{onClick:t[11]||(t[11]=e=>u.value=!1)},{default:(0,r.k6)(()=>t[26]||(t[26]=[(0,r.eW)("关闭",-1)])),_:1,__:[26]})]),default:(0,r.k6)(()=>[(0,r.Lk)("pre",{style:{"white-space":"pre-wrap",background:"#1e1e1e",padding:"10px","border-radius":"4px"},innerHTML:p.value},null,8,bT)]),_:1},8,["modelValue"])])}}};const yT=(0,p.A)(fT,[["__scopeId","data-v-419960e6"]]);var _T=yT,wT=t(5003),LT=t.p+"static/img/shijian.502b7197.svg",FT=t.p+"static/img/统计管理.6a0aac47.svg",CT=t(3009);const VT={class:"flow-container",style:{"margin-top":"-5px !important",top:"-5px !important"}},xT={class:"flow-header"},ST={style:{"margin-left":"6px"}},IT={class:"connector-canvas",ref:"connectorCanvas"},AT={class:"connector-defs"},RT=["id"],DT=["fill"],PT=["id"],$T=["fill"],TT={class:"card-title"},MT={class:"card-content"},ET={class:"card-buttons"},WT=["onClick"],zT=["onClick"],NT=["onClick","loading"],KT={style:{position:"fixed","z-index":"9999"}};function UT(e,a,t,l,s,o){const n=(0,r.g2)("VideoPlay"),d=(0,r.g2)("el-icon"),c=(0,r.g2)("el-button"),u=(0,r.g2)("Refresh"),p=(0,r.g2)("el-tooltip"),m=(0,r.g2)("script-dialog"),g=(0,r.g2)("log-dialog"),v=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",VT,[(0,r.Lk)("div",xT,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(c,{onClick:o.startAllSteps,type:"primary",size:"small",style:{height:"32px",padding:"0 16px"},loading:s.starting,disabled:s.hasStarted||s.starting,class:(0,x.C4)({"started-button":s.hasStarted})},{default:(0,r.k6)(()=>[(0,r.bF)(d,{size:"16"},{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1}),(0,r.Lk)("span",ST,(0,x.v_)(s.hasStarted?"已启动":"启动脚本"),1)]),_:1},8,["onClick","loading","disabled","class"])),[[v,["task:job:jobstart"]]]),(0,r.bF)(c,{onClick:o.handleRefresh,type:"warning",size:"small",style:{height:"32px",padding:"0 16px"},loading:s.refreshing},{default:(0,r.k6)(()=>[(0,r.bF)(d,{size:"16"},{default:(0,r.k6)(()=>[(0,r.bF)(u)]),_:1}),a[0]||(a[0]=(0,r.Lk)("span",{style:{"margin-left":"6px"}},"刷新状态",-1))]),_:1,__:[0]},8,["onClick","loading"])]),((0,r.uX)(),(0,r.CE)("svg",IT,null,512)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.orderedSteps,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"flow-step",style:(0,x.Tr)({"--step-order":e.order})},[((0,r.uX)(),(0,r.CE)("svg",AT,[(0,r.Lk)("defs",null,[(0,r.Lk)("marker",{id:"arrowhead-"+t,markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto"},[(0,r.Lk)("path",{d:"M0,0 L0,4 L6,2 Z",fill:"completed"===e.status?"rgba(76,175,80,0.7)":"active"===e.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"},null,8,DT)],8,RT),(0,r.Lk)("marker",{id:"flow-arrow-"+t,markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto"},[(0,r.Lk)("path",{d:"M0,0 L0,4 L6,2 Z",fill:"completed"===e.status?"rgba(76,175,80,0.7)":"active"===e.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"},null,8,$T)],8,PT)])])),(0,r.Lk)("div",{class:(0,x.C4)(["flow-card",o.getStepClass(e)])},[(0,r.Lk)("div",{class:(0,x.C4)(["status-text","status-"+e.status])},(0,x.v_)("completed"===e.status?"完成":"active"===e.status?"运行中":"error"===e.status?"异常":"等待"),3),(0,r.Lk)("h3",TT,[a[1]||(a[1]=(0,r.Lk)("svg",{class:"title-icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[(0,r.Lk)("path",{fill:"#9C27B0",d:"M512 1024C229.23 1024 0 794.77 0 512S229.23 0 512 0s512 229.23 512 512-229.23 512-512 512zm0-938.67C276.36 85.33 85.33 276.36 85.33 512S276.36 938.67 512 938.67 938.67 747.64 938.67 512 747.64 85.33 512 85.33z"}),(0,r.Lk)("path",{fill:"#9C27B0",d:"M341.33 426.67a42.67 42.67 0 100-85.34 42.67 42.67 0 000 85.34zM682.67 426.67a42.67 42.67 0 100-85.34 42.67 42.67 0 000 85.34z"}),(0,r.Lk)("path",{fill:"#9C27B0",d:"M512 768c-117.82 0-213.33-95.51-213.33-213.33h426.66C725.33 672.49 629.82 768 512 768z"})],-1)),(0,r.eW)(" "+(0,x.v_)(e.title),1)]),(0,r.Lk)("p",MT,(0,x.v_)(e.content),1),(0,r.Lk)("div",ET,[(0,r.bF)(p,{effect:"dark",content:"脚本",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("button",{onClick:(0,i.D$)(a=>o.onDetailClick(e),["stop"]),class:"btn-icon"},a[2]||(a[2]=[(0,r.Lk)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,r.Lk)("path",{d:"M14 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V8L14 2Z",fill:"#1890ff"}),(0,r.Lk)("path",{d:"M14 2V8H20",fill:"#1890ff","fill-opacity":"0.5"}),(0,r.Lk)("path",{d:"M16 13H8V11H16V13ZM16 17H8V15H16V17ZM13 9V3.5L18.5 9H13Z",fill:"white"})],-1)]),8,WT)]),_:2},1024),(0,r.bF)(p,{effect:"dark",content:"日志",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("button",{onClick:(0,i.D$)(a=>o.onLogClick(e),["stop"]),class:"btn-icon"},a[3]||(a[3]=[(0,r.Lk)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,r.Lk)("path",{d:"M21 10H7M21 6H3M21 14H3M21 18H7",stroke:"#722ed1","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,zT)]),_:2},1024),(0,r.bF)(p,{effect:"dark",content:"停止",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("button",{onClick:(0,i.D$)(a=>o.onStopClick(e),["stop"]),class:"btn-icon",loading:s.stopping},a[4]||(a[4]=[(0,r.Lk)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,r.Lk)("circle",{cx:"12",cy:"12",r:"8",fill:"#f5222d"})],-1)]),8,NT)),[[v,["task:job:jobstop"]]])]),_:2},1024)])],2)],4))),128)),(0,r.Lk)("div",KT,[(0,r.bF)(m,{ref:"scriptDialog"},null,512),(0,r.bF)(g,{ref:"logDialog"},null,512)])])}t(1148);const XT={key:0,class:"custom-dialog"},qT={class:"dialog-container"},HT={class:"dialog-header"},BT=["innerHTML"],jT={class:"dialog-footer"};function OT(e,a,t,l,s,o){return s.visible?((0,r.uX)(),(0,r.CE)("div",XT,[a[2]||(a[2]=(0,r.Lk)("div",{class:"dialog-mask"},null,-1)),(0,r.Lk)("div",qT,[(0,r.Lk)("div",HT,[(0,r.Lk)("h3",null,(0,x.v_)(t.title),1),(0,r.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>o.handleClose&&o.handleClose(...e))},"×")]),(0,r.Lk)("div",{class:"dialog-body",innerHTML:s.content},null,8,BT),(0,r.Lk)("div",jT,[(0,r.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>o.handleClose&&o.handleClose(...e))},"关闭")])])])):(0,r.Q3)("",!0)}var QT={name:"ScriptDialog",props:{title:{type:String,default:"脚本内容"}},data(){return{visible:!1,content:""}},methods:{show(e){let a=e;"string"!==typeof a&&(a=a.content||JSON.stringify(a,null,2)),a=a.replace(/\\n/g,"\n").replace(/\\r/g,"\r");const t=ah(a,"bash");this.content=`\n        <div class="highlight-container">\n          <pre style="white-space: pre-wrap; background: #121313e9; padding: 16px; border-radius: 6px;">\n            ${t}\n          </pre>\n        </div>\n      `,this.visible=!0},handleClose(){this.visible=!1,this.$emit("close")}}};const GT=(0,p.A)(QT,[["render",OT],["__scopeId","data-v-68690de0"]]);var YT=GT;const JT={key:0,class:"custom-dialog log-dialog"},ZT={class:"dialog-container"},eM={class:"dialog-header"},aM={style:{display:"block"}},tM=["innerHTML"],lM={class:"dialog-footer"};function sM(e,a,t,l,s,o){return s.visible?((0,r.uX)(),(0,r.CE)("div",JT,[a[2]||(a[2]=(0,r.Lk)("div",{class:"dialog-mask"},null,-1)),(0,r.Lk)("div",ZT,[(0,r.Lk)("div",eM,[(0,r.Lk)("h3",aM,(0,x.v_)(t.title),1),(0,r.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>o.handleClose&&o.handleClose(...e))},"×")]),(0,r.Lk)("div",{class:"dialog-body",innerHTML:s.content},null,8,tM),(0,r.Lk)("div",lM,[(0,r.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>o.handleClose&&o.handleClose(...e))},"关闭")])])])):(0,r.Q3)("",!0)}var oM={name:"LogDialog",props:{title:{type:String,default:"任务日志"}},data(){return{visible:!1,content:""}},methods:{show(e){let a=e;"string"!==typeof a&&(a=a.logs||JSON.stringify(a,null,2)),a=a.replace(/\\n/g,"\n").replace(/\\r/g,"\r");const t=ah(a,"bash");this.content=`\n        <div class="highlight-container">\n          <pre style="white-space: pre-wrap; background: #000; color: #fff; padding: 16px; border-radius: 6px; font-family: 'Courier New', monospace;">\n            ${t}\n          </pre>\n        </div>\n      `,this.visible=!0},handleClose(){this.visible=!1,this.$emit("close")}}};const nM=(0,p.A)(oM,[["render",sM],["__scopeId","data-v-bc031ce8"]]);var iM=nM,rM={components:{ScriptDialog:YT,LogDialog:iM},data(){return{starting:!1,stopping:!1,hasStarted:!1,refreshing:!1,forceUpdateKey:0,localSteps:[]}},props:{steps:{type:Array,required:!0,default:()=>[],validator:e=>Array.isArray(e)&&e.every(e=>"object"===typeof e&&null!==e)},taskId:{type:[String,Number],required:!0,default:null,validator:e=>null!==e&&void 0!==e&&""!==e}},watch:{steps:{handler(e,a){console.log("Steps prop changed - raw:",JSON.parse(JSON.stringify(e))),console.log("Current orderedSteps:",JSON.parse(JSON.stringify(this.orderedSteps))),e&&Array.isArray(e)&&(this.localSteps=[...e],this.forceUpdateKey+=1),this.checkTaskStatus(e),this.$nextTick(()=>{console.log("After nextTick - orderedSteps:",JSON.parse(JSON.stringify(this.orderedSteps))),this.drawConnectors()})},deep:!0,immediate:!0}},computed:{orderedSteps(){const e=this.forceUpdateKey,a=this.localSteps.length>0?this.localSteps:this.steps;if(!a||!Array.isArray(a))return console.warn("Invalid steps data:",a),[];console.log("原始steps数据 (forceUpdateKey="+e+"):",JSON.parse(JSON.stringify(a)));const t=a.map((e,a)=>{const t=void 0!==e.task_status?e.task_status:1,l=["pending","active","completed","error"][t-1]||"pending";return console.log(`步骤 ${e.template_id||a} 状态映射:`,`原始: ${e.task_status}, 最终: ${l}`),{...e,title:e.template_name||"",content:e.template_remark||"",order:e.order||a+1,status:l,_status:l,task_status:e.task_status}}).sort((e,a)=>e.order-a.order);return console.log("orderedSteps计算结果:",JSON.parse(JSON.stringify(t))),t}},methods:{checkTaskStatus(e){if(!e||!Array.isArray(e))return;const a=e.some(e=>{const a=e.task_status??1;return a>1});this.hasStarted=a,console.log("Task status check:",{hasStartedTask:a,hasStarted:this.hasStarted})},getStepClass(e){return`status-${e.status}`},async startAllSteps(){this.starting=!0;try{if(console.log("Starting task with props taskId:",this.taskId),console.log("Steps data:",this.steps),!this.taskId&&(!this.steps||0===this.steps.length))throw new Error("任务ID未定义");const e=this.steps[0]?.task_id||this.taskId;if(!e)throw new Error("无法获取有效的任务ID");console.log("Using task ID:",e);const a=new URLSearchParams;a.append("taskId",e),await Se({taskId:e},{params:a}),this.hasStarted=!0,this.$message.success("任务已启动"),this.$emit("refresh")}catch(e){console.error("启动任务失败:",e),this.$message.error("启动任务失败: "+(e.message||"未知错误"))}finally{this.starting=!1}},async handleRefresh(){this.refreshing=!0;try{console.log("开始刷新任务状态...");const e=this.steps[0]?.task_id||this.taskId;console.log("使用taskId:",e);const a=await Ve({id:e});if(console.log("API完整响应:",a),!a?.data?.data)throw new Error("无效的API响应");const t=JSON.parse(JSON.stringify(a.data.data));console.log("原始API数据:",t);const l=t.map((e,a)=>{const t=e.task_status??1,l=["pending","active","completed","error"][t-1]||"pending";return console.log(`步骤 ${e.template_id||a} 状态映射:`,`原始: ${e.task_status}, 最终: ${l}`),{...e,task_id:e.task_id||this.taskId,template_id:e.template_id||a+1,template_name:e.template_name||`步骤 ${a+1}`,template_remark:e.template_remark||"",task_status:t,status:l,order:e.order||a+1}});console.log("更新后的步骤数据:",JSON.parse(JSON.stringify(l))),this.localSteps=[...l],this.forceUpdateKey+=1,this.$emit("refresh-steps",l),this.$emit("update:steps",l),this.$nextTick(()=>{this.$forceUpdate(),console.log("强制更新后的orderedSteps:",this.orderedSteps),console.log("当前卡片状态:",this.orderedSteps.map(e=>`${e.template_name}: ${e.status}`).join(", ")),l.forEach((e,a)=>{console.log(`验证步骤 ${a+1}:`,{template_name:e.template_name,task_status:e.task_status,mapped_status:["pending","active","completed","error"][e.task_status-1],final_status:e.status})}),this.drawConnectors()}),this.$message.success("任务状态已刷新")}catch(e){console.error("刷新任务状态失败:",e),this.$message.error("刷新任务状态失败: "+(e.message||"未知错误"))}finally{this.refreshing=!1}},onDeployClick(e){this.$emit("deploy",e)},async onDetailClick(e){try{const a=await he({id:e.template_id});this.$emit("detail",{...e,content:a.data}),console.log("ScriptDialog ref:",this.$refs.scriptDialog),console.log("ScriptDialog component:",this.$refs.scriptDialog?.$el),this.$refs.scriptDialog?(console.log("Calling show method"),this.$refs.scriptDialog.show(a.data),console.log("Show method called")):console.error("ScriptDialog ref not found")}catch(a){console.error("获取模板内容失败:",a),this.$message.error("获取模板内容失败")}},async onStopClick(e){this.stopping=!0;try{await Ie({taskId:e.task_id,templateId:e.template_id}),this.$message.success("任务已停止"),this.$emit("refresh")}catch(a){console.error("停止任务失败:",a),this.$message.error("停止任务失败: "+(a.message||"未知错误"))}finally{this.stopping=!1}},async onLogClick(e){try{if(console.log("Step data:",e),!e.task_id)throw console.error("缺少任务ID，当前step:",e),new Error("缺少任务ID，请确保步骤数据包含task_id");console.log("调用日志API参数:",{taskId:e.task_id,templateId:e.template_id});const a=await xe({taskId:e.task_id,templateId:e.template_id});console.log("LogDialog ref:",this.$refs.logDialog),console.log("LogDialog component:",this.$refs.logDialog?.$el),this.$refs.logDialog?(console.log("Calling show method"),this.$refs.logDialog.show(a.data),console.log("Show method called"),this.$emit("log",{...e,logs:a.data})):console.error("LogDialog ref not found")}catch(a){console.error("获取任务日志失败:",a),this.$message.error(`获取任务日志失败: ${a.message||"未知错误"}`)}},drawConnectors(){const e=this.$refs.connectorCanvas;e&&this.$el&&(this.drawTimeout&&clearTimeout(this.drawTimeout),this.drawTimeout=setTimeout(()=>{const a={},t=Array.from(this.$el.querySelectorAll(".flow-step"));t.forEach(e=>{const t=e.querySelector(".flow-card");if(!t)return;const l=t.getBoundingClientRect();if(l.width>0&&l.height>0){const t=parseInt(e.style.getPropertyValue("--step-order"));a[t]={step:e,rect:l}}});const l=this.$el.getBoundingClientRect();e.innerHTML="";const s=document.createDocumentFragment(),o=Object.values(a).sort((e,a)=>{const t=parseInt(e.step.style.getPropertyValue("--step-order")),l=parseInt(a.step.style.getPropertyValue("--step-order"));return t-l}),n={3:4,9:10};for(let e=0;e<o.length;e++){const a=o[e],t=parseInt(a.step.style.getPropertyValue("--step-order"));if(n[t]){const e=o.find(e=>parseInt(e.step.style.getPropertyValue("--step-order"))===n[t]);if(e){const o=a.rect.left+a.rect.width/4-l.left,n=a.rect.bottom-l.top,i=e.rect.right-e.rect.width/4-l.left,r=e.rect.top-l.top,d=document.createElementNS("http://www.w3.org/2000/svg","path"),c=o+.25*(i-o),u=n,p=i-.25*(i-o),m=r;d.setAttribute("d",`M${o},${n} C${c},${u} ${p},${m} ${i},${r}`),d.setAttribute("class","flow-path"),d.setAttribute("stroke","completed"===a.step.status?"rgba(76,175,80,0.5)":"active"===a.step.status?"rgba(33,150,243,0.5)":"rgba(128,128,128,0.5)"),d.setAttribute("stroke-width","2"),d.setAttribute("stroke-dasharray","8,4"),d.setAttribute("marker-end",`url(#arrowhead-${t})`),d.setAttribute("fill","none");const g=document.createElementNS("http://www.w3.org/2000/svg","circle");g.setAttribute("cx","0"),g.setAttribute("cy","0"),g.setAttribute("r","3"),g.setAttribute("fill","completed"===a.step.status?"rgba(76,175,80,0.7)":"active"===a.step.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"),g.setAttribute("class",`flow-arrow status-${a.step.status}`),g.setAttribute("class","flow-arrow");const v=document.createElementNS("http://www.w3.org/2000/svg","animateMotion");v.setAttribute("path",`M${o},${n} L${i},${r}`),v.setAttribute("dur","3s"),v.setAttribute("repeatCount","indefinite"),g.appendChild(v),s.appendChild(d),s.appendChild(g);continue}}if(e<o.length-1){const i=o[e+1],r=parseInt(i.step.style.getPropertyValue("--step-order"));if(r===t+1&&!n[t]){let e,o,n,r,d;if(6===t){e=a.rect.left+a.rect.width/4-l.left,o=a.rect.bottom-l.top,n=i.rect.right-i.rect.width/4-l.left,r=i.rect.top-l.top,d=document.createElementNS("http://www.w3.org/2000/svg","path");const s=e+.25*(n-e),c=o,u=n-.25*(n-e),p=r;d.setAttribute("d",`M${e},${o} C${s},${c} ${u},${p} ${n},${r}`),d.setAttribute("class","flow-path"),d.setAttribute("stroke","completed"===a.step.status?"rgba(76,175,80,0.5)":"active"===a.step.status?"rgba(33,150,243,0.5)":"rgba(128,128,128,0.5)"),d.setAttribute("stroke-width","2"),d.setAttribute("stroke-dasharray","8,4"),d.setAttribute("marker-end",`url(#arrowhead-${t})`),d.setAttribute("fill","none")}else e=a.rect.right-l.left,o=a.rect.top+a.rect.height/2-l.top,n=i.rect.left-l.left,r=i.rect.top+i.rect.height/2-l.top,d=document.createElementNS("http://www.w3.org/2000/svg","path"),d.setAttribute("d",`M${e},${o} L${n},${r}`),d.setAttribute("class","flow-path"),d.setAttribute("stroke","completed"===a.step.status?"rgba(76,175,80,0.5)":"active"===a.step.status?"rgba(33,150,243,0.5)":"rgba(128,128,128,0.5)"),d.setAttribute("stroke-width","2"),d.setAttribute("stroke-dasharray","8,4"),d.setAttribute("marker-end",`url(#arrowhead-${t})`),d.setAttribute("fill","none");const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx","0"),c.setAttribute("cy","0"),c.setAttribute("r","3"),c.setAttribute("fill","completed"===a.step.status?"rgba(76,175,80,0.7)":"active"===a.step.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"),c.setAttribute("class","flow-arrow");const u=document.createElementNS("http://www.w3.org/2000/svg","animateMotion");u.setAttribute("path",`M${e},${o} L${n},${r}`),u.setAttribute("dur","3s"),u.setAttribute("repeatCount","indefinite"),c.appendChild(u),s.appendChild(d),s.appendChild(c)}}}e.appendChild(s)},150))}},mounted(){this.$nextTick(()=>{this.drawConnectors(),this.observer=new ResizeObserver(()=>{this.drawConnectors()}),this.observer.observe(this.$el),this.mutationObserver=new MutationObserver(e=>{e.forEach(()=>this.drawConnectors())}),this.mutationObserver.observe(this.$el,{childList:!0,subtree:!0,attributes:!0})})},updated(){this.$nextTick(()=>this.drawConnectors())},beforeUnmount(){console.log("Component destroying..."),this.observer?.disconnect(),this.mutationObserver?.disconnect(),this.drawTimeout&&clearTimeout(this.drawTimeout),console.log("Component destroyed")}};const dM=(0,p.A)(rM,[["render",UT],["__scopeId","data-v-a4389f70"]]);var cM=dM;const uM={class:"flow-container"};var pM={__name:"JobFlow",setup(e,{expose:a}){const t=(0,Y.KR)(!1),l=(0,Y.KR)(null),s=(0,Y.KR)(0),o=(0,Y.KR)(null),n=(0,Y.KR)([]),i=(0,r.EW)(()=>{if(console.log("计算steps - currentTaskId:",o.value),console.log("计算steps - templatesData:",JSON.parse(JSON.stringify(n.value))),!o.value){const e=[{task_count:1,task_status:1,template_id:1,template_name:"默认任务",template_remark:"等待启动",id:"task-1",hasDownConnector:!1,showHorizontalConnector:!1}];return console.log("返回模拟steps:",e),e}if(o.value&&n.value.length>0){const e=n.value.map((e,a)=>(console.log(`处理步骤${a} - 原始task_status:`,e.task_status),{...e,id:`task-${a+1}`,hasDownConnector:(a+1)%3===0&&a<n.value.length-1,showHorizontalConnector:(a+1)%3!==0&&a<n.value.length-1}));return console.log("返回API steps:",JSON.parse(JSON.stringify(e))),e}return console.log("返回空steps数组"),[]}),d=async e=>{try{if(console.log("Received taskId:",e),!e)throw new Error("任务ID未定义");o.value=e,n.value=[];const a=await Ve({id:e});if(console.log("获取模板响应:",a),!a?.data?.data)throw new Error("无效的API响应数据");const l=JSON.parse(JSON.stringify(a.data.data));console.log("API返回的原始数据:",l);const i=l.map(e=>({...e,task_status:e.task_status??1}));n.value=i,console.log("处理后的模板列表:",n.value);const r=n.value[0]?.task_id;if(!r)throw new Error("API响应中未包含task_id");return o.value=r,s.value=n.value.length,console.log("更新后的templatesData:",n.value),console.log("更新后的taskCount:",s.value),t.value=!0,r}catch(a){throw console.error("获取模板信息失败:",a),n.value=[],s.value=1,t.value=!0,a}},c=()=>{l.value?.stopAllPolling&&l.value.stopAllPolling()};return a({showFlow:d}),(e,a)=>{const s=(0,r.g2)("el-button"),n=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(n,{title:"任务流程",modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value=e),width:"80%",top:"5vh","custom-class":"task-flow-dialog",onClose:c},{footer:(0,r.k6)(()=>[(0,r.bF)(s,{onClick:a[0]||(a[0]=e=>t.value=!1)},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)("关闭",-1)])),_:1,__:[2]})]),default:(0,r.k6)(()=>[(0,r.Lk)("div",uM,[(0,r.bF)(cM,{ref_key:"taskFlowRef",ref:l,steps:i.value,"task-id":o.value},null,8,["steps","task-id"])])]),_:1},8,["modelValue"])}}};const mM=(0,p.A)(pM,[["__scopeId","data-v-18c2f50a"]]);var gM=mM;const vM={style:{display:"flex",height:"500px"}},hM={style:{width:"250px","border-right":"1px solid #ebeef5","padding-right":"10px","overflow-y":"auto"}},kM={style:{flex:"1","padding-left":"10px","overflow-y":"auto"}},bM={class:"highlight-cell"},fM={style:{"margin-left":"5px"}},yM={class:"highlight-cell"},_M={style:{"margin-left":"5px"}},wM={class:"highlight-cell"},LM={style:{"margin-left":"5px"}},FM={class:"pagination"};var CM={__name:"CreateTaskHost",props:{modelValue:{type:Boolean,default:!1},selectedHosts:{type:Array,default:()=>[]}},emits:["update:modelValue","hosts-selected"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(!1),o=(0,Y.KR)([]),n=(0,Y.KR)([]),i=(0,Y.KR)([]),d=(0,Y.KR)({pageNum:1,pageSize:10,total:0}),c=(0,Y.KR)(null),u=async()=>{try{const e=await ue.getGroupListWithHosts();200===e.data?.code&&(o.value=e.data.data||[])}catch(e){console.error("获取分组和主机列表失败:",e)}},p=async()=>{try{const e=await ue.getCmdbHostList({page:d.value.pageNum,pageSize:d.value.pageSize});200===e.data?.code&&(n.value=(e.data.data?.list||[]).map(e=>({id:e.id,name:e.hostName||e.name,privateIp:e.privateIp,publicIp:e.publicIp,os:e.os,remark:e.remark})),d.value.total=e.data.data?.total||0)}catch(e){console.error("获取主机列表失败:",e),n.value=[]}},m=async e=>{c.value=e.id;try{const a=await ue.getCmdbHostsByGroupId(e.id,{page:d.value.pageNum,pageSize:d.value.pageSize});if(200===a.data?.code){const e=a.data.data||[];n.value=e.map(e=>({id:e.id,name:e.hostName||e.name,privateIp:e.privateIp,publicIp:e.publicIp,os:e.os,remark:e.remark})),d.value.total=e.length}}catch(a){console.error("获取主机列表失败:",a),n.value=[]}},g=e=>{d.value.pageNum=e,c.value?m({id:c.value}):p()},v=e=>{d.value.pageSize=e,c.value?m({id:c.value}):p()},h=e=>{i.value=e},k=()=>{l("hosts-selected",i.value),i.value=[]},b=()=>{s.value=!1};return(0,r.wB)(()=>t.modelValue,e=>{s.value=e}),(0,r.wB)(s,e=>{l("update:modelValue",e)}),(0,r.sV)(()=>{u(),p()}),(e,a)=>{const t=(0,r.g2)("FolderOpened"),l=(0,r.g2)("el-icon"),i=(0,r.g2)("Folder"),c=(0,r.g2)("el-tree"),u=(0,r.g2)("el-table-column"),p=(0,r.g2)("User"),f=(0,r.g2)("HomeFilled"),y=(0,r.g2)("Connection"),_=(0,r.g2)("el-table"),w=(0,r.g2)("el-pagination"),L=(0,r.g2)("el-button"),F=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(F,{title:"选择执行主机",modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),width:"70%"},{footer:(0,r.k6)(()=>[(0,r.bF)(L,{onClick:b},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)("关闭",-1)])),_:1,__:[1]}),(0,r.bF)(L,{type:"primary",onClick:k},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)("添加选中主机",-1)])),_:1,__:[2]})]),default:(0,r.k6)(()=>[(0,r.Lk)("div",vM,[(0,r.Lk)("div",hM,[(0,r.bF)(c,{data:o.value,props:{label:"name",children:"children"},"node-key":"id","highlight-current":"",onNodeClick:m},{default:(0,r.k6)(({node:e,data:a})=>[(0,r.Lk)("span",null,[e.expanded?((0,r.uX)(),(0,r.Wv)(l,{key:0,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)(t)]),_:1})):((0,r.uX)(),(0,r.Wv)(l,{key:1,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)(i)]),_:1})),(0,r.eW)(" "+(0,x.v_)(e.label),1)])]),_:1},8,["data"])]),(0,r.Lk)("div",kM,[(0,r.bF)(_,{data:n.value,border:"",style:{width:"100%"},onSelectionChange:h,ref:"hostTable"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{type:"selection",width:"55",selectable:()=>!0}),(0,r.bF)(u,{prop:"name",label:"主机名称",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",bM,[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)(p)]),_:1}),(0,r.Lk)("span",fM,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(u,{prop:"privateIp",label:"内网IP",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",yM,[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)(f)]),_:1}),(0,r.Lk)("span",_M,(0,x.v_)(e.privateIp),1)])]),_:1}),(0,r.bF)(u,{prop:"publicIp",label:"外网IP",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",wM,[(0,r.bF)(l,{color:"#409EFF"},{default:(0,r.k6)(()=>[(0,r.bF)(y)]),_:1}),(0,r.Lk)("span",LM,(0,x.v_)(e.publicIp),1)])]),_:1}),(0,r.bF)(u,{prop:"os",label:"操作系统",width:"180"}),(0,r.bF)(u,{prop:"remark",label:"备注"})]),_:1},8,["data"]),(0,r.Lk)("div",FM,[(0,r.bF)(w,{onCurrentChange:g,onSizeChange:v,"current-page":d.value.pageNum,"page-sizes":[10,20,50,100],"page-size":d.value.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:d.value.total},null,8,["current-page","page-size","total"])])])])]),_:1},8,["modelValue"])}}};const VM=(0,p.A)(CM,[["__scopeId","data-v-4d4030d0"]]);var xM=VM;const SM={class:"taskjob-management"},IM={class:"search-section"},AM={class:"action-section"},RM={class:"table-section"},DM={style:{display:"flex","align-items":"center",gap:"8px"}},PM={style:{display:"flex","align-items":"center",gap:"8px"}},$M=["src","alt"],TM={style:{display:"flex","align-items":"center",gap:"8px"}},MM={style:{display:"flex","align-items":"center",gap:"8px"}},EM={class:"execute-count"},WM={key:1,style:{color:"#C0C4CC"}},zM={key:0,style:{display:"flex","align-items":"center",gap:"8px"}},NM={class:"next-run-time"},KM={key:1},UM={class:"operation-buttons"},XM={class:"pagination-section"},qM={key:0,style:{"margin-left":"10px",color:"#67C23A","font-weight":"500"}},HM={style:{display:"flex","align-items":"center","margin-bottom":"10px"}},BM={key:0,style:{border:"1px solid #ebeef5","border-radius":"4px",padding:"10px",background:"#f5f7fa"}},jM={style:{display:"flex","flex-direction":"column",gap:"8px"}},OM={style:{display:"flex","align-items":"center","margin-bottom":"10px"}},QM={key:0,style:{border:"1px solid #ebeef5","border-radius":"4px",padding:"10px",background:"#f5f7fa"}},GM={style:{display:"flex","flex-direction":"column",gap:"8px"}};var YM={__name:"TaskJob",setup(e){const a=(0,Y.KR)([]),l=(0,Y.KR)(!1),s=(0,Y.KR)(!1),o=(0,Y.IJ)(null),n=(0,Y.KR)(0),d=(0,Y.IJ)(null),c=(0,Y.KR)(""),u=(0,Y.KR)([]),p=(0,Y.KR)([]),m=(0,Y.KR)([]),g=(0,Y.KR)([]),v=(0,Y.KR)(!1),h=(0,Y.KR)(!1),k=(0,Y.Kh)({page:1,pageSize:10,name:"",type:null,status:null}),b=(0,Y.KR)({name:"",type:1,shell:"",hostIDs:"",cronExpr:"",remark:""}),f=(0,Y.Kh)({name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"change"}],shell:[{required:!0,validator:(e,a,t)=>{m.value.length>0?t():t(new Error("请选择任务模板"))},trigger:"change"}],cronExpr:[{required:!1,validator:(e,a,t)=>{2!==b.value.type||a?t():t(new Error("请输入定时表达式"))},trigger:"blur"}],hostIDs:[{required:!0,message:"请选择执行主机",trigger:"blur"}]}),y=async()=>{l.value=!0;try{console.log("请求参数:",JSON.stringify(k,null,2));const e=await _e({page:k.page,pageSize:k.pageSize,name:k.name||void 0,type:k.type||void 0,status:k.status||void 0});console.log("API响应:",JSON.stringify(e,null,2));const t=e?.data||{};if(200!==t.code)throw new Error(t.message||"获取任务列表失败");a.value=Array.isArray(t.data?.list)?t.data.list.map(e=>({id:e.id,name:e.name,type:e.type,shell:e.shell,hostIDs:e.host_ids,cronExpr:e.cron_expr,status:e.status,duration:e.duration,executeCount:e.execute_count||0,nextRunTime:e.next_run_time,remark:e.remark,startTime:e.start_time?O(e.start_time):"",endTime:e.end_time?O(e.end_time):"",createdAt:e.created_at?O(e.created_at):"",isActive:2===e.status})):[],n.value=t.data?.total||a.value.length,console.log("处理后的任务列表数据:",a.value)}catch(e){console.error("获取任务列表异常:",e),a.value=[],n.value=0}finally{l.value=!1}},_=()=>{b.value={name:"",type:1,shell:"",hostIDs:"",cronExpr:"",remark:""},m.value=[],g.value=[],(0,r.dY)(()=>{s.value=!0})},w=async e=>{try{await uv.s.confirm("确定要删除该任务吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ye({id:e}),J.nk.success("删除成功"),y()}catch(a){"cancel"!==a&&(console.error("删除任务失败:",a),J.nk.error(`删除失败: ${a.response?.data?.message||a.message||"未知错误"}`))}},L=async()=>{try{await(o.value?.validate()),!b.value.shell&&m.value.length>0&&(b.value.shell=m.value.join(","));const e={name:b.value.name.trim(),type:b.value.type,shell:b.value.shell||"",host_ids:b.value.hostIDs,remark:b.value.remark};2===b.value.type&&(e.cron_expr=b.value.cronExpr),console.log("提交的任务数据:",JSON.stringify(e,null,2));const a=await fe(e);if(console.log("API响应:",JSON.stringify(a,null,2)),200!==a.data?.code)throw new Error(a.data?.message||"创建任务失败");J.nk.success("任务创建成功"),s.value=!1,await(0,r.dY)(),y()}catch(e){"ValidationError"!==e.name&&(console.error("创建任务失败:",e),J.nk.error(`创建任务失败: ${e.response?.data?.message||e.message||"未知错误"}`))}},F=async e=>{try{l.value=!0,k.name=e,k.pageNum=1;const t=await we({name:e||void 0,pageNum:k.pageNum,pageSize:k.pageSize});a.value=t.data?.data||[],n.value=t.data?.total||a.value.length}catch(t){console.error("按名称搜索失败:",t),J.nk.error(`按名称搜索失败: ${t.message||"未知错误"}`)}finally{l.value=!1}},C=async e=>{try{l.value=!0,k.type=e,k.pageNum=1;const t=await Le({type:e||void 0,pageNum:k.pageNum,pageSize:k.pageSize});a.value=t.data?.data||[],n.value=t.data?.total||a.value.length}catch(t){console.error("按类型搜索失败:",t),J.nk.error(`按类型搜索失败: ${t.message||"未知错误"}`)}finally{l.value=!1}},V=async e=>{try{l.value=!0,k.status=e,k.pageNum=1;const t=await Fe({status:e||void 0,pageNum:k.pageNum,pageSize:k.pageSize});a.value=t.data?.data||[],n.value=t.data?.total||a.value.length}catch(t){console.error("按状态搜索失败:",t),J.nk.error(`按状态搜索失败: ${t.message||"未知错误"}`)}finally{l.value=!1}},S=()=>{k.name="",k.type=null,k.status=null,k.pageNum=1,y()},I=()=>{o.value?.resetFields()},A=e=>{k.pageSize=e,k.page=1,y()},R=e=>{k.page=e,y()},D=e=>{switch(e){case 1:return"type-normal";case 2:return"type-cron";case 3:return"type-ansible";case 4:return"type-job";default:return""}},P=e=>{switch(e){case 1:return"status-waiting";case 2:return"status-running";case 3:return"status-success";case 4:return"status-error";case 5:return"status-paused";default:return""}},$=e=>{switch(e){case 1:return"等待中";case 2:return"运行中";case 3:return"成功";case 4:return"异常";case 5:return"已暂停";default:return"未知"}},T=e=>{switch(e){case 1:return t(1070);case 2:return t(3009);case 3:return t(8484);case 4:return t(5003);default:return t(9144)}},M=e=>{switch(e){case 1:return"普通任务";case 2:return"定时任务";case 3:return"Ansible";case 4:return"工作作业";default:return"普通任务"}},E=async()=>{if(b.value.cronExpr&&2===b.value.type)try{const e=await Ce({cron:b.value.cronExpr});e.data?.data?.next_execution_time?c.value=O(e.data.data.next_execution_time):c.value="无法计算"}catch(e){console.error("计算下次执行时间失败:",e),c.value="计算失败"}else c.value=""},W=async()=>{try{const e=await me();200===e.data?.code&&(u.value=e.data.data||[])}catch(e){console.error("获取模板列表失败:",e)}},z=async()=>{try{const e=await ue.getGroupListWithHosts();200===e.data?.code&&(p.value=e.data.data||[])}catch(e){console.error("获取分组和主机列表失败:",e)}},N=()=>{v.value=!0},K=e=>{const a=u.value.find(a=>a.id===e);return a?a.name:"未知模板"},U=e=>{m.value=m.value.filter(a=>a!==e),q()},X=e=>{const a=Array.isArray(e)?e:[];m.value=[...a],b.value.shell=a.join(","),v.value=!1},q=()=>{b.value.shell=m.value.join(",")},H=()=>{h.value=!0},B=e=>{const a=Array.isArray(e)?e:[],t=new Set(g.value.map(e=>e.id));g.value=[...g.value,...a.filter(e=>e?.id&&!t.has(e.id))],b.value.hostIDs=g.value.filter(e=>e?.id).map(e=>e.id).join(","),h.value=!1},j=e=>{g.value=g.value.filter(a=>a?.id!==e),b.value.hostIDs=g.value.filter(e=>e?.id).map(e=>e.id).join(",")},O=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")},Q=async e=>{const a=e.isActive,t=a?"启动":"暂停",s=a?"确定要启动该定时任务吗？启动后任务将重新开始自动执行。":"确定要暂停该定时任务吗？暂停后任务将不再自动执行。";try{await uv.s.confirm(s,`${t}任务`,{confirmButtonText:"确定",cancelButtonText:"取消",type:a?"info":"warning"}),l.value=!0;const o=a?ze:We,n=await o(e.id);if(200!==n.data?.code)throw new Error(n.data?.message||`${t}任务失败`);J.nk.success(`任务${t}成功`),e.status=a?2:5,y()}catch(o){"cancel"!==o?(console.error(`${t}任务失败:`,o),J.nk.error(`${t}失败: ${o.response?.data?.message||o.message||"未知错误"}`),e.isActive=!e.isActive):e.isActive=!e.isActive}finally{l.value=!1}};return(0,r.sV)(async()=>{try{await Promise.all([y(),W(),z()])}catch(e){console.error("初始化失败:",e)}}),(e,t)=>{const p=(0,r.g2)("el-input"),y=(0,r.g2)("el-form-item"),W=(0,r.g2)("el-option"),z=(0,r.g2)("el-select"),q=(0,r.g2)("el-icon"),G=(0,r.g2)("el-button"),Z=(0,r.g2)("el-form"),ee=(0,r.g2)("el-table-column"),ae=(0,r.g2)("el-switch"),te=(0,r.g2)("el-tooltip"),le=(0,r.g2)("el-table"),se=(0,r.g2)("el-pagination"),oe=(0,r.g2)("el-card"),ne=(0,r.g2)("el-dialog"),ie=(0,r.gN)("authority"),re=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",SM,[(0,r.bF)(oe,{shadow:"hover",class:"taskjob-card"},{header:(0,r.k6)(()=>t[18]||(t[18]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"任务管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",IM,[(0,r.bF)(Z,{inline:!0,model:k,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{label:"任务名称"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{placeholder:"请输入任务名称",size:"small",clearable:"",modelValue:k.name,"onUpdate:modelValue":t[0]||(t[0]=e=>k.name=e),onKeyup:t[1]||(t[1]=(0,i.jR)(e=>F(k.name),["enter"]))},null,8,["modelValue"])]),_:1}),(0,r.bF)(y,{label:"任务类型",style:{width:"200px"}},{default:(0,r.k6)(()=>[(0,r.bF)(z,{size:"small",placeholder:"请选择任务类型",modelValue:k.type,"onUpdate:modelValue":t[2]||(t[2]=e=>k.type=e),onChange:t[3]||(t[3]=e=>C(k.type)),style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(W,{label:"普通任务",value:1}),(0,r.bF)(W,{label:"定时任务",value:2})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(y,{label:"任务状态",style:{width:"200px"}},{default:(0,r.k6)(()=>[(0,r.bF)(z,{size:"small",placeholder:"请选择任务状态",modelValue:k.status,"onUpdate:modelValue":t[4]||(t[4]=e=>k.status=e),onChange:t[5]||(t[5]=e=>V(k.status)),style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(W,{label:"等待中",value:1}),(0,r.bF)(W,{label:"运行中",value:2}),(0,r.bF)(W,{label:"成功",value:3}),(0,r.bF)(W,{label:"异常",value:4}),(0,r.bF)(W,{label:"已暂停",value:5})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(y,null,{default:(0,r.k6)(()=>[(0,r.bF)(G,{type:"primary",size:"small",onClick:t[6]||(t[6]=e=>F(k.name)),class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(q,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Search))]),_:1}),t[19]||(t[19]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[19]}),(0,r.bF)(G,{size:"small",onClick:S,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(q,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Refresh))]),_:1}),t[20]||(t[20]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[20]})]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",AM,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(G,{type:"success",size:"small",onClick:_,class:"modern-btn success-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(q,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Plus))]),_:1}),t[21]||(t[21]=(0,r.eW)(" 新增任务 ",-1))]),_:1,__:[21]})),[[ie,["task:job:add"]]])]),(0,r.Lk)("div",RM,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(le,{data:a.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{background:"#eef1f6",color:"#606266"}},{default:(0,r.k6)(()=>[(0,r.bF)(ee,{prop:"name",label:"任务名称"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",DM,[t[22]||(t[22]=(0,r.Lk)("img",{src:wT,alt:"任务",style:{width:"20px",height:"20px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(ee,{prop:"type",label:"类型",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",PM,[(0,r.Lk)("img",{src:T(e.type),alt:M(e.type),style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,8,$M),(0,r.Lk)("span",{class:(0,x.C4)(D(e.type))},(0,x.v_)(M(e.type)),3)])]),_:1}),(0,r.bF)(ee,{prop:"status",label:"状态"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",{class:(0,x.C4)(P(e.status))},(0,x.v_)($(e.status)),3)]),_:1}),(0,r.bF)(ee,{prop:"cronExpr",label:"定时表达式"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(2===e.type&&e.cronExpr||"-"),1)]),_:1}),(0,r.bF)(ee,{prop:"duration",label:"执行耗时(秒)"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",TM,[t[23]||(t[23]=(0,r.Lk)("img",{src:LT,alt:"时间",style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.duration||"0"),1)])]),_:1}),(0,r.bF)(ee,{prop:"executeCount",label:"执行次数"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",MM,[t[24]||(t[24]=(0,r.Lk)("img",{src:FT,alt:"次数",style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",EM,(0,x.v_)(e.executeCount||"0"),1)])]),_:1}),(0,r.bF)(ee,{label:"任务开关",align:"center"},{default:(0,r.k6)(({row:e})=>[2===e.type?((0,r.uX)(),(0,r.Wv)(ae,{key:0,modelValue:e.isActive,"onUpdate:modelValue":a=>e.isActive=a,disabled:1===e.status,onChange:a=>Q(e),"active-text":"启动","inactive-text":"暂停"},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])):((0,r.uX)(),(0,r.CE)("span",WM,"-"))]),_:1}),(0,r.bF)(ee,{prop:"nextRunTime",label:"下次执行时间",width:"220"},{default:(0,r.k6)(({row:e})=>[2===e.type&&e.nextRunTime?((0,r.uX)(),(0,r.CE)("div",zM,[t[25]||(t[25]=(0,r.Lk)("img",{src:CT,alt:"定时",style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",NM,(0,x.v_)(O(e.nextRunTime)),1)])):((0,r.uX)(),(0,r.CE)("span",KM,"-"))]),_:1}),(0,r.bF)(ee,{prop:"remark",label:"备注信息"}),(0,r.bF)(ee,{label:"操作"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",UM,[(0,r.bF)(te,{content:"启动任务",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(G,{type:"success",icon:(0,Y.R1)(vc.VideoPlay),size:"small",circle:"",onClick:async()=>{if(console.log("Starting task with ID:",e.id),!e.id)return void(0,Y.R1)(J.nk).error("任务ID无效");const a=await(d.value?.showFlow?.(e.id));console.log("API Task ID:",a)}},null,8,["icon","onClick"]),[[ie,["task:job:start"]]])]),_:2},1024),(0,r.bF)(te,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(G,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",onClick:a=>w(e.id)},null,8,["icon","onClick"]),[[ie,["task:job:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[re,l.value]])]),(0,r.Lk)("div",XM,[(0,r.bF)(se,{onSizeChange:A,onCurrentChange:R,"current-page":k.pageNum,"page-sizes":[10,50,100],"page-size":k.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n.value},null,8,["current-page","page-size","total"])])]),_:1}),(0,r.bF)(ne,{title:"新增任务",modelValue:s.value,"onUpdate:modelValue":t[17]||(t[17]=e=>s.value=e),width:"35%",onClose:I},{footer:(0,r.k6)(()=>[(0,r.bF)(G,{onClick:t[16]||(t[16]=e=>s.value=!1)},{default:(0,r.k6)(()=>t[32]||(t[32]=[(0,r.eW)("取消",-1)])),_:1,__:[32]}),(0,r.bF)(G,{type:"primary",onClick:L},{default:(0,r.k6)(()=>t[33]||(t[33]=[(0,r.eW)("确定",-1)])),_:1,__:[33]})]),default:(0,r.k6)(()=>[(0,r.bF)(Z,{ref_key:"taskFormRef",ref:o,"label-width":"100px",model:b.value,rules:f},{default:(0,r.k6)(()=>[(0,r.bF)(y,{label:"任务名称",prop:"name","label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:b.value.name,"onUpdate:modelValue":t[7]||(t[7]=e=>b.value.name=e),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(y,{label:"任务类型",prop:"type","label-width":"120px"},{default:(0,r.k6)(()=>[(0,r.bF)(z,{modelValue:b.value.type,"onUpdate:modelValue":t[8]||(t[8]=e=>b.value.type=e),placeholder:"请选择任务类型"},{default:(0,r.k6)(()=>[(0,r.bF)(W,{label:"普通任务",value:1}),(0,r.bF)(W,{label:"定时任务",value:2})]),_:1},8,["modelValue"])]),_:1}),2===b.value.type?((0,r.uX)(),(0,r.Wv)(y,{key:0,label:"定时表达式",prop:"cronExpr"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:b.value.cronExpr,"onUpdate:modelValue":t[9]||(t[9]=e=>b.value.cronExpr=e),placeholder:"请输入cron表达式，如: * * * * *",onChange:E},null,8,["modelValue"]),c.value?((0,r.uX)(),(0,r.CE)("span",qM," 下次执行时间: "+(0,x.v_)(c.value),1)):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(y,{label:"任务模版",prop:"shell",style:{"margin-bottom":"15px"}},{default:(0,r.k6)(()=>[(0,r.Lk)("div",HM,[(0,r.bF)(G,{type:"primary",icon:"Plus",size:"small",onClick:N,style:{"margin-left":"10px"}},{default:(0,r.k6)(()=>t[26]||(t[26]=[(0,r.eW)("添加模板",-1)])),_:1,__:[26]})]),m.value.length>0?((0,r.uX)(),(0,r.CE)("div",BM,[t[27]||(t[27]=(0,r.Lk)("div",{style:{color:"#606266","margin-bottom":"8px"}},"已选择模板:",-1)),(0,r.Lk)("div",jM,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"6px 10px",background:"white","border-radius":"4px"}},[(0,r.Lk)("span",null,(0,x.v_)(K(e)),1),(0,r.bF)(G,{type:"danger",icon:"Close",size:"small",circle:"",plain:"",onClick:a=>U(e)},null,8,["onClick"])]))),128))])])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(ne,{title:"选择任务模板",modelValue:v.value,"onUpdate:modelValue":t[13]||(t[13]=e=>v.value=e),width:"35%"},{footer:(0,r.k6)(()=>[(0,r.bF)(G,{onClick:t[11]||(t[11]=e=>v.value=!1)},{default:(0,r.k6)(()=>t[28]||(t[28]=[(0,r.eW)("取消",-1)])),_:1,__:[28]}),(0,r.bF)(G,{type:"primary",onClick:t[12]||(t[12]=e=>X(m.value))},{default:(0,r.k6)(()=>t[29]||(t[29]=[(0,r.eW)("确定",-1)])),_:1,__:[29]})]),default:(0,r.k6)(()=>[(0,r.bF)(z,{modelValue:m.value,"onUpdate:modelValue":t[10]||(t[10]=e=>m.value=e),multiple:"",placeholder:"请选择任务模板",style:{width:"100%"},filterable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(u.value,e=>((0,r.uX)(),(0,r.Wv)(W,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"]),(0,r.bF)(y,{label:"执行主机",prop:"hostIDs"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",OM,[(0,r.bF)(G,{type:"primary",icon:"Plus",size:"small",onClick:H,style:{"margin-left":"10px"}},{default:(0,r.k6)(()=>t[30]||(t[30]=[(0,r.eW)("添加主机",-1)])),_:1,__:[30]})]),g.value.length>0?((0,r.uX)(),(0,r.CE)("div",QM,[t[31]||(t[31]=(0,r.Lk)("div",{style:{color:"#606266","margin-bottom":"8px"}},"已选择主机:",-1)),(0,r.Lk)("div",GM,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,e=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"6px 10px",background:"white","border-radius":"4px"}},[(0,r.Lk)("span",null,(0,x.v_)(e.name)+" ("+(0,x.v_)(e.ip)+")",1),(0,r.bF)(G,{type:"danger",icon:"Close",size:"small",circle:"",plain:"",onClick:a=>j(e.id)},null,8,["onClick"])]))),128))])])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(xM,{modelValue:h.value,"onUpdate:modelValue":t[14]||(t[14]=e=>h.value=e),onHostsSelected:B},null,8,["modelValue"]),(0,r.bF)(y,{label:"备注信息"},{default:(0,r.k6)(()=>[(0,r.bF)(p,{modelValue:b.value.remark,"onUpdate:modelValue":t[15]||(t[15]=e=>b.value.remark=e),type:"textarea",rows:2,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),(0,r.bF)(gM,{ref_key:"jobFlowRef",ref:d},null,512)])}}};const JM=(0,p.A)(YM,[["__scopeId","data-v-e2f03b76"]]);var ZM=JM,eE=t.p+"static/img/zhuangtai.1d99f8d2.svg",aE=t.p+"static/img/定时关闭.712ceb9b.svg";const tE={class:"ansible-flow-container",style:{"margin-top":"-5px !important",top:"-5px !important"}},lE={class:"flow-header"},sE={class:"connector-canvas",ref:"connectorCanvas"},oE={class:"connector-defs"},nE=["id"],iE=["fill"],rE=["id"],dE=["fill"],cE={class:"card-title"},uE={class:"card-content"},pE={key:0,class:"card-duration"},mE={class:"card-buttons"},gE=["onClick"],vE={style:{position:"fixed","z-index":"9999"}};function hE(e,a,t,l,s,o){const n=(0,r.g2)("VideoPlay"),d=(0,r.g2)("el-icon"),c=(0,r.g2)("el-button"),u=(0,r.g2)("Refresh"),p=(0,r.g2)("el-tooltip"),m=(0,r.g2)("ansible-log-dialog"),g=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",tE,[(0,r.Lk)("div",lE,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(c,{onClick:o.startAnsibleTask,type:"primary",size:"medium",style:{height:"40px",padding:"0 20px"},loading:s.starting},{default:(0,r.k6)(()=>[(0,r.bF)(d,{size:"20"},{default:(0,r.k6)(()=>[(0,r.bF)(n)]),_:1}),a[0]||(a[0]=(0,r.Lk)("span",{style:{"margin-left":"8px"}},"启动任务",-1))]),_:1,__:[0]},8,["onClick","loading"])),[[g,["task:ansible:jobstart"]]]),(0,r.bF)(c,{onClick:o.handleRefresh,type:"info",size:"medium",style:{height:"40px",padding:"0 20px"}},{default:(0,r.k6)(()=>[(0,r.bF)(d,{size:"20"},{default:(0,r.k6)(()=>[(0,r.bF)(u)]),_:1}),a[1]||(a[1]=(0,r.Lk)("span",{style:{"margin-left":"8px"}},"刷新状态",-1))]),_:1,__:[1]},8,["onClick"])]),((0,r.uX)(),(0,r.CE)("svg",sE,null,512)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.orderedSteps,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:t,class:"flow-step",style:(0,x.Tr)({"--step-order":e.order})},[((0,r.uX)(),(0,r.CE)("svg",oE,[(0,r.Lk)("defs",null,[(0,r.Lk)("marker",{id:"arrowhead-"+t,markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto"},[(0,r.Lk)("path",{d:"M0,0 L0,4 L6,2 Z",fill:"completed"===e.status?"rgba(76,175,80,0.7)":"active"===e.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"},null,8,iE)],8,nE),(0,r.Lk)("marker",{id:"flow-arrow-"+t,markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto"},[(0,r.Lk)("path",{d:"M0,0 L0,4 L6,2 Z",fill:"completed"===e.status?"rgba(76,175,80,0.7)":"active"===e.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"},null,8,dE)],8,rE)])])),(0,r.Lk)("div",{class:(0,x.C4)(["flow-card",o.getStepClass(e)])},[(0,r.Lk)("div",{class:(0,x.C4)(["status-text","status-"+e.status])},(0,x.v_)("completed"===e.status?"完成":"active"===e.status?"运行中":"error"===e.status?"异常":"等待"),3),(0,r.Lk)("h3",cE,[a[2]||(a[2]=(0,r.Lk)("svg",{class:"title-icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[(0,r.Lk)("path",{fill:"#E6522C",d:"M512 1024C229.23 1024 0 794.77 0 512S229.23 0 512 0s512 229.23 512 512-229.23 512-512 512zm0-938.67C276.36 85.33 85.33 276.36 85.33 512S276.36 938.67 512 938.67 938.67 747.64 938.67 512 747.64 85.33 512 85.33z"}),(0,r.Lk)("path",{fill:"#E6522C",d:"M341.33 426.67a42.67 42.67 0 100-85.34 42.67 42.67 0 000 85.34zM682.67 426.67a42.67 42.67 0 100-85.34 42.67 42.67 0 000 85.34z"}),(0,r.Lk)("path",{fill:"#E6522C",d:"M512 768c-117.82 0-213.33-95.51-213.33-213.33h426.66C725.33 672.49 629.82 768 512 768z"})],-1)),(0,r.eW)(" "+(0,x.v_)(e.title),1)]),(0,r.Lk)("p",uE,"任务名称: "+(0,x.v_)(e.entry_file_name),1),e.duration>0?((0,r.uX)(),(0,r.CE)("div",pE," 执行时长: "+(0,x.v_)(o.formatDuration(e.duration))+"秒 ",1)):(0,r.Q3)("",!0),(0,r.Lk)("div",mE,[(0,r.bF)(p,{effect:"dark",content:"查看日志",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("button",{onClick:(0,i.D$)(a=>o.onLogClick(e),["stop"]),class:"btn-icon"},a[3]||(a[3]=[(0,r.Lk)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,r.Lk)("path",{d:"M21 10H7M21 6H3M21 14H3M21 18H7",stroke:"#722ed1","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,gE)]),_:2},1024)])],2)],4))),128)),(0,r.Lk)("div",vE,[(0,r.bF)(m,{ref:"ansibleLogDialog"},null,512)])])}const kE={key:0,class:"log-header"},bE={class:"log-container"},fE={class:"log-controls"},yE={class:"log-content-wrapper"},_E={key:0,class:"log-stats"},wE={key:0,style:{color:"#67c23a"}},LE={key:1,style:{color:"#409eff"}},FE={key:2,style:{color:"#909399"}},CE={key:0,class:"log-loading"},VE={key:1,class:"log-error"},xE={key:2,class:"log-empty"},SE={key:3,class:"log-lines"},IE={class:"line-number"},AE=["innerHTML"],RE=5,DE=3e3;var PE={__name:"AnsibleLogDialog",props:{visible:{type:Boolean,default:!1}},emits:["update:visible"],setup(e,{expose:a,emit:t}){const l=e,s=t,o=(0,Y.KR)(!1),n=(0,Y.KR)(!1),i=(0,Y.KR)(!1),d=(0,Y.KR)(!1),c=(0,Y.KR)(""),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(null),g=(0,Y.KR)([]),v=(0,Y.KR)(null),h=(0,Y.KR)([]),k=(0,Y.KR)([]),b=(0,Y.KR)(0);let f=null,y=null,_=0,w=null;(0,r.wB)(()=>l.visible,e=>{o.value=e}),(0,r.wB)(o,e=>{s("update:visible",e),e?(0,r.dY)(()=>{M()}):(S(),A())});const L=e=>{m.value={...e},g.value=[],h.value=[],k.value=[],b.value=0,d.value=!1,u.value=!1,n.value=!0,o.value=!0,R(),F()},F=()=>{if(!m.value)return;const{taskId:e,workId:a}=m.value,t=`ws://localhost:8080/api/v1/ws/task/ansible/${e}/log/${a}`;console.log("🔌 连接WebSocket:",t),console.log("📊 WebSocket连接参数:",{taskId:e,workId:a,wsUrl:t});try{f=new WebSocket(t),f.onopen=()=>{console.log("✅ WebSocket连接成功"),p.value=!0,_=0,n.value=!1},f.onmessage=e=>{try{const a=JSON.parse(e.data);C(a)}catch(a){console.error("解析WebSocket消息失败:",a)}},f.onclose=e=>{console.log("🔌 WebSocket连接关闭:",e.code,e.reason),p.value=!1,1e3!==e.code&&o.value&&_<RE&&V()},f.onerror=e=>{console.error("❌ WebSocket连接错误:",e),p.value=!1,console.log("🔄 WebSocket连接失败，切换到HTTP轮询模式"),I()}}catch(l){console.error("❌ 创建WebSocket连接失败:",l),d.value=!0,c.value="无法创建WebSocket连接"}},C=e=>{switch(console.log("📨 收到WebSocket消息:",e),e.type){case"log":e.line_num>b.value&&(b.value=e.line_num,k.value.push({line_num:e.line_num,content:e.content,timestamp:e.timestamp,source:"websocket"}),P(),(0,r.dY)(()=>{M()}));break;case"complete":u.value=!0,p.value=!1,console.log(`✅ 任务完成，共${e.line_num}行日志`),J.nk.success(`任务完成，共${g.value.length}行日志`),f&&f.close(1e3,"Task completed");break;case"error":d.value=!0,c.value=e.content||"任务执行错误",J.nk.error(c.value);break;default:console.warn("未知的WebSocket消息类型:",e.type)}},V=()=>{if(_>=RE)return void console.log("❌ WebSocket重连次数超限，停止重连");_++;const e=Math.min(1e3*Math.pow(2,_),1e4);console.log(`🔄 WebSocket重连 (${_}/${RE})，${e/1e3}秒后重试`),y=setTimeout(()=>{o.value&&F()},e)},S=()=>{y&&(clearTimeout(y),y=null),f&&(f.close(1e3,"Dialog closed"),f=null),p.value=!1,_=0,A()},I=()=>{console.log("🔄 启动HTTP轮询模式"),A(),R(),w=setInterval(async()=>{try{await R(),console.log("📥 HTTP轮询获取日志成功")}catch(e){console.error("❌ HTTP轮询获取日志失败:",e)}},DE),console.log(`✅ HTTP轮询已启动，间隔${DE/1e3}秒`)},A=()=>{w&&(clearInterval(w),w=null,console.log("🛑 HTTP轮询已停止"))},R=async()=>{if(m.value&&!i.value){i.value=!0,d.value=!1;try{console.log("🔄 获取历史日志..."),0===g.value.length&&J.nk.info("正在获取历史日志，后端可能需要处理时间...");const e=await De(m.value.taskId,m.value.workId);if(e&&e.data){const a=D(e.data);h.value=a,P(),console.log(`✅ 获取到 ${a.length} 行历史日志`),d.value=!1,c.value="",a.length>0&&J.nk.success(`成功获取 ${a.length} 行历史日志`)}}catch(e){if(console.error("❌ 获取历史日志失败:",e),"ECONNABORTED"===e.code){const a=e.contextMessage||"后端处理时间较长";console.warn("⚠️ 历史日志获取超时，但WebSocket实时日志仍可用"),(0,J.nk)({type:"warning",message:`${a}，实时日志正常运行中`,duration:5e3,showClose:!0}),0===g.value.length&&(0,J.nk)({type:"info",message:"暂无历史日志，等待实时日志数据...",duration:3e3})}else d.value=!0,c.value="获取历史日志失败: "+(e.message||"未知错误"),J.nk.error(c.value)}finally{i.value=!1,n.value=!1}}},D=e=>{if("string"!==typeof e)return[];const a=e.split("\n").filter(e=>e.trim());return a.map((e,a)=>({line_num:a+1,content:e,timestamp:null,source:"history"}))},P=()=>{const e=new Map;h.value.forEach(a=>{const t=a.content.trim();t&&!e.has(t)&&e.set(t,{...a,finalLineNum:a.line_num})}),k.value.forEach(a=>{const t=a.content.trim();if(t&&!e.has(t)){const l=h.value.length;e.set(t,{...a,finalLineNum:l+k.value.indexOf(a)+1})}});const a=Array.from(e.values()).sort((e,a)=>e.finalLineNum-a.finalLineNum);g.value=a.map((e,a)=>({...e,line_num:a+1})),console.log(`🔄 日志合并完成: 历史${h.value.length}行 + 实时${k.value.length}行 = 最终${g.value.length}行`)},$=e=>e?e.replace(/\u001b\[0;32m/g,'<span style="color: #67c23a;">').replace(/\u001b\[0;31m/g,'<span style="color: #f56c6c;">').replace(/\u001b\[0;33m/g,'<span style="color: #e6a23c;">').replace(/\u001b\[0;34m/g,'<span style="color: #409eff;">').replace(/\u001b\[0m/g,"</span>").replace(/\u001b\[[\d;]*m/g,""):"",T=e=>{const a=e.content.toLowerCase();return a.includes("error")||a.includes("failed")?"log-error-line":a.includes("warn")?"log-warn-line":a.includes("success")||a.includes("ok")?"log-success-line":""},M=()=>{v.value&&(v.value.scrollTop=v.value.scrollHeight)},E=()=>{try{const e=g.value.map(e=>e.content).join("\n"),a=new Blob([e],{type:"text/plain;charset=utf-8"}),t=window.URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`ansible-task-${m.value?.taskId}-work-${m.value?.workId}-logs.txt`,l.click(),window.URL.revokeObjectURL(t),J.nk.success("日志下载成功")}catch(e){console.error("下载日志失败:",e),J.nk.error("下载日志失败")}},W=()=>{S(),o.value=!1};return(0,r.hi)(()=>{S(),A()}),a({show:L}),(e,a)=>{const t=(0,r.g2)("el-descriptions-item"),l=(0,r.g2)("el-descriptions"),s=(0,r.g2)("el-button"),h=(0,r.g2)("el-tag"),k=(0,r.g2)("el-icon"),b=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(b,{title:"Ansible任务日志",modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),width:"80%",top:"5vh","append-to-body":"","before-close":W},{default:(0,r.k6)(()=>[m.value?((0,r.uX)(),(0,r.CE)("div",kE,[(0,r.bF)(l,{column:3,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(t,{label:"任务ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(m.value.taskId),1)]),_:1}),(0,r.bF)(t,{label:"Work ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(m.value.workId),1)]),_:1}),(0,r.bF)(t,{label:"文件名"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(m.value.fileName),1)]),_:1})]),_:1})])):(0,r.Q3)("",!0),(0,r.Lk)("div",bE,[(0,r.Lk)("div",fE,[(0,r.bF)(s,{type:"primary",icon:"Refresh",size:"small",onClick:R,loading:i.value},{default:(0,r.k6)(()=>a[1]||(a[1]=[(0,r.eW)(" 刷新日志 ",-1)])),_:1,__:[1]},8,["loading"]),(0,r.bF)(s,{type:"info",icon:"Download",size:"small",onClick:E},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)(" 下载日志 ",-1)])),_:1,__:[2]}),p.value?((0,r.uX)(),(0,r.Wv)(h,{key:0,type:"success",size:"small"},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)(" 🔄 实时连接 ",-1)])),_:1,__:[3]})):u.value?((0,r.uX)(),(0,r.Wv)(h,{key:1,type:"info",size:"small"},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)(" ✅ 任务完成 ",-1)])),_:1,__:[4]})):((0,r.uX)(),(0,r.Wv)(h,{key:2,type:"warning",size:"small"},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)(" ⚪ 未连接 ",-1)])),_:1,__:[5]}))]),(0,r.Lk)("div",yE,[g.value.length>0?((0,r.uX)(),(0,r.CE)("div",_E,[(0,r.eW)(" 📊 日志行数: "+(0,x.v_)(g.value.length)+" 行 ",1),u.value?((0,r.uX)(),(0,r.CE)("span",wE,"| ✅ 任务已完成")):p.value?((0,r.uX)(),(0,r.CE)("span",LE,"| 🔄 任务运行中")):((0,r.uX)(),(0,r.CE)("span",FE,"| 空闲"))])):(0,r.Q3)("",!0),(0,r.Lk)("div",{ref_key:"logContainer",ref:v,class:(0,x.C4)(["log-content",{loading:n.value,error:d.value}])},[n.value?((0,r.uX)(),(0,r.CE)("div",CE,[(0,r.bF)(k,{class:"is-loading"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Loading))]),_:1}),a[6]||(a[6]=(0,r.Lk)("div",{class:"loading-text"},[(0,r.Lk)("div",null,"加载历史日志中..."),(0,r.Lk)("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 后端可能需要2-3分钟处理时间，请耐心等待 ")],-1))])):d.value?((0,r.uX)(),(0,r.CE)("div",VE,[(0,r.bF)(k,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.WarningFilled))]),_:1}),(0,r.eW)(" "+(0,x.v_)(c.value),1)])):0===g.value.length?((0,r.uX)(),(0,r.CE)("div",xE,[(0,r.bF)(k,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Document))]),_:1}),a[7]||(a[7]=(0,r.eW)(" 暂无日志数据 ",-1))])):((0,r.uX)(),(0,r.CE)("div",SE,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(g.value,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.line_num||a}`,class:(0,x.C4)(["log-line",T(e)])},[(0,r.Lk)("span",IE,(0,x.v_)(e.line_num||a+1),1),(0,r.Lk)("span",{class:"line-content",innerHTML:$(e.content)},null,8,AE)],2))),128))]))],2)])])]),_:1},8,["modelValue"])}}};const $E=(0,p.A)(PE,[["__scopeId","data-v-4db9da56"]]);var TE=$E,ME={components:{AnsibleLogDialog:TE},data(){return{starting:!1}},props:{steps:{type:Array,required:!0,default:()=>[],validator:e=>Array.isArray(e)&&e.every(e=>"object"===typeof e&&null!==e)},taskId:{type:[String,Number],required:!0,default:null,validator:e=>null!==e&&void 0!==e&&""!==e}},watch:{steps:{handler(e){console.log("Ansible Steps prop changed - raw:",JSON.parse(JSON.stringify(e))),console.log("Current orderedSteps:",JSON.parse(JSON.stringify(this.orderedSteps))),this.$nextTick(()=>{console.log("After nextTick - orderedSteps:",JSON.parse(JSON.stringify(this.orderedSteps))),this.drawConnectors()})},deep:!0,immediate:!0}},computed:{orderedSteps(){if(!this.steps||!Array.isArray(this.steps))return console.warn("Invalid Ansible steps data:",this.steps),[];console.log("原始Ansible steps数据:",JSON.parse(JSON.stringify(this.steps)));const e=this.steps.map((e,a)=>{const t=void 0!==e.status?e.status:1,l=["pending","active","completed","error"][t-1]||"pending";return console.log(`Ansible步骤 ${e.work_id||a} 状态映射:`,`原始: ${e.status}, 最终: ${l}`),{...e,title:e.entry_file_name||`Work ${a+1}`,content:e.entry_file_name||"",order:a+1,status:l,_status:l,original_status:e.status}}).sort((e,a)=>e.order-a.order);return console.log("Ansible orderedSteps计算结果:",JSON.parse(JSON.stringify(e))),e}},methods:{getStepClass(e){return`status-${e.status}`},async startAnsibleTask(){this.starting=!0;try{if(console.log("Starting Ansible task with taskId:",this.taskId),!this.taskId)throw new Error("Ansible任务ID未定义");console.log("Using Ansible task ID:",this.taskId),await $e(this.taskId),this.$message.success("Ansible任务已启动"),this.$emit("refresh")}catch(e){console.error("启动Ansible任务失败:",e),this.$message.error("启动Ansible任务失败: "+(e.message||"未知错误"))}finally{this.starting=!1}},async handleRefresh(){try{console.log("开始刷新Ansible任务状态..."),console.log("使用taskId:",this.taskId);const e=await Pe(this.taskId);if(console.log("Ansible API完整响应:",e),!e?.data?.data?.task_info)throw new Error("无效的API响应");const a=JSON.parse(JSON.stringify(e.data.data.task_info));console.log("原始Ansible API数据:",a);const t=(a.Works||[]).map((e,a)=>{const t=e.status??1,l=["pending","active","completed","error"][t-1]||"pending";return console.log(`Ansible步骤 ${e.workid||a} 状态映射:`,`原始: ${e.status}, 最终: ${l}`),{task_id:this.taskId,work_id:e.workid,entry_file_name:e.EntryFileName||`Work ${a+1}`,status:t,duration:e.Duration||0,order:a+1}});console.log("更新后的Ansible步骤数据:",JSON.parse(JSON.stringify(t)));const l=t.map(e=>({...e,task_id:e.task_id,work_id:e.work_id,entry_file_name:e.entry_file_name,status:e.status,duration:e.duration}));console.log("准备emit的Ansible数据:",JSON.parse(JSON.stringify(l))),this.$emit("update:steps",l),this.$emit("update-steps",l),this.$emit("update:steps",[...t]),this.$emit("update-steps",[...t]),this.$emit("refresh",{steps:[...t],taskId:this.taskId}),this.$nextTick(()=>{console.log("更新后的Ansible orderedSteps:",this.orderedSteps),console.log("当前Ansible卡片状态:",this.orderedSteps.map(e=>`${e.entry_file_name}: ${e.status}`).join(", "))}),this.$message.success("Ansible任务状态已刷新")}catch(e){console.error("刷新Ansible任务状态失败:",e),this.$message.error("刷新Ansible任务状态失败: "+(e.message||"未知错误"))}},async onLogClick(e){try{if(console.log("Ansible Step data:",e),console.log("详细的step对象结构:",JSON.stringify(e,null,2)),console.log("step.task_id:",e.task_id,"typeof:",typeof e.task_id),console.log("step.work_id:",e.work_id,"typeof:",typeof e.work_id),console.log("step.workid:",e.workid,"typeof:",typeof e.workid),!e.task_id||!e.work_id&&!e.workid)throw console.error("缺少任务ID或WorkID，当前step:",e),console.error("可用的ID字段:",{task_id:e.task_id,work_id:e.work_id,workid:e.workid,id:e.id}),new Error("缺少任务ID或WorkID，请确保步骤数据包含task_id和work_id");if(console.log("AnsibleLogDialog ref:",this.$refs.ansibleLogDialog),this.$refs.ansibleLogDialog){console.log("Calling show method with loading state");const a="active"===e.status||2===e.status;console.log("任务状态检查:",{stepStatus:e.status,statusType:typeof e.status,isRunningTask:a,stepData:e}),console.log("SSE不可用，优先尝试定时刷新模式");const t=e.work_id||e.workid;console.log("使用的workId:",t,"来源:",e.work_id?"work_id":"workid"),this.$refs.ansibleLogDialog.show({taskId:e.task_id,workId:t,fileName:e.entry_file_name}),console.log("WebSocket日志对话框已显示")}else console.error("AnsibleLogDialog ref not found")}catch(a){console.error("获取Ansible任务日志失败:",a);const t=a.message&&a.message.includes("timeout"),l="active"===e.status||2===e.status;t&&l?(console.log("任务运行中的超时，切换到实时模式"),this.$message.warning("网络响应超时，将自动切换到实时日志模式")):t?(console.log("日志获取超时，可能是网络波动"),this.$message.warning("日志获取超时，请稍后重试")):(console.log("WebSocket模式下的错误将由连接处理器自动显示"),this.$message.error(`获取Ansible任务日志失败: ${a.message||"未知错误"}`))}},formatDuration(e){return e&&0!==e?e.toString():"0"},drawConnectors(){const e=this.$refs.connectorCanvas;e&&this.$el&&(this.drawTimeout&&clearTimeout(this.drawTimeout),this.drawTimeout=setTimeout(()=>{const a={},t=Array.from(this.$el.querySelectorAll(".flow-step"));t.forEach(e=>{const t=e.querySelector(".flow-card");if(!t)return;const l=t.getBoundingClientRect();if(l.width>0&&l.height>0){const t=parseInt(e.style.getPropertyValue("--step-order"));a[t]={step:e,rect:l}}});const l=this.$el.getBoundingClientRect();e.innerHTML="";const s=document.createDocumentFragment(),o=Object.values(a).sort((e,a)=>{const t=parseInt(e.step.style.getPropertyValue("--step-order")),l=parseInt(a.step.style.getPropertyValue("--step-order"));return t-l});for(let e=0;e<o.length;e++){const a=o[e],t=parseInt(a.step.style.getPropertyValue("--step-order"));if(e<o.length-1){const n=o[e+1],i=parseInt(n.step.style.getPropertyValue("--step-order"));if(i===t+1){const e=a.rect.right-l.left,o=a.rect.top+a.rect.height/2-l.top,i=n.rect.left-l.left,r=n.rect.top+n.rect.height/2-l.top,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",`M${e},${o} L${i},${r}`),d.setAttribute("class","flow-path"),d.setAttribute("stroke","completed"===a.step.status?"rgba(76,175,80,0.5)":"active"===a.step.status?"rgba(33,150,243,0.5)":"rgba(128,128,128,0.5)"),d.setAttribute("stroke-width","2"),d.setAttribute("stroke-dasharray","8,4"),d.setAttribute("marker-end",`url(#arrowhead-${t})`),d.setAttribute("fill","none");const c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx","0"),c.setAttribute("cy","0"),c.setAttribute("r","3"),c.setAttribute("fill","completed"===a.step.status?"rgba(76,175,80,0.7)":"active"===a.step.status?"rgba(33,150,243,0.7)":"rgba(128,128,128,0.7)"),c.setAttribute("class","flow-arrow");const u=document.createElementNS("http://www.w3.org/2000/svg","animateMotion");u.setAttribute("path",`M${e},${o} L${i},${r}`),u.setAttribute("dur","3s"),u.setAttribute("repeatCount","indefinite"),c.appendChild(u),s.appendChild(d),s.appendChild(c)}}}e.appendChild(s)},150))}},mounted(){this.$nextTick(()=>{this.drawConnectors(),this.observer=new ResizeObserver(()=>{this.drawConnectors()}),this.observer.observe(this.$el),this.mutationObserver=new MutationObserver(e=>{e.forEach(()=>this.drawConnectors())}),this.mutationObserver.observe(this.$el,{childList:!0,subtree:!0,attributes:!0})})},updated(){this.$nextTick(()=>this.drawConnectors())},beforeUnmount(){console.log("Ansible Component destroying..."),this.observer?.disconnect(),this.mutationObserver?.disconnect(),this.drawTimeout&&clearTimeout(this.drawTimeout),console.log("Ansible Component destroyed")}};const EE=(0,p.A)(ME,[["render",hE],["__scopeId","data-v-41ef9adc"]]);var WE=EE;const zE={class:"flow-container"};var NE={__name:"AnsibleJobFlow",setup(e,{expose:a}){const t=(0,Y.KR)(!1),l=(0,Y.KR)(null),s=(0,Y.KR)(null),o=(0,Y.KR)(null),n=(0,Y.KR)([]),i=(0,r.EW)(()=>{if(console.log("计算Ansible steps - currentTaskId:",s.value),console.log("计算Ansible steps - worksData:",JSON.parse(JSON.stringify(n.value))),!s.value){const e=[{work_id:1,entry_file_name:"默认任务",status:1,duration:0,id:"ansible-work-1",hasDownConnector:!1,showHorizontalConnector:!1}];return console.log("返回模拟Ansible steps:",e),e}if(s.value&&n.value.length>0){const e=n.value.map((e,a)=>(console.log(`处理步骤${a} - 原始status:`,e.status),{...e,task_id:s.value,work_id:e.workid,entry_file_name:e.EntryFileName,status:e.status,duration:e.Duration,id:`ansible-work-${a+1}`,hasDownConnector:(a+1)%3===0&&a<n.value.length-1,showHorizontalConnector:(a+1)%3!==0&&a<n.value.length-1}));return console.log("返回Ansible API steps:",JSON.parse(JSON.stringify(e))),e}return console.log("返回空Ansible steps数组"),[]}),d=async e=>{try{if(console.log("Received Ansible taskId:",e),!e)throw new Error("Ansible任务ID未定义");s.value=e,o.value=null,n.value=[];const a=await Pe(e);if(console.log("获取Ansible任务详情响应:",a),!a?.data?.data?.task_info)throw new Error("无效的API响应数据");const l=JSON.parse(JSON.stringify(a.data.data));return console.log("Ansible API返回的原始数据:",l),o.value=l.task_info,n.value=l.task_info.Works||[],console.log("处理后的任务数据:",o.value),console.log("处理后的Works列表:",n.value),t.value=!0,s.value}catch(a){throw console.error("获取Ansible任务信息失败:",a),n.value=[],t.value=!0,a}},c=async()=>{s.value&&await d(s.value)},u=()=>{l.value?.stopAllPolling&&l.value.stopAllPolling()};return a({showFlow:d}),(e,a)=>{const o=(0,r.g2)("el-button"),n=(0,r.g2)("el-dialog");return(0,r.uX)(),(0,r.Wv)(n,{title:"Ansible任务流程",modelValue:t.value,"onUpdate:modelValue":a[1]||(a[1]=e=>t.value=e),width:"80%",top:"5vh","custom-class":"ansible-flow-dialog",onClose:u},{footer:(0,r.k6)(()=>[(0,r.bF)(o,{onClick:a[0]||(a[0]=e=>t.value=!1)},{default:(0,r.k6)(()=>a[2]||(a[2]=[(0,r.eW)("关闭",-1)])),_:1,__:[2]})]),default:(0,r.k6)(()=>[(0,r.Lk)("div",zE,[(0,r.bF)(WE,{ref_key:"ansibleFlowRef",ref:l,steps:i.value,"task-id":s.value,onRefresh:c},null,8,["steps","task-id"])])]),_:1},8,["modelValue"])}}};const KE=(0,p.A)(NE,[["__scopeId","data-v-dfd8a83c"]]);var UE=KE;const XE={class:"taskansible-management"},qE={class:"search-section"},HE={class:"action-section"},BE={class:"table-section"},jE={style:{display:"flex","align-items":"center",gap:"8px"}},OE={style:{display:"flex","align-items":"center",gap:"8px"}},QE=["src","alt"],GE={style:{display:"flex","align-items":"center",gap:"8px"}},YE={style:{display:"flex","align-items":"center",gap:"8px"}},JE=["title"],ZE=["title"],eW={class:"operation-buttons"},aW={class:"pagination-section"},tW={style:{"margin-bottom":"10px"}},lW={key:0,style:{border:"1px solid #ebeef5","border-radius":"4px",padding:"10px",background:"#f5f7fa"}},sW={style:{"margin-bottom":"10px"}},oW={key:0,style:{border:"1px solid #ebeef5","border-radius":"4px",padding:"10px",background:"#f5f7fa"}},nW={key:0,style:{border:"1px solid #ebeef5","border-radius":"4px",padding:"15px",background:"#f5f7fa"}},iW={style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"8px 12px",background:"white","border-radius":"4px",border:"1px solid #e4e7ed"}},rW={style:{color:"#666"}},dW={key:0,style:{"margin-top":"8px",padding:"8px",background:"#fafafa","border-radius":"4px",border:"1px solid #eee"}},cW={key:1,style:{"text-align":"center",padding:"40px",color:"#999"}};var uW={__name:"TaskAnsible",setup(e){const a=(0,Y.KR)([]),l=(0,Y.KR)(!1),s=(0,Y.KR)(!1),o=(0,Y.KR)("all"),n=(0,Y.IJ)(null),d=(0,Y.KR)(0),c=(0,Y.KR)(!1),u=(0,Y.KR)(!1),p=(0,Y.KR)(!1),m=(0,Y.KR)(""),g=(0,Y.KR)(null),v=(0,Y.IJ)(null),h=(0,Y.KR)([]),k=(0,Y.Kh)({page:1,pageSize:10,name:"",type:null}),b=(0,Y.KR)({name:"",description:"",type:1,hostGroups:{},variables:"",gitRepo:"",playbookFile:null,rolesFile:null}),f=(0,Y.Kh)({name:[{required:!0,message:"请输入任务名称",trigger:"blur"}],type:[{required:!0,message:"请选择任务类型",trigger:"change"}],hostGroups:[{required:!0,validator:(e,a,t)=>{0===Object.keys(b.value.hostGroups).length?t(new Error("请至少配置一个主机分组")):t()},trigger:"change"}],playbooks:[{required:!1,validator:(e,a,t)=>{1!==b.value.type||b.value.playbookFile?t():t(new Error("请选择Playbook文件"))},trigger:"change"}],gitRepo:[{required:!1,validator:(e,a,t)=>{2!==b.value.type||b.value.gitRepo?t():t(new Error("请输入Git仓库地址"))},trigger:"blur"}]}),y=async()=>{l.value=!0;try{let e;if(console.log("请求参数:",JSON.stringify(k,null,2)),console.log("当前搜索模式:",o.value),"name"===o.value&&k.name&&k.name.trim()?(console.log("使用名称查询接口"),e=await Me({name:k.name,page:k.page,pageSize:k.pageSize})):"type"===o.value&&null!==k.type&&void 0!==k.type?(console.log("使用类型查询接口"),e=await Ee({type:k.type,page:k.page,pageSize:k.pageSize})):"all"===o.value?k.name&&k.name.trim()?(console.log("全部模式-使用名称查询接口"),e=await Me({name:k.name,page:k.page,pageSize:k.pageSize})):null!==k.type&&void 0!==k.type?(console.log("全部模式-使用类型查询接口"),e=await Ee({type:k.type,page:k.page,pageSize:k.pageSize})):(console.log("全部模式-使用普通列表查询"),e=await Ae({page:k.page,pageSize:k.pageSize})):(console.log("默认-使用普通列表查询"),e=await Ae({page:k.page,pageSize:k.pageSize})),console.log("后端API响应:",e),e?.data){const t=e.data;let l=[];Array.isArray(t.data)?l=t.data:Array.isArray(t)?l=t:t.data&&Array.isArray(t.data.data)?l=t.data.data:(console.warn("未知的API响应格式:",t),l=[]),console.log("解析后的taskList:",l),console.log("taskList类型:",typeof l,"是否为数组:",Array.isArray(l)),Array.isArray(l)?(a.value=l.map(e=>({id:e.ID,name:e.Name,description:e.Description,type:e.Type,gitRepo:e.GitRepo,hostGroups:e.HostGroups,allHostIDs:e.AllHostIDs,globalVars:e.GlobalVars,status:e.status,errorMsg:e.ErrorMsg,taskCount:e.TaskCount,totalDuration:e.TotalDuration,createdAt:q(e.CreatedAt),updatedAt:q(e.UpdatedAt),works:e.Works})),d.value=t.total||l.length,console.log("处理后的任务列表:",a.value)):(console.error("taskList不是数组:",l),a.value=[],d.value=0,J.nk.warning("数据格式异常，请检查API返回格式"))}else a.value=[],d.value=0}catch(e){console.error("获取Ansible任务列表失败:",e),console.error("错误详情:",{message:e.message,stack:e.stack,response:e.response?.data}),J.nk.error(`获取任务列表失败: ${e.message||"未知错误"}`),a.value=[],d.value=0}finally{l.value=!1}},_=()=>{b.value={name:"",description:"",type:1,hostGroups:{},variables:"",gitRepo:"",playbookFile:null,rolesFile:null},h.value=[],s.value=!0},w=async()=>{try{await(n.value?.validate()),c.value=!0;const e=new FormData;e.append("name",b.value.name),b.value.description&&e.append("description",b.value.description),e.append("type",b.value.type.toString()),e.append("hostGroups",JSON.stringify(b.value.hostGroups)),1===b.value.type?(b.value.variables&&e.append("variables",b.value.variables),b.value.playbookFile&&e.append("playbooks",b.value.playbookFile),b.value.rolesFile&&e.append("roles",b.value.rolesFile)):e.append("gitRepo",b.value.gitRepo);const a=await Re(e);if(200!==a?.data?.code)throw new Error(a?.data?.message||"创建任务失败");J.nk.success("Ansible任务创建成功"),s.value=!1,y()}catch(e){console.error("创建 Ansible 任务失败:",e),J.nk.error(`创建任务失败: ${e.message||"未知错误"}`)}finally{c.value=!1}},L=async e=>{try{await uv.s.confirm("确定要删除该Ansible任务吗？删除后将同时删除相关的子任务和执行记录。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1}),console.log("开始删除任务，ID:",e);const a=await Te(e);if(200!==a?.data?.code&&200!==a?.status)throw new Error(a?.data?.message||"删除任务失败");J.nk.success("任务删除成功"),y()}catch(a){"cancel"!==a&&(console.error("删除任务失败:",a),J.nk.error(`删除失败: ${a.response?.data?.message||a.message||"未知错误"}`))}},F=()=>{m.value="",u.value=!0},C=()=>{m.value.trim()?p.value=!0:J.nk.warning("请先输入分组名称")},V=e=>{if(!m.value.trim())return void J.nk.warning("请先输入分组名称");if(0===e.length)return void J.nk.warning("请选择至少一台主机");if(b.value.hostGroups[m.value])return void J.nk.warning(`分组"${m.value}"已存在，请更换分组名称`);const a=e.map(e=>e.id);b.value.hostGroups[m.value]=a,console.log("已添加主机分组:",{groupName:m.value,hostIds:a,allGroups:b.value.hostGroups}),J.nk.success(`已添加分组"${m.value}"，包含${a.length}台主机`),m.value="",p.value=!1},S=e=>{delete b.value.hostGroups[e];const a=h.value.indexOf(e);a>-1&&h.value.splice(a,1)},I=(e,a)=>{const t=h.value.indexOf(e);t>-1?h.value.splice(t,1):h.value.push(e)},A=e=>{b.value.playbookFile=e.raw},R=e=>{b.value.rolesFile=e.raw},D=()=>{k.page=1,y()},P=()=>{o.value="all",k.name="",k.type=null,k.page=1,y()},$=e=>{console.log("搜索模式切换为:",e),"name"===e?k.type=null:"type"===e&&(k.name=""),k.page=1,y()},T=e=>{k.pageSize=e,k.page=1,y()},M=e=>{k.page=e,y()},E=()=>{n.value?.resetFields()},W=e=>1===e?"type-manual":"type-auto",z=e=>{switch(e){case 1:return"status-waiting";case 2:return"status-running";case 3:return"status-success";case 4:return"status-error";default:return""}},N=e=>{switch(e){case 1:return"等待中";case 2:return"运行中";case 3:return"成功";case 4:return"失败";default:return"未知"}},K=e=>{switch(e){case 1:return t(8903);case 2:return t(3489);case 3:return t(496);default:return t(6343)}},U=e=>{switch(e){case 1:return"手动任务";case 2:return"自动任务";case 3:return"K8s任务";default:return"手动任务"}},X=e=>{if(!e||0===e)return"0秒";const a=Math.floor(e/3600),t=Math.floor(e%3600/60),l=e%60,s=[];return a>0&&s.push(`${a}小时`),t>0&&s.push(`${t}分钟`),(l>0||0===s.length)&&s.push(`${l}秒`),s.join("")},q=e=>{if(!e)return"";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")},H=async e=>{console.log("直接启动任务:",e),g.value=e;try{const a=await(v.value?.showFlow?.(e.id));console.log("任务流程已显示，任务ID:",a)}catch(a){console.error("显示任务流程失败:",a),J.nk.error("显示任务流程失败: "+(a.message||"未知错误"))}};return(0,r.sV)(()=>{y()}),(e,t)=>{const g=(0,r.g2)("el-radio-button"),y=(0,r.g2)("el-radio-group"),q=(0,r.g2)("el-form-item"),B=(0,r.g2)("el-input"),j=(0,r.g2)("el-option"),O=(0,r.g2)("el-select"),Q=(0,r.g2)("el-button"),G=(0,r.g2)("el-form"),J=(0,r.g2)("el-table-column"),Z=(0,r.g2)("el-tooltip"),ee=(0,r.g2)("el-table"),ae=(0,r.g2)("el-pagination"),te=(0,r.g2)("el-card"),le=(0,r.g2)("el-radio"),se=(0,r.g2)("el-upload"),oe=(0,r.g2)("el-dialog"),ne=(0,r.g2)("el-tag"),ie=(0,r.g2)("el-icon"),re=(0,r.gN)("authority"),de=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",XE,[(0,r.bF)(te,{shadow:"hover",class:"taskansible-card"},{header:(0,r.k6)(()=>t[14]||(t[14]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"Ansible任务管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",qE,[(0,r.bF)(G,{inline:!0,model:k,class:"search-form",ref:"queryForm"},{default:(0,r.k6)(()=>[(0,r.bF)(q,{label:"搜索模式"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),size:"small",onChange:$},{default:(0,r.k6)(()=>[(0,r.bF)(g,{label:"all"},{default:(0,r.k6)(()=>t[15]||(t[15]=[(0,r.eW)("全部",-1)])),_:1,__:[15]}),(0,r.bF)(g,{label:"name"},{default:(0,r.k6)(()=>t[16]||(t[16]=[(0,r.eW)("按名称",-1)])),_:1,__:[16]}),(0,r.bF)(g,{label:"type"},{default:(0,r.k6)(()=>t[17]||(t[17]=[(0,r.eW)("按类型",-1)])),_:1,__:[17]})]),_:1},8,["modelValue"])]),_:1}),"name"===o.value||"all"===o.value?((0,r.uX)(),(0,r.Wv)(q,{key:0,label:"任务名称"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{placeholder:"请输入任务名称",size:"small",clearable:"",modelValue:k.name,"onUpdate:modelValue":t[1]||(t[1]=e=>k.name=e),onKeyup:(0,i.jR)(D,["enter"]),disabled:"type"===o.value},null,8,["modelValue","disabled"])]),_:1})):(0,r.Q3)("",!0),"type"===o.value||"all"===o.value?((0,r.uX)(),(0,r.Wv)(q,{key:1,label:"任务类型",style:{width:"200px"}},{default:(0,r.k6)(()=>[(0,r.bF)(O,{size:"small",placeholder:"请选择任务类型",modelValue:k.type,"onUpdate:modelValue":t[2]||(t[2]=e=>k.type=e),onChange:D,style:{width:"100%"},disabled:"name"===o.value},{default:(0,r.k6)(()=>[(0,r.bF)(j,{label:"手动任务",value:1}),(0,r.bF)(j,{label:"自动任务",value:2})]),_:1},8,["modelValue","disabled"])]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(q,null,{default:(0,r.k6)(()=>[(0,r.bF)(Q,{type:"primary",icon:"Search",size:"small",onClick:D},{default:(0,r.k6)(()=>t[18]||(t[18]=[(0,r.eW)("搜索",-1)])),_:1,__:[18]}),(0,r.bF)(Q,{type:"warning",icon:"Refresh",size:"small",onClick:P},{default:(0,r.k6)(()=>t[19]||(t[19]=[(0,r.eW)("重置",-1)])),_:1,__:[19]})]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",HE,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(Q,{plain:"",type:"success",icon:"Plus",size:"small",onClick:_},{default:(0,r.k6)(()=>t[20]||(t[20]=[(0,r.eW)("新增Ansible任务",-1)])),_:1,__:[20]})),[[re,["task:ansible:create"]]])]),(0,r.Lk)("div",BE,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(ee,{data:a.value,border:"",stripe:"",style:{width:"100%"},"header-cell-style":{background:"#eef1f6",color:"#606266"}},{default:(0,r.k6)(()=>[(0,r.bF)(J,{prop:"name",label:"任务名称",width:"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",jE,[t[21]||(t[21]=(0,r.Lk)("img",{src:nT,alt:"ansible",style:{width:"20px",height:"20px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(J,{prop:"type",label:"类型",width:"130"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",OE,[(0,r.Lk)("img",{src:K(e.type),alt:U(e.type),style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,8,QE),(0,r.Lk)("span",{class:(0,x.C4)(W(e.type))},(0,x.v_)(U(e.type)),3)])]),_:1}),(0,r.bF)(J,{prop:"status",label:"状态",width:"130"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",GE,[t[22]||(t[22]=(0,r.Lk)("img",{src:eE,alt:"状态",style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",{class:(0,x.C4)(z(e.status))},(0,x.v_)(N(e.status)),3)])]),_:1}),(0,r.bF)(J,{prop:"taskCount",label:"任务数量"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.taskCount||0),1)]),_:1}),(0,r.bF)(J,{prop:"totalDuration",label:"执行耗时",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",YE,[t[23]||(t[23]=(0,r.Lk)("img",{src:aE,alt:"时间",style:{width:"18px",height:"18px","object-fit":"contain","flex-shrink":"0"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(X(e.totalDuration)),1)])]),_:1}),(0,r.bF)(J,{prop:"description",label:"任务描述"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",{title:e.description,style:{display:"inline-block","max-width":"180px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},(0,x.v_)(e.description||"暂无描述"),9,JE)]),_:1}),2===k.type?((0,r.uX)(),(0,r.Wv)(J,{key:0,prop:"gitRepo",label:"Git仓库"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",{title:e.gitRepo,style:{display:"inline-block",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}},(0,x.v_)(e.gitRepo||"-"),9,ZE)]),_:1})):(0,r.Q3)("",!0),(0,r.bF)(J,{prop:"createdAt",label:"创建时间"}),(0,r.bF)(J,{prop:"updatedAt",label:"更新时间"}),(0,r.bF)(J,{label:"操作",width:"120",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",eW,[(0,r.bF)(Z,{content:"启动任务",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(Q,{type:"success",icon:(0,Y.R1)(vc.VideoPlay),size:"small",circle:"",onClick:()=>H(e)},null,8,["icon","onClick"]),[[re,["task:ansible:start"]]])]),_:2},1024),(0,r.bF)(Z,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(Q,{type:"danger",icon:(0,Y.R1)(vc.Delete),size:"small",circle:"",onClick:a=>L(e.id)},null,8,["icon","onClick"]),[[re,["task:ansible:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[de,l.value]])]),(0,r.Lk)("div",aW,[(0,r.bF)(ae,{onSizeChange:T,onCurrentChange:M,"current-page":k.page,"page-sizes":[10,50,100],"page-size":k.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:d.value},null,8,["current-page","page-size","total"])])]),_:1}),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(oe,{title:"新增Ansible任务",modelValue:s.value,"onUpdate:modelValue":t[9]||(t[9]=e=>s.value=e),width:"50%",onClose:E,modal:!1,"append-to-body":!0,class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(Q,{onClick:t[8]||(t[8]=e=>s.value=!1)},{default:(0,r.k6)(()=>t[35]||(t[35]=[(0,r.eW)("取消",-1)])),_:1,__:[35]}),(0,r.bF)(Q,{type:"primary",onClick:w,loading:c.value},{default:(0,r.k6)(()=>t[36]||(t[36]=[(0,r.eW)("确定",-1)])),_:1,__:[36]},8,["loading"])]),default:(0,r.k6)(()=>[(0,r.bF)(G,{ref_key:"ansibleFormRef",ref:n,"label-width":"120px",model:b.value,rules:f},{default:(0,r.k6)(()=>[(0,r.bF)(q,{label:"任务名称",prop:"name"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:b.value.name,"onUpdate:modelValue":t[3]||(t[3]=e=>b.value.name=e),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1}),(0,r.bF)(q,{label:"任务描述"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:b.value.description,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value.description=e),type:"textarea",rows:2,placeholder:"请输入任务描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),(0,r.bF)(q,{label:"任务类型",prop:"type"},{default:(0,r.k6)(()=>[(0,r.bF)(y,{modelValue:b.value.type,"onUpdate:modelValue":t[5]||(t[5]=e=>b.value.type=e)},{default:(0,r.k6)(()=>[(0,r.bF)(le,{label:1},{default:(0,r.k6)(()=>t[24]||(t[24]=[(0,r.eW)("手动任务",-1)])),_:1,__:[24]}),(0,r.bF)(le,{label:2},{default:(0,r.k6)(()=>t[25]||(t[25]=[(0,r.eW)("自动任务",-1)])),_:1,__:[25]})]),_:1},8,["modelValue"])]),_:1}),1===b.value.type?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(q,{label:"主机分组",prop:"hostGroups"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",tW,[(0,r.bF)(Q,{type:"primary",icon:"Plus",size:"small",onClick:F},{default:(0,r.k6)(()=>t[26]||(t[26]=[(0,r.eW)("添加主机分组",-1)])),_:1,__:[26]})]),Object.keys(b.value.hostGroups).length>0?((0,r.uX)(),(0,r.CE)("div",lW,[t[27]||(t[27]=(0,r.Lk)("div",{style:{color:"#606266","margin-bottom":"8px"}},"已配置分组:",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(b.value.hostGroups,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"6px 10px",background:"white","border-radius":"4px","margin-bottom":"5px"}},[(0,r.Lk)("span",null,(0,x.v_)(a)+" ("+(0,x.v_)(e.length)+"台主机)",1),(0,r.bF)(Q,{type:"danger",icon:"Close",size:"small",circle:"",plain:"",onClick:e=>S(a)},null,8,["onClick"])]))),128))])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(q,{label:"全局变量"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:b.value.variables,"onUpdate:modelValue":t[6]||(t[6]=e=>b.value.variables=e),type:"textarea",rows:3,placeholder:'请输入JSON格式的全局变量，如: {"name":"mysql-test","version":"5.7"}'},null,8,["modelValue"])]),_:1}),(0,r.bF)(q,{label:"Playbook文件",prop:"playbooks"},{default:(0,r.k6)(()=>[(0,r.bF)(se,{ref:"playbookUpload","auto-upload":!1,"show-file-list":!0,limit:1,accept:".yml,.yaml",onChange:A},{tip:(0,r.k6)(()=>t[29]||(t[29]=[(0,r.Lk)("div",{class:"el-upload__tip"},"只能上传yaml文件，且不超过10MB",-1)])),default:(0,r.k6)(()=>[(0,r.bF)(Q,{size:"small",type:"primary",icon:"Upload"},{default:(0,r.k6)(()=>t[28]||(t[28]=[(0,r.eW)("选择Playbook",-1)])),_:1,__:[28]})]),_:1},512)]),_:1}),(0,r.bF)(q,{label:"Roles压缩包"},{default:(0,r.k6)(()=>[(0,r.bF)(se,{ref:"rolesUpload","auto-upload":!1,"show-file-list":!0,limit:1,accept:".zip",onChange:R},{tip:(0,r.k6)(()=>t[31]||(t[31]=[(0,r.Lk)("div",{class:"el-upload__tip"},"只能上传zip文件，且不超过50MB",-1)])),default:(0,r.k6)(()=>[(0,r.bF)(Q,{size:"small",type:"primary",icon:"Upload"},{default:(0,r.k6)(()=>t[30]||(t[30]=[(0,r.eW)("选择Roles",-1)])),_:1,__:[30]})]),_:1},512)]),_:1})],64)):(0,r.Q3)("",!0),2===b.value.type?((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(q,{label:"主机分组",prop:"hostGroups"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",sW,[(0,r.bF)(Q,{type:"primary",icon:"Plus",size:"small",onClick:F},{default:(0,r.k6)(()=>t[32]||(t[32]=[(0,r.eW)("添加主机分组",-1)])),_:1,__:[32]})]),Object.keys(b.value.hostGroups).length>0?((0,r.uX)(),(0,r.CE)("div",oW,[t[33]||(t[33]=(0,r.Lk)("div",{style:{color:"#606266","margin-bottom":"8px"}},"已配置分组:",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(b.value.hostGroups,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,style:{display:"flex","justify-content":"space-between","align-items":"center",padding:"6px 10px",background:"white","border-radius":"4px","margin-bottom":"5px"}},[(0,r.Lk)("span",null,(0,x.v_)(a)+" ("+(0,x.v_)(e.length)+"台主机)",1),(0,r.bF)(Q,{type:"danger",icon:"Close",size:"small",circle:"",plain:"",onClick:e=>S(a)},null,8,["onClick"])]))),128))])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(q,{label:"Git仓库地址",prop:"gitRepo"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:b.value.gitRepo,"onUpdate:modelValue":t[7]||(t[7]=e=>b.value.gitRepo=e),placeholder:"请输入Git仓库地址"},null,8,["modelValue"]),t[34]||(t[34]=(0,r.Lk)("div",{style:{"margin-top":"4px",color:"#909399","font-size":"12px"}},[(0,r.Lk)("span",null,"示例: git@gitee.com:zhang_fan1024/ansible-playbook.git")],-1))]),_:1,__:[34]})],64)):(0,r.Q3)("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])),[[re,["task:ansible:create"]]]),(0,r.bF)(oe,{title:"配置主机分组",modelValue:u.value,"onUpdate:modelValue":t[12]||(t[12]=e=>u.value=e),width:"50%",modal:!1,"append-to-body":!0,class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(Q,{onClick:t[11]||(t[11]=e=>u.value=!1)},{default:(0,r.k6)(()=>t[42]||(t[42]=[(0,r.eW)("关闭",-1)])),_:1,__:[42]})]),default:(0,r.k6)(()=>[(0,r.bF)(G,{inline:!0,style:{"margin-bottom":"15px"}},{default:(0,r.k6)(()=>[(0,r.bF)(q,{label:"分组名称"},{default:(0,r.k6)(()=>[(0,r.bF)(B,{modelValue:m.value,"onUpdate:modelValue":t[10]||(t[10]=e=>m.value=e),placeholder:"请输入分组名称（如：web、api、db）",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),(0,r.bF)(q,null,{default:(0,r.k6)(()=>[(0,r.bF)(Q,{type:"primary",icon:"Plus",onClick:C,disabled:!m.value.trim()},{default:(0,r.k6)(()=>t[37]||(t[37]=[(0,r.eW)("选择主机",-1)])),_:1,__:[37]},8,["disabled"])]),_:1})]),_:1}),Object.keys(b.value.hostGroups).length>0?((0,r.uX)(),(0,r.CE)("div",nW,[t[40]||(t[40]=(0,r.Lk)("div",{style:{color:"#606266","margin-bottom":"10px","font-weight":"500"}},"已配置分组:",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(b.value.hostGroups,(e,a)=>((0,r.uX)(),(0,r.CE)("div",{key:a,style:{"margin-bottom":"12px"}},[(0,r.Lk)("div",iW,[(0,r.Lk)("div",null,[(0,r.bF)(ne,{type:"primary",style:{"margin-right":"8px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(a),1)]),_:2},1024),(0,r.Lk)("span",rW,(0,x.v_)(e.length)+"台主机",1),(0,r.bF)(Q,{type:"text",size:"small",onClick:t=>I(a,e),style:{"margin-left":"8px",color:"#409EFF"}},{default:(0,r.k6)(()=>t[38]||(t[38]=[(0,r.eW)(" 查看详情 ",-1)])),_:2,__:[38]},1032,["onClick"])]),(0,r.bF)(Q,{type:"danger",icon:"Close",size:"small",circle:"",plain:"",onClick:e=>S(a)},null,8,["onClick"])]),h.value.includes(a)?((0,r.uX)(),(0,r.CE)("div",dW,[t[39]||(t[39]=(0,r.Lk)("div",{style:{color:"#666","font-size":"12px","margin-bottom":"5px"}},"主机 ID 列表:",-1)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e,e=>((0,r.uX)(),(0,r.Wv)(ne,{key:e,size:"small",type:"info",style:{"margin-right":"5px","margin-bottom":"3px"}},{default:(0,r.k6)(()=>[(0,r.eW)(" ID: "+(0,x.v_)(e),1)]),_:2},1024))),128))])):(0,r.Q3)("",!0)]))),128))])):((0,r.uX)(),(0,r.CE)("div",cW,[(0,r.bF)(ie,{size:"48"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Connection))]),_:1}),t[41]||(t[41]=(0,r.Lk)("div",{style:{"margin-top":"16px"}},"暂无主机分组，请点击上方按钮添加",-1))]))]),_:1},8,["modelValue"]),(0,r.bF)(xM,{modelValue:p.value,"onUpdate:modelValue":t[13]||(t[13]=e=>p.value=e),onHostsSelected:V},null,8,["modelValue"]),(0,r.bF)(UE,{ref_key:"ansibleJobFlowRef",ref:v},null,512)])}}};const pW=(0,p.A)(uW,[["__scopeId","data-v-f034dd18"]]);var mW=pW;const gW=[{path:"/task/template",component:_T,meta:{sTitle:"任务中心",tTitle:"任务模版"}},{path:"/task/job",component:ZM,meta:{sTitle:"任务中心",tTitle:"任务作业"}},{path:"/task/ansible",component:mW,meta:{sTitle:"任务中心",tTitle:"Ansible任务"}}];var vW=gW;function hW(e,a){return(0,r.uX)(),(0,r.CE)("h2",null,"运维工具")}const kW={},bW=(0,p.A)(kW,[["render",hW]]);var fW=bW,yW=t(5428),_W=t.p+"static/img/ip.aeeae59d.svg",wW=t(1700),LW=t.p+"static/img/卸载.8e56a399.svg";const FW={style:{display:"flex",height:"500px"}},CW={style:{width:"250px","border-right":"1px solid #ebeef5","padding-right":"10px","overflow-y":"auto"}},VW={style:{"margin-bottom":"10px"}},xW={style:{flex:"1","padding-left":"10px","overflow-y":"auto"}},SW={style:{"margin-bottom":"10px"}},IW={class:"host-cell"},AW={style:{"margin-left":"5px"}},RW={class:"host-cell"},DW={style:{"margin-left":"5px"}},PW={class:"host-cell"},$W={style:{"margin-left":"5px"}},TW={class:"pagination"},MW={style:{display:"flex","justify-content":"space-between","align-items":"center"}},EW={style:{color:"#606266","font-size":"14px"}},WW={key:0},zW={key:1};var NW={__name:"SelectDeployHost",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","hosts-selected"],setup(e,{emit:a}){const t=e,l=a,s=(0,Y.KR)(!1),o=(0,Y.KR)(!1),n=(0,Y.KR)([]),i=(0,Y.KR)([]),d=(0,Y.KR)([]),c=(0,Y.KR)(""),u=(0,Y.KR)([]),p=(0,Y.KR)({pageNum:1,pageSize:10,total:0}),m=(0,Y.KR)(null),g=(0,r.EW)(()=>{if(!c.value)return i.value;const e=c.value.toLowerCase();return i.value.filter(a=>{const t=(a.hostName||a.name||"").toLowerCase(),l=(a.privateIp||"").toLowerCase(),s=(a.publicIp||"").toLowerCase();return t.includes(e)||l.includes(e)||s.includes(e)})}),v=async()=>{try{const e=await ue.getGroupListWithHosts();200===e.data?.code&&(n.value=e.data.data||[])}catch(e){console.error("获取分组和主机列表失败:",e)}},h=async()=>{try{const e=await ue.getAgentList({page:1,pageSize:1e3});200===e.data?.code&&(u.value=e.data.data?.list||[])}catch(e){console.error("获取Agent列表失败:",e)}},k=async()=>{m.value=null,await b()},b=async()=>{o.value=!0;try{const e=await ue.getCmdbHostList({page:p.value.pageNum,pageSize:p.value.pageSize});200===e.data?.code&&(i.value=(e.data.data?.list||[]).map(e=>({id:e.id,name:e.hostName||e.name,hostName:e.hostName||e.name,privateIp:e.privateIp,publicIp:e.publicIp,os:e.os,remark:e.remark})),p.value.total=e.data.data?.total||0)}catch(e){console.error("获取主机列表失败:",e),i.value=[]}finally{o.value=!1}},f=async e=>{m.value=e.id,o.value=!0;try{const a=await ue.getCmdbHostsByGroupId(e.id,{page:p.value.pageNum,pageSize:p.value.pageSize});if(200===a.data?.code){const e=a.data.data||[];i.value=e.map(e=>({id:e.id,name:e.hostName||e.name,hostName:e.hostName||e.name,privateIp:e.privateIp,publicIp:e.publicIp,os:e.os,remark:e.remark})),p.value.total=e.length}}catch(a){console.error("获取主机列表失败:",a),i.value=[]}finally{o.value=!1}},y=e=>{p.value.pageNum=e,m.value?f({id:m.value}):b()},_=e=>{p.value.pageSize=e,m.value?f({id:m.value}):b()},w=e=>{d.value=e},L=()=>{},F=e=>u.value.some(a=>a.hostId===e.id&&(1===a.status||3===a.status)),C=e=>{const a=u.value.find(a=>a.hostId===e.id);if(!a)return"未部署";const t={1:"部署中",2:"部署失败",3:"运行中",4:"启动异常"};return t[a.status]||"未知"},V=e=>{const a=u.value.find(a=>a.hostId===e.id);if(!a)return"info";const t={1:"warning",2:"danger",3:"success",4:"danger"};return t[a.status]||"info"},S=()=>{l("hosts-selected",d.value),d.value=[]},I=()=>{s.value=!1,d.value=[],c.value=""};return(0,r.wB)(()=>t.modelValue,e=>{s.value=e,e&&(h(),b())}),(0,r.wB)(s,e=>{l("update:modelValue",e)}),(0,r.sV)(()=>{v(),h()}),(e,a)=>{const t=(0,r.g2)("el-icon"),l=(0,r.g2)("el-button"),i=(0,r.g2)("el-tree"),u=(0,r.g2)("el-input"),v=(0,r.g2)("el-table-column"),h=(0,r.g2)("el-tag"),b=(0,r.g2)("el-table"),A=(0,r.g2)("el-pagination"),R=(0,r.g2)("el-dialog"),D=(0,r.gN)("loading");return(0,r.uX)(),(0,r.Wv)(R,{title:"选择部署Agent的主机",modelValue:s.value,"onUpdate:modelValue":a[1]||(a[1]=e=>s.value=e),width:"70%",modal:!1},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",MW,[(0,r.Lk)("div",EW,[d.value.length>0?((0,r.uX)(),(0,r.CE)("span",WW," 已选择 "+(0,x.v_)(d.value.length)+" 台主机 ",1)):((0,r.uX)(),(0,r.CE)("span",zW,"请选择主机"))]),(0,r.Lk)("div",null,[(0,r.bF)(l,{onClick:I},{default:(0,r.k6)(()=>a[3]||(a[3]=[(0,r.eW)("取消",-1)])),_:1,__:[3]}),(0,r.bF)(l,{type:"primary",onClick:S,disabled:0===d.value.length},{default:(0,r.k6)(()=>a[4]||(a[4]=[(0,r.eW)("部署到选中主机",-1)])),_:1,__:[4]},8,["disabled"])])])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",FW,[(0,r.Lk)("div",CW,[(0,r.Lk)("div",VW,[(0,r.bF)(l,{type:"primary",size:"small",onClick:k,style:{width:"100%"},class:(0,x.C4)({"active-group":!m.value})},{default:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.House))]),_:1}),a[2]||(a[2]=(0,r.eW)(" 所有主机 ",-1))]),_:1,__:[2]},8,["class"])]),(0,r.bF)(i,{data:n.value,props:{label:"name",children:"children"},"node-key":"id","highlight-current":"",onNodeClick:f},{default:(0,r.k6)(({node:e,data:a})=>[(0,r.Lk)("span",null,[e.expanded?((0,r.uX)(),(0,r.Wv)(t,{key:0,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.FolderOpened))]),_:1})):((0,r.uX)(),(0,r.Wv)(t,{key:1,style:{"margin-right":"5px"}},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Folder))]),_:1})),(0,r.eW)(" "+(0,x.v_)(e.label),1)])]),_:1},8,["data"])]),(0,r.Lk)("div",xW,[(0,r.Lk)("div",SW,[(0,r.bF)(u,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),placeholder:"搜索主机名称或IP地址",clearable:"",size:"small",style:{width:"300px"},onInput:L},{prefix:(0,r.k6)(()=>[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Search))]),_:1})]),_:1},8,["modelValue"])]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(b,{data:g.value,border:"",style:{width:"100%"},ref:"hostTable",onSelectionChange:w},{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"selection",width:"55",selectable:e=>!F(e)},null,8,["selectable"]),(0,r.bF)(v,{prop:"name",label:"主机名称",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",IW,[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("span",AW,(0,x.v_)(e.hostName||e.name),1)])]),_:1}),(0,r.bF)(v,{prop:"privateIp",label:"内网IP",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",RW,[(0,r.bF)(t,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.HomeFilled))]),_:1}),(0,r.Lk)("span",DW,(0,x.v_)(e.privateIp),1)])]),_:1}),(0,r.bF)(v,{prop:"publicIp",label:"外网IP",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",PW,[(0,r.bF)(t,{color:"#409EFF"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Connection))]),_:1}),(0,r.Lk)("span",$W,(0,x.v_)(e.publicIp||"-"),1)])]),_:1}),(0,r.bF)(v,{prop:"os",label:"操作系统",width:"180"}),(0,r.bF)(v,{label:"Agent状态",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(h,{type:V(e),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(C(e)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(v,{prop:"remark",label:"备注"})]),_:1},8,["data"])),[[D,o.value]]),(0,r.Lk)("div",TW,[(0,r.bF)(A,{onCurrentChange:y,onSizeChange:_,"current-page":p.value.pageNum,"page-sizes":[10,20,50,100],"page-size":p.value.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:p.value.total},null,8,["current-page","page-size","total"])])])])]),_:1},8,["modelValue"])}}};const KW=(0,p.A)(NW,[["__scopeId","data-v-7eb2e4f0"]]);var UW=KW;const XW={class:"agent-management"},qW={class:"search-section"},HW={class:"action-section"},BW={class:"table-section"},jW={style:{display:"flex","align-items":"center",gap:"8px"}},OW={style:{display:"flex","align-items":"center",gap:"8px"}},QW={style:{display:"flex","align-items":"center",gap:"8px"}},GW={style:{display:"flex","align-items":"center",gap:"8px"}},YW={key:0},JW={style:{"margin-top":"4px","font-size":"12px",color:"#67C23A"}},ZW={key:1},ez={style:{"margin-top":"4px","font-size":"12px",color:"#67C23A"}},az={key:2},tz={key:0},lz={key:1,class:"text-muted"},sz={class:"pagination-section"},oz={key:0},nz={key:1,class:"text-muted"},iz=5;var rz={__name:"Agent",setup(e){const a=(0,Y.KR)([]),t=(0,Y.KR)(!1),l=(0,Y.KR)(!1),s=(0,Y.KR)(null),o=(0,Y.KR)([]),n=(0,Y.KR)(0),d=(0,Y.KR)(!1);let c=null,u=0;const p=(0,Y.Kh)({page:1,pageSize:10,hostName:"",status:null,version:""}),m=async()=>{t.value=!0;try{const e=await ue.getAgentList({page:p.page,pageSize:p.pageSize,hostName:p.hostName||void 0,status:p.status||void 0,version:p.version||void 0});if(200!==e.data?.code)throw new Error(e.data?.message||"获取Agent列表失败");a.value=(e.data.data?.list||[]).map(e=>({id:e.id,hostId:e.hostId,hostName:e.hostName,sshIp:e.sshIp,version:e.version,status:e.status,statusText:e.statusText,installPath:e.installPath,port:e.port,pid:e.pid,lastHeartbeat:e.lastHeartbeat,updateTime:e.updateTime,createTime:e.createTime,isHealthy:e.isHealthy,errorMsg:e.errorMsg,installProgress:e.installProgress,installProgressText:e.installProgressText})),n.value=e.data.data?.total||0}catch(e){console.error("获取Agent列表失败:",e),J.nk.error(`获取Agent列表失败: ${e.message||"未知错误"}`),a.value=[],n.value=0}finally{t.value=!1}},g=async e=>{try{await uv.s.confirm(`确定要重新部署Agent到主机 ${e.hostName} 吗？`,"确认重新部署",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),await ue.deployAgent([e.hostId],"1.0.0"),J.nk.success("Agent重新部署已启动，请等待部署完成"),m(),$()}catch(a){"cancel"!==a&&(console.error("重新部署Agent失败:",a),J.nk.error(`重新部署Agent失败: ${a.response?.data?.message||a.message||"未知错误"}`))}},v=()=>{d.value=!0},h=async e=>{if(e&&0!==e.length)try{const a=e.map(e=>e.name).join(", ");await uv.s.confirm(`确定要在以下主机上部署Agent吗？\n${a}`,"确认部署",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"});const t=e.map(e=>e.id);await ue.deployAgent(t,"1.0.0"),J.nk.success(`已开始在 ${e.length} 台主机上部署Agent，请等待部署完成`),d.value=!1,m(),$()}catch(a){"cancel"!==a&&(console.error("部署Agent失败:",a),J.nk.error(`部署Agent失败: ${a.response?.data?.message||a.message||"未知错误"}`))}else J.nk.warning("请选择要部署Agent的主机")},k=async e=>{try{await uv.s.confirm(`确定要卸载主机 ${e.hostName} 的Agent吗？`,"确认卸载",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue.uninstallAgent([e.hostId]),J.nk.success("Agent卸载已启动，请等待卸载完成"),await m(),$(),setTimeout(()=>{m()},3e3)}catch(a){"cancel"!==a&&(console.error("卸载Agent失败:",a),J.nk.error(`卸载Agent失败: ${a.response?.data?.message||a.message||"未知错误"}`))}},b=async e=>{try{await uv.s.confirm(`确定要删除主机 ${e.hostName} 的Agent数据吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await ue.deleteAgent(e.id),J.nk.success("Agent数据删除成功"),await m()}catch(a){"cancel"!==a&&(console.error("删除Agent失败:",a),J.nk.error(`删除Agent失败: ${a.response?.data?.message||a.message||"未知错误"}`))}},f=async e=>{try{await uv.s.confirm(`确定要重启主机 ${e.hostName} 的Agent吗？`,"确认重启",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),await ue.restartAgent(e.hostId),J.nk.success("Agent重启指令已发送"),await m(),$()}catch(a){"cancel"!==a&&(console.error("重启Agent失败:",a),J.nk.error(`重启Agent失败: ${a.response?.data?.message||a.message||"未知错误"}`))}},y=async()=>{try{const e=o.value.map(e=>e.hostName).join(", ");await uv.s.confirm(`确定要批量卸载以下主机的Agent吗？\n${e}`,"确认批量卸载",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=o.value.map(e=>e.hostId);await ue.uninstallAgent(a),J.nk.success("批量卸载已启动，请等待卸载完成"),await m(),$(),setTimeout(()=>{m()},3e3)}catch(e){"cancel"!==e&&(console.error("批量卸载失败:",e),J.nk.error(`批量卸载失败: ${e.message||"未知错误"}`))}},_=e=>{s.value=e,l.value=!0},w=e=>{o.value=e},L=()=>{p.page=1,m()},F=()=>{p.page=1,m()},C=()=>{p.page=1,m()},V=()=>{p.hostName="",p.status=null,p.version="",p.page=1,m()},S=e=>{p.pageSize=e,p.page=1,m()},I=e=>{p.page=e,m()},A=e=>{const a={1:"status-deploying",2:"status-deploy-failed",3:"status-running",4:"status-exception"};return a[e]||""},R=e=>{const a={1:"Loading",2:"Close",3:"CircleCheck",4:"Warning"};return a[e]||"Warning"},D=e=>{const a={1:"部署中",2:"部署失败",3:"运行中",4:"启动异常"};return a[e]||"未知状态"},P=e=>{if(!e||"0001-01-01 00:00:00"===e)return"无";const a=new Date(e);return a.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/\//g,"-")},$=()=>{c&&clearInterval(c),u=0,c=setInterval(()=>{const e=a.value.some(e=>1===e.status);e?(u=0,m()):(u++,u<=iz?m():T())},3e3)},T=()=>{c&&(clearInterval(c),c=null)};return(0,r.sV)(()=>{m()}),(0,r.hi)(()=>{T()}),(e,c)=>{const u=(0,r.g2)("el-input"),$=(0,r.g2)("el-form-item"),T=(0,r.g2)("el-option"),M=(0,r.g2)("el-select"),E=(0,r.g2)("el-button"),W=(0,r.g2)("el-form"),z=(0,r.g2)("el-table-column"),N=(0,r.g2)("el-icon"),K=(0,r.g2)("el-progress"),U=(0,r.g2)("el-tag"),X=(0,r.g2)("el-tooltip"),q=(0,r.g2)("el-table"),H=(0,r.g2)("el-pagination"),B=(0,r.g2)("el-descriptions-item"),j=(0,r.g2)("el-alert"),O=(0,r.g2)("el-descriptions"),Q=(0,r.g2)("el-dialog"),G=(0,r.g2)("el-card"),Y=(0,r.gN)("authority"),J=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",XW,[(0,r.bF)(G,{shadow:"hover",class:"agent-card"},{header:(0,r.k6)(()=>c[9]||(c[9]=[(0,r.Lk)("div",{class:"card-header"},[(0,r.Lk)("span",{class:"title"},"Agent管理")],-1)])),default:(0,r.k6)(()=>[(0,r.Lk)("div",qW,[(0,r.bF)(W,{model:p,inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)($,{label:"主机名称"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{placeholder:"请输入主机名称",size:"small",clearable:"",modelValue:p.hostName,"onUpdate:modelValue":c[0]||(c[0]=e=>p.hostName=e),onKeyup:c[1]||(c[1]=(0,i.jR)(e=>L(p.hostName),["enter"]))},null,8,["modelValue"])]),_:1}),(0,r.bF)($,{label:"Agent状态",style:{width:"200px"}},{default:(0,r.k6)(()=>[(0,r.bF)(M,{size:"small",placeholder:"请选择Agent状态",modelValue:p.status,"onUpdate:modelValue":c[2]||(c[2]=e=>p.status=e),onChange:c[3]||(c[3]=e=>F(p.status)),style:{width:"100%"}},{default:(0,r.k6)(()=>[(0,r.bF)(T,{label:"部署中",value:1}),(0,r.bF)(T,{label:"部署失败",value:2}),(0,r.bF)(T,{label:"运行中",value:3}),(0,r.bF)(T,{label:"启动异常",value:4})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)($,{label:"版本"},{default:(0,r.k6)(()=>[(0,r.bF)(u,{placeholder:"请输入版本号",size:"small",clearable:"",modelValue:p.version,"onUpdate:modelValue":c[4]||(c[4]=e=>p.version=e),onKeyup:c[5]||(c[5]=(0,i.jR)(e=>C(p.version),["enter"]))},null,8,["modelValue"])]),_:1}),(0,r.bF)($,null,{default:(0,r.k6)(()=>[(0,r.bF)(E,{type:"primary",icon:"Search",size:"small",onClick:m},{default:(0,r.k6)(()=>c[10]||(c[10]=[(0,r.eW)("搜索",-1)])),_:1,__:[10]}),(0,r.bF)(E,{icon:"Refresh",size:"small",onClick:V},{default:(0,r.k6)(()=>c[11]||(c[11]=[(0,r.eW)("重置",-1)])),_:1,__:[11]})]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",HW,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(E,{type:"success",plain:"",icon:"Plus",size:"small",onClick:v},{default:(0,r.k6)(()=>c[12]||(c[12]=[(0,r.eW)("部署Agent",-1)])),_:1,__:[12]})),[[Y,["ops:agent:create"]]]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(E,{type:"danger",plain:"",icon:"Delete",size:"small",onClick:y,disabled:0===o.value.length},{default:(0,r.k6)(()=>[(0,r.eW)("批量卸载("+(0,x.v_)(o.value.length)+")",1)]),_:1},8,["disabled"])),[[Y,["ops:agent:deleteall"]]])]),(0,r.Lk)("div",BW,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(q,{data:a.value,stripe:"",style:{width:"100%"},class:"agent-table",onSelectionChange:w},{default:(0,r.k6)(()=>[(0,r.bF)(z,{type:"selection",width:"55"}),(0,r.bF)(z,{prop:"hostName",label:"主机名称",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",jW,[c[13]||(c[13]=(0,r.Lk)("img",{src:yW,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.hostName),1)])]),_:1}),(0,r.bF)(z,{prop:"sshIp",label:"IP地址",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",OW,[c[14]||(c[14]=(0,r.Lk)("img",{src:_W,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.sshIp),1)])]),_:1}),(0,r.bF)(z,{prop:"version",label:"版本",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",QW,[c[15]||(c[15]=(0,r.Lk)("img",{src:wW,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.version),1)])]),_:1}),(0,r.bF)(z,{prop:"status",label:"状态",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",{class:(0,x.C4)(A(e.status))},[(0,r.bF)(N,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(R(e.status))))]),_:2},1024),(0,r.eW)(" "+(0,x.v_)(D(e.status)),1)],2)]),_:1}),(0,r.bF)(z,{prop:"port",label:"监听端口",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",GW,[c[16]||(c[16]=(0,r.Lk)("img",{src:Zp,style:{width:"16px",height:"16px"}},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.port),1)])]),_:1}),(0,r.bF)(z,{label:"安装进度",width:"150"},{default:(0,r.k6)(({row:e})=>[1===e.status?((0,r.uX)(),(0,r.CE)("div",YW,[(0,r.bF)(K,{percentage:e.installProgress||0,status:"success","stroke-width":8},null,8,["percentage"]),(0,r.Lk)("div",JW,(0,x.v_)(e.installProgressText||"部署中..."),1)])):3===e.status&&100===e.installProgress?((0,r.uX)(),(0,r.CE)("div",ZW,[(0,r.bF)(K,{percentage:100,status:"success","stroke-width":8}),(0,r.Lk)("div",ez,(0,x.v_)(e.installProgressText||"部署完成"),1)])):((0,r.uX)(),(0,r.CE)("span",az,"-"))]),_:1}),(0,r.bF)(z,{label:"健康状态",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(U,{type:e.isHealthy?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(N,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.isHealthy?"CircleCheck":"CircleClose")))]),_:2},1024),(0,r.eW)(" "+(0,x.v_)(e.isHealthy?"健康":"异常"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(z,{prop:"lastHeartbeat",label:"最后心跳",width:"180"},{default:(0,r.k6)(({row:e})=>[e.lastHeartbeat&&"0001-01-01 00:00:00"!==e.lastHeartbeat?((0,r.uX)(),(0,r.CE)("span",tz,(0,x.v_)(P(e.lastHeartbeat)),1)):((0,r.uX)(),(0,r.CE)("span",lz,"未连接"))]),_:1}),(0,r.bF)(z,{prop:"updateTime",label:"更新时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.eW)((0,x.v_)(P(e.updateTime)),1)]),_:1}),(0,r.bF)(z,{label:"操作",fixed:"right"},{default:(0,r.k6)(({row:e})=>[2===e.status?((0,r.uX)(),(0,r.Wv)(E,{key:0,size:"small",type:"success",icon:"Download",onClick:a=>g(e),disabled:1===e.status},{default:(0,r.k6)(()=>c[17]||(c[17]=[(0,r.eW)("重新部署",-1)])),_:2,__:[17]},1032,["onClick","disabled"])):(0,r.Q3)("",!0),4===e.status?((0,r.uX)(),(0,r.Wv)(E,{key:1,size:"small",type:"warning",icon:"Refresh",onClick:a=>f(e),disabled:1===e.status},{default:(0,r.k6)(()=>c[18]||(c[18]=[(0,r.eW)("重启",-1)])),_:2,__:[18]},1032,["onClick","disabled"])):(0,r.Q3)("",!0),(0,r.bF)(X,{content:"卸载",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(E,{size:"small",type:"warning",circle:"",onClick:a=>k(e)},{default:(0,r.k6)(()=>c[19]||(c[19]=[(0,r.Lk)("img",{src:LW,style:{width:"16px",height:"16px"}},null,-1)])),_:2,__:[19]},1032,["onClick"])),[[Y,["ops:agent:delete"]]])]),_:2},1024),(0,r.bo)((0,r.bF)(E,{size:"small",type:"danger",icon:"Delete",circle:"",onClick:a=>b(e)},null,8,["onClick"]),[[Y,["ops:agent:delete"]]]),(0,r.bo)((0,r.bF)(E,{size:"small",type:"success",icon:"View",circle:"",onClick:a=>_(e)},null,8,["onClick"]),[[Y,["ops:agent:get"]]])]),_:1})]),_:1},8,["data"])),[[J,t.value]])]),(0,r.Lk)("div",sz,[(0,r.bF)(H,{onSizeChange:S,onCurrentChange:I,"current-page":p.page,"page-sizes":[10,50,100],"page-size":p.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:n.value},null,8,["current-page","page-size","total"])]),(0,r.bF)(Q,{title:"Agent详情",modelValue:l.value,"onUpdate:modelValue":c[7]||(c[7]=e=>l.value=e),width:"50%",modal:!1},{footer:(0,r.k6)(()=>[(0,r.bF)(E,{onClick:c[6]||(c[6]=e=>l.value=!1)},{default:(0,r.k6)(()=>c[20]||(c[20]=[(0,r.eW)("关闭",-1)])),_:1,__:[20]})]),default:(0,r.k6)(()=>[s.value?((0,r.uX)(),(0,r.Wv)(O,{key:0,column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(B,{label:"主机名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.hostName),1)]),_:1}),(0,r.bF)(B,{label:"IP地址"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.sshIp),1)]),_:1}),(0,r.bF)(B,{label:"版本"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.version),1)]),_:1}),(0,r.bF)(B,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.Lk)("span",{class:(0,x.C4)(A(s.value.status))},[(0,r.bF)(N,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(R(s.value.status))))]),_:1}),(0,r.eW)(" "+(0,x.v_)(D(s.value.status)),1)],2)]),_:1}),(0,r.bF)(B,{label:"安装路径"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.installPath||"未设置"),1)]),_:1}),(0,r.bF)(B,{label:"监听端口"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.port),1)]),_:1}),(0,r.bF)(B,{label:"进程ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.pid||"无"),1)]),_:1}),(0,r.bF)(B,{label:"健康状态"},{default:(0,r.k6)(()=>[(0,r.bF)(U,{type:s.value.isHealthy?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(s.value.isHealthy?"健康":"异常"),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(B,{label:"最后心跳",span:"2"},{default:(0,r.k6)(()=>[s.value.lastHeartbeat&&"0001-01-01 00:00:00"!==s.value.lastHeartbeat?((0,r.uX)(),(0,r.CE)("span",oz,(0,x.v_)(P(s.value.lastHeartbeat)),1)):((0,r.uX)(),(0,r.CE)("span",nz,"未连接"))]),_:1}),(0,r.bF)(B,{label:"创建时间",span:"2"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(P(s.value.createTime)),1)]),_:1}),(0,r.bF)(B,{label:"更新时间",span:"2"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(P(s.value.updateTime)),1)]),_:1}),s.value.errorMsg?((0,r.uX)(),(0,r.Wv)(B,{key:0,label:"错误信息",span:"2"},{default:(0,r.k6)(()=>[(0,r.bF)(j,{title:s.value.errorMsg,type:"error",closable:!1,"show-icon":""},null,8,["title"])]),_:1})):(0,r.Q3)("",!0)]),_:1})):(0,r.Q3)("",!0)]),_:1},8,["modelValue"]),(0,r.bF)(UW,{modelValue:d.value,"onUpdate:modelValue":c[8]||(c[8]=e=>d.value=e),onHostsSelected:h},null,8,["modelValue"])]),_:1})])}}};const dz=(0,p.A)(rz,[["__scopeId","data-v-89b17a2c"]]);var cz=dz;const uz=[{path:"/ops/tools",component:fW,meta:{sTitle:"运维工具",tTitle:"工具列表"}},{path:"/ops/agent",component:cz,meta:{sTitle:"运维工具",tTitle:"agent列表"}}];var pz=uz;const mz={class:"application-management"},gz={class:"card-header"},vz={class:"header-actions"},hz={class:"search-toolbar"},kz={class:"toolbar-right"},bz={class:"resource-count"},fz={class:"app-name"},yz=["onClick"],_z={style:{"font-size":"12px"}},wz={style:{"font-size":"12px"}},Lz={style:{"font-size":"12px"}},Fz={class:"operation-buttons"},Cz={class:"pagination-wrapper"},Vz={class:"form-row"},xz={class:"form-row"},Sz={class:"form-row"},Iz={class:"form-row"},Az={class:"dialog-footer"},Rz={class:"form-row"},Dz={class:"form-row"},Pz={class:"form-row"},$z={class:"form-row"},Tz={class:"dialog-footer"},Mz={class:"detail-content"},Ez={class:"detail-item"},Wz={class:"detail-value"},zz={class:"detail-item"},Nz={class:"detail-value"},Kz={class:"detail-item"},Uz={class:"detail-value"},Xz={class:"detail-item"},qz={class:"detail-value"},Hz={class:"detail-item"},Bz={class:"detail-item"},jz={class:"detail-value"},Oz={class:"env-list-section"},Qz={class:"section-header"},Gz={class:"header-left"},Yz={class:"server-name"},Jz={class:"job-name"},Zz={class:"create-time"},eN={class:"table-actions"},aN={key:0,class:"env-form-section"},tN={class:"section-header"},lN={class:"header-left"},sN={class:"section-title"},oN={class:"form-row"},nN={class:"job-name-input-group"},iN={key:0,class:"validation-status"},rN={class:"validation-result"},dN={key:2,class:"error-message"},cN={class:"dialog-footer"};var uN=Object.assign({name:"AppApplication"},{__name:"application",setup(e){const a=(0,Y.KR)(!1),t=(0,Y.KR)(""),l=(0,v.rd)(),s=(0,Y.KR)([]),o=(0,Y.KR)({}),n=(0,Y.KR)(!1),d=(0,Y.KR)(!1),c=(0,Y.KR)(!1),u=(0,Y.Kh)({page:1,pageSize:10,total:0}),p=(0,Y.KR)({name:"",business_group_id:null,business_dept_id:null,description:"",repo_url:"",dev_owners:[],test_owners:[],ops_owners:[],programming_lang:"",start_command:"",stop_command:"",health_api:"",domains:[],hosts:[],databases:[],other_res:{rabbitmq:[],zookeeper:[],kafka:[],redis:[],other:[]},jenkins_envs:[]}),m=["Java","Go","Python","Node.js","C++","C#",".NET","PHP","Ruby","Rust"],g=(0,Y.KR)([]),h=(0,Y.KR)([]),k=(0,Y.KR)([]),b=(0,Y.KR)(!1),f=(0,Y.KR)([]),y=(0,Y.KR)({env_name:"",jenkins_server_id:null,job_name:""}),_=(0,Y.KR)(null),w=(0,Y.KR)(!1),L=(0,Y.KR)(null),F=(0,Y.KR)(""),C=(0,Y.KR)([]),V=(0,Y.KR)([]),S=(0,Y.KR)(!1),I=(0,Y.KR)(!1),A=(0,Y.KR)(null),R=(0,r.EW)(()=>{const e=Array.isArray(s.value)?s.value:[];return t.value?e.filter(e=>e.name?.toLowerCase().includes(t.value.toLowerCase())||e.code?.toLowerCase().includes(t.value.toLowerCase())||e.programming_lang?.toLowerCase().includes(t.value.toLowerCase())):e}),D=async()=>{a.value=!0;try{const e={page:u.page,pageSize:u.pageSize};t.value&&(e.keyword=t.value);const a=await Ke.getApplicationList(e);200===a.data?.code?(s.value=a.data.data?.list||[],u.total=a.data.data?.total||0):J.nk.error(a.data?.message||"获取应用列表失败")}catch(e){console.error("获取应用列表失败:",e),J.nk.error("获取应用列表失败")}finally{a.value=!1}},P=()=>{Z(),n.value=!0},$=e=>{o.value={...e},Object.assign(p.value,e),d.value=!0},T=e=>{o.value={...e},c.value=!0},M=async e=>{L.value=e.id,F.value=e.name,b.value=!0,await Promise.all([E(),X()])},E=async()=>{try{const e=await Ke.getAppJenkinsEnvs(L.value);200===e.data?.code&&(f.value=e.data.data||[])}catch(e){console.error("获取Jenkins环境列表失败:",e),J.nk.error("获取Jenkins环境列表失败")}},W=()=>{_.value=null,y.value={env_name:"",jenkins_server_id:null,job_name:""},V.value=[],A.value=null,w.value=!0},z=e=>{_.value=e,w.value=!0,y.value={env_name:e.env_name,jenkins_server_id:e.jenkins_server_id,job_name:e.job_name},A.value=null},N=async()=>{try{if(!y.value.env_name?.trim())return void J.nk.warning("请填写环境名称");const a=y.value.jenkins_server_id&&y.value.job_name?.trim();if(a&&(!A.value||!A.value.exists))try{await uv.s.confirm(`Jenkins任务 "${y.value.job_name.trim()}" 在所选服务器中可能不存在，确定要保存吗？`,"任务验证提醒",{confirmButtonText:"确定保存",cancelButtonText:"取消",type:"warning"})}catch(e){return}const t={env_name:y.value.env_name.trim(),jenkins_server_id:y.value.jenkins_server_id||null,job_name:y.value.job_name?.trim()||""};t.jenkins_server_id||(t.job_name=""),_.value?(await Ke.updateAppJenkinsEnv(L.value,_.value.id,t),J.nk.success("Jenkins环境更新成功")):(await Ke.addAppJenkinsEnv(L.value,t),J.nk.success("Jenkins环境创建成功")),U(),await E()}catch(a){console.error("保存Jenkins环境失败:",a);const e=a.response?.data?.message||"保存Jenkins环境失败";J.nk.error(e)}},K=async e=>{try{await uv.s.confirm(`确定要删除环境 "${e.env_name}" 吗？`,"删除确认",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}),await Ke.deleteAppJenkinsEnv(L.value,e.id),J.nk.success("Jenkins环境删除成功"),await E()}catch(a){"cancel"!==a&&(console.error("删除Jenkins环境失败:",a),J.nk.error(a.response?.data?.message||"删除Jenkins环境失败"))}},U=()=>{_.value=null,w.value=!1,y.value={env_name:"",jenkins_server_id:null,job_name:""},V.value=[],A.value=null},X=async()=>{try{const e=await Ke.getJenkinsServers();200===e.data?.code&&(C.value=e.data.data||[])}catch(e){console.error("获取Jenkins服务器列表失败:",e),J.nk.error("获取Jenkins服务器列表失败")}},q=async e=>{y.value.job_name="",A.value=null,e?await H(""):V.value=[]},H=async(e="")=>{if(y.value.jenkins_server_id){S.value=!0;try{const a=await Ke.searchJenkinsJobs(y.value.jenkins_server_id,e);200===a.data?.code&&(V.value=a.data.data||[])}catch(a){console.error("搜索Jenkins任务失败:",a),J.nk.error("搜索Jenkins任务失败")}finally{S.value=!1}}else V.value=[]};let B=null;const j=e=>{clearTimeout(B),B=setTimeout(()=>{y.value.jenkins_server_id&&H(e)},500)},O=async()=>{if(y.value.jenkins_server_id&&y.value.job_name){I.value=!0;try{const e=await Ke.validateJenkinsJob({jenkins_server_id:y.value.jenkins_server_id,job_name:y.value.job_name});if(200===e.data?.code){const a=e.data.data;A.value={exists:a.exists,message:a.message,job_url:a.job_url},a.exists||J.nk.warning(`任务验证失败: ${a.message}`)}}catch(e){console.error("验证Jenkins任务失败:",e),J.nk.error("验证Jenkins任务失败"),A.value={exists:!1,message:"验证失败"}}finally{I.value=!1}}else A.value=null},Q=async e=>{try{await uv.s.confirm(`确认删除应用 "${e.name}"？删除后将无法恢复。`,"删除确认",{confirmButtonText:"确认删除",cancelButtonText:"取消",type:"warning",confirmButtonClass:"el-button--danger"});const a=await Ke.deleteApplication(e.id);200===a.data?.code?(J.nk.success("应用删除成功"),D()):J.nk.error(a.data?.message||"删除应用失败")}catch(a){"cancel"!==a&&(console.error("删除应用失败:",a),J.nk.error(a.response?.data?.message||"删除应用失败"))}},G=async()=>{try{if(!p.value.name)return void J.nk.warning("请填写应用名称");if(!p.value.business_group_id)return void J.nk.warning("请选择业务组");if(!p.value.business_dept_id)return void J.nk.warning("请选择业务部门");const e={};e.name=p.value.name,e.business_group_id=p.value.business_group_id,e.business_dept_id=p.value.business_dept_id,p.value.description&&(e.description=p.value.description),p.value.repo_url&&(e.repo_url=p.value.repo_url),p.value.programming_lang&&(e.programming_lang=p.value.programming_lang),p.value.start_command&&(e.start_command=p.value.start_command),p.value.stop_command&&(e.stop_command=p.value.stop_command),p.value.health_api&&(e.health_api=p.value.health_api),p.value.dev_owners?.length>0&&(e.dev_owners=p.value.dev_owners),p.value.test_owners?.length>0&&(e.test_owners=p.value.test_owners),p.value.ops_owners?.length>0&&(e.ops_owners=p.value.ops_owners),p.value.domains?.length>0&&(e.domains=p.value.domains),p.value.hosts?.length>0&&(e.hosts=p.value.hosts),p.value.databases?.length>0&&(e.databases=p.value.databases);const a={};let t;p.value.other_res.rabbitmq?.length>0&&(a.rabbitmq=p.value.other_res.rabbitmq),p.value.other_res.zookeeper?.length>0&&(a.zookeeper=p.value.other_res.zookeeper),p.value.other_res.kafka?.length>0&&(a.kafka=p.value.other_res.kafka),p.value.other_res.redis?.length>0&&(a.redis=p.value.other_res.redis),p.value.other_res.other?.length>0&&(a.other=p.value.other_res.other),Object.keys(a).length>0&&(e.other_res=a),p.value.jenkins_envs?.length>0&&(e.jenkins_envs=p.value.jenkins_envs),t=d.value?await Ke.updateApplication(o.value.id,e):await Ke.createApplication(e),200===t.data?.code?(J.nk.success(d.value?"应用更新成功":"应用创建成功"),n.value=!1,d.value=!1,D()):J.nk.error(t.data?.message||"操作失败")}catch(e){console.error("保存应用失败:",e),J.nk.error(e.response?.data?.message||"保存应用失败")}},Z=()=>{p.value={name:"",business_group_id:null,business_dept_id:null,description:"",repo_url:"",dev_owners:[],test_owners:[],ops_owners:[],programming_lang:"",start_command:"",stop_command:"",health_api:"",domains:[],hosts:[],databases:[],other_res:{rabbitmq:[],zookeeper:[],kafka:[],redis:[],other:[]},jenkins_envs:[]}},ee=()=>{D()},ae=()=>{t.value="",D()},te=()=>{l.push("/app/quick-release")},le=e=>{u.page=e,D()},se=e=>{u.pageSize=e,u.page=1,D()},oe=e=>{const a={1:"warning",2:"success",3:"danger",0:"info"};return a[e]||"info"},ne=e=>{const a={1:"未激活",2:"已激活",3:"异常",0:"未知"};return a[e]||"未知"},ie=async()=>{try{const e=await ue.getAllCmdbGroups();200===e.data?.code&&(g.value=e.data.data||[])}catch(e){console.error("获取业务组列表失败:",e)}},re=(0,r.EW)(()=>g.value.map(e=>({value:e.id,label:e.name,leaf:!1,children:e.children?.filter(e=>!e.children||0===e.children.length).map(e=>({value:e.id,label:e.name,leaf:!0}))||[]}))),de=async()=>{try{const a=await Ue.queryDeptList();if(200===a.data?.code)h.value=(a.data.data||[]).filter(e=>e.deptName);else try{const e=await Ue.querySysDeptVoList();200===e.data?.code&&(h.value=(e.data.data||[]).filter(e=>e.deptName))}catch(e){console.error("获取业务部门列表失败:",e)}}catch(a){console.error("获取业务部门列表失败:",a)}},ce=async()=>{try{const e=await Ue.queryAdminList({pageNum:1,pageSize:1e3,status:"1"});200===e.data?.code&&(k.value=e.data.data?.list?.map(e=>({id:e.id,name:e.nickname||e.username})).filter(e=>e.name)||[])}catch(e){console.error("获取用户列表失败:",e)}},pe=e=>{if(!e)return"-";const a=h.value.find(a=>a.id===e);return a?a.deptName:`部门ID: ${e}`},me=e=>{if(!e)return"-";for(const a of g.value)if(a.children&&a.children.length>0){const t=a.children.find(a=>a.id===e);if(t)return t.name}return`业务组ID: ${e}`},ge=e=>{if(!e||!Array.isArray(e)||0===e.length)return"-";const a=e.map(e=>{const a=k.value.find(a=>a.id===e);return a?a.name:`用户ID: ${e}`});return a.join(", ")},ve=e=>{if(!e)return"未配置";const a=C.value.find(a=>a.id===e);return a?a.name:`服务器${e}`};return(0,r.sV)(()=>{D(),ie(),de(),ce()}),(e,l)=>{const s=(0,r.g2)("el-button"),g=(0,r.g2)("el-input"),v=(0,r.g2)("el-form-item"),L=(0,r.g2)("el-form"),D=(0,r.g2)("el-card"),E=(0,r.g2)("el-icon"),X=(0,r.g2)("el-table-column"),H=(0,r.g2)("el-tag"),B=(0,r.g2)("el-tooltip"),J=(0,r.g2)("el-table"),Z=(0,r.g2)("el-pagination"),ie=(0,r.g2)("el-cascader"),de=(0,r.g2)("el-option"),ce=(0,r.g2)("el-select"),ue=(0,r.g2)("el-dialog"),he=(0,r.gN)("authority"),ke=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",mz,[(0,r.bF)(D,{shadow:"hover",class:"main-card"},{header:(0,r.k6)(()=>[(0,r.Lk)("div",gz,[l[38]||(l[38]=(0,r.Lk)("span",{class:"title"},"应用管理",-1)),(0,r.Lk)("div",vz,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(s,{type:"primary",icon:(0,Y.R1)(vc.Plus),size:"small",onClick:P},{default:(0,r.k6)(()=>l[37]||(l[37]=[(0,r.eW)(" 创建应用 ",-1)])),_:1,__:[37]},8,["icon"])),[[he,["app:application:add"]]])])])]),default:(0,r.k6)(()=>[(0,r.bF)(D,{shadow:"hover",class:"search-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",hz,[(0,r.bF)(L,{inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(v,null,{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:t.value,"onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),placeholder:"搜索应用名称、编码或技术栈",clearable:"",size:"small",style:{width:"300px"},"prefix-icon":(0,Y.R1)(vc.Search),onKeyup:(0,i.jR)(ae,["enter"])},null,8,["modelValue","prefix-icon"])]),_:1}),(0,r.bF)(v,null,{default:(0,r.k6)(()=>[(0,r.bF)(s,{type:"primary",icon:(0,Y.R1)(vc.Search),size:"small",onClick:ae},{default:(0,r.k6)(()=>l[39]||(l[39]=[(0,r.eW)(" 搜索 ",-1)])),_:1,__:[39]},8,["icon"]),(0,r.bF)(s,{icon:(0,Y.R1)(vc.Refresh),size:"small",onClick:ee},{default:(0,r.k6)(()=>l[40]||(l[40]=[(0,r.eW)(" 刷新 ",-1)])),_:1,__:[40]},8,["icon"]),(0,r.bF)(s,{type:"success",icon:(0,Y.R1)(vc.Rocket),size:"small",onClick:te},{default:(0,r.k6)(()=>l[41]||(l[41]=[(0,r.eW)(" 快速发布 ",-1)])),_:1,__:[41]},8,["icon"])]),_:1})]),_:1}),(0,r.Lk)("div",kz,[(0,r.Lk)("span",bz,"共 "+(0,x.v_)(R.value.length)+" 个应用",1)])])]),_:1}),(0,r.bF)(D,{shadow:"never",class:"table-card"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(J,{data:R.value,"element-loading-text":"加载中...",class:"app-table","empty-text":"暂无应用数据",stripe:""},{default:(0,r.k6)(()=>[(0,r.bF)(X,{prop:"name",label:"应用名称","min-width":"150",fixed:"left"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",fz,[(0,r.bF)(E,{class:"app-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),(0,r.Lk)("span",{class:"app-name-link",onClick:a=>T(e)},(0,x.v_)(e.name),9,yz)])]),_:1}),(0,r.bF)(X,{prop:"business_group_id",label:"业务线","min-width":"200","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(H,{size:"small",type:"primary"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(me(e.business_group_id)),1)]),_:2},1024)]),_:1}),(0,r.bF)(X,{prop:"business_dept_id",label:"业务部门",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(H,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(pe(e.business_dept_id)),1)]),_:2},1024)]),_:1}),(0,r.bF)(X,{prop:"dev_owners",label:"研发负责人","min-width":"150","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",_z,(0,x.v_)(ge(e.dev_owners)),1)]),_:1}),(0,r.bF)(X,{prop:"test_owners",label:"测试负责人","min-width":"150","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",wz,(0,x.v_)(ge(e.test_owners)),1)]),_:1}),(0,r.bF)(X,{prop:"ops_owners",label:"运维负责人","min-width":"150","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",Lz,(0,x.v_)(ge(e.ops_owners)),1)]),_:1}),(0,r.bF)(X,{prop:"programming_lang",label:"技术栈",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(H,{type:"Java"===e.programming_lang?"warning":"primary",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.programming_lang||"-"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(X,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(H,{type:oe(e.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(ne(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(X,{prop:"created_at",label:"创建时间",width:"180"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.created_at?new Date(e.created_at).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(X,{label:"操作",width:"200",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",Fz,[(0,r.bF)(B,{content:"编辑",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(s,{icon:(0,Y.R1)(vc.Edit),size:"small",type:"primary",circle:"",onClick:a=>$(e)},null,8,["icon","onClick"]),[[he,["app:application:edit"]]])]),_:2},1024),(0,r.bF)(B,{content:"环境配置",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(s,{icon:(0,Y.R1)(vc.Setting),size:"small",type:"warning",circle:"",onClick:a=>M(e)},null,8,["icon","onClick"]),[[he,["app:application:env"]]])]),_:2},1024),(0,r.bF)(B,{content:"删除",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(s,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",onClick:a=>Q(e)},null,8,["icon","onClick"]),[[he,["app:application:delete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])),[[ke,a.value]]),(0,r.Lk)("div",Cz,[(0,r.bF)(Z,{"current-page":u.page,"onUpdate:currentPage":l[1]||(l[1]=e=>u.page=e),"page-size":u.pageSize,"onUpdate:pageSize":l[2]||(l[2]=e=>u.pageSize=e),"page-sizes":[10,20,50,100],total:u.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:se,onCurrentChange:le},null,8,["current-page","page-size","total"])])]),_:1})]),_:1}),(0,r.bF)(ue,{modelValue:n.value,"onUpdate:modelValue":l[16]||(l[16]=e=>n.value=e),title:"创建应用",width:"700px",class:"create-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",Az,[(0,r.bF)(s,{onClick:l[15]||(l[15]=e=>n.value=!1),size:"small"},{default:(0,r.k6)(()=>l[42]||(l[42]=[(0,r.eW)("取消",-1)])),_:1,__:[42]}),(0,r.bF)(s,{type:"primary",onClick:G,size:"small"},{default:(0,r.k6)(()=>l[43]||(l[43]=[(0,r.eW)("确认创建",-1)])),_:1,__:[43]})])]),default:(0,r.k6)(()=>[(0,r.bF)(L,{model:p.value,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{label:"应用名称",required:"",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.name,"onUpdate:modelValue":l[3]||(l[3]=e=>p.value.name=e),placeholder:"请输入应用名称",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.Lk)("div",Vz,[(0,r.bF)(v,{label:"业务组",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{modelValue:p.value.business_group_id,"onUpdate:modelValue":l[4]||(l[4]=e=>p.value.business_group_id=e),options:re.value,placeholder:"请选择业务组",style:{width:"100%"},size:"small",props:{expandTrigger:"hover",checkStrictly:!0,emitPath:!1,leaf:"leaf"}},null,8,["modelValue","options"])]),_:1}),(0,r.bF)(v,{label:"业务部门",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.business_dept_id,"onUpdate:modelValue":l[5]||(l[5]=e=>p.value.business_dept_id=e),placeholder:"请选择业务部门",style:{width:"100%"},size:"small",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.deptName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(v,{label:"应用描述",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.description,"onUpdate:modelValue":l[6]||(l[6]=e=>p.value.description=e),type:"textarea",rows:2,placeholder:"请输入应用描述",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"仓库地址",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.repo_url,"onUpdate:modelValue":l[7]||(l[7]=e=>p.value.repo_url=e),placeholder:"https://git.company.com/project.git",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.Lk)("div",xz,[(0,r.bF)(v,{label:"编程语言",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.programming_lang,"onUpdate:modelValue":l[8]||(l[8]=e=>p.value.programming_lang=e),placeholder:"请选择编程语言",style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(m,e=>(0,r.bF)(de,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"健康检查",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.health_api,"onUpdate:modelValue":l[9]||(l[9]=e=>p.value.health_api=e),placeholder:"/api/v1/health",size:"small"},null,8,["modelValue"])]),_:1})]),(0,r.Lk)("div",Sz,[(0,r.bF)(v,{label:"启动命令",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.start_command,"onUpdate:modelValue":l[10]||(l[10]=e=>p.value.start_command=e),placeholder:"./app --config=config.yaml",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"停止命令",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.stop_command,"onUpdate:modelValue":l[11]||(l[11]=e=>p.value.stop_command=e),placeholder:"kill -TERM $PID",size:"small"},null,8,["modelValue"])]),_:1})]),(0,r.Lk)("div",Iz,[(0,r.bF)(v,{label:"研发负责人",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.dev_owners,"onUpdate:modelValue":l[12]||(l[12]=e=>p.value.dev_owners=e),placeholder:"请选择研发负责人",style:{width:"100%"},size:"small",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"测试负责人",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.test_owners,"onUpdate:modelValue":l[13]||(l[13]=e=>p.value.test_owners=e),placeholder:"请选择测试负责人",style:{width:"100%"},size:"small",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(v,{label:"运维负责人",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.ops_owners,"onUpdate:modelValue":l[14]||(l[14]=e=>p.value.ops_owners=e),placeholder:"请选择运维负责人",style:{width:"100%"},size:"small",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name||`用户${e.id}`,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(ue,{modelValue:d.value,"onUpdate:modelValue":l[30]||(l[30]=e=>d.value=e),title:"编辑应用",width:"700px",class:"edit-dialog compact-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",Tz,[(0,r.bF)(s,{onClick:l[29]||(l[29]=e=>d.value=!1),size:"small"},{default:(0,r.k6)(()=>l[44]||(l[44]=[(0,r.eW)("取消",-1)])),_:1,__:[44]}),(0,r.bF)(s,{type:"primary",onClick:G,size:"small"},{default:(0,r.k6)(()=>l[45]||(l[45]=[(0,r.eW)("确认更新",-1)])),_:1,__:[45]})])]),default:(0,r.k6)(()=>[(0,r.bF)(L,{model:p.value,"label-width":"90px",class:"compact-form"},{default:(0,r.k6)(()=>[(0,r.bF)(v,{label:"应用名称",required:"",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.name,"onUpdate:modelValue":l[17]||(l[17]=e=>p.value.name=e),placeholder:"请输入应用名称",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.Lk)("div",Rz,[(0,r.bF)(v,{label:"业务组",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ie,{modelValue:p.value.business_group_id,"onUpdate:modelValue":l[18]||(l[18]=e=>p.value.business_group_id=e),options:re.value,placeholder:"请选择业务组",style:{width:"100%"},size:"small",props:{expandTrigger:"hover",checkStrictly:!0,emitPath:!1,leaf:"leaf"}},null,8,["modelValue","options"])]),_:1}),(0,r.bF)(v,{label:"业务部门",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.business_dept_id,"onUpdate:modelValue":l[19]||(l[19]=e=>p.value.business_dept_id=e),placeholder:"请选择业务部门",style:{width:"100%"},size:"small",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(h.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.deptName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(v,{label:"应用描述",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.description,"onUpdate:modelValue":l[20]||(l[20]=e=>p.value.description=e),type:"textarea",rows:2,placeholder:"请输入应用描述",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"仓库地址",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.repo_url,"onUpdate:modelValue":l[21]||(l[21]=e=>p.value.repo_url=e),placeholder:"https://git.company.com/project.git",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.Lk)("div",Dz,[(0,r.bF)(v,{label:"编程语言",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.programming_lang,"onUpdate:modelValue":l[22]||(l[22]=e=>p.value.programming_lang=e),placeholder:"请选择编程语言",style:{width:"100%"},size:"small"},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(m,e=>(0,r.bF)(de,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"健康检查",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.health_api,"onUpdate:modelValue":l[23]||(l[23]=e=>p.value.health_api=e),placeholder:"/api/v1/health",size:"small"},null,8,["modelValue"])]),_:1})]),(0,r.Lk)("div",Pz,[(0,r.bF)(v,{label:"启动命令",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.start_command,"onUpdate:modelValue":l[24]||(l[24]=e=>p.value.start_command=e),placeholder:"./app --config=config.yaml",size:"small"},null,8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"停止命令",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:p.value.stop_command,"onUpdate:modelValue":l[25]||(l[25]=e=>p.value.stop_command=e),placeholder:"kill -TERM $PID",size:"small"},null,8,["modelValue"])]),_:1})]),(0,r.Lk)("div",$z,[(0,r.bF)(v,{label:"研发负责人",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.dev_owners,"onUpdate:modelValue":l[26]||(l[26]=e=>p.value.dev_owners=e),placeholder:"请选择研发负责人",style:{width:"100%"},size:"small",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"测试负责人",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.test_owners,"onUpdate:modelValue":l[27]||(l[27]=e=>p.value.test_owners=e),placeholder:"请选择测试负责人",style:{width:"100%"},size:"small",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(v,{label:"运维负责人",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:p.value.ops_owners,"onUpdate:modelValue":l[28]||(l[28]=e=>p.value.ops_owners=e),placeholder:"请选择运维负责人",style:{width:"100%"},size:"small",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",filterable:"",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(k.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(ue,{modelValue:c.value,"onUpdate:modelValue":l[31]||(l[31]=e=>c.value=e),title:"应用详情",width:"600px",class:"detail-dialog compact-dialog"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Mz,[(0,r.Lk)("div",Ez,[l[46]||(l[46]=(0,r.Lk)("span",{class:"detail-label"},"应用名称:",-1)),(0,r.Lk)("span",Wz,(0,x.v_)(o.value.name),1)]),(0,r.Lk)("div",zz,[l[47]||(l[47]=(0,r.Lk)("span",{class:"detail-label"},"应用编码:",-1)),(0,r.Lk)("span",Nz,(0,x.v_)(o.value.code),1)]),(0,r.Lk)("div",Kz,[l[48]||(l[48]=(0,r.Lk)("span",{class:"detail-label"},"应用描述:",-1)),(0,r.Lk)("span",Uz,(0,x.v_)(o.value.description||"-"),1)]),(0,r.Lk)("div",Xz,[l[49]||(l[49]=(0,r.Lk)("span",{class:"detail-label"},"技术栈:",-1)),(0,r.Lk)("span",qz,(0,x.v_)(o.value.programming_lang||"-"),1)]),(0,r.Lk)("div",Hz,[l[50]||(l[50]=(0,r.Lk)("span",{class:"detail-label"},"状态:",-1)),(0,r.bF)(H,{type:oe(o.value.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(ne(o.value.status)),1)]),_:1},8,["type"])]),(0,r.Lk)("div",Bz,[l[51]||(l[51]=(0,r.Lk)("span",{class:"detail-label"},"创建时间:",-1)),(0,r.Lk)("span",jz,(0,x.v_)(o.value.created_at?new Date(o.value.created_at).toLocaleString():"-"),1)])])]),_:1},8,["modelValue"]),(0,r.bF)(ue,{modelValue:b.value,"onUpdate:modelValue":l[36]||(l[36]=e=>b.value=e),title:`${F.value} - Jenkins环境配置`,width:"900px",class:"jenkins-env-dialog modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.Lk)("div",cN,[(0,r.bF)(s,{onClick:l[35]||(l[35]=e=>b.value=!1),size:"small"},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Close))]),_:1}),l[56]||(l[56]=(0,r.eW)(" 关闭 ",-1))]),_:1,__:[56]})])]),default:(0,r.k6)(()=>[(0,r.bF)(D,{shadow:"hover",class:"env-main-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",Oz,[(0,r.Lk)("div",Qz,[(0,r.Lk)("div",Gz,[(0,r.bF)(E,{class:"section-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Monitor))]),_:1}),l[52]||(l[52]=(0,r.Lk)("span",{class:"section-title"},"环境列表",-1))]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(s,{type:"primary",size:"small",onClick:W,class:"add-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Plus))]),_:1}),l[53]||(l[53]=(0,r.eW)(" 新增环境 ",-1))]),_:1,__:[53]})),[[he,["app:application:envadd"]]])]),(0,r.bF)(J,{data:f.value,size:"small",class:"env-table"},{default:(0,r.k6)(()=>[(0,r.bF)(X,{prop:"env_name",label:"环境名称",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(H,{type:"info",size:"small",class:"env-tag"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.env_name),1)]),_:2},1024)]),_:1}),(0,r.bF)(X,{prop:"jenkins_server_id",label:"Jenkins服务器",width:"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",Yz,(0,x.v_)(ve(e.jenkins_server_id)),1)]),_:1}),(0,r.bF)(X,{prop:"job_name",label:"任务名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",Jz,(0,x.v_)(e.job_name||"未配置"),1)]),_:1}),(0,r.bF)(X,{label:"配置状态",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(H,{type:e.jenkins_server_id&&e.job_name?"success":"warning",size:"small",class:"status-tag"},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.jenkins_server_id&&e.job_name?(0,Y.R1)(vc.SuccessFilled):(0,Y.R1)(vc.WarningFilled))))]),_:2},1024),(0,r.eW)(" "+(0,x.v_)(e.jenkins_server_id&&e.job_name?"已配置":"待配置"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(X,{label:"创建时间",width:"160"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",Zz,(0,x.v_)(e.created_at?new Date(e.created_at).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(X,{label:"操作",width:"140"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",eN,[(0,r.bF)(B,{content:"编辑环境",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(s,{size:"small",type:"primary",circle:"",onClick:a=>z(e)},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Edit))]),_:1})]),_:2},1032,["onClick"])),[[he,["app:application:envedit"]]])]),_:2},1024),(0,r.bF)(B,{content:"删除环境",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(s,{size:"small",type:"danger",circle:"",onClick:a=>K(e)},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Delete))]),_:1})]),_:2},1032,["onClick"])),[[he,["app:application:envdelete"]]])]),_:2},1024)])]),_:1})]),_:1},8,["data"])]),w.value||null!==_.value?((0,r.uX)(),(0,r.CE)("div",aN,[(0,r.bF)(D,{shadow:"hover",class:"form-card"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",tN,[(0,r.Lk)("div",lN,[(0,r.bF)(E,{class:"section-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Setting))]),_:1}),(0,r.Lk)("span",sN,(0,x.v_)(_.value?"编辑环境":"新增环境"),1)])]),(0,r.bF)(L,{model:y.value,"label-width":"120px",size:"small",class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",oN,[(0,r.bF)(v,{label:"环境名称",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(g,{modelValue:y.value.env_name,"onUpdate:modelValue":l[32]||(l[32]=e=>y.value.env_name=e),placeholder:"请输入环境名称（如：prod、test、dev）"},null,8,["modelValue"])]),_:1}),(0,r.bF)(v,{label:"Jenkins服务器",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ce,{modelValue:y.value.jenkins_server_id,"onUpdate:modelValue":l[33]||(l[33]=e=>y.value.jenkins_server_id=e),placeholder:"请选择Jenkins服务器",style:{width:"100%"},filterable:"",clearable:"",onChange:q},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(C.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(v,{label:"任务名称",class:"form-item-full"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",nN,[(0,r.bF)(ce,{modelValue:y.value.job_name,"onUpdate:modelValue":l[34]||(l[34]=e=>y.value.job_name=e),placeholder:"请选择或输入Jenkins任务名称",style:{width:"100%"},filterable:"","allow-create":"",clearable:"",loading:S.value,onInput:j,disabled:!y.value.jenkins_server_id},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(V.value,e=>((0,r.uX)(),(0,r.Wv)(de,{key:e,label:e,value:e},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading","disabled"]),(0,r.bF)(s,{type:"primary",icon:(0,Y.R1)(vc.Search),loading:I.value,onClick:O,disabled:!y.value.jenkins_server_id||!y.value.job_name,class:"validate-btn"},{default:(0,r.k6)(()=>l[54]||(l[54]=[(0,r.eW)(" 验证任务 ",-1)])),_:1,__:[54]},8,["icon","loading","disabled"])]),A.value?((0,r.uX)(),(0,r.CE)("div",iN,[(0,r.Lk)("div",rN,[A.value.exists?((0,r.uX)(),(0,r.Wv)(E,{key:0,class:"success-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.SuccessFilled))]),_:1})):((0,r.uX)(),(0,r.Wv)(E,{key:1,class:"error-icon"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.WarningFilled))]),_:1})),A.value.exists?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",dN,(0,x.v_)(A.value.message),1))])])):(0,r.Q3)("",!0)]),_:1}),(0,r.bF)(v,{class:"form-actions"},{default:(0,r.k6)(()=>[(0,r.bF)(s,{type:"primary",onClick:N},{default:(0,r.k6)(()=>[(0,r.bF)(E,null,{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(_.value?(0,Y.R1)(vc.Edit):(0,Y.R1)(vc.Plus))))]),_:1}),(0,r.eW)(" "+(0,x.v_)(_.value?"更新环境":"创建环境"),1)]),_:1}),(0,r.bF)(s,{onClick:U},{default:(0,r.k6)(()=>l[55]||(l[55]=[(0,r.eW)("取消",-1)])),_:1,__:[55]})]),_:1})]),_:1},8,["model"])]),_:1})])):(0,r.Q3)("",!0)]),_:1})]),_:1},8,["modelValue","title"])])}}});const pN=(0,p.A)(uN,[["__scopeId","data-v-1c84787e"]]);var mN=pN,gN=t.p+"static/img/环境.5cfb733c.svg";const vN={class:"quick-release-management"},hN={class:"glass-card main-card"},kN={class:"card-header"},bN={class:"search-section"},fN={class:"table-section"},yN={class:"table-cell-with-icon"},_N={class:"services-cell"},wN={class:"service-name"},LN={class:"environment-wrapper"},FN={class:"service-name"},CN={key:0,class:"environment-wrapper"},VN={key:2,class:"no-service"},xN={class:"table-cell-with-icon"},SN={class:"operation-buttons"},IN={class:"pagination-section"},AN={class:"form-row"},RN={class:"applications-section"},DN={class:"applications-header"},PN={key:0,class:"app-count"},$N={key:0,class:"selected-apps-list"},TN={class:"app-info"},MN={class:"app-name"},EN={class:"app-environment"},WN={class:"app-actions"},zN={key:1,class:"empty-apps"},NN={class:"host-selection-layout"},KN={class:"tree-section"},UN={class:"tree-node"},XN={class:"services-section"},qN={class:"services-header"},HN={key:0,class:"selected-group"},BN={class:"app-name-cell"},jN={class:"environments-cell"},ON={key:0,class:"no-env"},QN={key:0,class:"empty-state"};var GN=Object.assign({name:"AppQuickRelease"},{__name:"app_quick_release",setup(e){const a=(0,v.rd)(),t=(0,Y.KR)(!1),l=(0,Y.KR)([]),s=(0,Y.KR)([]),o=(0,Y.KR)([]),n=(0,Y.KR)([]),i=(0,Y.KR)(!1),d=(0,Y.KR)(new Set),c=(0,Y.KR)(!1),u=(0,Y.KR)([]),p=(0,Y.KR)(null),m=(0,Y.KR)([]),g=(0,Y.KR)([]),h=(0,Y.KR)(),k=(0,Y.KR)(!1),b=(0,Y.Kh)({title:"",environment:"",status:null,business_group_id:null,page:1,pageSize:10}),f=(0,Y.Kh)({page:1,pageSize:10,total:0}),y=[{label:"待发布",value:1},{label:"发布中",value:2},{label:"发布成功",value:3},{label:"发布失败",value:4}],_=(0,Y.KR)(!1),w=(0,Y.KR)(),L=(0,Y.Kh)({title:"",business_group_id:null,business_dept_id:null,description:"",applications:[]}),F={title:[{required:!0,message:"请输入发布标题",trigger:"blur"}],business_group_id:[{required:!0,message:"请选择业务组",trigger:"change"}],business_dept_id:[{required:!0,message:"请选择业务部门",trigger:"change"}],description:[{required:!0,message:"请输入发布描述",trigger:"blur"}],applications:[{validator:(e,a,t)=>{a&&0!==a.length?a.some(e=>!e.environment)?t(new Error("请为所有应用选择环境")):t():t(new Error("请至少添加一个应用"))},trigger:"change"}]},C=e=>{const a={test:"test",dev:"dev",prod:"prod"};return a[e]||e},V=e=>{const a={test:"env-test",staging:"env-staging",prod:"env-prod",dev:"env-dev"};return a[e]||"env-default"},S=e=>{const a={1:"info",2:"warning",3:"success",4:"danger"};return a[e]||"info"},I=e=>{const a={1:"待发布",2:"发布中",3:"发布成功",4:"发布失败"};return a[e]||"未知"},A=e=>{if(!e)return"-";const a=Math.floor(e/60),t=e%60;return a>0?`${a}分${t}秒`:`${t}秒`},R=e=>{if(!e)return"-";const a=new Date(e),t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0"),o=String(a.getHours()).padStart(2,"0"),n=String(a.getMinutes()).padStart(2,"0"),i=String(a.getSeconds()).padStart(2,"0");return`${t}-${l}-${s} ${o}:${n}:${i}`},D=async()=>{t.value=!0;try{const e={...b,page:f.page,pageSize:f.pageSize};Object.keys(e).forEach(a=>{""!==e[a]&&null!==e[a]||delete e[a]});const a=await Ke.getDeploymentList(e);200===a.data.code?(l.value=a.data.data.list||[],f.total=a.data.data.total||0):J.nk.error(a.data.message||"获取发布列表失败")}catch(e){console.error("获取发布列表失败:",e),J.nk.error("获取发布列表失败")}finally{t.value=!1}},P=async()=>{try{const e=await ue.getAllCmdbGroups();200===e.data?.code&&(s.value=e.data.data||[],u.value=s.value.map(e=>({id:e.id,name:e.name,type:"group",children:e.children?.map(a=>({id:a.id,name:a.name,type:"subgroup",parentId:e.id,parentName:e.name}))||[]})))}catch(e){console.error("获取业务组列表失败:",e)}},$=(0,r.EW)(()=>s.value.map(e=>({value:e.id,label:e.name,leaf:!1,children:e.children?.filter(e=>!e.children||0===e.children.length).map(e=>({value:e.id,label:e.name,leaf:!0}))||[]}))),T=async()=>{try{const a=await Ue.queryDeptList();if(200===a.data?.code)o.value=(a.data.data||[]).filter(e=>e.deptName);else try{const e=await Ue.querySysDeptVoList();200===e.data?.code&&(o.value=(e.data.data||[]).filter(e=>e.deptName))}catch(e){console.error("获取业务部门列表失败:",e)}}catch(a){console.error("获取业务部门列表失败:",a)}},M=()=>{f.page=1,D()},E=()=>{Object.assign(b,{title:"",environment:"",status:null,business_group_id:null}),f.page=1,D()},W=e=>{f.pageSize=e,f.page=1,D()},z=e=>{f.page=e,D()},N=()=>{_.value=!0,Z()},K=()=>{L.applications=[]},U=()=>{},X=()=>{c.value=!0,p.value=null,m.value=[],g.value=[]},q=async e=>{"subgroup"===e.type&&(p.value={id:e.id,name:e.name,parentId:e.parentId,parentName:e.parentName},await H(e.id))},H=async e=>{if(e){i.value=!0;try{const a={business_group_ids:[e]},t=await Ke.getServiceTree(a);if(200===t.data.code){const e=t.data.data||[],a=[];e.forEach(e=>{e.services?.forEach(t=>{a.push({id:t.id,name:t.name,code:t.code,status:t.status,business_group_id:e.business_group_id,business_group_name:e.business_group_name,jenkins_envs:t.jenkins_envs||[]})})}),m.value=a}}catch(a){console.error("获取业务组应用失败:",a),J.nk.error("获取业务组应用失败")}finally{i.value=!1}}else m.value=[]},B=e=>{g.value=e},j=()=>{g.value.forEach(e=>{const a=L.applications.some(a=>a.app_id===e.id);if(!a){const a=e.jenkins_envs.map(e=>({value:e.env_name,label:C(e.env_name)}));L.applications.push({app_id:e.id,app_name:e.name,business_group_name:e.business_group_name,environment:"",available_environments:a})}}),c.value=!1},O=e=>{L.applications.splice(e,1)},Q=async e=>{if(e.environment)try{const a=await Ke.getEnvironment({app_id:e.app_id,environment:e.environment});if(200===a.data.code){const t=a.data.data;t.is_configured||J.nk.warning(`${e.app_name} 的 ${e.environment} 环境配置不完整`)}}catch(a){console.error("验证环境配置失败:",a)}},G=async()=>{try{if(await w.value.validate(),0===L.applications.length)return void J.nk.warning("请至少添加一个应用");const e=L.applications.find(e=>!e.environment);if(e)return void J.nk.warning(`请为应用"${e.app_name}"选择环境`);k.value=!0;const a={title:L.title,business_group_id:L.business_group_id,business_dept_id:L.business_dept_id,description:L.description,applications:L.applications.map(e=>({app_id:e.app_id,environment:e.environment}))},t=await Ke.createQuickDeployment(a);200===t.data.code?(J.nk.success("发布创建成功"),_.value=!1,Z(),D()):J.nk.error(t.data.message||"创建发布失败")}catch(e){console.error("创建发布失败:",e),J.nk.error("创建发布失败")}finally{k.value=!1}},Z=()=>{Object.assign(L,{title:"",business_group_id:null,business_dept_id:null,description:"",applications:[]}),n.value=[]},ee=e=>{d.value.add(e.id),a.push(`/app/quick-temp/${e.id}`)},ae=async e=>{try{if(2===e.status)return void J.nk.warning("发布中的任务不允许删除");await uv.s.confirm(`确定要删除发布任务"${e.title}"吗？此操作将同时删除所有相关的子任务记录，且无法恢复。`,"确认删除",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!1});const a=await Ke.deleteDeployment(e.id);200===a.data.code?(J.nk.success("删除成功"),D()):J.nk.error(a.data.message||"删除失败")}catch(a){"cancel"!==a&&(console.error("删除失败:",a),J.nk.error(a.response?.data?.message||"删除失败"))}};return(0,r.sV)(()=>{D(),P(),T()}),(e,a)=>{const n=(0,r.g2)("el-icon"),v=(0,r.g2)("el-button"),D=(0,r.g2)("el-input"),P=(0,r.g2)("el-form-item"),T=(0,r.g2)("el-option"),H=(0,r.g2)("el-select"),J=(0,r.g2)("el-form"),Z=(0,r.g2)("el-table-column"),te=(0,r.g2)("el-tag"),le=(0,r.g2)("el-tooltip"),se=(0,r.g2)("el-table"),oe=(0,r.g2)("el-pagination"),ne=(0,r.g2)("el-cascader"),ie=(0,r.g2)("el-empty"),re=(0,r.g2)("el-dialog"),de=(0,r.g2)("el-tree"),ce=(0,r.gN)("authority"),ue=(0,r.gN)("loading");return(0,r.uX)(),(0,r.CE)("div",vN,[(0,r.Lk)("div",hN,[(0,r.Lk)("div",kN,[a[13]||(a[13]=(0,r.Lk)("h1",{class:"gradient-title"},"快速发布",-1)),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(v,{type:"primary",size:"small",onClick:N,class:"modern-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Plus))]),_:1}),a[12]||(a[12]=(0,r.eW)(" 新建发布计划 ",-1))]),_:1,__:[12]})),[[ce,["app:quick-release:add"]]])]),(0,r.Lk)("div",bN,[(0,r.bF)(J,{model:b,inline:!0,class:"search-form"},{default:(0,r.k6)(()=>[(0,r.bF)(P,{label:"发布标题",prop:"title"},{default:(0,r.k6)(()=>[(0,r.bF)(D,{placeholder:"请输入发布标题",clearable:"",size:"small",class:"modern-input",modelValue:b.title,"onUpdate:modelValue":a[0]||(a[0]=e=>b.title=e)},null,8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"环境",prop:"environment"},{default:(0,r.k6)(()=>[(0,r.bF)(H,{modelValue:b.environment,"onUpdate:modelValue":a[1]||(a[1]=e=>b.environment=e),placeholder:"请选择环境",size:"small",style:{width:"150px"},class:"modern-select",clearable:""},{default:(0,r.k6)(()=>[(0,r.bF)(T,{label:"测试环境",value:"test"}),(0,r.bF)(T,{label:"预发环境",value:"staging"}),(0,r.bF)(T,{label:"生产环境",value:"prod"})]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"状态",prop:"status"},{default:(0,r.k6)(()=>[(0,r.bF)(H,{modelValue:b.status,"onUpdate:modelValue":a[2]||(a[2]=e=>b.status=e),placeholder:"发布状态",size:"small",style:{width:"150px"},class:"modern-select",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.CE)(r.FK,null,(0,r.pI)(y,e=>(0,r.bF)(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(P,{label:"业务组",prop:"business_group_id"},{default:(0,r.k6)(()=>[(0,r.bF)(H,{modelValue:b.business_group_id,"onUpdate:modelValue":a[3]||(a[3]=e=>b.business_group_id=e),placeholder:"请选择业务组",size:"small",style:{width:"150px"},class:"modern-select",clearable:""},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(s.value,e=>((0,r.uX)(),(0,r.Wv)(T,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(0,r.bF)(P,null,{default:(0,r.k6)(()=>[(0,r.bF)(v,{type:"primary",size:"small",onClick:M,class:"modern-btn primary-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Search))]),_:1}),a[14]||(a[14]=(0,r.eW)(" 搜索 ",-1))]),_:1,__:[14]}),(0,r.bF)(v,{size:"small",onClick:E,class:"modern-btn reset-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Refresh))]),_:1}),a[15]||(a[15]=(0,r.eW)(" 重置 ",-1))]),_:1,__:[15]})]),_:1})]),_:1},8,["model"])]),(0,r.Lk)("div",fN,[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(se,{data:l.value,class:"modern-table",stripe:""},{default:(0,r.k6)(()=>[(0,r.bF)(Z,{prop:"title",label:"发布标题","show-overflow-tooltip":""},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",yN,[a[16]||(a[16]=(0,r.Lk)("img",{src:wT,width:"16",height:"16",alt:"任务"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(e.title),1)])]),_:1}),(0,r.bF)(Z,{prop:"applications",label:"发布服务"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",_N,[e.tasks&&e.tasks.length>0?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(e.tasks,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.app_id}-${t}`,class:"service-item"},[(0,r.Lk)("span",wN,(0,x.v_)(e.app_name),1),(0,r.Lk)("div",LN,[a[17]||(a[17]=(0,r.Lk)("img",{src:gN,width:"12",height:"12",alt:"环境"},null,-1)),(0,r.Lk)("span",{class:(0,x.C4)(["environment-tag",V(e.environment)])},(0,x.v_)(e.environment),3)])]))),128)):e.applications&&e.applications.length>0?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:1},(0,r.pI)(e.applications,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.app_id}-${t}`,class:"service-item"},[(0,r.Lk)("span",FN,(0,x.v_)(e.app_name||`服务${e.app_id}`),1),e.environment?((0,r.uX)(),(0,r.CE)("div",CN,[a[18]||(a[18]=(0,r.Lk)("img",{src:gN,width:"12",height:"12",alt:"环境"},null,-1)),(0,r.Lk)("span",{class:(0,x.C4)(["environment-tag",V(e.environment)])},(0,x.v_)(e.environment),3)])):(0,r.Q3)("",!0)]))),128)):((0,r.uX)(),(0,r.CE)("span",VN,"-"))])]),_:1}),(0,r.bF)(Z,{prop:"status",label:"状态"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(te,{type:S(e.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(I(e.status)),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(Z,{prop:"duration",label:"耗时"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",xN,[a[19]||(a[19]=(0,r.Lk)("img",{src:LT,width:"16",height:"16",alt:"时间"},null,-1)),(0,r.Lk)("span",null,(0,x.v_)(A(e.duration)),1)])]),_:1}),(0,r.bF)(Z,{prop:"creator_name",label:"创建人"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(e.creator_username||e.creator_name||"-"),1)]),_:1}),(0,r.bF)(Z,{prop:"created_at",label:"创建时间"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("span",null,(0,x.v_)(R(e.created_at)),1)]),_:1}),(0,r.bF)(Z,{label:"操作",fixed:"right"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",SN,[d.value.has(e.id)?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.Wv)(le,{key:0,content:"服务上线",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(v,{icon:(0,Y.R1)(vc.VideoPlay),size:"small",type:"primary",circle:"",onClick:a=>ee(e)},null,8,["icon","onClick"]),[[ce,["app:quick-release:start"]]])]),_:2},1024)),(0,r.bF)(le,{content:2===e.status?"发布中的任务不能删除":"删除任务",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)((0,r.bF)(v,{icon:(0,Y.R1)(vc.Delete),size:"small",type:"danger",circle:"",disabled:2===e.status,onClick:a=>ae(e)},null,8,["icon","disabled","onClick"]),[[ce,["app:quick-release:delete"]]])]),_:2},1032,["content"])])]),_:1})]),_:1},8,["data"])),[[ue,t.value]])]),(0,r.Lk)("div",IN,[(0,r.bF)(oe,{onSizeChange:W,onCurrentChange:z,"current-page":f.page,"page-sizes":[10,20,50,100],"page-size":f.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:f.total,class:"modern-pagination"},null,8,["current-page","page-size","total"])])]),(0,r.bF)(re,{modelValue:_.value,"onUpdate:modelValue":a[9]||(a[9]=e=>_.value=e),title:"新建快速发布",width:"800px",class:"modern-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(v,{onClick:a[8]||(a[8]=e=>_.value=!1)},{default:(0,r.k6)(()=>a[22]||(a[22]=[(0,r.eW)("取消",-1)])),_:1,__:[22]}),(0,r.bF)(v,{type:"primary",onClick:G,loading:k.value},{default:(0,r.k6)(()=>a[23]||(a[23]=[(0,r.eW)("创建发布",-1)])),_:1,__:[23]},8,["loading"])]),default:(0,r.k6)(()=>[(0,r.bF)(J,{model:L,rules:F,ref_key:"createFormRef",ref:w,"label-width":"120px",class:"modern-form"},{default:(0,r.k6)(()=>[(0,r.bF)(P,{label:"发布标题",prop:"title",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:L.title,"onUpdate:modelValue":a[4]||(a[4]=e=>L.title=e),placeholder:"请输入发布标题",clearable:""},null,8,["modelValue"])]),_:1}),(0,r.Lk)("div",AN,[(0,r.bF)(P,{label:"业务组",prop:"business_group_id",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(ne,{modelValue:L.business_group_id,"onUpdate:modelValue":a[5]||(a[5]=e=>L.business_group_id=e),options:$.value,placeholder:"请选择业务组",style:{width:"100%"},onChange:K,props:{expandTrigger:"hover",checkStrictly:!0,emitPath:!1,leaf:"leaf"}},null,8,["modelValue","options"])]),_:1}),(0,r.bF)(P,{label:"业务部门",prop:"business_dept_id",required:"",class:"form-item-half"},{default:(0,r.k6)(()=>[(0,r.bF)(H,{modelValue:L.business_dept_id,"onUpdate:modelValue":a[6]||(a[6]=e=>L.business_dept_id=e),placeholder:"请选择业务部门",style:{width:"100%"},size:"small",filterable:"",clearable:"",onChange:U},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(o.value,e=>((0,r.uX)(),(0,r.Wv)(T,{key:e.id,label:e.deptName,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),(0,r.bF)(P,{label:"应用配置",required:""},{default:(0,r.k6)(()=>[(0,r.Lk)("div",RN,[(0,r.Lk)("div",DN,[(0,r.bF)(v,{type:"primary",size:"small",onClick:X,icon:"Plus"},{default:(0,r.k6)(()=>a[20]||(a[20]=[(0,r.eW)(" 添加应用 ",-1)])),_:1,__:[20]}),L.applications.length>0?((0,r.uX)(),(0,r.CE)("span",PN," 已选择 "+(0,x.v_)(L.applications.length)+" 个应用 ",1)):(0,r.Q3)("",!0)]),L.applications.length>0?((0,r.uX)(),(0,r.CE)("div",$N,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(L.applications,(e,t)=>((0,r.uX)(),(0,r.CE)("div",{key:`${e.app_id}-${t}`,class:"selected-app-item"},[(0,r.Lk)("div",TN,[(0,r.Lk)("span",MN,(0,x.v_)(e.app_name||`应用${e.app_id}`),1),(0,r.bF)(te,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.business_group_name),1)]),_:2},1024)]),(0,r.Lk)("div",EN,[(0,r.bF)(H,{modelValue:e.environment,"onUpdate:modelValue":a=>e.environment=a,placeholder:"选择环境",size:"small",style:{width:"120px"},onChange:a=>Q(e)},{default:(0,r.k6)(()=>[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.available_environments||[],e=>((0,r.uX)(),(0,r.Wv)(T,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),(0,r.Lk)("div",WN,[(0,r.bF)(v,{size:"small",type:"danger",icon:"Delete",onClick:e=>O(t)},{default:(0,r.k6)(()=>a[21]||(a[21]=[(0,r.eW)(" 移除 ",-1)])),_:2,__:[21]},1032,["onClick"])])]))),128))])):(0,r.Q3)("",!0),0===L.applications.length?((0,r.uX)(),(0,r.CE)("div",zN,[(0,r.bF)(ie,{"image-size":100,description:"请添加要发布的应用"},{image:(0,r.k6)(()=>[(0,r.bF)(n,{size:"100",color:"#ccc"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Document))]),_:1})]),_:1})])):(0,r.Q3)("",!0)])]),_:1}),(0,r.bF)(P,{label:"发布描述",prop:"description",required:""},{default:(0,r.k6)(()=>[(0,r.bF)(D,{modelValue:L.description,"onUpdate:modelValue":a[7]||(a[7]=e=>L.description=e),type:"textarea",rows:"3",placeholder:"请输入发布描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),(0,r.bF)(re,{modelValue:c.value,"onUpdate:modelValue":a[11]||(a[11]=e=>c.value=e),title:"选择应用",width:"1000px",class:"modern-dialog app-selection-dialog"},{footer:(0,r.k6)(()=>[(0,r.bF)(v,{onClick:a[10]||(a[10]=e=>c.value=!1)},{default:(0,r.k6)(()=>a[26]||(a[26]=[(0,r.eW)("取消",-1)])),_:1,__:[26]}),(0,r.bF)(v,{type:"primary",onClick:j,disabled:0===g.value.length},{default:(0,r.k6)(()=>[(0,r.eW)(" 确认选择 ("+(0,x.v_)(g.value.length)+") ",1)]),_:1},8,["disabled"])]),default:(0,r.k6)(()=>[(0,r.Lk)("div",NN,[(0,r.Lk)("div",KN,[a[24]||(a[24]=(0,r.Lk)("div",{class:"tree-header"},[(0,r.Lk)("h4",null,"业务树")],-1)),(0,r.bF)(de,{data:u.value,props:{label:"name",children:"children"},"node-key":"id","highlight-current":"",onNodeClick:q},{default:(0,r.k6)(({node:e,data:a})=>[(0,r.Lk)("span",UN,[a.children?.length>0?((0,r.uX)(),(0,r.Wv)(n,{key:0},{default:(0,r.k6)(()=>[((0,r.uX)(),(0,r.Wv)((0,r.$y)(e.expanded?"FolderOpened":"Folder")))]),_:2},1024)):((0,r.uX)(),(0,r.Wv)(n,{key:1},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Document))]),_:1})),(0,r.eW)(" "+(0,x.v_)(e.label),1)])]),_:1},8,["data"])]),(0,r.Lk)("div",XN,[(0,r.Lk)("div",qN,[a[25]||(a[25]=(0,r.Lk)("h4",null,"应用列表",-1)),p.value?((0,r.uX)(),(0,r.CE)("span",HN,(0,x.v_)(p.value.name),1)):(0,r.Q3)("",!0)]),(0,r.bo)(((0,r.uX)(),(0,r.Wv)(se,{data:m.value,border:"",style:{width:"100%"},onSelectionChange:B,ref_key:"appTable",ref:h},{default:(0,r.k6)(()=>[(0,r.bF)(Z,{type:"selection",width:"55",selectable:e=>2===e.status},null,8,["selectable"]),(0,r.bF)(Z,{prop:"name",label:"应用名称","min-width":"150"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",BN,[(0,r.bF)(n,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Document))]),_:1}),(0,r.Lk)("span",null,(0,x.v_)(e.name),1)])]),_:1}),(0,r.bF)(Z,{prop:"code",label:"应用代码",width:"120"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(te,{type:"info",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.code),1)]),_:2},1024)]),_:1}),(0,r.bF)(Z,{prop:"status",label:"状态",width:"100"},{default:(0,r.k6)(({row:e})=>[(0,r.bF)(te,{type:2===e.status?"success":"danger",size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(2===e.status?"已激活":"未激活"),1)]),_:2},1032,["type"])]),_:1}),(0,r.bF)(Z,{prop:"jenkins_envs",label:"支持环境","min-width":"200"},{default:(0,r.k6)(({row:e})=>[(0,r.Lk)("div",jN,[((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(e.jenkins_envs,e=>((0,r.uX)(),(0,r.Wv)(te,{key:e.env_name,size:"small",type:"warning",style:{"margin-right":"4px","margin-bottom":"2px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(C(e.env_name)),1)]),_:2},1024))),128)),e.jenkins_envs&&0!==e.jenkins_envs.length?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("span",ON," 暂无环境配置 "))])]),_:1})]),_:1},8,["data"])),[[ue,i.value]]),p.value?(0,r.Q3)("",!0):((0,r.uX)(),(0,r.CE)("div",QN,[(0,r.bF)(ie,{"image-size":100,description:"请选择左侧业务组查看应用"},{image:(0,r.k6)(()=>[(0,r.bF)(n,{size:"100",color:"#ccc"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Document))]),_:1})]),_:1})]))])])]),_:1},8,["modelValue"])])}}});const YN=(0,p.A)(GN,[["__scopeId","data-v-118474cc"]]);var JN=YN,ZN=t.p+"static/img/日志.1ff343b2.svg",eK=t.p+"static/img/停止.13c5391e.svg";const aK={class:"quick-deployment-container"},tK={class:"glass-card main-card"},lK={class:"deployment-header"},sK={class:"header-info"},oK={class:"deployment-title"},nK={class:"deployment-meta"},iK={class:"meta-text"},rK={class:"meta-text"},dK={class:"header-actions"},cK={class:"mode-option"},uK={class:"mode-option"},pK={class:"deployment-steps-section"},mK={class:"deployment-steps-container"},gK={class:"connector-defs"},vK=["id"],hK=["fill"],kK=["id"],bK=["fill"],fK={class:"card-title"},yK={class:"card-content"},_K={class:"card-content"},wK={key:0,class:"card-duration"},LK={class:"card-buttons"},FK={style:{"font-size":"10px",color:"#999","margin-bottom":"5px"}},CK=["onClick"],VK=["onClick"],xK=["onClick"],SK={key:1,class:"error-message"},IK={key:2,class:"build-info"},AK={key:0,class:"task-detail-content"},RK={key:0,class:"error-section"},DK={class:"log-section"},PK={class:"log-header"},$K={class:"log-container"},TK={class:"log-info"},MK={class:"action-links"};var EK=Object.assign({name:"AppQuickTemp"},{__name:"app_quick_temp",setup(e){const a=(0,v.lq)(),t=(0,v.rd)(),l=(0,Y.KR)(!1),s=(0,Y.KR)(!1),o=(0,Y.KR)({}),n=(0,Y.KR)([]),d=(0,Y.KR)(!1),c=(0,Y.KR)(null),u=(0,Y.KR)(null),p=(0,r.EW)(()=>a.params.id),m=(0,r.EW)(()=>[...n.value].sort((e,a)=>e.execute_order-a.execute_order)),g=e=>{const a={test:"warning",staging:"info",prod:"danger"};return a[e]||"info"},h=e=>{const a={1:"info",2:"warning",3:"success",4:"danger"};return a[e]||"info"},k=e=>{const a={1:"待发布",2:"发布中",3:"发布成功",4:"发布失败"};return a[e]||"未知"},b=e=>{const a={1:"pending",2:"running",3:"success",4:"error"};return a[e]||"pending"},f=e=>{const a={1:"等待部署",2:"部署中",3:"部署成功",4:"部署失败"};return a[e]||"未知"},y=e=>{const a={1:"info",2:"warning",3:"success",4:"danger"};return a[e]||"info"},_=e=>{const a={1:"rgba(128,128,128,0.7)",2:"rgba(33,150,243,0.7)",3:"rgba(76,175,80,0.7)",4:"rgba(244,67,54,0.7)"};return a[e]||"rgba(128,128,128,0.7)"},w=e=>{const a=b(e.status);return`task-${a}`},L=e=>{if(!e)return"-";const a=Math.floor(e/60),t=e%60;return a>0?`${a}分${t}秒`:`${t}秒`},F=async()=>{l.value=!0;try{console.log("获取部署详情，ID:",p.value);const e=await Ke.getDeploymentDetail(p.value);if(console.log("API响应:",e),200===e.data.code){const a=e.data.data||{};console.log("部署数据:",a),o.value={id:a.id,title:a.title,description:a.description,status:a.status,creator_name:a.creator_name,created_at:a.created_at,environment:a.environment},a.tasks&&Array.isArray(a.tasks)?n.value=a.tasks.map((e,a)=>({id:e.id,app_id:e.app_id,app_name:e.app_name||`应用${e.app_id}`,app_code:e.app_code||"",environment:e.environment,execute_order:e.execute_order||a+1,status:e.status||1,start_time:e.start_time,end_time:e.end_time,duration:e.duration,jenkins_job_url:e.jenkins_job_url,jenkins_env_id:e.jenkins_env_id,build_number:e.build_number,log_url:e.log_url,error_message:e.error_message})):a.applications&&Array.isArray(a.applications)?n.value=a.applications.map((e,a)=>({id:e.task_id||e.id,app_id:e.app_id,app_name:e.app_name||`应用${e.app_id}`,app_code:e.app_code||"",environment:e.environment,execute_order:a+1,status:e.status||1,start_time:e.start_time,end_time:e.end_time,duration:e.duration,jenkins_job_url:e.jenkins_job_url,jenkins_env_id:e.jenkins_env_id,build_number:e.build_number,log_url:e.log_url,error_message:e.error_message})):n.value=[],console.log("处理后的任务列表:",n.value),await(0,r.dY)(),C(),W()}else J.nk.error(e.data.message||"获取部署详情失败")}catch(e){console.error("获取部署详情失败:",e),J.nk.error("获取部署详情失败")}finally{l.value=!1}},C=()=>{if(!u.value||m.value.length<=1)return;const e=u.value,a=document.querySelectorAll(".deployment-step");e.innerHTML="";const t=e.getBoundingClientRect();e.setAttribute("width",t.width),e.setAttribute("height",t.height);for(let l=0;l<a.length-1;l++){const t=a[l],s=a[l+1];if(!t||!s)continue;const o=t.getBoundingClientRect(),n=s.getBoundingClientRect(),i=e.getBoundingClientRect(),r=m.value[l],d=_(r.status),c=l%3,u=Math.floor(l/3),p=Math.floor((l+1)/3);let g,v,h,k;u===p?(g=o.right-i.left,v=o.top+o.height/2-i.top,h=n.left-i.left,k=n.top+n.height/2-i.top):2===c?(g=o.left+o.width/2-i.left,v=o.bottom-i.top,h=n.left+n.width/2-i.left,k=n.top-i.top):(g=o.right-i.left,v=o.top+o.height/2-i.top,h=n.left-i.left,k=n.top+n.height/2-i.top);const b=document.createElementNS("http://www.w3.org/2000/svg","path");let f;if(u===p)f=`M${g},${v} L${h},${k}`;else{const e=g,a=k;f=`M${g},${v} L${e},${a} L${h},${k}`}b.setAttribute("d",f),b.setAttribute("stroke",d),b.setAttribute("stroke-width","2"),b.setAttribute("fill","none"),b.setAttribute("marker-end",`url(#arrowhead-${l})`),b.setAttribute("stroke-dasharray","5,5"),e.appendChild(b)}},V=()=>{F()},S=async(e=2)=>{try{const a=1===e?"并行执行":"串行执行";await uv.s.confirm(`确定要${a}发布任务"${o.value.title}"吗？`,"确认执行",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),s.value=!0;const t=await Ke.executeQuickDeployment({deployment_id:parseInt(p.value),execution_mode:e});200===t.data.code?(J.nk.success(`发布任务已启动（${a}）`),setTimeout(()=>{F()},1e3)):J.nk.error(t.data.message||"启动发布失败")}catch(a){"cancel"!==a&&(console.error("执行发布失败:",a),J.nk.error("执行发布失败"))}finally{s.value=!1}},I=()=>{t.push("/app/quick-release")},A=e=>{console.log(`显示任务 ${e.id} 的详情和日志`),c.value=e,d.value=!0,console.log(`任务 ${e.id} 立即获取日志`),R(e.id),2!==e.status||T.has(`log_${e.id}`)||(console.log(`任务 ${e.id} 正在运行，开始监控`),z(e.id))},R=async e=>{try{console.log(`立即获取任务 ${e} 的完整日志`);const a=await Ke.getTaskLog(e,0);if(200===a.data.code){const t=a.data.data;if(t.log){console.log(`立即获取到任务 ${e} 日志，长度: ${t.log.length}`);const a=X(t.log);M.value.set(e,a),t.text_size&&E.value.set(e,t.text_size)}}}catch(a){console.error(`立即获取任务 ${e} 日志失败:`,a)}},D=e=>{e&&window.open(e,"_blank")},P=e=>{e&&window.open(e,"_blank")},$=async e=>{if(3!==e.status&&4!==e.status)try{await uv.s.confirm(`确定要停止任务"${e.app_name}"吗？`,"确认停止",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const a=await Ke.stopTask(e.id);200===a.data.code?(J.nk.success("任务停止成功"),N(e.id),F()):J.nk.error(a.data.message||"停止任务失败")}catch(a){"cancel"!==a&&(console.error("停止任务失败:",a),J.nk.error("停止任务失败"))}else J.nk.warning("任务已完成或失败，无法停止")},T=new Map,M=(0,Y.KR)(new Map),E=(0,Y.KR)(new Map),W=()=>{0!==m.value.length&&(console.log("开始监控所有任务:",m.value.map(e=>({id:e.id,name:e.app_name}))),m.value.forEach(e=>{z(e.id)}))},z=e=>{console.log(`开始监控任务 ${e}`);const a=n.value.find(a=>a.id===e);if(a&&(3===a.status||4===a.status))return void console.log(`任务 ${e} 已完成，状态: ${a.status}，跳过监控`);N(e),E.value.has(e)||E.value.set(e,0);const t=setInterval(async()=>{try{console.log(`正在检查任务 ${e} 的状态...`);const a=await Ke.getTaskStatus(e);if(console.log(`任务 ${e} 状态响应:`,a.data),200===a.data.code){if(U(e,a.data.data),3===a.data.data.status||4===a.data.data.status){console.log(`任务 ${e} 已完成，状态: ${a.data.data.status_text}，停止状态监控`);const t=`status_${e}`;T.has(t)&&(clearInterval(T.get(t)),T.delete(t),console.log(`已停止任务 ${e} 的状态监控`))}}else console.error(`任务 ${e} 状态检查失败:`,a.data)}catch(a){console.error(`获取任务 ${e} 状态失败:`,a),console.error("错误详情:",a.response?.data||a.message)}},3e3),l=setInterval(async()=>{try{const a=E.value.get(e)||0;console.log(`正在获取任务 ${e} 的日志，从位置 ${a} 开始...`);const t=await Ke.getTaskLog(e,a);if(console.log(`任务 ${e} 日志响应:`,t.data),200===t.data.code){const a=t.data.data;if(a.log&&(console.log(`任务 ${e} 获取到新日志，长度: ${a.log.length}`),q(e,a.log)),a.has_more&&a.text_size)E.value.set(e,a.text_size),console.log(`任务 ${e} 更新日志起始位置为: ${a.text_size}`);else if(!a.has_more){console.log(`任务 ${e} 日志已完整，停止日志监控`);const a=`log_${e}`;T.has(a)&&(clearInterval(T.get(a)),T.delete(a),console.log(`已停止任务 ${e} 的日志监控`))}}else console.error(`任务 ${e} 日志获取失败:`,t.data)}catch(a){console.error(`获取任务 ${e} 日志失败:`,a),console.error("日志错误详情:",a.response?.data||a.message)}},2e3);T.set(`status_${e}`,t),T.set(`log_${e}`,l)},N=e=>{console.log(`停止监控任务 ${e}`);const a=`status_${e}`,t=`log_${e}`;T.has(a)&&(clearInterval(T.get(a)),T.delete(a)),T.has(t)&&(clearInterval(T.get(t)),T.delete(t))},K=()=>{console.log("停止所有监控"),T.forEach((e,a)=>{clearInterval(e)}),T.clear()},U=(e,a)=>{const t=n.value.findIndex(a=>a.id===e);-1!==t&&(n.value[t]={...n.value[t],status:a.status,build_number:a.build_number,start_time:a.start_time,end_time:a.end_time,duration:a.duration,error_message:a.error_message,jenkins_job_url:a.jenkins_job_url||n.value[t].jenkins_job_url},console.log(`任务 ${e} 状态更新:`,a))},X=e=>e.replace(/\u001b\[[0-9;]*[mGKH]/g,""),q=(e,a)=>{M.value.has(e)||M.value.set(e,"");const t=M.value.get(e),l=X(a);M.value.set(e,t+l),(0,r.dY)(()=>{if(c.value&&c.value.id===e&&d.value){const e=document.querySelector(".log-container");e&&(e.scrollTop=e.scrollHeight)}})},H=e=>{const a=M.value.get(e)||"";return console.log(`获取任务 ${e} 的日志，长度: ${a.length}`),a};(0,r.sV)(()=>{F()});let B=null;return(0,r.wB)(()=>o.value.status,e=>{B&&(clearInterval(B),B=null),2===e&&(B=setInterval(()=>{F().then(()=>{2!==o.value.status&&(clearInterval(B),B=null)})},5e3))},{immediate:!0}),(0,r.hi)(()=>{B&&clearInterval(B),K()}),window.addEventListener("resize",()=>{setTimeout(C,100)}),(e,a)=>{const t=(0,r.g2)("el-tag"),l=(0,r.g2)("el-icon"),n=(0,r.g2)("el-button"),p=(0,r.g2)("el-dropdown-item"),v=(0,r.g2)("el-dropdown-menu"),F=(0,r.g2)("el-dropdown"),C=(0,r.g2)("el-tooltip"),M=(0,r.g2)("el-alert"),E=(0,r.g2)("el-descriptions-item"),W=(0,r.g2)("el-descriptions"),z=(0,r.g2)("el-dialog"),N=(0,r.gN)("authority");return(0,r.uX)(),(0,r.CE)("div",aK,[(0,r.Lk)("div",tK,[(0,r.Lk)("div",lK,[(0,r.Lk)("div",sK,[(0,r.Lk)("h2",oK,(0,x.v_)(o.value.title||"发布任务"),1),(0,r.Lk)("div",nK,[m.value.length>0?((0,r.uX)(!0),(0,r.CE)(r.FK,{key:0},(0,r.pI)(m.value,(e,a)=>((0,r.uX)(),(0,r.Wv)(t,{key:`env-${a}`,type:g(e.environment),size:"small",style:{"margin-right":"4px"}},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(e.app_name)+"-"+(0,x.v_)(e.environment),1)]),_:2},1032,["type"]))),128)):(0,r.Q3)("",!0),(0,r.bF)(t,{type:h(o.value.status),size:"small"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(k(o.value.status)),1)]),_:1},8,["type"]),(0,r.Lk)("span",iK,"创建人: "+(0,x.v_)(o.value.creator_name||"-"),1),(0,r.Lk)("span",rK,"创建时间: "+(0,x.v_)(o.value.created_at?new Date(o.value.created_at).toLocaleString():"-"),1)])]),(0,r.Lk)("div",dK,[(0,r.bF)(F,{onCommand:S,trigger:"click",disabled:s.value},{dropdown:(0,r.k6)(()=>[(0,r.bF)(v,null,{default:(0,r.k6)(()=>[(0,r.bF)(p,{command:2,class:"execution-mode-item"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",cK,[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Sort))]),_:1}),a[6]||(a[6]=(0,r.Lk)("div",{class:"mode-info"},[(0,r.Lk)("div",{class:"mode-title"},"串行执行"),(0,r.Lk)("div",{class:"mode-desc"},"按顺序执行，适合有依赖关系的任务")],-1)),(0,r.bF)(t,{size:"small",type:"success"},{default:(0,r.k6)(()=>a[5]||(a[5]=[(0,r.eW)("默认",-1)])),_:1,__:[5]})])]),_:1}),(0,r.bF)(p,{command:1,class:"execution-mode-item"},{default:(0,r.k6)(()=>[(0,r.Lk)("div",uK,[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Grid))]),_:1}),a[7]||(a[7]=(0,r.Lk)("div",{class:"mode-info"},[(0,r.Lk)("div",{class:"mode-title"},"并行执行"),(0,r.Lk)("div",{class:"mode-desc"},"同时执行，适合独立的部署任务")],-1))])]),_:1})]),_:1})]),default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.Wv)(n,{size:"small",class:"modern-btn green-btn",loading:s.value},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.VideoPlay))]),_:1}),a[4]||(a[4]=(0,r.eW)(" 启动jenkins任务 ",-1)),(0,r.bF)(l,{class:"el-icon--right"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.ArrowDown))]),_:1})]),_:1,__:[4]},8,["loading"])),[[N,["app:quick-release:jobstart"]]])]),_:1},8,["disabled"]),(0,r.bF)(n,{onClick:V,size:"small",class:"modern-btn blue-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Refresh))]),_:1}),a[8]||(a[8]=(0,r.eW)(" 刷新状态 ",-1))]),_:1,__:[8]}),(0,r.bF)(n,{onClick:I,size:"small",class:"modern-btn green-btn"},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.ArrowLeft))]),_:1}),a[9]||(a[9]=(0,r.eW)(" 返回列表 ",-1))]),_:1,__:[9]})])]),(0,r.Lk)("div",pK,[(0,r.Lk)("div",mK,[((0,r.uX)(),(0,r.CE)("svg",{class:"connector-canvas",ref_key:"connectorCanvas",ref:u},null,512)),((0,r.uX)(!0),(0,r.CE)(r.FK,null,(0,r.pI)(m.value,(e,s)=>((0,r.uX)(),(0,r.CE)("div",{key:e.id,class:"deployment-step",style:(0,x.Tr)({"--step-order":e.execute_order})},[((0,r.uX)(),(0,r.CE)("svg",gK,[(0,r.Lk)("defs",null,[(0,r.Lk)("marker",{id:"arrowhead-"+s,markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto"},[(0,r.Lk)("path",{d:"M0,0 L0,4 L6,2 Z",fill:_(e.status)},null,8,hK)],8,vK),(0,r.Lk)("marker",{id:"flow-arrow-"+s,markerWidth:"6",markerHeight:"4",refX:"5",refY:"2",orient:"auto"},[(0,r.Lk)("path",{d:"M0,0 L0,4 L6,2 Z",fill:_(e.status)},null,8,bK)],8,kK)])])),(0,r.Lk)("div",{class:(0,x.C4)(["deployment-card",w(e)])},[(0,r.Lk)("div",{class:(0,x.C4)(["task-status-indicator","status-"+b(e.status)])},[3===e.status?((0,r.uX)(),(0,r.Wv)(l,{key:0,class:"status-icon success"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.SuccessFilled))]),_:1})):4===e.status?((0,r.uX)(),(0,r.Wv)(l,{key:1,class:"status-icon error"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.CircleCloseFilled))]),_:1})):2===e.status?((0,r.uX)(),(0,r.Wv)(l,{key:2,class:"status-icon running"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Loading))]),_:1})):((0,r.uX)(),(0,r.Wv)(l,{key:3,class:"status-icon pending"},{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Clock))]),_:1}))],2),(0,r.Lk)("div",{class:(0,x.C4)(["status-text","status-"+b(e.status)])},(0,x.v_)(3===e.status?"完成":2===e.status?"运行中":4===e.status?"异常":"等待"),3),(0,r.Lk)("h3",fK,[a[10]||(a[10]=(0,r.Lk)("svg",{class:"title-icon",viewBox:"0 0 1024 1024",width:"20",height:"20"},[(0,r.Lk)("path",{fill:"#1A237E",d:"M512 1024C229.23 1024 0 794.77 0 512S229.23 0 512 0s512 229.23 512 512-229.23 512-512 512zm0-938.67C276.36 85.33 85.33 276.36 85.33 512S276.36 938.67 512 938.67 938.67 747.64 938.67 512 747.64 85.33 512 85.33z"}),(0,r.Lk)("path",{fill:"#1A237E",d:"M341.33 426.67a42.67 42.67 0 100-85.34 42.67 42.67 0 000 85.34zM682.67 426.67a42.67 42.67 0 100-85.34 42.67 42.67 0 000 85.34z"}),(0,r.Lk)("path",{fill:"#1A237E",d:"M512 768c-117.82 0-213.33-95.51-213.33-213.33h426.66C725.33 672.49 629.82 768 512 768z"})],-1)),(0,r.eW)(" "+(0,x.v_)(e.app_name),1)]),(0,r.Lk)("p",yK,"应用: "+(0,x.v_)(e.app_code),1),(0,r.Lk)("p",_K,"环境: "+(0,x.v_)(e.environment),1),e.duration>0?((0,r.uX)(),(0,r.CE)("div",wK," 执行时长: "+(0,x.v_)(L(e.duration)),1)):(0,r.Q3)("",!0),(0,r.Lk)("div",LK,[(0,r.Lk)("div",FK,[(0,r.eW)(" 任务ID: "+(0,x.v_)(e.id)+" | 状态: "+(0,x.v_)(e.status)+" | 应用: "+(0,x.v_)(e.app_name),1),a[11]||(a[11]=(0,r.Lk)("br",null,null,-1)),(0,r.eW)(" Jenkins URL: "+(0,x.v_)(e.jenkins_job_url||e.log_url||"无"),1)]),(0,r.bF)(C,{effect:"dark",content:"查看日志",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("button",{onClick:(0,i.D$)(a=>A(e),["stop"]),class:"btn-icon"},a[12]||(a[12]=[(0,r.Lk)("img",{src:ZN,width:"20",height:"20",alt:"日志"},null,-1)]),8,CK)]),_:2},1024),(0,r.bF)(C,{effect:"dark",content:"停止任务",placement:"top"},{default:(0,r.k6)(()=>[(0,r.bo)(((0,r.uX)(),(0,r.CE)("button",{onClick:(0,i.D$)(a=>$(e),["stop"]),class:"btn-icon stop-btn"},a[13]||(a[13]=[(0,r.Lk)("img",{src:eK,width:"20",height:"20",alt:"停止"},null,-1)]),8,VK)),[[N,["app:quick-release:jobstop"]]])]),_:2},1024),e.jenkins_job_url||e.log_url?((0,r.uX)(),(0,r.Wv)(C,{key:0,effect:"dark",content:"Jenkins任务",placement:"top"},{default:(0,r.k6)(()=>[(0,r.Lk)("button",{onClick:(0,i.D$)(a=>D(e.jenkins_job_url||e.log_url),["stop"]),class:"btn-icon"},a[14]||(a[14]=[(0,r.Lk)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[(0,r.Lk)("path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",stroke:"white","stroke-width":"2","stroke-linecap":"round"}),(0,r.Lk)("path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",stroke:"white","stroke-width":"2","stroke-linecap":"round"})],-1)]),8,xK)]),_:2},1024)):(0,r.Q3)("",!0)]),4===e.status&&e.error_message?((0,r.uX)(),(0,r.CE)("div",SK,[(0,r.bF)(M,{title:e.error_message,type:"error",closable:!1,"show-icon":""},null,8,["title"])])):(0,r.Q3)("",!0),e.build_number?((0,r.uX)(),(0,r.CE)("div",IK,[(0,r.bF)(t,{size:"small",type:"info"},{default:(0,r.k6)(()=>[(0,r.eW)(" 构建 #"+(0,x.v_)(e.build_number),1)]),_:2},1024)])):(0,r.Q3)("",!0)],2)],4))),128))])])]),(0,r.bF)(z,{modelValue:d.value,"onUpdate:modelValue":a[3]||(a[3]=e=>d.value=e),title:c.value?.app_name||"任务详情",width:"600px",class:"modern-dialog task-detail-dialog"},{default:(0,r.k6)(()=>[c.value?((0,r.uX)(),(0,r.CE)("div",AK,[(0,r.bF)(W,{column:2,border:""},{default:(0,r.k6)(()=>[(0,r.bF)(E,{label:"应用名称"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.app_name),1)]),_:1}),(0,r.bF)(E,{label:"应用编码"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.app_code),1)]),_:1}),(0,r.bF)(E,{label:"环境"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.environment),1)]),_:1}),(0,r.bF)(E,{label:"执行顺序"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.execute_order),1)]),_:1}),(0,r.bF)(E,{label:"状态"},{default:(0,r.k6)(()=>[(0,r.bF)(t,{type:y(c.value.status)},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(f(c.value.status)),1)]),_:1},8,["type"])]),_:1}),(0,r.bF)(E,{label:"Jenkins任务ID"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.jenkins_env_id||"-"),1)]),_:1}),(0,r.bF)(E,{label:"开始时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.start_time?new Date(c.value.start_time).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(E,{label:"结束时间"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.end_time?new Date(c.value.end_time).toLocaleString():"-"),1)]),_:1}),(0,r.bF)(E,{label:"耗时"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.duration?L(c.value.duration):"-"),1)]),_:1}),(0,r.bF)(E,{label:"构建号"},{default:(0,r.k6)(()=>[(0,r.eW)((0,x.v_)(c.value.build_number||"-"),1)]),_:1})]),_:1}),c.value.error_message?((0,r.uX)(),(0,r.CE)("div",RK,[a[15]||(a[15]=(0,r.Lk)("h4",null,"错误信息",-1)),(0,r.bF)(M,{title:c.value.error_message,type:"error",closable:!1,"show-icon":""},null,8,["title"])])):(0,r.Q3)("",!0),(0,r.Lk)("div",DK,[(0,r.Lk)("div",PK,[(0,r.Lk)("h4",null,[a[16]||(a[16]=(0,r.eW)("实时日志 ",-1)),(0,r.Lk)("small",null,"（任务ID: "+(0,x.v_)(c.value.id)+"）",1)]),(0,r.bF)(n,{size:"small",onClick:a[0]||(a[0]=e=>R(c.value.id)),type:"primary"},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Refresh))]),_:1}),a[17]||(a[17]=(0,r.eW)(" 刷新日志 ",-1))]),_:1,__:[17]})]),(0,r.Lk)("div",$K,[(0,r.bF)(ih,{"model-value":H(c.value.id)||"暂无日志数据...",language:"bash",height:"300px",readonly:!0,fontSize:"12px"},null,8,["model-value"])]),(0,r.Lk)("div",TK,[(0,r.Lk)("small",null,"日志长度: "+(0,x.v_)(H(c.value.id).length)+" 字符 | 实时更新: "+(0,x.v_)((0,Y.R1)(T).has(`log_${c.value.id}`)?"开启":"关闭"),1)])]),(0,r.Lk)("div",MK,[c.value.jenkins_job_url||c.value.log_url?((0,r.uX)(),(0,r.Wv)(n,{key:0,onClick:a[1]||(a[1]=e=>D(c.value.jenkins_job_url||c.value.log_url)),type:"primary"},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Link))]),_:1}),a[18]||(a[18]=(0,r.eW)(" 打开Jenkins任务 ",-1))]),_:1,__:[18]})):(0,r.Q3)("",!0),c.value.log_url?((0,r.uX)(),(0,r.Wv)(n,{key:1,onClick:a[2]||(a[2]=e=>P(c.value.log_url)),type:"success"},{default:(0,r.k6)(()=>[(0,r.bF)(l,null,{default:(0,r.k6)(()=>[(0,r.bF)((0,Y.R1)(vc.Document))]),_:1}),a[19]||(a[19]=(0,r.eW)(" 查看构建日志 ",-1))]),_:1,__:[19]})):(0,r.Q3)("",!0)])])):(0,r.Q3)("",!0)]),_:1},8,["modelValue","title"])])}}});const WK=(0,p.A)(EK,[["__scopeId","data-v-414160b5"]]);var zK=WK;const NK=[{path:"/app/application",component:mN,meta:{sTitle:"服务管理",tTitle:"应用列表"}},{path:"/app/quick-release",component:JN,meta:{sTitle:"服务管理",tTitle:"快速发布"}},{path:"/app/quick-temp/:id",component:zK,meta:{sTitle:"服务管理",tTitle:"发布模板"}}];var KK=NK;const UK=[{path:"/",redirect:"/login"},{path:"/login",component:V},{path:"/home",component:G,redirect:"/dashboard",children:[{path:"/dashboard",component:_t,meta:{tTitle:"仪表盘"}},{path:"/dashboard/assets",component:Gl,meta:{tTitle:"资产管理"}},{path:"/dashboard/services",component:wo,meta:{tTitle:"服务管理"}},{path:"/dashboard/monitoring",component:Ci,meta:{tTitle:"监控告警"}},{path:"/dashboard/users",component:dd,meta:{tTitle:"用户统计"}},...Au,...cv,...yP,...lT,...vW,...pz,...KK]}],XK=(0,v.aE)({history:(0,v.LA)(),routes:UK});XK.beforeEach((e,a,t)=>{const l=P.getItem("token"),s=P.getItem("sysAdmin");return"/login"===e.path&&l&&s?t("/dashboard"):"/login"===e.path||l&&s?void t():t("/login")});var qK=XK,HK={saveSysAdmin(e,a){e.sysAdmin=a,P.setItem("sysAdmin",a)},saveToken(e,a){e.token=a,P.setItem("token",a)},saveLeftMenuList(e,a){console.log("【mutations】准备保存 leftMenuList：",a),e.leftMenuList=a,P.setItem("leftMenuList",a)},savePermissionList(e,a){console.log("【mutations】准备保存 permissionList：",a),e.permissionList=a,P.setItem("permissionList",a)},saveActivePath(e,a){e.activePath=a,P.setItem("activePath",a)}},BK=(0,q.y$)({state:{sysAdmin:P.getItem("sysAdmin")||"",token:P.getItem("token")||"",leftMenuList:P.getItem("leftMenuList")||"",permissionList:P.getItem("permissionList")||"",activePath:P.getItem("activePath")||""},mutations:HK}),jK={captcha(){return oe({url:"captcha",method:"get"})},login(e){return oe({url:"login",method:"post",data:e})},...Ue,...ue,...de,system:Ue,cmdb:ue,dashboard:de},OK=t(8671),QK=(t(2153),{handleTree(e,a,t,l){let s={id:a||"id",parentId:t||"parentId",childrenList:l||"children"};var o={},n={},i=[];for(let d of e){let e=d[s.parentId];null==o[e]&&(o[e]=[]),n[d[s.id]]=d,o[e].push(d)}for(let d of e){let e=d[s.parentId];null==n[e]&&i.push(d)}for(let d of i)r(d);function r(e){if(null!==o[e[s.id]]&&(e[s.childrenList]=o[e[s.id]]),e[s.childrenList])for(let a of e[s.childrenList])r(a)}return i}});function GK(e,a){let t=!0;return e&&(t=e instanceof Array&&e.length>0?a.some(a=>e.includes(a)):a.some(a=>a===e)),t}var YK={mounted(e,a){const{value:t}=a,l=P.getItem("permissionList")||[],s=GK(t,l);if(s)e.setAttribute("code",t);else{e.disabled=!0,e.style.opacity="0.5",e.style.cursor="not-allowed",e.style.pointerEvents="none",e.classList.add("no-permission");const a=document.createElement("div");a.style.position="relative",a.style.display="inline-block",e.parentNode&&(e.parentNode.insertBefore(a,e),a.appendChild(e)),a.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),J.nk.warning("您没有该操作权限，请联系管理员")}),e.style.pointerEvents="auto"}}},JK={install(e){e.directive("authority",YK)}};const ZK=(0,i.Ef)(g);for(let eU in vc)ZK.component(eU,vc[eU]);ZK.config.globalProperties.$storage=P,ZK.config.globalProperties.$api=jK,ZK.config.globalProperties.$handleTree=QK,ZK.config.errorHandler=(e,a,t)=>{console.error("全局错误处理:",e,t),(e.message&&e.message.includes("TOKEN")||e.message&&e.message.includes("401"))&&console.log("检测到TOKEN过期错误，准备跳转登录页")},window.addEventListener("unhandledrejection",e=>{console.error("未处理的Promise错误:",e.reason),e.preventDefault()}),ZK.use(qK),ZK.use(BK),ZK.use(OK.A),ZK.use(QK),JK.install(ZK),ZK.mount("#app")}},a={};function t(l){var s=a[l];if(void 0!==s)return s.exports;var o=a[l]={id:l,loaded:!1,exports:{}};return e[l].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}t.m=e,function(){var e=[];t.O=function(a,l,s,o){if(!l){var n=1/0;for(c=0;c<e.length;c++){l=e[c][0],s=e[c][1],o=e[c][2];for(var i=!0,r=0;r<l.length;r++)(!1&o||n>=o)&&Object.keys(t.O).every(function(e){return t.O[e](l[r])})?l.splice(r--,1):(i=!1,o<n&&(n=o));if(i){e.splice(c--,1);var d=s();void 0!==d&&(a=d)}}return a}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[l,s,o]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){t.p="/"}(),function(){var e={524:0};t.O.j=function(a){return 0===e[a]};var a=function(a,l){var s,o,n=l[0],i=l[1],r=l[2],d=0;if(n.some(function(a){return 0!==e[a]})){for(s in i)t.o(i,s)&&(t.m[s]=i[s]);if(r)var c=r(t)}for(a&&a(l);d<n.length;d++)o=n[d],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(c)},l=self["webpackChunkgin_web"]=self["webpackChunkgin_web"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))}();var l=t.O(void 0,[504],function(){return t(9775)});l=t.O(l)})();